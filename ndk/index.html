<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>安卓NDK开发 | 凡墙总是门</title><meta name="keywords" content="so,ndk"><meta name="author" content="Kevin"><meta name="copyright" content="Kevin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="参考: https:&#x2F;&#x2F;developer.android.com&#x2F;ndk&#x2F;guides JNI 简述 JNI: Java Native Interface 的缩写, 通常翻译为 Java 本地接口; 从 Java1.1 开始, Java Native Interface 标准成为了 Java 平台的一部分, 它允许了 Java 代码和其他语言的代码进行交互; JNI 一开始是为了本地已编译的语言">
<meta property="og:type" content="article">
<meta property="og:title" content="安卓NDK开发">
<meta property="og:url" content="http://example.com/ndk/index.html">
<meta property="og:site_name" content="凡墙总是门">
<meta property="og:description" content="参考: https:&#x2F;&#x2F;developer.android.com&#x2F;ndk&#x2F;guides JNI 简述 JNI: Java Native Interface 的缩写, 通常翻译为 Java 本地接口; 从 Java1.1 开始, Java Native Interface 标准成为了 Java 平台的一部分, 它允许了 Java 代码和其他语言的代码进行交互; JNI 一开始是为了本地已编译的语言">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-02-25-094138.jpg">
<meta property="article:published_time" content="2021-03-22T11:29:21.000Z">
<meta property="article:modified_time" content="2021-07-29T02:18:01.138Z">
<meta property="article:author" content="Kevin">
<meta property="article:tag" content="so">
<meta property="article:tag" content="ndk">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-02-25-094138.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/ndk/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><meta name="baidu-site-verification" content="T0kgJCNqdP"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-07-29 10:18:01'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-02-25-094138.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">凡墙总是门</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">安卓NDK开发</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-03-22T11:29:21.000Z" title="发表于 2021-03-22 19:29:21">2021-03-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-07-29T02:18:01.138Z" title="更新于 2021-07-29 10:18:01">2021-07-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/so/">so</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>参考: <a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides">https://developer.android.com/ndk/guides</a></p>
<h1 id="JNI-简述"><a href="#JNI-简述" class="headerlink" title="JNI 简述"></a>JNI 简述</h1><ul>
<li>JNI: Java Native Interface 的缩写, 通常翻译为 Java 本地接口;</li>
<li>从 Java1.1 开始, Java Native Interface 标准成为了 Java 平台的一部分, 它允许了 Java 代码和其他语言的代码进行交互; JNI 一开始是为了本地已编译的语言, 尤其是 C 和 C++设计的, 但是现在只要调用约定受支持的语言都可以使用;</li>
<li>JNI不是 Android 特有的, windowd, linux 等凡是有 JVM 的地方都支持 JNI; Android 的虚拟机 Dalvik/Art 都支持 JNI 标准; 通过 JNI, 就可以打通 Android 中 Java 世界和 Native 世界;</li>
</ul>
<h1 id="NDK-简述"><a href="#NDK-简述" class="headerlink" title="NDK 简述"></a>NDK 简述</h1><ul>
<li>NDK: Native Development Kit的缩写</li>
<li>NDK 是一系列工具的集合, 是一个开发套件, 帮助开发者快速开发以及调试 C/C++ 的动态库;</li>
<li>为了弥补 Java 容易被反编译的问题, 一些重要的逻辑和算法可以采用 C/C++ 甚至是汇编的形式编写, 再通过 NDK 的工具最终编译生成动态库, 再通过 JNI 来完成和 Dalvik/Art 虚拟机环境的 Java 代码的交互</li>
</ul>
<h1 id="ABI-和支持的指令集"><a href="#ABI-和支持的指令集" class="headerlink" title="ABI 和支持的指令集"></a>ABI 和支持的指令集</h1><p>使用 NDK 开发的 so 不再具有跨平台特性, 需要编译提供不同平台支持 ABI: Application Binary Interface</p>
<table>
<thead>
<tr>
<th>ABI</th>
<th>支持的指令集</th>
</tr>
</thead>
<tbody><tr>
<td>armeabi-v7a</td>
<td>armeabi, Thumb-2, VFPv3-D16</td>
</tr>
<tr>
<td>Arm64-v8a</td>
<td>AArch64</td>
</tr>
<tr>
<td>x86</td>
<td>x86, MMX, SSE/2/3, SSSE3</td>
</tr>
<tr>
<td>x86_64</td>
<td>x86, MMX, SSE/2/3, SSSE3, SSE4.1,SSE4.2,POPCNT</td>
</tr>
</tbody></table>
<h1 id="Java-反射"><a href="#Java-反射" class="headerlink" title="Java 反射"></a>Java 反射</h1><p>Java 反射定义:</p>
<ol>
<li>对于任意一个类, 都能够知道这个类的所有属性和方法</li>
<li>对于任意一个类的静态属性, 都能进行静态属性的获取和设置, 静态方法的调用</li>
<li>对于任意一个对象, 都能够进行对象的属性的获取和设置, 对象方法的调用</li>
</ol>
<h2 id="java-反射获取类"><a href="#java-反射获取类" class="headerlink" title="java 反射获取类"></a>java 反射获取类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 某个对象.class.getClassLoader().loadClass()</span></span><br><span class="line">Class TestClazz = MainActivity.class.getClassLoader().loadClass(<span class="string">&quot;com.kevin.reflection.Test&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Class.forName()</span></span><br><span class="line">Class TestClazz1 = Class.forName(<span class="string">&quot;com.kevin.reflection.Test&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="java-反射获取构造方法"><a href="#java-反射获取构造方法" class="headerlink" title="java 反射获取构造方法"></a>java 反射获取构造方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Class TestClazz = Class.forName(<span class="string">&quot;com.kevin.reflection.Test&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 获取无参构造方法</span></span><br><span class="line">Constructor constructor = TestClazz.getConstructor(<span class="keyword">null</span>);</span><br><span class="line">Test obj = (Test) constructor.newInstance();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 获取指定参数为 String 的构造方法</span></span><br><span class="line">Constructor constructor1 = TestClazz.getConstructor(String.class);</span><br><span class="line">Test obj1 = (Test) constructor1.newInstance(<span class="string">&quot;测试字符串&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 获取私有的构造方法</span></span><br><span class="line">Constructor constructor2 = TestClazz.getDeclaredConstructor(<span class="keyword">char</span>.class);</span><br><span class="line"><span class="comment">// 暴力反射, 忽略所有访问修饰符</span></span><br><span class="line">constructor2.setAccessible(<span class="keyword">true</span>); </span><br><span class="line">Test obj2 = (Test) constructor2.newInstance(<span class="string">&#x27;a&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="java-反射获取静态属性"><a href="#java-反射获取静态属性" class="headerlink" title="java 反射获取静态属性"></a>java 反射获取静态属性</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 public static 静态属性</span></span><br><span class="line">Class TestClazz = Class.forName(<span class="string">&quot;com.kevin.reflection.Test&quot;</span>);</span><br><span class="line">Field publicStaticField = TestClazz.getDeclaredField(<span class="string">&quot;publicStaticField&quot;</span>);</span><br><span class="line">String publicStaticFieldValue = publicStaticField.get(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 private static 静态属性</span></span><br><span class="line">Class TestClazz = Class.forName(<span class="string">&quot;com.kevin.reflection.Test&quot;</span>);</span><br><span class="line">Field privateStaticField = TestClazz.getDecalredField(<span class="string">&quot;privateStaticField&quot;</span>);</span><br><span class="line">privateStaticField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">String privateStaticFieldValue = privateStaticField.get(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>

<h2 id="java-反射获取动态属性"><a href="#java-反射获取动态属性" class="headerlink" title="java 反射获取动态属性"></a>java 反射获取动态属性</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 public 动态属性</span></span><br><span class="line">Class TestClazz = Class.forName(<span class="string">&quot;com.kevin.reflectiontest.Test&quot;</span>); </span><br><span class="line">Constructor constructor = TestClazz.getConstructor();</span><br><span class="line">Test obj1 = (Test) constructor.newInstance();</span><br><span class="line">Field publicNonStaticField = TestClazz.getDeclaredField(<span class="string">&quot;publicNonStaticField&quot;</span>);</span><br><span class="line">String publicNoneStaticFieldValue = publicNonStaticField.get(obj1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 private 动态属性</span></span><br><span class="line">Class TestClazz = Class.forName(<span class="string">&quot;com.kevin.reflectiontest.Test&quot;</span>); </span><br><span class="line">Constructor constructor = TestClazz.getConstructor();</span><br><span class="line">Test obj1 = (Test) constructor.newInstance();</span><br><span class="line">Field privateNonStaticField = TestClazz.getDeclaredField(<span class="string">&quot;privateNonStaticField&quot;</span>);</span><br><span class="line">privateNoneStaticField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">String privateNonStaticFieldValue = privateNonStaticField.get(obj1);</span><br></pre></td></tr></table></figure>

<h2 id="java-反射获取并调用方法"><a href="#java-反射获取并调用方法" class="headerlink" title="java 反射获取并调用方法"></a>java 反射获取并调用方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取并调用非静态方法</span></span><br><span class="line">Class TestClazz = Class.forName(<span class="string">&quot;com.kevin.reflectiontest.Test&quot;</span>);</span><br><span class="line">Constructor constructor = TestClazz.getConstructor();</span><br><span class="line">Test obj = (Test) constructor.newInstance();</span><br><span class="line">Method method = TestClazz.getDeclaredMethod(<span class="string">&quot;privateNonStaticFunc&quot;</span>, String.class);</span><br><span class="line">method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">method.invoke(obj, <span class="string">&quot;string as arg&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取并调用静态方法</span></span><br><span class="line">Class TestClazz = Class.forName(<span class="string">&quot;com.kevin.reflectiontest.Test&quot;</span>);</span><br><span class="line">Method method = TestClazz.getDeclaredMethod(<span class="string">&quot;privateStaticFunc&quot;</span>);</span><br><span class="line">method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">method.invoke(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>

<h2 id="java-反射案例"><a href="#java-反射案例" class="headerlink" title="java 反射案例"></a>java 反射案例</h2><p>自定义类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kevin.reflectiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;kevinTest&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String flag = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String publicStaticField = <span class="string">&quot;i am a public static field&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> String publicNonStaticField = <span class="string">&quot;i am a public non static field&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String privateStaticField = <span class="string">&quot;i am a private static field&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String privateNonStaticField = <span class="string">&quot;i am a private non static field&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        flag = <span class="string">&quot;Test()&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String arg)</span></span>&#123;</span><br><span class="line">        flag = <span class="string">&quot;Test(String arg)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String arg, <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        flag = <span class="string">&quot;Test(String arg, int num)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">publicStaticFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;public Static Func: &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publicNonStaticFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;public Non Static Func: &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">privateStaticFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;private Static Func: &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">privateNonStaticFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;private Non Static Func: &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">privateNonStaticFunc</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;private Non Static Func: arg is String : &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反射代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kevin.reflectiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.annotation.RequiresApi;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;kevinTest MainActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Used to load the &#x27;native-lib&#x27; library on application startup.</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;native-lib&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequiresApi(api = Build.VERSION_CODES.KITKAT)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Example of a call to a native method</span></span><br><span class="line">        TextView tv = findViewById(R.id.sample_text);</span><br><span class="line">        tv.setText(stringFromJNI());</span><br><span class="line"></span><br><span class="line">        test();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// reflection</span></span><br><span class="line">    <span class="meta">@RequiresApi(api = Build.VERSION_CODES.KITKAT)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// get class</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="comment">// 通过 class.getClassLoader().loadClass()加载</span></span><br><span class="line">            Class TestClazz = MainActivity.class.getClassLoader().loadClass(<span class="string">&quot;com.kevin.reflectiontest.Test&quot;</span>);</span><br><span class="line">						<span class="comment">// 使用 Class.forname()显示加载</span></span><br><span class="line">            Class TestClazz1 = Class.forName(<span class="string">&quot;com.kevin.reflectiontest.Test&quot;</span>); </span><br><span class="line">						<span class="comment">// 在同一个 classloader 中, 可以直接获取</span></span><br><span class="line">            Class TestCLazz2 = Test.class; </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// constructor filed method</span></span><br><span class="line">        Class TestClazz = Test.class;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取重载的构造函数 并 创建实例</span></span><br><span class="line">            Constructor constructor = TestClazz.getConstructor();</span><br><span class="line">            Test obj1 = (Test) constructor.newInstance();</span><br><span class="line">            Constructor constructor1 = TestClazz.getConstructor(String.class);</span><br><span class="line">            Test obj2 = (Test) constructor1.newInstance(<span class="string">&quot;String arg&quot;</span>);</span><br><span class="line"></span><br><span class="line">            Constructor constructor2 = TestClazz.getConstructor(String.class, <span class="keyword">int</span>.class);</span><br><span class="line">            Test obj3 = (Test) constructor2.newInstance(<span class="string">&quot;String arg&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">            Constructor[] constructors= TestClazz.getDeclaredConstructors();</span><br><span class="line">            <span class="keyword">for</span> (Constructor each : constructors) &#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;test: getDeclaredConstructors :&quot;</span> + each);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// get public static filed</span></span><br><span class="line">            Field publicStaticField = TestClazz.getDeclaredField(<span class="string">&quot;publicStaticField&quot;</span>);</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;test: getDecalredField() publicStaticFiled is &quot;</span> + publicStaticField);</span><br><span class="line">            <span class="comment">// use Field to get static field value</span></span><br><span class="line">            String publicStaticFieldValue = (String) publicStaticField.get(<span class="keyword">null</span>);</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;test: publicStaticFieldValue is &quot;</span> + publicStaticFieldValue);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// get private static field</span></span><br><span class="line">            Field privateStaticField = TestClazz.getDeclaredField(<span class="string">&quot;privateStaticField&quot;</span>);</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;test: getDecalredField() privateStaticField is &quot;</span> + privateStaticField);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// get value from private static filed</span></span><br><span class="line">            privateStaticField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            String privateStaticFieldValue = (String) privateStaticField.get(<span class="keyword">null</span>);</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;test: get private static field value is:&quot;</span> + privateStaticFieldValue);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// get public non static value from obj</span></span><br><span class="line">            Field privateNonStaticField = TestClazz.getDeclaredField(<span class="string">&quot;privateNonStaticField&quot;</span>);</span><br><span class="line">            privateNonStaticField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            String privateNonStaticFieldValue = (String) privateNonStaticField.get(obj1);</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;test: get private non static field value is :&quot;</span> + privateNonStaticFieldValue);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// get public filed from obj</span></span><br><span class="line">            Field flag = TestClazz.getDeclaredField(<span class="string">&quot;flag&quot;</span>);</span><br><span class="line">            String value = (String) flag.get(obj1);</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;test: flag value is :&quot;</span> + value);</span><br><span class="line"></span><br><span class="line">            String value1 = (String) flag.get(obj2);</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;test: flag1 value is :&quot;</span> + value1);</span><br><span class="line"></span><br><span class="line">            String value2 = (String) flag.get(obj3);</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;test: flag2 value is :&quot;</span> + value2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// get fields use getDecalredFields() 可以获取所有属性 包含 public 和 private</span></span><br><span class="line">            Field[] fields = TestClazz.getDeclaredFields();</span><br><span class="line">            <span class="keyword">for</span> (Field each : fields)&#123;</span><br><span class="line">                Log.d(TAG, <span class="string">&quot;onCreate: getDecalredFields() is :&quot;</span> + each);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// get fields use getFields() 只能获取 public 属性</span></span><br><span class="line">            Field[] fields1 = TestClazz.getFields();</span><br><span class="line">            <span class="keyword">for</span> (Field each : fields1) &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">&quot;onCreate: getFields() is :&quot;</span> + each);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// get method</span></span><br><span class="line">            <span class="comment">// get methods</span></span><br><span class="line">            Method[] methods = TestClazz.getMethods();</span><br><span class="line">            <span class="keyword">for</span> (Method each : methods) &#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;test: getMethods() is &quot;</span> + each);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Method[] methods1 = TestClazz.getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span> (Method each : methods1) &#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;test: getDecalredMethods() is &quot;</span> + each);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// getDecalredMethod() // invoke non static method</span></span><br><span class="line">            Method method = TestClazz.getDeclaredMethod(<span class="string">&quot;privateNonStaticFunc&quot;</span>, String.class);</span><br><span class="line">            method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            method.invoke(obj1, <span class="string">&quot;string as arg&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// invoke static method</span></span><br><span class="line">            Method method1 = TestClazz.getDeclaredMethod(<span class="string">&quot;privateStaticFunc&quot;</span>);</span><br><span class="line">            method1.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            method1.invoke(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException | IllegalAccessException | InstantiationException | NoSuchMethodException | InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="Native-方法的标识"><a href="#Native-方法的标识" class="headerlink" title="Native 方法的标识"></a>Native 方法的标识</h1><ul>
<li>Native 方法在代码中含有 <code>native</code> 关键字修饰</li>
<li>Native 方法在 Java 中会有静态代码块, 使用了 <code>System.loadLibrary</code> 加载一个 <code>native-lib</code> 的 so 文件</li>
</ul>
<h1 id="Jni-函数定义和参数解析"><a href="#Jni-函数定义和参数解析" class="headerlink" title="Jni 函数定义和参数解析"></a>Jni 函数定义和参数解析</h1><ol>
<li><p><code>JNIEXPORT</code>: 是一个宏, 等价于<code>_ _attribute_ _((visibility (&quot;default&quot;)))</code> , 表示当前函数符号需要导出, 与之对应为<code>hidden</code>隐藏符号信息;</p>
</li>
<li><p><code>extern &quot;C&quot;</code>: 按照 C 函数进行编译, 不使用 <code>name mangling</code>; 因为 C++支持重载, C++类中的函数会使用<code>name mangling</code></p>
<ol>
<li>未使用 <code>extern &quot;C&quot;</code>, <code>add</code> 方法被导出为 <code>_Z3addii</code>; 还原 <code>name mangling</code>可以使用命令: <code>c++flit -n _Z3addii</code> 进行还原;</li>
<li>使用了<code>extern &quot;C&quot;</code>, <code>add1</code> 方法被导出为 <code>add1</code>;</li>
</ol>
</li>
<li><p><code>JNICALL</code> : 空宏, 目前无实际意义可以删除;</p>
</li>
<li><p><code>JNI</code>函数的参数:</p>
<ol>
<li><code>JNIEnv* env</code> : 一个<code>JNIEnv</code>类型的指针, 所有<code>JNI</code>函数的第一个参数都是<code>env</code>;</li>
<li><code>jclass</code> or <code>jobject</code>: 当方法为 <code>static</code>时, 第二个参数为 <code>jclass</code> , 当方法为非<code>static</code>时, 第二个参数为 <code>jobject</code>;</li>
<li>从第三个参数开始, 才是该函数真正的参数;</li>
</ol>
</li>
<li><p>静态注册的<code>JNI</code>方法命名遵循格式为: <code>Java_包名_类名_方法名</code> , 以<code>Java</code>开头, 用<code>_</code>进行分割</p>
</li>
</ol>
<h1 id="Native-打印-log-日志"><a href="#Native-打印-log-日志" class="headerlink" title="Native 打印 log 日志"></a>Native 打印 log 日志</h1><ol>
<li>在 C++代码中引入头文件; <code>#include &lt;android/log.h&gt;</code></li>
<li><code>__android_log_print(ANDROID_LOG_INFO, &quot;kevinTest&quot;, &quot;result is %d&quot;, result);</code></li>
</ol>
<h1 id="C-中导入其他-C文件"><a href="#C-中导入其他-C文件" class="headerlink" title="C++ 中导入其他 C文件"></a>C++ 中导入其他 C文件</h1><ol>
<li><p>在 cpp 目录下创建头文件<code>testc.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> NDKDEMO01_TESTC_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NDKDEMO01_TESTC_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">//NDKDEMO01_TESTC_H</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add_c</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li><p>在 cpp 目录下创建<code>testc.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;testc.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add_c</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a +b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在 cpp 目录下的 <code>CMakeLists.txt</code> 中的 <code>add_library</code> 添加 <code>testc.c</code></p>
</li>
<li><p>在<code>native-lib.cpp</code> 文件中就可以直接使用导入的方法了</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;testc.h&quot;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL <span class="title">Java_com_kevin_ndkdemo01_MainActivity_myStaticJni</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    JNIEnv* env,</span></span></span><br><span class="line"><span class="function"><span class="params">    jclass)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> result = add_c(<span class="number">4</span>, <span class="number">6</span>);</span><br><span class="line">__android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;result is %d&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="JNI-和-Java-和-C-C-基础数据类型映射"><a href="#JNI-和-Java-和-C-C-基础数据类型映射" class="headerlink" title="JNI 和 Java 和 C/C++ 基础数据类型映射"></a>JNI 和 Java 和 C/C++ 基础数据类型映射</h1><h2 id="基础数据类型"><a href="#基础数据类型" class="headerlink" title="基础数据类型"></a>基础数据类型</h2><table>
<thead>
<tr>
<th>Java</th>
<th>C/C++</th>
<th>JNI</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>int</td>
<td>long</td>
<td>jint</td>
<td>signed 32bit</td>
</tr>
<tr>
<td>long</td>
<td>_int64</td>
<td>jlong</td>
<td>signed 64 bit</td>
</tr>
<tr>
<td>byte</td>
<td>signed char</td>
<td>jbyte</td>
<td>signed 8bit</td>
</tr>
<tr>
<td>boolean</td>
<td>unsigned char</td>
<td>jboolean</td>
<td>unsigned 8bit</td>
</tr>
<tr>
<td>char</td>
<td>unsigned short</td>
<td>jchar</td>
<td>unsigned 16bit</td>
</tr>
<tr>
<td>short</td>
<td>short</td>
<td>jshort</td>
<td>signed 16bit</td>
</tr>
<tr>
<td>float</td>
<td>float</td>
<td>jfloat</td>
<td>32 bit</td>
</tr>
<tr>
<td>double</td>
<td>double</td>
<td>jdouble</td>
<td>64 bit</td>
</tr>
<tr>
<td>void</td>
<td>void</td>
<td>void</td>
<td>N/A</td>
</tr>
</tbody></table>
<h2 id="引用数据类型"><a href="#引用数据类型" class="headerlink" title="引用数据类型"></a>引用数据类型</h2><table>
<thead>
<tr>
<th>Java</th>
<th>JNI</th>
</tr>
</thead>
<tbody><tr>
<td>java.lang.Object</td>
<td>jobject</td>
</tr>
<tr>
<td>java.lang.Class</td>
<td>jclass</td>
</tr>
<tr>
<td>java.lang.reflect.Field</td>
<td>jfieldID</td>
</tr>
<tr>
<td>java.lang.reflect.Method</td>
<td>jmethodID</td>
</tr>
<tr>
<td>java.lang.String</td>
<td>jstring</td>
</tr>
<tr>
<td>java.lang.Throwable</td>
<td>jthrowable</td>
</tr>
</tbody></table>
<h2 id="数组类型"><a href="#数组类型" class="headerlink" title="数组类型"></a>数组类型</h2><table>
<thead>
<tr>
<th>Java</th>
<th>JNI</th>
</tr>
</thead>
<tbody><tr>
<td>int[]</td>
<td>jintArray</td>
</tr>
<tr>
<td>byte[]</td>
<td>jbyteArray</td>
</tr>
<tr>
<td>short[]</td>
<td>jshortArray</td>
</tr>
<tr>
<td>long[]</td>
<td>jlongArray</td>
</tr>
<tr>
<td>float[]</td>
<td>jfloatArray</td>
</tr>
<tr>
<td>double[]</td>
<td>jdoubleArray</td>
</tr>
<tr>
<td>char[]</td>
<td>jcharArray</td>
</tr>
<tr>
<td>boolean[]</td>
<td>jbooleanArray</td>
</tr>
<tr>
<td>Object[] 引用类型的数组</td>
<td>jobjectArray</td>
</tr>
</tbody></table>
<h2 id="访问-String-对象"><a href="#访问-String-对象" class="headerlink" title="访问 String 对象"></a>访问 String 对象</h2><p>从 <code>java</code> 中传入的 <code>String</code> 对象在本地方法中对应的是 <code>jstring</code> 类型, <code>jstring</code>类型和 c 中的 char* 不同, 无法直接使用;</p>
<p>常用的方法:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 String 对象</span></span><br><span class="line">jstring NewString(const jchar* unicodeChars, jsize len): 创建一个 Unicode 格式的 String 对象</span><br><span class="line">jstring NewStringUTF(const char* bytes): 创建一个 UTF-8 格式的 String 对象</span><br><span class="line"></span><br><span class="line"><span class="comment">// String 对象转 char*</span></span><br><span class="line">const jchar* GetStringChars(jstring string, jboolean* isCopy): 将 string 对象转换成 Unicode 格式的 char* </span><br><span class="line">const char* GetStringUTFChars(jstring string, jboolean* isCopy): 将 string 对象转换成 UTF-8 类型</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放 char* 指针</span></span><br><span class="line">void ReleaseStringChars(jstring string, const jchar* chars) : 释放指向 Unicode 格式的 char* 指针</span><br><span class="line">void ReleaseStringUTFChars(jstring string, const char* utf): 释放指向 UTF-8 格式的 char*指针</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 string 长度</span></span><br><span class="line">jsize GetStringUTFLength(jstring string): 获取 string 对应 UTF-8 的 char*长度</span><br><span class="line">jsize GetStringLength(jstring string): 获取 string 对应 Unicode 格式的 char* 长度</span><br></pre></td></tr></table></figure>

<p>代码示例:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 java 的 string 类型转为 native 的 char* 互转</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kevin_ndkdemo01_MainActivity_getStringToChar(JNIEnv *env, jobject, jstring inputStr)&#123;</span><br><span class="line">    <span class="comment">// string 转 char*</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* nativeChar = (env-&gt;GetStringUTFChars(inputStr, <span class="literal">nullptr</span>));</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;string from java is %s&quot;</span>, nativeChar);</span><br><span class="line">    env-&gt;ReleaseStringUTFChars(inputStr, nativeChar);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// char* 转 string</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *fromNativeChar = <span class="string">&quot;char* from native&quot;</span>;</span><br><span class="line">    jstring result = env-&gt;NewStringUTF(fromNativeChar);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>env.GetStringUTFChars(jstring string, jboolean* isCopy)</code> 将传入的 jstring 转换成 UTF-8 的格式, 这样就可以在 C/C++中使用了</li>
<li><code>env.ReleaseStringUTFChars(jstring string, const char* utf)</code> 在使用完你所转换之后的对象之后，需要显示调用ReleaseStringUTFChars方法，让JVM释放转换成UTF-8的string的对象的空间，如果不显示的调用的话，JVM中会一直保存该对象，不会被垃圾回收器回收，因此就会导致内存溢出</li>
</ul>
<h2 id="访问-Array-对象"><a href="#访问-Array-对象" class="headerlink" title="访问 Array 对象"></a>访问 Array 对象</h2><p>和 String 对象一样, 在 c/c++中不能直接访问 jarray 对象, 需要使用 JNIEnv 指针指向的一些方法进行转换;</p>
<p>常用方法:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取数组长度</span></span><br><span class="line">jsize GetArrayLength(jarray array) : 获取数组的长度</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取数组对应的指针</span></span><br><span class="line">jboolean* GetBooleanArrayElements(jbooleanArray array, jboolean* isCopy): 获取 boolean 数组指针</span><br><span class="line"></span><br><span class="line">jbyte* GetByteArrayElements(jbyteArray array, jboolean* isCopy): 获取 byte 数组指针</span><br><span class="line"></span><br><span class="line">jchar* GetCharArrayElements(jcharArray array, jboolean* isCopy): 获取 char 数组指针</span><br><span class="line"></span><br><span class="line">jshort* GetShortArrayElements(jshortArray array, jboolean* isCopy): 获取 short 数组指针</span><br><span class="line"></span><br><span class="line">jint* GetIntArrayElements(jintArray array, jboolean* isCopy): 获取 int 数组指针</span><br><span class="line"></span><br><span class="line">jlong* GetLongArrayElements(jlongArray array, jboolean* isCopy): 获取 long 数组指针</span><br><span class="line"></span><br><span class="line">jfloat* GetFloatArrayElements(jfloatArray array, jboolean* isCopy): 获取 float 数组指针</span><br><span class="line"></span><br><span class="line">jdouble* GetDoubleArrayElements(jdoubleArray array, jboolean* isCopy): 获取 double 数组指针</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历数组</span></span><br><span class="line">jint sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">    sum += arrayptr[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放数组指针</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReleaseBooleanArrayElements</span><span class="params">(jbooleanArray <span class="built_in">array</span>, jboolean* elems,</span></span></span><br><span class="line">    jint mode):  释放 boolean 数组指针</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReleaseByteArrayElements</span><span class="params">(jbyteArray <span class="built_in">array</span>, jbyte* elems,</span></span></span><br><span class="line">    jint mode): 释放 byte 数组指针</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReleaseCharArrayElements</span><span class="params">(jcharArray <span class="built_in">array</span>, jchar* elems,</span></span></span><br><span class="line">    jint mode): 释放 char 数组指针</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReleaseShortArrayElements</span><span class="params">(jshortArray <span class="built_in">array</span>, jshort* elems,</span></span></span><br><span class="line">    jint mode): 释放 short 数组指针</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReleaseIntArrayElements</span><span class="params">(jintArray <span class="built_in">array</span>, jint* elems,</span></span></span><br><span class="line">    jint mode): 释放 int 数组指针</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReleaseLongArrayElements</span><span class="params">(jlongArray <span class="built_in">array</span>, jlong* elems,</span></span></span><br><span class="line">    jint mode): 释放 long 数组指针</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReleaseFloatArrayElements</span><span class="params">(jfloatArray <span class="built_in">array</span>, jfloat* elems,</span></span></span><br><span class="line">    jint mode): 释放 float 数组指针</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReleaseDoubleArrayElements</span><span class="params">(jdoubleArray <span class="built_in">array</span>, jdouble* elems,</span></span></span><br><span class="line">    jint mode): 释放 double 数组指针</span><br></pre></td></tr></table></figure>

<p>代码示例:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// native 使用 java 的 bytes array</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_ndkdemo01_MainActivity_getByteArray(JNIEnv *env, jobject, jintArray inputIntArray)&#123;</span><br><span class="line">    <span class="comment">// 获取数组长度</span></span><br><span class="line">    jint length = env-&gt;GetArrayLength(inputIntArray);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;native 数组长度为 %d&quot;</span>, length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取数组元素的指针</span></span><br><span class="line">    jint* arrayptr = env-&gt;GetIntArrayElements(inputIntArray, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据指针和索引获取数组中的对应值</span></span><br><span class="line">    jint sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">        sum += arrayptr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;native sum is: %d&quot;</span>, sum);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 释放数组指针</span></span><br><span class="line">    env-&gt;ReleaseIntArrayElements(inputIntArray, arrayptr, <span class="number">0</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="访问自定义-Java-对象数组"><a href="#访问自定义-Java-对象数组" class="headerlink" title="访问自定义 Java 对象数组"></a>访问自定义 Java 对象数组</h2><p>JNI 提供了两个单独的方法来访问对象数组的元素, 通过这两个方法可以获取和设置单个对象数组的元素;<br>JNI 无法一次获取到对象数组的所有元素</p>
<p>常用方法:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jobject GetObjectArrayElement(jobjectArray array, jsize index): 获取 java 对象数组中指定索引位置的值</span><br><span class="line"></span><br><span class="line">void SetObjectArrayElement(jobjectArray array, jsize index, jobject value): 设置 java 对象数组中指定索引位置的值</span><br></pre></td></tr></table></figure>

<p>代码示例:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// native 使用 java 的 对象数组</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_ndkdemo01_MainActivity_getStringArray(JNIEnv *env, jobject, jobjectArray inputStringArray)&#123;</span><br><span class="line">    jstring str1 = (jstring) env-&gt;GetObjectArrayElement(inputStringArray, <span class="number">0</span>);</span><br><span class="line">    jstring str2 = (jstring) env-&gt;GetObjectArrayElement(inputStringArray, <span class="number">1</span>);</span><br><span class="line">    jstring str3 = (jstring) env-&gt;GetObjectArrayElement(inputStringArray, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *char1 = env-&gt;GetStringUTFChars(str1, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *char2 = env-&gt;GetStringUTFChars(str2, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *char3 = env-&gt;GetStringUTFChars(str3, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;native inputStringArray is : %s %s %s&quot;</span>,</span><br><span class="line">                        char1, char2, char3);</span><br><span class="line"></span><br><span class="line">    env-&gt;ReleaseStringUTFChars(str1, char1);</span><br><span class="line">    env-&gt;ReleaseStringUTFChars(str2, char2);</span><br><span class="line">    env-&gt;ReleaseStringUTFChars(str3, char3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="描述符"><a href="#描述符" class="headerlink" title="描述符"></a>描述符</h1><h2 id="类描述符"><a href="#类描述符" class="headerlink" title="类描述符"></a>类描述符</h2><ul>
<li>类描述符是类的完整名称(包名+类名), 在 jni 中, 需要将原来的<code>.</code> 分隔符替换成 <code>/</code> 分隔符;</li>
<li>类描述符常用于 <code>env.FindClass()</code>, 获取 <code>jclass</code> 的时候使用</li>
</ul>
<h2 id="域描述符"><a href="#域描述符" class="headerlink" title="域描述符"></a>域描述符</h2><h3 id="基本数据类型域描述符"><a href="#基本数据类型域描述符" class="headerlink" title="基本数据类型域描述符"></a>基本数据类型域描述符</h3><table>
<thead>
<tr>
<th>域描述符</th>
<th>java 基础数据类型</th>
</tr>
</thead>
<tbody><tr>
<td>Z</td>
<td>boolean</td>
</tr>
<tr>
<td>B</td>
<td>byte</td>
</tr>
<tr>
<td>C</td>
<td>char</td>
</tr>
<tr>
<td>S</td>
<td>short</td>
</tr>
<tr>
<td>I</td>
<td>int</td>
</tr>
<tr>
<td>J</td>
<td>long</td>
</tr>
<tr>
<td>F</td>
<td>float</td>
</tr>
<tr>
<td>D</td>
<td>double</td>
</tr>
<tr>
<td>V</td>
<td>void</td>
</tr>
</tbody></table>
<h3 id="引用数据类型域描述符"><a href="#引用数据类型域描述符" class="headerlink" title="引用数据类型域描述符"></a>引用数据类型域描述符</h3><p>格式为: <code>L + 该类型的类描述符 + ;</code><br>String 类型的域描述符: <code>&quot;Ljava/lang/String;&quot;</code><br>Object 类型的域描述符: <code>&quot;Ljava/lang/Object;&quot;</code></p>
<h2 id="函数描述符"><a href="#函数描述符" class="headerlink" title="函数描述符"></a>函数描述符</h2><p>格式为: <code>(参数的域描述符叠加)返回值的域描述符</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String test()&#96; 函数描述符为: &#96;&quot;Ljava&#x2F;lang&#x2F;String&quot;&#96;</span><br><span class="line">&#96;int f(int i, Object object)&#96; 函数描述符为: &#96;&quot;(ILjava&#x2F;lang&#x2F;Object;)I&quot;&#96;</span><br><span class="line">&#96;void set(byte[] bytes)&#96; : 函数描述符为: &#96;&quot;([B)V&quot;</span><br></pre></td></tr></table></figure>



<h2 id="数组描述符"><a href="#数组描述符" class="headerlink" title="数组描述符"></a>数组描述符</h2><p>格式为: <code>[ + 其他类型的域描述符</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int[]&#96; 描述符为: &#96;[I&#96;</span><br><span class="line">&#96;float[]&#96; 描述符为: &#96;[F&#96;</span><br><span class="line">&#96;String[]&#96; 描述符为: &#96;[Ljava&#x2F;lang&#x2F;String;</span><br></pre></td></tr></table></figure>

<p>多维数组类型的描述符格式为: <code>n 个 [ + 该类型的域描述符</code><br><code>int[][]</code> 描述符为: <code>[[I</code><br><code>float[][]</code> 描述符为: <code>[[F</code></p>
<h1 id="JNI-获取-Java-层"><a href="#JNI-获取-Java-层" class="headerlink" title="JNI 获取 Java 层"></a>JNI 获取 Java 层</h1><h2 id="JNI-获取-Java-类"><a href="#JNI-获取-Java-类" class="headerlink" title="JNI 获取 Java 类"></a>JNI 获取 Java 类</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jnienv 获取 java 类</span></span><br><span class="line">jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/ndkdemo01/Test&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// jnienv 通过 java 层传入的对象获取该对象的类</span></span><br><span class="line">jclass TestClass = env-&gt;GetObjectClass(obj); <span class="comment">// obj 为 java 层传入的 Test 对象</span></span><br></pre></td></tr></table></figure>

<p><code>env.FindClass()</code> 传入的参数为: 对应的 java 类的路径, java 中用<code>.</code> 分割, <code>jni</code> 中使用 <code>/</code> 分割; <code>com/kevin/ndkdemo01/Test</code> 是类描述符, 常在 jni 层查找 java 层对应的类时使用;</p>
<h2 id="JNI-获取-Java-层属性"><a href="#JNI-获取-Java-层属性" class="headerlink" title="JNI 获取 Java 层属性"></a>JNI 获取 Java 层属性</h2><p>获取 java 层属性常用 API</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取静态属性的 FieldID</span></span><br><span class="line"><span class="function">jfieldID <span class="title">GetStaticFieldID</span><span class="params">(jclass clazz, <span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">const</span> <span class="keyword">char</span>* sig)</span></span></span><br><span class="line"><span class="function"><span class="comment">// clazz : 对应的 jclass</span></span></span><br><span class="line"><span class="function"><span class="comment">// name: 该属性名称</span></span></span><br><span class="line"><span class="function"><span class="comment">// sig: 该属性的域描述符</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 获取非静态属性的 FieldID</span></span></span><br><span class="line"><span class="function">jfieldID <span class="title">GetFieldID</span><span class="params">(jclass clazz, <span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">const</span> <span class="keyword">char</span>* sig)</span></span></span><br><span class="line"><span class="function"><span class="comment">// clazz: 对应的 jclass </span></span></span><br><span class="line"><span class="function"><span class="comment">// name: 该属性的名称</span></span></span><br><span class="line"><span class="function"><span class="comment">// sig: 该属性的域描述符</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 获取非静态属性对应的值</span></span></span><br><span class="line"><span class="function">jobject <span class="title">GetObjectField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jboolean <span class="title">GetBooleanField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jbyte <span class="title">GetByteField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jchar <span class="title">GetCharField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jshort <span class="title">GetShortField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jint <span class="title">GetIntField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jlong <span class="title">GetLongField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jfloat <span class="title">GetFloatField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jdouble <span class="title">GetDoubleField</span><span class="params">(jobject obj, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 获取类的静态属性对应的值</span></span></span><br><span class="line"><span class="function">jobject <span class="title">GetStaticObjectField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jboolean <span class="title">GetStaticBooleanField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jbyte <span class="title">GetStaticByteField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jchar <span class="title">GetStaticCharField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jshort <span class="title">GetStaticShortField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jint <span class="title">GetStaticIntField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jlong <span class="title">GetStaticLongField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jfloat <span class="title">GetStaticFloatField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function">jdouble <span class="title">GetStaticDoubleField</span><span class="params">(jclass clazz, jfieldID fieldID)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 设置非静态属性对应的值</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetObjectField</span><span class="params">(jobject obj, jfieldID fieldID, jobject value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetBooleanField</span><span class="params">(jobject obj, jfieldID fieldID, jboolean value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetByteField</span><span class="params">(jobject obj, jfieldID fieldID, jbyte value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetCharField</span><span class="params">(jobject obj, jfieldID fieldID, jchar value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetShortField</span><span class="params">(jobject obj, jfieldID fieldID, jshort value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetIntField</span><span class="params">(jobject obj, jfieldID fieldID, jint value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetLongField</span><span class="params">(jobject obj, jfieldID fieldID, jlong value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetFloatField</span><span class="params">(jobject obj, jfieldID fieldID, jfloat value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetDoubleField</span><span class="params">(jobject obj, jfieldID fieldID, jdouble value)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 设置静态属性对应的值</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetStaticObjectField</span><span class="params">(jclass clazz, jfieldID fieldID, jobject value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetStaticBooleanField</span><span class="params">(jclass clazz, jfieldID fieldID, jboolean value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetStaticByteField</span><span class="params">(jclass clazz, jfieldID fieldID, jbyte value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetStaticCharField</span><span class="params">(jclass clazz, jfieldID fieldID, jchar value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetStaticShortField</span><span class="params">(jclass clazz, jfieldID fieldID, jshort value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetStaticIntField</span><span class="params">(jclass clazz, jfieldID fieldID, jint value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetStaticLongField</span><span class="params">(jclass clazz, jfieldID fieldID, jlong value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetStaticFloatField</span><span class="params">(jclass clazz, jfieldID fieldID, jfloat value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetStaticDoubleField</span><span class="params">(jclass clazz, jfieldID fieldID, jdouble value)</span></span></span><br></pre></td></tr></table></figure>

<p>JNI 获取类的静态属性</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_ndkdemo01_MainActivity_jniGetJava(JNIEnv *env, jobject) &#123;</span><br><span class="line">    <span class="comment">// jnienv 获取 java 类</span></span><br><span class="line">    jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/ndkdemo01/Test&quot;</span>);</span><br><span class="line">    <span class="comment">// jnienv 获取 java 类的静态属性</span></span><br><span class="line">    jfieldID publicStaticField_filedid = env-&gt;GetStaticFieldID(TestClass, <span class="string">&quot;publicStaticField&quot;</span>, <span class="string">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class="line">    jstring publicStaticFiled_value = (jstring)env-&gt;GetStaticObjectField(TestClass, publicStaticField_filedid);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* native_publicStaticFiled_value = env-&gt;GetStringUTFChars(publicStaticFiled_value, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;native publicStaticFiled value is %s&quot;</span>,</span><br><span class="line">                        native_publicStaticFiled_value);</span><br><span class="line">    env-&gt;ReleaseStringUTFChars(publicStaticFiled_value, native_publicStaticFiled_value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JNI 获取对象的属性</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jni 获取 java 对象的属性</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_ndkdemo01_MainActivity_jniGetJavaObjFiled(JNIEnv *env, jobject, jobject testObj) &#123;</span><br><span class="line">    <span class="comment">// env 获取类</span></span><br><span class="line">    jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/ndkdemo01/Test&quot;</span>);</span><br><span class="line">    jfieldID publicNonStaticFiledId = env-&gt;GetFieldID(TestClass, <span class="string">&quot;publicNonStaticField&quot;</span>, <span class="string">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class="line">    jstring publicNonStaticFieldValue = (jstring) env-&gt;GetObjectField(testObj, publicNonStaticFiledId);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *nativeChar = env-&gt;GetStringUTFChars(publicNonStaticFieldValue, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;native public NonStatic Field value is %s&quot;</span>,</span><br><span class="line">                        nativeChar);</span><br><span class="line">    env-&gt;ReleaseStringUTFChars(publicNonStaticFieldValue, nativeChar);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="JNI-获取-Java-层方法"><a href="#JNI-获取-Java-层方法" class="headerlink" title="JNI 获取 Java 层方法"></a>JNI 获取 Java 层方法</h2><p>获取 java 层方法常用 API</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 java 类的静态方法</span></span><br><span class="line"><span class="function">jmethodID <span class="title">GetStaticMethodID</span><span class="params">(jclass clazz, <span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">const</span> <span class="keyword">char</span>* sig)</span></span></span><br><span class="line"><span class="function"><span class="comment">// clazz: 对应的 jclass</span></span></span><br><span class="line"><span class="function"><span class="comment">// name: 对应的方法名</span></span></span><br><span class="line"><span class="function"><span class="comment">// sig: 对应的函数描述符</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 获取 java 非静态方法</span></span></span><br><span class="line"><span class="function">jmethodID <span class="title">GetMethodID</span><span class="params">(jclass clazz, <span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">const</span> <span class="keyword">char</span>* sig)</span></span></span><br><span class="line"><span class="function"><span class="comment">// clazz: 对应的 jclass</span></span></span><br><span class="line"><span class="function"><span class="comment">// name: 对应的方法名</span></span></span><br><span class="line"><span class="function"><span class="comment">// sig: 对应的函数描述符</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 调用静态方法</span></span></span><br><span class="line"><span class="function">NativeType CallStatic&lt;type&gt;<span class="title">Method</span><span class="params">(JNIEnv *env, jclass clazz,</span></span></span><br><span class="line"><span class="function"><span class="params">jmethodID methodID, ...)</span></span>;</span><br><span class="line"></span><br><span class="line">NativeType CallStatic&lt;type&gt;MethodA(JNIEnv *env, jclass clazz,</span><br><span class="line">jmethodID methodID, jvalue *args);</span><br><span class="line"></span><br><span class="line">NativeType CallStatic&lt;type&gt;MethodV(JNIEnv *env, jclass clazz,</span><br><span class="line">jmethodID methodID, va_list args);</span><br><span class="line"></span><br><span class="line"><span class="comment">// clazz: 对应的 jlazz</span></span><br><span class="line"><span class="comment">// methodID: 方法对应的 MethodID</span></span><br><span class="line"><span class="comment">// ...：变参列表</span></span><br><span class="line"><span class="comment">// jvalue *args：Java值数组</span></span><br><span class="line"><span class="comment">// va_list args：指向变参列表的指针</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用非静态方法</span></span><br><span class="line">NativeType Call&lt;type&gt;Method(JNIEnv *env, jobject obj,</span><br><span class="line">jmethodID methodID, ...);</span><br><span class="line"></span><br><span class="line">NativeType Call&lt;type&gt;MethodA(JNIEnv *env, jobject obj,</span><br><span class="line">jmethodID methodID, <span class="keyword">const</span> jvalue *args);</span><br><span class="line"></span><br><span class="line">NativeType Call&lt;type&gt;MethodV(JNIEnv *env, jobject obj,</span><br><span class="line">jmethodID methodID, va_list args);</span><br><span class="line"><span class="comment">// obj: java 对象</span></span><br><span class="line"><span class="comment">// methodID: 实例方法 ID</span></span><br><span class="line"><span class="comment">// ... : 变参列表</span></span><br><span class="line"><span class="comment">// jvalue *args: 参数数组</span></span><br><span class="line"><span class="comment">// va_list args: 指向变参列表的指针</span></span><br></pre></td></tr></table></figure>

<p>JNI 获取并调用类的静态方法</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_ndkdemo01_MainActivity_jniGetJavaStaticMethod(JNIEnv *env, jobject)&#123;</span><br><span class="line">    jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/ndkdemo01/Test&quot;</span>);</span><br><span class="line">    jmethodID publicStaticMethodID = env-&gt;GetStaticMethodID(TestClass, <span class="string">&quot;publicStaticFunc&quot;</span>, <span class="string">&quot;()V&quot;</span>);</span><br><span class="line">    env-&gt;CallStaticVoidMethod(TestClass, publicStaticMethodID);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;native 调用 publicStaticMethod&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JNI 获取并调用非静态方法</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jni 获取 java 非静态方法</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_ndkdemo01_MainActivity_jniGetJavaNonStaticMethod(JNIEnv *env, jobject, jobject TestObj)&#123;</span><br><span class="line">    jclass TestClass = env-&gt;GetObjectClass(TestObj);</span><br><span class="line">    jmethodID publicNonStaticMethodID = env-&gt;GetMethodID(TestClass, <span class="string">&quot;publicNonStaticFunc&quot;</span>, <span class="string">&quot;()V&quot;</span>);</span><br><span class="line">    env-&gt;CallVoidMethod(TestObj, publicNonStaticMethodID);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;native public Nonstatic func&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="JNI-OnLoad"><a href="#JNI-OnLoad" class="headerlink" title="JNI_OnLoad"></a>JNI_OnLoad</h1><p>负责 Java 方法和本地函数的链接工作;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JNIEXPORT jint JNI_OnLoad(JavaVM* vm, void* reserved)</span><br></pre></td></tr></table></figure>

<ul>
<li>参数: 该函数的格式固定, 其中第一个参数为 <code>JavaVM* vm</code>, 第二个参数保留;</li>
<li>作用: 该函数通常用于处理一些动态注册, 逻辑准备, 参数初始化的功能;</li>
<li>返回值: <code>JNI</code>的版本号, 如 <code>JNI_VERSION_1_4</code> ;</li>
<li>运行时机: 运行时机早于其他的 JNI 函数, 在静态代码块中调用 <code>System.loadLibrary()</code> 或者 <code>System.load()</code> 的时候就会调用;</li>
</ul>
<h1 id="RegisterNatives"><a href="#RegisterNatives" class="headerlink" title="RegisterNatives"></a>RegisterNatives</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jint RegisterNatives(jclass clazz, const JNINativeMethod* methods, jint nMethods)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>clazz: java 层对应的类描述符</p>
</li>
<li><p>methods: JNINativeMethod 结构体,定义如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* name;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* signature;</span><br><span class="line">    <span class="keyword">void</span>*       fnPtr;</span><br><span class="line">&#125; JNINativeMethod;</span><br><span class="line"><span class="comment">// name: Java 方法名</span></span><br><span class="line"><span class="comment">// signature: Java 函数签名</span></span><br><span class="line"><span class="comment">// fnPtr: native 函数指针</span></span><br></pre></td></tr></table></figure></li>
<li><p>nMethods: 注册的方法数量</p>
</li>
</ul>
<h2 id="动态注册代码"><a href="#动态注册代码" class="headerlink" title="动态注册代码"></a>动态注册代码</h2><ol>
<li>定义一个 java 层需要动态注册的方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.kevin;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NativeLib</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title">getName</span><span class="params">(<span class="keyword">int</span> number)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>本地声明一个该方法实现的函数, 并动态注册</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">JNIEXPORT jstring JNICALL <span class="title">getName</span><span class="params">(JNIEnv* env, jobject thiz, <span class="keyword">int</span> number)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(<span class="string">&quot;Hello from jni !!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *CLASS_NAME = <span class="string">&quot;com/github/kevin/NativeLib&quot;</span>; <span class="comment">// 类名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> JNINativeMethod method = &#123; <span class="comment">// 本地方法描述</span></span><br><span class="line">    <span class="string">&quot;getName&quot;</span>, <span class="comment">// Java 方法名</span></span><br><span class="line">    <span class="string">&quot;(I)Ljava/lang/String;&quot;</span>,  <span class="comment">//方法签名</span></span><br><span class="line">    (<span class="keyword">void</span> *) getName <span class="comment">// 绑定本地函数 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">bool</span> bindNative(JNIEnv* env)&#123;</span><br><span class="line">    jclass clazz;</span><br><span class="line">    clazz = env-&gt;FindClass(CLASS_NAME);</span><br><span class="line">    <span class="keyword">if</span> (clazz == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;RegisterNatives(clazz, &amp;method, <span class="number">1</span>) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">JNIEXPORT jint JNICALL <span class="title">JNI_OnLoad</span><span class="params">(JavaVM* vm, <span class="keyword">void</span>* reserved)</span></span>&#123;</span><br><span class="line">    JNIEnv* env = <span class="literal">NULL</span>;</span><br><span class="line">    jint result = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (vm-&gt;GetEnv((<span class="keyword">void</span>**) &amp;env, JNI_VERSION_1_6) != JNI_OK)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> res = bindNative(env);</span><br><span class="line">    <span class="keyword">return</span> JNI_VERSION_1_6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="JavaVM"><a href="#JavaVM" class="headerlink" title="JavaVM"></a>JavaVM</h1><h2 id="JavaVM-定义"><a href="#JavaVM-定义" class="headerlink" title="JavaVM 定义"></a>JavaVM 定义</h2><p><code>JavaVM</code>是一个虚拟机在<code>JNI</code>层的代表, 一个进程只有一个<code>JavaVM</code>, 所有的线程共用一个<code>JavaVM</code>;</p>
<h2 id="JavaVM-2-种获取方式"><a href="#JavaVM-2-种获取方式" class="headerlink" title="JavaVM 2 种获取方式"></a>JavaVM 2 种获取方式</h2><ol>
<li><p>通过 <code>JNI_OnLoad</code> 来获取 <code>JavaVM</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">JNIEXPORT jint <span class="title">JNI_OnLoad</span><span class="params">(JavaVM* vm, <span class="keyword">void</span>* reserved)</span></span>&#123;</span><br><span class="line">  <span class="comment">// 直接获取到 JavaVM* vm</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>通过 <code>JNIEnv</code> 来获取 <code>JavaVM</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 JNIEnv 获取 JavaVM</span></span><br><span class="line">JavaVM* vm = <span class="literal">nullptr</span>;</span><br><span class="line">env-&gt;GetJavaVM(&amp;vm);</span><br></pre></td></tr></table></figure>

<h2 id="JavaVM-相关-api"><a href="#JavaVM-相关-api" class="headerlink" title="JavaVM 相关 api"></a>JavaVM 相关 api</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">jint <span class="title">DestroyJavaVM</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="keyword">return</span> functions-&gt;DestroyJavaVM(<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jint <span class="title">AttachCurrentThread</span><span class="params">(JNIEnv** p_env, <span class="keyword">void</span>* thr_args)</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="keyword">return</span> functions-&gt;AttachCurrentThread(<span class="keyword">this</span>, p_env, thr_args); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jint <span class="title">DetachCurrentThread</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="keyword">return</span> functions-&gt;DetachCurrentThread(<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jint <span class="title">GetEnv</span><span class="params">(<span class="keyword">void</span>** env, jint version)</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="keyword">return</span> functions-&gt;GetEnv(<span class="keyword">this</span>, env, version); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">jint <span class="title">AttachCurrentThreadAsDaemon</span><span class="params">(JNIEnv** p_env, <span class="keyword">void</span>* thr_args)</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="keyword">return</span> functions-&gt;AttachCurrentThreadAsDaemon(<span class="keyword">this</span>, p_env, thr_args); &#125;</span><br></pre></td></tr></table></figure>

<p><strong>链接到虚拟机</strong></p>
<p><code>JNIEnv</code> 指针仅在创建它的线程中有效, 如果我们需要在其他线程中访问 <code>JVM</code>, 那么必须先调用 <code>AttachCurrentThread</code> 将当前线程与 <code>JVM</code> 进行关联, 然后才能获得<code>JNIEnv</code> 对象; 当不使用该线程的时候, 需要调用 <code>DetachCurrentThread</code> 来解除链接;</p>
<p><code>jint AttachCurrentThread(JavaVM* vm , JNIEnv** env , JavaVMAttachArgs* args);</code></p>
<ul>
<li>vm: 虚拟机对象指针</li>
<li>env: 用来保存得到的 JNIEnv 的指针</li>
<li>args: 链接参数, 参数结构如下所示</li>
<li>return: 链接成功返回 0, 链接失败返回其他</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">JavaVMAttachArgs</span> &#123;</span></span><br><span class="line">    jint        version;    <span class="comment">/* must be &gt;= JNI_VERSION_1_2 */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* name;       <span class="comment">/* NULL or name of thread as modified UTF-8 str */</span></span><br><span class="line">    jobject     group;      <span class="comment">/* global ref of a ThreadGroup object, or NULL */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>卸载虚拟机</strong></p>
<p><code>jint DetachCurrentThread(JavaVM* vm);</code></p>
<p><strong>解除与虚拟机的链接</strong></p>
<p><code>jint DetachCurrentThread(JavaVM* vm);</code></p>
<p><strong>卸载虚拟机</strong></p>
<p><code>jint DestroyJavaVM(JavaVM* vm);</code></p>
<p><strong>获取 JNIEnv</strong></p>
<p><code>jint GetEnv(void** env, jint version)</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">JNIEXPORT jnit JNICALL <span class="title">JNI_OnLoad</span><span class="params">(JavaVM* vm, <span class="keyword">void</span>* reserved)</span></span>&#123;</span><br><span class="line">    JNIEnv* env = <span class="literal">nullptr</span>;</span><br><span class="line">  	<span class="keyword">if</span> (vm-&gt;GetEnv((<span class="keyword">void</span>**) &amp;env, JNI_VERSION_1_6) == JNI_OK)&#123;</span><br><span class="line">      	__android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;jni-&gt;%s&quot;</span>, <span class="string">&quot;vm-&gt;GetEnv((void **) &amp;env, JNI_VERSION_1_6)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="JNIEnv"><a href="#JNIEnv" class="headerlink" title="JNIEnv"></a>JNIEnv</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p><code>JNIEnv*</code> 是 <code>Java Native Interface Environment</code> , 是一个 <code>JNI</code> 接口指针, 指向了本地方法的函数表, 该函数表的每个成员执行了一个 <code>jni</code> 函数</p>
<h2 id="JNIEnv-特性"><a href="#JNIEnv-特性" class="headerlink" title="JNIEnv 特性"></a>JNIEnv 特性</h2><ol>
<li><code>JNIEnv</code> 只在创建它的线程中生效, 不能跨线程传递, 不同线程的 <code>JNIEnv</code> 彼此独立</li>
<li><code>native</code> 环境中创建的线程, 如果需要访问 <code>JNIEnv</code>, 必须调用 <code>AttachCurrentThread</code> 关联, 并使用 <code>DetachCurrentThread</code> 解除链接</li>
</ol>
<h2 id="获取-JNIEnv"><a href="#获取-JNIEnv" class="headerlink" title="获取 JNIEnv"></a>获取 <code>JNIEnv</code></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vm-&gt;GetEnv()` 在主线程获取 `JNIEnv</span><br><span class="line">JNIEnv *env = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">if</span> (vm-&gt;GetEnv((<span class="keyword">void</span>**)&amp;env, JNI_VERSION_1_6) == JNI_OK)&#123;</span><br><span class="line">	__android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;jni-&gt;%s&quot;</span>, <span class="string">&quot;vm-&gt;GetEnv((void **) &amp;env, JNI_VERSION_1_6)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">vm-&gt;GetEnv()` 在子线程中获取 `JNIEnv</span><br><span class="line"><span class="comment">// 从 JNI_OnLoad中获取的 vm 保存为全局变量 globalvm</span></span><br><span class="line"><span class="comment">// 使用 AttachCurrentThread 对子线程进行注册</span></span><br><span class="line"><span class="comment">// globalvm-&gt;AttachCurrentThread(&amp;threadenv, nullptr);</span></span><br><span class="line"><span class="comment">// 再使用 vm-&gt;GetEnv()获取 JNIEnv</span></span><br><span class="line"><span class="keyword">if</span> (globalvm-&gt;AttachCurrentThread(&amp;threadenv, <span class="literal">nullptr</span>)== JNI_OK)&#123;</span><br><span class="line">    <span class="keyword">if</span> (globalvm-&gt;GetEnv((<span class="keyword">void</span>**)&amp;threadenv, JNI_VERSION_1_6) == JNI_OK)&#123;</span><br><span class="line">			__android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;jni-&gt;get jnienv from thread %p&quot;</span>, threadenv);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">globalvm-&gt;DetachCurrentThread();</span><br></pre></td></tr></table></figure>

<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul>
<li><p><code>JNIEnv</code>是与一个<code>ClassLoader</code>绑定的, 当使用<code>env-&gt;FindClass()</code>进行类的查询和加载时, 便是使用的这个<code>ClassLoader</code></p>
</li>
<li><p><code>JNIEnv</code>是当前<code>Java</code>线程的执行环境, 一个<code>JVM</code>对应一个<code>JavaVM</code>结构, 而一个<code>JVM</code>中可能创建多个<code>Java</code>线程, 使用<code>pthread_create</code>新建的线程当使用<code>AttachCurrentTread(&amp;env, nullptr)</code>获得到<code>JNIEnv</code>后, 该<code>JNIEnv</code>的<code>CLassLoader</code>并不是主线程的<code>ClassLoader</code>, 因此也无法加载<code>app</code>自己的 <code>Class</code></p>
</li>
<li><p>解决子线程无法获取主线程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ClassLoader</span><br></pre></td></tr></table></figure>

<p>问题:</p>
<ul>
<li>保存全局<code>ClassLoader</code>, 之后在子线程中使用全局<code>ClassLoader</code></li>
<li>在主线程中获取到要使用的<code>Class</code>, 创建全局引用</li>
</ul>
</li>
</ul>
<h1 id="JNI-访问成员属性汇总"><a href="#JNI-访问成员属性汇总" class="headerlink" title="JNI 访问成员属性汇总"></a>JNI 访问成员属性汇总</h1><h2 id="定义-Test-类测试"><a href="#定义-Test-类测试" class="headerlink" title="定义 Test 类测试"></a>定义 <code>Test</code> 类测试</h2><ul>
<li><p><code>Test</code> 类定义代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kevin.reflectiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;kevinTest&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String flag = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String publicStaticField = <span class="string">&quot;i am a public static field&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> String publicNonStaticField = <span class="string">&quot;i am a public non static field&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String privateStaticField = <span class="string">&quot;i am a private static field&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String privateNonStaticField = <span class="string">&quot;i am a private non static field&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        flag = <span class="string">&quot;Test()&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String arg)</span></span>&#123;</span><br><span class="line">        flag = <span class="string">&quot;Test(String arg)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String arg, <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        flag = <span class="string">&quot;Test(String arg, int num)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">publicStaticFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;public Static Func: &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publicNonStaticFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;public Non Static Func: &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">privateStaticFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;private Static Func: &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">privateNonStaticFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;private Non Static Func: &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">privateNonStaticFunc</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;private Non Static Func: arg is String : &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="获取-Field-静态属性的方法"><a href="#获取-Field-静态属性的方法" class="headerlink" title="获取 Field 静态属性的方法"></a>获取 <code>Field</code> 静态属性的方法</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于获取非基础数据类型的属性</span></span><br><span class="line">jobject     (*GetStaticObjectField)(JNIEnv*, jclass, jfieldID);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于获取 8 种基础数据类型</span></span><br><span class="line">jboolean    (*GetStaticBooleanField)(JNIEnv*, jclass, jfieldID);</span><br><span class="line">jbyte       (*GetStaticByteField)(JNIEnv*, jclass, jfieldID);</span><br><span class="line">jchar       (*GetStaticCharField)(JNIEnv*, jclass, jfieldID);</span><br><span class="line">jshort      (*GetStaticShortField)(JNIEnv*, jclass, jfieldID);</span><br><span class="line">jint        (*GetStaticIntField)(JNIEnv*, jclass, jfieldID);</span><br><span class="line">jlong       (*GetStaticLongField)(JNIEnv*, jclass, jfieldID);</span><br><span class="line">jfloat      (*GetStaticFloatField)(JNIEnv*, jclass, jfieldID);</span><br><span class="line">jdouble     (*GetStaticDoubleField)(JNIEnv*, jclass, jfieldID);</span><br></pre></td></tr></table></figure>

<h2 id="设置-Field-静态属性的方法"><a href="#设置-Field-静态属性的方法" class="headerlink" title="设置 Field 静态属性的方法"></a>设置 <code>Field</code> 静态属性的方法</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span>        (*SetStaticObjectField)(JNIEnv*, jclass, jfieldID, jobject);</span><br><span class="line"><span class="keyword">void</span>        (*SetStaticBooleanField)(JNIEnv*, jclass, jfieldID, jboolean);</span><br><span class="line"><span class="keyword">void</span>        (*SetStaticByteField)(JNIEnv*, jclass, jfieldID, jbyte);</span><br><span class="line"><span class="keyword">void</span>        (*SetStaticCharField)(JNIEnv*, jclass, jfieldID, jchar);</span><br><span class="line"><span class="keyword">void</span>        (*SetStaticShortField)(JNIEnv*, jclass, jfieldID, jshort);</span><br><span class="line"><span class="keyword">void</span>        (*SetStaticIntField)(JNIEnv*, jclass, jfieldID, jint);</span><br><span class="line"><span class="keyword">void</span>        (*SetStaticLongField)(JNIEnv*, jclass, jfieldID, jlong);</span><br><span class="line"><span class="keyword">void</span>        (*SetStaticFloatField)(JNIEnv*, jclass, jfieldID, jfloat);</span><br><span class="line"><span class="keyword">void</span>        (*SetStaticDoubleField)(JNIEnv*, jclass, jfieldID, jdouble);</span><br></pre></td></tr></table></figure>

<h2 id="获取-Field-动态属性的方法"><a href="#获取-Field-动态属性的方法" class="headerlink" title="获取 Field 动态属性的方法"></a>获取 <code>Field</code> 动态属性的方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于获取非基础数据类型的属性</span></span><br><span class="line">jobject     (*GetObjectField)(JNIEnv*, jobject, jfieldID);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于获取 8 种基础数据类型</span></span><br><span class="line">jboolean    (*GetBooleanField)(JNIEnv*, jobject, jfieldID);</span><br><span class="line">jbyte       (*GetByteField)(JNIEnv*, jobject, jfieldID);</span><br><span class="line">jchar       (*GetCharField)(JNIEnv*, jobject, jfieldID);</span><br><span class="line">jshort      (*GetShortField)(JNIEnv*, jobject, jfieldID);</span><br><span class="line">jint        (*GetIntField)(JNIEnv*, jobject, jfieldID);</span><br><span class="line">jlong       (*GetLongField)(JNIEnv*, jobject, jfieldID);</span><br><span class="line">jfloat      (*GetFloatField)(JNIEnv*, jobject, jfieldID);</span><br><span class="line">jdouble     (*GetDoubleField)(JNIEnv*, jobject, jfieldID);</span><br></pre></td></tr></table></figure>

<h2 id="设置-Field-动态属性的方法"><a href="#设置-Field-动态属性的方法" class="headerlink" title="设置 Field 动态属性的方法"></a>设置 <code>Field</code> 动态属性的方法</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span>        (*SetObjectField)(JNIEnv*, jobject, jfieldID, jobject);</span><br><span class="line"><span class="keyword">void</span>        (*SetBooleanField)(JNIEnv*, jobject, jfieldID, jboolean);</span><br><span class="line"><span class="keyword">void</span>        (*SetByteField)(JNIEnv*, jobject, jfieldID, jbyte);</span><br><span class="line"><span class="keyword">void</span>        (*SetCharField)(JNIEnv*, jobject, jfieldID, jchar);</span><br><span class="line"><span class="keyword">void</span>        (*SetShortField)(JNIEnv*, jobject, jfieldID, jshort);</span><br><span class="line"><span class="keyword">void</span>        (*SetIntField)(JNIEnv*, jobject, jfieldID, jint);</span><br><span class="line"><span class="keyword">void</span>        (*SetLongField)(JNIEnv*, jobject, jfieldID, jlong);</span><br><span class="line"><span class="keyword">void</span>        (*SetFloatField)(JNIEnv*, jobject, jfieldID, jfloat);</span><br><span class="line"><span class="keyword">void</span>        (*SetDoubleField)(JNIEnv*, jobject, jfieldID, jdouble);</span><br></pre></td></tr></table></figure>

<h2 id="访问类的静态属性"><a href="#访问类的静态属性" class="headerlink" title="访问类的静态属性"></a>访问类的静态属性</h2><ul>
<li><p>访问类的静态属性</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jni 访问非私有的属性</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_reflectiontest_MainActivity_getStaticField(JNIEnv *env, jobject)&#123;</span><br><span class="line">    <span class="comment">// 获取类</span></span><br><span class="line">    jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/reflectiontest/Test&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 找到静态 public 属性的 fieldID</span></span><br><span class="line">    <span class="comment">// public static String publicStaticField = &quot;i am a public static field&quot;;</span></span><br><span class="line">    jfieldID publicStaticFieldid = env-&gt;GetStaticFieldID(TestClass, <span class="string">&quot;publicStaticField&quot;</span>,</span><br><span class="line">                                                            <span class="string">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class="line">    <span class="comment">// 通过 GetStaticObjectFiled 找到对应属性的值</span></span><br><span class="line">    jstring publicStaticField = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestClass,</span><br><span class="line">                                                                                    publicStaticFieldid));</span><br><span class="line">    <span class="comment">// 将 jstring 转成 char*</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *publicStaticFieldValue = env-&gt;GetStringUTFChars(publicStaticField, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;获取到public 静态属性 %s&quot;</span>, publicStaticFieldValue);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 找到静态 private 属性的 FieldID</span></span><br><span class="line">    <span class="comment">// private static String privateStaticField = &quot;i am a private static field&quot;;</span></span><br><span class="line">    jfieldID privateStaticFieldID = env-&gt;GetStaticFieldID(TestClass, <span class="string">&quot;privateStaticField&quot;</span>,</span><br><span class="line">                                                          <span class="string">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class="line">    jstring privateStaticField = (jstring)env-&gt;GetStaticObjectField(TestClass, privateStaticFieldID);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *privateStaticFieldValue = env-&gt;GetStringUTFChars(privateStaticField, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;获取到 private 静态属性 %s&quot;</span>,</span><br><span class="line">                        privateStaticFieldValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="修改类的静态属性"><a href="#修改类的静态属性" class="headerlink" title="修改类的静态属性"></a>修改类的静态属性</h2><p><code>SetStaticObjectField</code> 静态的<code>private</code>和<code>public</code>修改的方法相同;</p>
<ul>
<li><p>修改类的静态属性</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jni 访问类的属性</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_reflectiontest_MainActivity_getStaticField(JNIEnv *env, jobject)&#123;</span><br><span class="line">    <span class="comment">// 获取类</span></span><br><span class="line">    jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/reflectiontest/Test&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 找到静态 public 属性的 fieldID</span></span><br><span class="line">    <span class="comment">// public static String publicStaticField = &quot;i am a public static field&quot;;</span></span><br><span class="line">    jfieldID publicStaticFieldid = env-&gt;GetStaticFieldID(TestClass, <span class="string">&quot;publicStaticField&quot;</span>,</span><br><span class="line">                                                            <span class="string">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class="line">    <span class="comment">// 通过 GetStaticObjectFiled 找到对应属性的值</span></span><br><span class="line">    jstring publicStaticField = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestClass,publicStaticFieldid));</span><br><span class="line">    <span class="comment">// 将 jstring 转成 char*</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *publicStaticFieldValue = env-&gt;GetStringUTFChars(publicStaticField, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;获取到public 静态属性 %s&quot;</span>, publicStaticFieldValue);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改 public static 属性的值</span></span><br><span class="line">    <span class="comment">// void SetStaticObjectField(jclass clazz, jfieldID fieldID, jobject value)</span></span><br><span class="line">    jstring changeValue = env-&gt;NewStringUTF(<span class="string">&quot;change the value&quot;</span>);</span><br><span class="line">    env-&gt;SetStaticObjectField(TestClass, publicStaticFieldid, changeValue);</span><br><span class="line">    jstring publicStaticFieldChange = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestClass,publicStaticFieldid));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *publicStaticFieldChangeValue = env-&gt;GetStringUTFChars(publicStaticFieldChange, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;获取到public 静态属性 改变为: %s&quot;</span>, publicStaticFieldChangeValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="访问对象的属性"><a href="#访问对象的属性" class="headerlink" title="访问对象的属性"></a>访问对象的属性</h2><ul>
<li><p>访问对象的属性</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jni 访问对象的属性</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_reflectiontest_MainActivity_getObjectField(JNIEnv *env, jobject obj, jobject inputObj)&#123;</span><br><span class="line">    <span class="comment">// 访问对象的私有属性 private String privateNonStaticField = &quot;i am a private non static field&quot;;</span></span><br><span class="line">    <span class="comment">// 1. 获取类</span></span><br><span class="line">    jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/reflectiontest/Test&quot;</span>);</span><br><span class="line">    <span class="comment">// 2. 获取属性ID</span></span><br><span class="line">    jfieldID privateNonStaticFieldID = env-&gt;GetFieldID(TestClass, <span class="string">&quot;privateNonStaticField&quot;</span>,</span><br><span class="line">                                                       <span class="string">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class="line">    <span class="comment">// 3. 获取对象的值</span></span><br><span class="line">    jstring privateNonStaticField = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetObjectField(inputObj,privateNonStaticFieldID));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. jstring 转 char* 并打印</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* privateNonStaticFieldValue = env-&gt;GetStringUTFChars(privateNonStaticField, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;privateNoneStaticFieldValue is %s&quot;</span>,</span><br><span class="line">                        privateNonStaticFieldValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="修改对象的属性"><a href="#修改对象的属性" class="headerlink" title="修改对象的属性"></a>修改对象的属性</h2><ul>
<li><p>修改对象的属性</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jni 访问类的属性</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_reflectiontest_MainActivity_getStaticField(JNIEnv *env, jobject)&#123;</span><br><span class="line">    <span class="comment">// 获取类</span></span><br><span class="line">    jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/reflectiontest/Test&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 找到静态 public 属性的 fieldID</span></span><br><span class="line">    <span class="comment">// public static String publicStaticField = &quot;i am a public static field&quot;;</span></span><br><span class="line">    jfieldID publicStaticFieldid = env-&gt;GetStaticFieldID(TestClass, <span class="string">&quot;publicStaticField&quot;</span>,</span><br><span class="line">                                                            <span class="string">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class="line">    <span class="comment">// 通过 GetStaticObjectFiled 找到对应属性的值</span></span><br><span class="line">    jstring publicStaticField = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestClass,</span><br><span class="line">                                                                                    publicStaticFieldid));</span><br><span class="line">    <span class="comment">// 将 jstring 转成 char*</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *publicStaticFieldValue = env-&gt;GetStringUTFChars(publicStaticField, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;获取到public 静态属性 %s&quot;</span>, publicStaticFieldValue);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 找到静态 private 属性的 FieldID</span></span><br><span class="line">    <span class="comment">// private static String privateStaticField = &quot;i am a private static field&quot;;</span></span><br><span class="line">    jfieldID privateStaticFieldID = env-&gt;GetStaticFieldID(TestClass, <span class="string">&quot;privateStaticField&quot;</span>,</span><br><span class="line">                                                          <span class="string">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class="line">    jstring privateStaticField = (jstring)env-&gt;GetStaticObjectField(TestClass, privateStaticFieldID);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *privateStaticFieldValue = env-&gt;GetStringUTFChars(privateStaticField, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;获取到 private 静态属性 %s&quot;</span>,</span><br><span class="line">                        privateStaticFieldValue);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改 public static 属性的值</span></span><br><span class="line">    <span class="comment">// void SetStaticObjectField(jclass clazz, jfieldID fieldID, jobject value)</span></span><br><span class="line">    jstring changeValue = env-&gt;NewStringUTF(<span class="string">&quot;change the value&quot;</span>);</span><br><span class="line">    env-&gt;SetStaticObjectField(TestClass, publicStaticFieldid, changeValue);</span><br><span class="line">    jstring publicStaticFieldChange = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestClass,</span><br><span class="line">                                                                               publicStaticFieldid));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *publicStaticFieldChangeValue = env-&gt;GetStringUTFChars(publicStaticFieldChange, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;获取到public 静态属性 改变为: %s&quot;</span>, publicStaticFieldChangeValue);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改 private static 属性值</span></span><br><span class="line">    jstring changeValue2 = env-&gt;NewStringUTF(<span class="string">&quot;change private the value&quot;</span>);</span><br><span class="line">    env-&gt;SetStaticObjectField(TestClass, privateStaticFieldID, changeValue2);</span><br><span class="line">    jstring privateStaticFieldChange = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetStaticObjectField(TestClass,</span><br><span class="line">                                                                                      privateStaticFieldID));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *privateStaticFieldChangeValue = env-&gt;GetStringUTFChars(privateStaticFieldChange,</span><br><span class="line">                                                                       <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;获取到private 静态属性 改变为: %s&quot;</span>, privateStaticFieldChangeValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jni 访问对象的属性</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_reflectiontest_MainActivity_getObjectField(JNIEnv *env, jobject obj, jobject inputObj)&#123;</span><br><span class="line">    <span class="comment">// 访问对象的私有属性 private String privateNonStaticField = &quot;i am a private non static field&quot;;</span></span><br><span class="line">    <span class="comment">// 1. 获取类</span></span><br><span class="line">    jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/reflectiontest/Test&quot;</span>);</span><br><span class="line">    <span class="comment">// 2. 获取属性ID</span></span><br><span class="line">    jfieldID privateNonStaticFieldID = env-&gt;GetFieldID(TestClass, <span class="string">&quot;privateNonStaticField&quot;</span>,</span><br><span class="line">                                                       <span class="string">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class="line">    <span class="comment">// 3. 获取对象的值</span></span><br><span class="line">    jstring privateNonStaticField = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetObjectField(inputObj,                                                                       privateNonStaticFieldID));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. jstring 转 char* 并打印</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* privateNonStaticFieldValue = env-&gt;GetStringUTFChars(privateNonStaticField, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;privateNoneStaticFieldValue is %s&quot;</span>,</span><br><span class="line">                        privateNonStaticFieldValue);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 修改对象的属性</span></span><br><span class="line">    jstring newString = env-&gt;NewStringUTF(<span class="string">&quot;modified new String&quot;</span>);</span><br><span class="line">    env-&gt;SetObjectField(inputObj, privateNonStaticFieldID, newString);</span><br><span class="line">    <span class="comment">// 6. 获取对象的值</span></span><br><span class="line">    jstring privateNonStaticField1 = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;GetObjectField(inputObj,                                                      privateNonStaticFieldID));</span><br><span class="line">    <span class="comment">// 7. jstring 转 char* 并打印</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* privateNonStaticFieldValue1 = env-&gt;GetStringUTFChars(privateNonStaticField1, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;privateNoneStaticFieldValue is %s&quot;</span>,</span><br><span class="line">                        privateNonStaticFieldValue1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="访问和修改数组类型的属性"><a href="#访问和修改数组类型的属性" class="headerlink" title="访问和修改数组类型的属性"></a>访问和修改数组类型的属性</h2><p><code>env-&gt;GetArrayLength</code>: 获取数组的长度</p>
<p><code>env-&gt;GetIntArrayElements</code>: 获取数组首元素的指针</p>
<p><code>env-&gt;SetIntArrayRegion</code>: 修改数组的值</p>
<ul>
<li><p>code</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_reflectiontest_MainActivity_getArrayField(JNIEnv *env, jobject obj, jobject inputObj)&#123;</span><br><span class="line">    <span class="comment">// 1. 获取 class</span></span><br><span class="line">    jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/reflectiontest/Test&quot;</span>);</span><br><span class="line">    <span class="comment">// private int[] ArrayField = &#123;1, 2, 3, 4&#125;;</span></span><br><span class="line">    <span class="comment">// 2. 获取 fieldID</span></span><br><span class="line">    jfieldID ArrayFieldID = env-&gt;GetFieldID(TestClass, <span class="string">&quot;ArrayField&quot;</span>, <span class="string">&quot;[I&quot;</span>);</span><br><span class="line">    <span class="comment">// 3. 获取 filedobj</span></span><br><span class="line">    jintArray ArrayFiledObj = <span class="keyword">static_cast</span>&lt;jintArray&gt;(env-&gt;GetObjectField(inputObj, ArrayFieldID));</span><br><span class="line">    <span class="comment">// 4. 获取 jintArray 的长度</span></span><br><span class="line">    jint length = env-&gt;GetArrayLength(ArrayFiledObj);</span><br><span class="line">    <span class="comment">// 5. 获取 jintArray 首元素的指针</span></span><br><span class="line">    <span class="keyword">int</span> *<span class="built_in">array</span> = env-&gt;GetIntArrayElements(ArrayFiledObj, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="comment">// 6. 遍历打印</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">        __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;array[%d]-&gt;%d&quot;</span>, i, <span class="built_in">array</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 7. 定义新的jintArray</span></span><br><span class="line">    jint jni_array[length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">        jni_array[i] = <span class="number">10</span> - i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//void SetIntArrayRegion(jintArray array, jsize start, jsize len,</span></span><br><span class="line">    <span class="keyword">const</span> jint *ptr = jni_array;</span><br><span class="line">    env-&gt;SetIntArrayRegion(ArrayFiledObj, <span class="number">0</span>, length, ptr);</span><br><span class="line">    <span class="keyword">int</span> *array1 = env-&gt;GetIntArrayElements(ArrayFiledObj, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="comment">// 6. 遍历打印</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">        __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;array[%d]-&gt;%d&quot;</span>, i, array1[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1 id="JNI-访问成员方法汇总"><a href="#JNI-访问成员方法汇总" class="headerlink" title="JNI 访问成员方法汇总"></a>JNI 访问成员方法汇总</h1><h2 id="访问构造函数"><a href="#访问构造函数" class="headerlink" title="访问构造函数"></a>访问构造函数</h2><p>对于构造函数的调用来说, 只能通过<code>NewObject</code>和<code>AllocObject</code>来调用; 因为构造函数本身首先不是静态函数, 自然不能通过类名进行调用; 其次, 如果按照一般的函数进行调用的话, 还需要传入对象, 而此时还没有对象, 因此只能是使用创建对象的方式来调用;</p>
<ul>
<li><p>code</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jni 调用 构造函数</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT jobject JNICALL</span><br><span class="line">Java_com_kevin_reflectiontest_MainActivity_getInitMethod(JNIEnv *env, jobject obj)&#123;</span><br><span class="line">    jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/reflectiontest/Test&quot;</span>);</span><br><span class="line">    <span class="comment">//  Test(String arg, int num)</span></span><br><span class="line">    jmethodID initMethodID = env-&gt;GetMethodID(TestClass, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;(Ljava/lang/String;I)V&quot;</span>);</span><br><span class="line">    jstring inputStr = env-&gt;NewStringUTF(<span class="string">&quot;构造函数字符串&quot;</span>);</span><br><span class="line">    jobject newObj = env-&gt;NewObject(TestClass, initMethodID, inputStr, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">return</span> newObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="访问静态函数"><a href="#访问静态函数" class="headerlink" title="访问静态函数"></a>访问静态函数</h2><p>对于静态函数来说, 可以通过传入类名, 直接通过 <code>CallStaticXXXMethod</code> 调用;</p>
<ol>
<li><code>CallStaticXXXMethod</code></li>
<li><code>CallStaticXXXMethodV</code></li>
<li><code>CallStaticXXXMethodA</code></li>
</ol>
<p>这三个接口都可以完成函数的调用, 只不过是传参的方式不同;</p>
<ul>
<li><p>code</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jni 调用 静态函数</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_reflectiontest_MainActivity_callStaticMethod(JNIEnv *env, jobject obj)&#123;</span><br><span class="line">    jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/reflectiontest/Test&quot;</span>);</span><br><span class="line">    </span><br><span class="line">  	<span class="comment">// 调用 public 静态方法</span></span><br><span class="line">  	<span class="comment">// public static void publicStaticFunc()</span></span><br><span class="line">    jmethodID jmethodId = env-&gt;GetStaticMethodID(TestClass, <span class="string">&quot;publicStaticFunc&quot;</span>, <span class="string">&quot;()V&quot;</span>);</span><br><span class="line">    env-&gt;CallStaticVoidMethod(TestClass, jmethodId);</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// 调用 private 静态方法</span></span><br><span class="line">  	<span class="comment">// private static void privateStaticFunc()</span></span><br><span class="line">    jmethodID jmethidID2 = env-&gt;GetStaticMethodID(TestClass, <span class="string">&quot;privateStaticFunc&quot;</span>, <span class="string">&quot;()V&quot;</span>);</span><br><span class="line">    env-&gt;CallStaticVoidMethod(TestClass, jmethidID2);</span><br><span class="line">	</span><br><span class="line">  </span><br><span class="line">  	<span class="comment">// 调用 带有参数和返回值的静态方法</span></span><br><span class="line">    <span class="comment">// public static String publicStaticFunc_string(String arg)</span></span><br><span class="line">    jmethodID jmethodID3 = env-&gt;GetStaticMethodID(TestClass, <span class="string">&quot;publicStaticFunc_string&quot;</span>,</span><br><span class="line">                                                  <span class="string">&quot;(Ljava/lang/String;)Ljava/lang/String;&quot;</span>);</span><br><span class="line">    jstring arg = env-&gt;NewStringUTF(<span class="string">&quot;字符串参数&quot;</span>);</span><br><span class="line">    jstring result = <span class="keyword">static_cast</span>&lt;jstring&gt;(env-&gt;CallStaticObjectMethod(TestClass, jmethodID3, arg));</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *logResutl = env-&gt;GetStringUTFChars(result, <span class="literal">nullptr</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;jni log result is : %s&quot;</span>, logResutl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="访问非静态函数"><a href="#访问非静态函数" class="headerlink" title="访问非静态函数"></a>访问非静态函数</h2><p>对于非静态函数来说, 可以通过传入类名, 直接通过<code>CallXXXMethod</code>调用;</p>
<ul>
<li><p>code</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_reflectiontest_MainActivity_callMethod(JNIEnv *env, jobject obj)&#123;</span><br><span class="line">    <span class="comment">// 创建实例</span></span><br><span class="line">    jclass TestClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/reflectiontest/Test&quot;</span>);</span><br><span class="line">    jmethodID jmethodId = env-&gt;GetMethodID(TestClass, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;(Ljava/lang/String;I)V&quot;</span>);</span><br><span class="line">    jstring arg1 = env-&gt;NewStringUTF(<span class="string">&quot;字符串参数&quot;</span>);</span><br><span class="line">    jobject testObj = env-&gt;NewObject(TestClass, jmethodId, arg1, <span class="number">100</span>);</span><br><span class="line">    <span class="comment">// 调用对象的方法</span></span><br><span class="line">    <span class="comment">// public void publicNonStaticFunc()</span></span><br><span class="line">    jmethodID jmethodId2 = env-&gt;GetMethodID(TestClass, <span class="string">&quot;publicNonStaticFunc&quot;</span>, <span class="string">&quot;()V&quot;</span>);</span><br><span class="line">    env-&gt;CallVoidMethod(testObj, jmethodId2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  private void privateNonStaticFunc()</span></span><br><span class="line">    jmethodID jmethodId3 = env-&gt;GetMethodID(TestClass, <span class="string">&quot;privateNonStaticFunc&quot;</span>, <span class="string">&quot;()V&quot;</span>);</span><br><span class="line">    env-&gt;CallVoidMethod(testObj, jmethodId3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="访问父类的函数"><a href="#访问父类的函数" class="headerlink" title="访问父类的函数"></a>访问父类的函数</h2><p><code>CallNonvirtualXXXMethod()</code>通过子类对象调用父类的方法</p>
<ul>
<li><p>code</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_reflectiontest_MainActivity_callObjFaterMethod(JNIEnv *env, jobject obj, jobject BundleObj)&#123;</span><br><span class="line">    <span class="comment">// jni 层调用 android log</span></span><br><span class="line">    jclass LogClass = env-&gt;FindClass(<span class="string">&quot;android/util/Log&quot;</span>);</span><br><span class="line">    <span class="comment">// public static int i(String tag, String msg)</span></span><br><span class="line">    jmethodID logMehodid = env-&gt;GetStaticMethodID(LogClass, <span class="string">&quot;i&quot;</span>,</span><br><span class="line">                                                  <span class="string">&quot;(Ljava/lang/String;Ljava/lang/String;)I&quot;</span>);</span><br><span class="line">    jstring arg1 = env-&gt;NewStringUTF(<span class="string">&quot;kevinTest&quot;</span>);</span><br><span class="line">    jstring arg2 = env-&gt;NewStringUTF(<span class="string">&quot;onCreate called&quot;</span>);</span><br><span class="line">    env-&gt;CallStaticIntMethod(LogClass, logMehodid, arg1, arg2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取父类</span></span><br><span class="line">    jclass AppCompatActivityClass = env-&gt;FindClass(<span class="string">&quot;androidx/appcompat/app/AppCompatActivity&quot;</span>);</span><br><span class="line">    <span class="comment">// 获取要调用的父类方法 id</span></span><br><span class="line">    jmethodID jmethodId = env-&gt;GetMethodID(AppCompatActivityClass, <span class="string">&quot;onCreate&quot;</span>,</span><br><span class="line">                                           <span class="string">&quot;(Landroid/os/Bundle;)V&quot;</span>);</span><br><span class="line">    <span class="comment">// void CallNonvirtualVoidMethod(jobject obj, jclass clazz, jmethodID methodID, ...)</span></span><br><span class="line">    <span class="comment">// 调用 CallNonvirtualVoidMethod() 传入对象, 父类名称, 父类方法 id, 参数 进行调用</span></span><br><span class="line">    env-&gt;CallNonvirtualVoidMethod(obj, AppCompatActivityClass, jmethodId, BundleObj);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// error  java.lang.IllegalStateException: Already attached 反复调用 super.onCreate() 方法导致</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="JNI-创建对象"><a href="#JNI-创建对象" class="headerlink" title="JNI 创建对象"></a>JNI 创建对象</h1><ol>
<li><p>通过 <code>FIndClass</code> 查找到对应的类</p>
</li>
<li><p>通过 <code>GetMethodID</code> 找到对应的 <code>jmethodID</code></p>
<ol>
<li>构造函数名称统一为 <code>&lt;init&gt;</code></li>
</ol>
</li>
<li><p>通过函数描述符来区分重载</p>
</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jni 创建 java 对象</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_kevin_reflectiontest_MainActivity_newObject(JNIEnv *env, jobject)&#123;</span><br><span class="line">    <span class="comment">// NewObject 创建实例</span></span><br><span class="line">    jclass TestClazz = env-&gt;FindClass(<span class="string">&quot;com/kevin/reflectiontest/Test&quot;</span>);</span><br><span class="line">    jmethodID jmethodId = env-&gt;GetMethodID(TestClazz, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;(Ljava/lang/String;)V&quot;</span>);</span><br><span class="line">    jstring arg = env-&gt;NewStringUTF(<span class="string">&quot;I am from JNI : Test(String arg)&quot;</span>);</span><br><span class="line">    jobject testobj = env-&gt;NewObject(TestClazz, jmethodId, arg);</span><br><span class="line">    <span class="keyword">if</span> (testobj != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">        __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;NewObject success! %p&quot;</span>, &amp;testobj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>





<h1 id="动态注册和静态注册"><a href="#动态注册和静态注册" class="headerlink" title="动态注册和静态注册"></a>动态注册和静态注册</h1><p>对于任意一个 <code>jni</code> 函数来说, 在该函数调用前, 必须要完成 <code>java</code> 函数与 <code>so</code> 中地址的绑定, 这个绑定过程可以是主动的也可以是被动的;</p>
<p>被动绑定是由 <code>Dalvik/ART</code> 虚拟机在调用前查找并完成地址的绑定, 这就是静态注册;</p>
<p>主动注册就是由 <code>app</code> 自己完成的地址绑定;</p>
<h2 id="静态注册"><a href="#静态注册" class="headerlink" title="静态注册"></a>静态注册</h2><p>对应的函数名: <code>Java_包名_类名_方法名</code> , 通过指定的方式进行命名的 <code>jni</code> 方法</p>
<p>优点: 静态注册简单明了, 语义清晰</p>
<p>缺点: 不够安全, 必须要遵守注册规则从而导致名字过长; 由于要保留符号名, 很容易通过 <code>ida</code> 直接定位到方法地址</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// java native method</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// jni method</span></span><br><span class="line">extern <span class="string">&quot;C&quot;</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_afei_jnidemo_MainActivity_stringFromJNI(JNIEnv* env, jobject jobject)&#123;</span><br><span class="line">	<span class="comment">// pass</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="动态注册"><a href="#动态注册" class="headerlink" title="动态注册"></a>动态注册</h2><p>在 <code>JNI_OnLoad</code> 中通过 <code>RegisterNatives</code> 方法手动完成 <code>native</code> 方法和 <code>so</code> 中的方法的绑定, 这样虚拟机就可以通过这个函数银蛇关系直接找到相应的方法了;</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kevin_registerdemo_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv* env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">&quot;Hello from C++&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(JNIEnv *env, jobject, jint a ,jint b)</span></span>&#123;</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;result is : %d&quot;</span>, a + b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//typedef struct &#123;</span></span><br><span class="line"><span class="comment">//    const char* name;</span></span><br><span class="line"><span class="comment">//    const char* signature;</span></span><br><span class="line"><span class="comment">//    void*       fnPtr;</span></span><br><span class="line"><span class="comment">//&#125; JNINativeMethod;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//jint RegisterNatives(jclass clazz, const JNINativeMethod* methods, </span></span><br><span class="line"><span class="comment">//jint nMethods)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在静态代码块 System.loadLibrary 或者 System.load 的时候自动执行 JNI_Onload</span></span><br><span class="line"><span class="function">JNIEXPORT jint <span class="title">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="keyword">void</span> *reserved)</span></span>&#123;</span><br><span class="line">    JNIEnv *env = <span class="literal">nullptr</span>;</span><br><span class="line">    vm-&gt;GetEnv(<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> **&gt;(&amp;env), JNI_VERSION_1_6);</span><br><span class="line"></span><br><span class="line">    jclass MainActivityClass = env-&gt;FindClass(<span class="string">&quot;com/kevin/registerdemo/MainActivity&quot;</span>);</span><br><span class="line">    JNINativeMethod method[] = &#123;</span><br><span class="line">            &#123;<span class="string">&quot;add&quot;</span>, <span class="string">&quot;(II)V&quot;</span>, (<span class="keyword">void</span> *) add&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    jint result = env-&gt;RegisterNatives(MainActivityClass,  method, <span class="number">1</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, <span class="string">&quot;kevinTest&quot;</span>, <span class="string">&quot;registerNatives result is : %d&quot;</span>, result);</span><br><span class="line">    <span class="keyword">return</span> JNI_VERSION_1_6;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="so-加载执行顺序"><a href="#so-加载执行顺序" class="headerlink" title="so 加载执行顺序"></a>so 加载执行顺序</h1><h2 id="常用加载so的方法"><a href="#常用加载so的方法" class="headerlink" title="常用加载so的方法"></a>常用加载<code>so</code>的方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.loadLibrary()&#96;: 自动读取&#96;so&#96;文件的文件名, 不需要加&#96;.so</span><br></pre></td></tr></table></figure>

<p>例如: <code>System.loadLibrary(&quot;native-lib&quot;);</code></p>
<p><code>System.load()</code>: 需要指定<code>so</code>的绝对路径</p>
<p>例如: <code>System.load(&quot;/data/data/xxx/test.so&quot;)</code></p>
<h2 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h2><ol>
<li><code>extern &quot;C&quot; void _init(void)&#123;&#125;</code></li>
<li><code>__attribute__((constructor, visibility (&quot;hidden&quot;))) void initarray_1(void)&#123;&#125;</code></li>
<li><code>extern &quot;C&quot; jint JNI_OnLoad(JavaVM *vm, void *reserved)&#123;&#125;</code></li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Kevin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/ndk/">http://example.com/ndk/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">凡墙总是门</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/so/">so</a><a class="post-meta__tags" href="/tags/ndk/">ndk</a></div><div class="post_share"><div class="social-share" data-image="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-02-25-094138.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/fridahookso/"><img class="prev-cover" src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-02-26-065402.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">frida hook so</div></div></a></div><div class="next-post pull-right"><a href="/androidenv/"><img class="next-cover" src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-02-24-023938.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">逆向环境搭建</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Kevin</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/kevinspider"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/kevinspider" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:zhangyang.spider@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JNI-%E7%AE%80%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">JNI 简述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NDK-%E7%AE%80%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">NDK 简述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ABI-%E5%92%8C%E6%94%AF%E6%8C%81%E7%9A%84%E6%8C%87%E4%BB%A4%E9%9B%86"><span class="toc-number">3.</span> <span class="toc-text">ABI 和支持的指令集</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Java-%E5%8F%8D%E5%B0%84"><span class="toc-number">4.</span> <span class="toc-text">Java 反射</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#java-%E5%8F%8D%E5%B0%84%E8%8E%B7%E5%8F%96%E7%B1%BB"><span class="toc-number">4.1.</span> <span class="toc-text">java 反射获取类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java-%E5%8F%8D%E5%B0%84%E8%8E%B7%E5%8F%96%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">java 反射获取构造方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java-%E5%8F%8D%E5%B0%84%E8%8E%B7%E5%8F%96%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7"><span class="toc-number">4.3.</span> <span class="toc-text">java 反射获取静态属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java-%E5%8F%8D%E5%B0%84%E8%8E%B7%E5%8F%96%E5%8A%A8%E6%80%81%E5%B1%9E%E6%80%A7"><span class="toc-number">4.4.</span> <span class="toc-text">java 反射获取动态属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java-%E5%8F%8D%E5%B0%84%E8%8E%B7%E5%8F%96%E5%B9%B6%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">4.5.</span> <span class="toc-text">java 反射获取并调用方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java-%E5%8F%8D%E5%B0%84%E6%A1%88%E4%BE%8B"><span class="toc-number">4.6.</span> <span class="toc-text">java 反射案例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Native-%E6%96%B9%E6%B3%95%E7%9A%84%E6%A0%87%E8%AF%86"><span class="toc-number">5.</span> <span class="toc-text">Native 方法的标识</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Jni-%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89%E5%92%8C%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="toc-number">6.</span> <span class="toc-text">Jni 函数定义和参数解析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Native-%E6%89%93%E5%8D%B0-log-%E6%97%A5%E5%BF%97"><span class="toc-number">7.</span> <span class="toc-text">Native 打印 log 日志</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#C-%E4%B8%AD%E5%AF%BC%E5%85%A5%E5%85%B6%E4%BB%96-C%E6%96%87%E4%BB%B6"><span class="toc-number">8.</span> <span class="toc-text">C++ 中导入其他 C文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JNI-%E5%92%8C-Java-%E5%92%8C-C-C-%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E6%98%A0%E5%B0%84"><span class="toc-number">9.</span> <span class="toc-text">JNI 和 Java 和 C&#x2F;C++ 基础数据类型映射</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">9.1.</span> <span class="toc-text">基础数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">9.2.</span> <span class="toc-text">引用数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">9.3.</span> <span class="toc-text">数组类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE-String-%E5%AF%B9%E8%B1%A1"><span class="toc-number">9.4.</span> <span class="toc-text">访问 String 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE-Array-%E5%AF%B9%E8%B1%A1"><span class="toc-number">9.5.</span> <span class="toc-text">访问 Array 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%87%AA%E5%AE%9A%E4%B9%89-Java-%E5%AF%B9%E8%B1%A1%E6%95%B0%E7%BB%84"><span class="toc-number">9.6.</span> <span class="toc-text">访问自定义 Java 对象数组</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">10.</span> <span class="toc-text">描述符</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">10.1.</span> <span class="toc-text">类描述符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">10.2.</span> <span class="toc-text">域描述符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%9F%9F%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">10.2.1.</span> <span class="toc-text">基本数据类型域描述符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%9F%9F%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">10.2.2.</span> <span class="toc-text">引用数据类型域描述符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">10.3.</span> <span class="toc-text">函数描述符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">10.4.</span> <span class="toc-text">数组描述符</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JNI-%E8%8E%B7%E5%8F%96-Java-%E5%B1%82"><span class="toc-number">11.</span> <span class="toc-text">JNI 获取 Java 层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JNI-%E8%8E%B7%E5%8F%96-Java-%E7%B1%BB"><span class="toc-number">11.1.</span> <span class="toc-text">JNI 获取 Java 类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JNI-%E8%8E%B7%E5%8F%96-Java-%E5%B1%82%E5%B1%9E%E6%80%A7"><span class="toc-number">11.2.</span> <span class="toc-text">JNI 获取 Java 层属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JNI-%E8%8E%B7%E5%8F%96-Java-%E5%B1%82%E6%96%B9%E6%B3%95"><span class="toc-number">11.3.</span> <span class="toc-text">JNI 获取 Java 层方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JNI-OnLoad"><span class="toc-number">12.</span> <span class="toc-text">JNI_OnLoad</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RegisterNatives"><span class="toc-number">13.</span> <span class="toc-text">RegisterNatives</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%B3%A8%E5%86%8C%E4%BB%A3%E7%A0%81"><span class="toc-number">13.1.</span> <span class="toc-text">动态注册代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JavaVM"><span class="toc-number">14.</span> <span class="toc-text">JavaVM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaVM-%E5%AE%9A%E4%B9%89"><span class="toc-number">14.1.</span> <span class="toc-text">JavaVM 定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaVM-2-%E7%A7%8D%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F"><span class="toc-number">14.2.</span> <span class="toc-text">JavaVM 2 种获取方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaVM-%E7%9B%B8%E5%85%B3-api"><span class="toc-number">14.3.</span> <span class="toc-text">JavaVM 相关 api</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JNIEnv"><span class="toc-number">15.</span> <span class="toc-text">JNIEnv</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">15.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JNIEnv-%E7%89%B9%E6%80%A7"><span class="toc-number">15.2.</span> <span class="toc-text">JNIEnv 特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-JNIEnv"><span class="toc-number">15.3.</span> <span class="toc-text">获取 JNIEnv</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">15.4.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JNI-%E8%AE%BF%E9%97%AE%E6%88%90%E5%91%98%E5%B1%9E%E6%80%A7%E6%B1%87%E6%80%BB"><span class="toc-number">16.</span> <span class="toc-text">JNI 访问成员属性汇总</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-Test-%E7%B1%BB%E6%B5%8B%E8%AF%95"><span class="toc-number">16.1.</span> <span class="toc-text">定义 Test 类测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-Field-%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">16.2.</span> <span class="toc-text">获取 Field 静态属性的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-Field-%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">16.3.</span> <span class="toc-text">设置 Field 静态属性的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-Field-%E5%8A%A8%E6%80%81%E5%B1%9E%E6%80%A7%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">16.4.</span> <span class="toc-text">获取 Field 动态属性的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-Field-%E5%8A%A8%E6%80%81%E5%B1%9E%E6%80%A7%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">16.5.</span> <span class="toc-text">设置 Field 动态属性的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E7%B1%BB%E7%9A%84%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7"><span class="toc-number">16.6.</span> <span class="toc-text">访问类的静态属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%B1%BB%E7%9A%84%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7"><span class="toc-number">16.7.</span> <span class="toc-text">修改类的静态属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">16.8.</span> <span class="toc-text">访问对象的属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">16.9.</span> <span class="toc-text">修改对象的属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%92%8C%E4%BF%AE%E6%94%B9%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">16.10.</span> <span class="toc-text">访问和修改数组类型的属性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JNI-%E8%AE%BF%E9%97%AE%E6%88%90%E5%91%98%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB"><span class="toc-number">17.</span> <span class="toc-text">JNI 访问成员方法汇总</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">17.1.</span> <span class="toc-text">访问构造函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E9%9D%99%E6%80%81%E5%87%BD%E6%95%B0"><span class="toc-number">17.2.</span> <span class="toc-text">访问静态函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E9%9D%9E%E9%9D%99%E6%80%81%E5%87%BD%E6%95%B0"><span class="toc-number">17.3.</span> <span class="toc-text">访问非静态函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E7%88%B6%E7%B1%BB%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">17.4.</span> <span class="toc-text">访问父类的函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JNI-%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1"><span class="toc-number">18.</span> <span class="toc-text">JNI 创建对象</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%B3%A8%E5%86%8C%E5%92%8C%E9%9D%99%E6%80%81%E6%B3%A8%E5%86%8C"><span class="toc-number">19.</span> <span class="toc-text">动态注册和静态注册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%B3%A8%E5%86%8C"><span class="toc-number">19.1.</span> <span class="toc-text">静态注册</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%B3%A8%E5%86%8C"><span class="toc-number">19.2.</span> <span class="toc-text">动态注册</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#so-%E5%8A%A0%E8%BD%BD%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">20.</span> <span class="toc-text">so 加载执行顺序</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%8A%A0%E8%BD%BDso%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">20.1.</span> <span class="toc-text">常用加载so的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">20.2.</span> <span class="toc-text">执行顺序</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/books-coder/" title="程序员的自我修养"><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-29-055533.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="程序员的自我修养"/></a><div class="content"><a class="title" href="/books-coder/" title="程序员的自我修养">程序员的自我修养</a><time datetime="2021-07-29T05:54:37.000Z" title="发表于 2021-07-29 13:54:37">2021-07-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/so1/" title="so基础入门"><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-15-050409.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="so基础入门"/></a><div class="content"><a class="title" href="/so1/" title="so基础入门">so基础入门</a><time datetime="2021-07-15T05:02:50.000Z" title="发表于 2021-07-15 13:02:50">2021-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/js_iterator/" title="js_迭代器与生成器"><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-08-030145.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="js_迭代器与生成器"/></a><div class="content"><a class="title" href="/js_iterator/" title="js_迭代器与生成器">js_迭代器与生成器</a><time datetime="2021-07-13T02:57:22.000Z" title="发表于 2021-07-13 10:57:22">2021-07-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/js_objectreference/" title="js_集合引用类型"><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-08-030145.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="js_集合引用类型"/></a><div class="content"><a class="title" href="/js_objectreference/" title="js_集合引用类型">js_集合引用类型</a><time datetime="2021-07-09T05:06:17.000Z" title="发表于 2021-07-09 13:06:17">2021-07-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/js_referenceType/" title="js_基本引用类型"><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-08-030145.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="js_基本引用类型"/></a><div class="content"><a class="title" href="/js_referenceType/" title="js_基本引用类型">js_基本引用类型</a><time datetime="2021-07-07T05:45:56.000Z" title="发表于 2021-07-07 13:45:56">2021-07-07</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Kevin</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: 'e26403e0bb1e289c53e6',
      clientSecret: '5826f8314e51e7f17499d405d916c47d2bae3ec4',
      repo: 'kevinspider.github.io',
      owner: 'kevinspider',
      admin: ['kevinspider'],
      id: '7736bad854548e8ced841f77c62436d6',
      language: 'en',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div></div></body></html>