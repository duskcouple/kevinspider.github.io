<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>常见加解密 | 凡墙总是门</title><meta name="robots" content="noindex"><meta name="keywords" content="加解密"><meta name="author" content="Kevin"><meta name="copyright" content="Kevin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="简单分类 对称加密: 加密和解密时使用的密钥相同, 典型的有 RC4, DES, AES 等;  序列密码: 将明文消息按字符逐位进行加密;  分组密码: 将明文消息分组 (每组多个字符)逐组进行加密;    非对称加密: 加密和解密时使用的密钥不同, 典型的有 RSA, ECC 椭圆曲线等  散列算法: 又称为哈希函数, 对不同长度的输入产生固定长度的输出; 这个固定长度的输出称为原输入消息的散">
<meta property="og:type" content="article">
<meta property="og:title" content="常见加解密">
<meta property="og:url" content="http://example.com/secret/index.html">
<meta property="og:site_name" content="凡墙总是门">
<meta property="og:description" content="简单分类 对称加密: 加密和解密时使用的密钥相同, 典型的有 RC4, DES, AES 等;  序列密码: 将明文消息按字符逐位进行加密;  分组密码: 将明文消息分组 (每组多个字符)逐组进行加密;    非对称加密: 加密和解密时使用的密钥不同, 典型的有 RSA, ECC 椭圆曲线等  散列算法: 又称为哈希函数, 对不同长度的输入产生固定长度的输出; 这个固定长度的输出称为原输入消息的散">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-12-082615.png">
<meta property="article:published_time" content="2021-04-12T13:13:14.000Z">
<meta property="article:modified_time" content="2021-09-23T09:20:37.259Z">
<meta property="article:author" content="Kevin">
<meta property="article:tag" content="加解密">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-12-082615.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/secret/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="T0kgJCNqdP"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-09-23 17:20:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-12-082615.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">凡墙总是门</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">常见加解密</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-04-12T13:13:14.000Z" title="发表于 2021-04-12 21:13:14">2021-04-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-09-23T09:20:37.259Z" title="更新于 2021-09-23 17:20:37">2021-09-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%8A%A0%E8%A7%A3%E5%AF%86/">加解密</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="简单分类"><a href="#简单分类" class="headerlink" title="简单分类"></a>简单分类</h1><ol>
<li>对称加密: 加密和解密时使用的密钥相同, 典型的有 RC4, DES, AES 等;<ol>
<li> 序列密码: 将明文消息按字符逐位进行加密;</li>
<li> 分组密码: 将明文消息分组 (每组多个字符)逐组进行加密;</li>
</ol>
</li>
<li> 非对称加密: 加密和解密时使用的密钥不同, 典型的有 RSA, ECC 椭圆曲线等</li>
<li> 散列算法: 又称为哈希函数, 对不同长度的输入产生固定长度的输出; 这个固定长度的输出称为原输入消息的散列或者消息摘要</li>
</ol>
<h1 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h1><p>不是一种加密, 只是一种编码方式, 并不涉及到加密密钥 Key; </p>
<p>base64是最常见的用于字节信息的编码方式, 基于64个可打印字符来表示二进制数据的方法;</p>
<table>
<thead>
<tr>
<th>索引</th>
<th>对应字符</th>
<th>索引</th>
<th>对应字符</th>
<th>索引</th>
<th>对应字符</th>
<th>索引</th>
<th>对应字符</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>A</td>
<td>17</td>
<td>R</td>
<td>34</td>
<td>i</td>
<td>51</td>
<td>z</td>
</tr>
<tr>
<td>1</td>
<td>B</td>
<td>18</td>
<td>S</td>
<td>35</td>
<td>j</td>
<td>52</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>C</td>
<td>19</td>
<td>T</td>
<td>36</td>
<td>k</td>
<td>53</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>D</td>
<td>20</td>
<td>U</td>
<td>37</td>
<td>l</td>
<td>54</td>
<td>2</td>
</tr>
<tr>
<td>4</td>
<td>E</td>
<td>21</td>
<td>V</td>
<td>38</td>
<td>m</td>
<td>55</td>
<td>3</td>
</tr>
<tr>
<td>5</td>
<td>F</td>
<td>22</td>
<td>W</td>
<td>39</td>
<td>n</td>
<td>56</td>
<td>4</td>
</tr>
<tr>
<td>6</td>
<td>G</td>
<td>23</td>
<td>X</td>
<td>40</td>
<td>o</td>
<td>57</td>
<td>5</td>
</tr>
<tr>
<td>7</td>
<td>H</td>
<td>24</td>
<td>Y</td>
<td>41</td>
<td>p</td>
<td>58</td>
<td>6</td>
</tr>
<tr>
<td>8</td>
<td>I</td>
<td>25</td>
<td>Z</td>
<td>42</td>
<td>q</td>
<td>59</td>
<td>7</td>
</tr>
<tr>
<td>9</td>
<td>J</td>
<td>26</td>
<td>a</td>
<td>43</td>
<td>r</td>
<td>60</td>
<td>8</td>
</tr>
<tr>
<td>10</td>
<td>K</td>
<td>27</td>
<td>b</td>
<td>44</td>
<td>s</td>
<td>61</td>
<td>9</td>
</tr>
<tr>
<td>11</td>
<td>L</td>
<td>28</td>
<td>c</td>
<td>45</td>
<td>t</td>
<td>62</td>
<td>+</td>
</tr>
<tr>
<td>12</td>
<td>M</td>
<td>29</td>
<td>d</td>
<td>46</td>
<td>u</td>
<td>63</td>
<td>/</td>
</tr>
<tr>
<td>13</td>
<td>N</td>
<td>30</td>
<td>e</td>
<td>47</td>
<td>v</td>
<td></td>
<td></td>
</tr>
<tr>
<td>14</td>
<td>O</td>
<td>31</td>
<td>f</td>
<td>48</td>
<td>w</td>
<td></td>
<td></td>
</tr>
<tr>
<td>15</td>
<td>P</td>
<td>32</td>
<td>g</td>
<td>49</td>
<td>x</td>
<td></td>
<td></td>
</tr>
<tr>
<td>16</td>
<td>Q</td>
<td>33</td>
<td>h</td>
<td>50</td>
<td>y</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="编码原理"><a href="#编码原理" class="headerlink" title="编码原理"></a>编码原理</h2><p>在 base64中, 最大值为63, 二进制为0b111111, 也就是使用了6bit; （2的6次幂就是64）表示字符，因此叫做Base64。同理，Base32就是用5位，Base16就是用4位。大家可以按照上面的步骤进行演化一下。</p>
<p> 6bit 和8bit 的最小公倍数为24bit, 24bit/8=3byte(字节); 也就是要想刚好表示需要是3字节的倍数, 如果不是3的倍数, 那么就需要使用=号进行填充;</p>
<p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-12-140802.jpg"></p>
<ul>
<li>  第一步：“M”、“a”、”n”对应的ASCII码值分别为77，97，110，对应的二进制值是01001101、01100001、01101110。如图第二三行所示，由此组成一个24位的二进制字符串。</li>
<li>  第二步：如图红色框，将24位每6位二进制位一组分成四组。</li>
<li>  第三步：在上面每一组前面补两个0，扩展成32个二进制位，此时变为四个字节：00010011、00010110、00000101、00101110。分别对应的值（Base64编码索引）为：19、22、5、46。</li>
<li>  第四步：用上面的值在Base64编码表中进行查找，分别对应：T、W、F、u。因此“Man”Base64编码之后就变为：TWFu。</li>
</ul>
<p>位数不足的情况:</p>
<p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-12-140430.jpg"></p>
<ul>
<li>  一个字节：一个字节共8个二进制位，依旧按照规则进行分组。此时共8个二进制位，每6个一组，则第二组缺少4位，用0补齐，得到两个Base64编码，而后面两组没有对应数据，都用“=”补上。因此，上图中“A”转换之后为“QQ==”；</li>
<li>  两个字节：两个字节共16个二进制位，依旧按照规则进行分组。此时总共16个二进制位，每6个一组，则第三组缺少2位，用0补齐，得到三个Base64编码，第四组完全没有数据则用“=”补上。因此，上图中“BC”转换之后为“QKM=”；</li>
</ul>
<h2 id="快速识别"><a href="#快速识别" class="headerlink" title="快速识别"></a>快速识别</h2><ol>
<li> 输出字符串内容, 全部是可见字符</li>
<li> 输入输出的字符串长度</li>
<li> 逆向分析时明显的编码表以及查表过程, ida 中通过 text 快速定位编码表</li>
</ol>
<h2 id="frida-实战"><a href="#frida-实战" class="headerlink" title="frida 实战"></a>frida 实战</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取 so 文件基地址</span></span><br><span class="line">    <span class="keyword">var</span> base = Module.findBaseAddress(<span class="string">&quot;libnative-lib.so&quot;</span>);</span><br><span class="line">    <span class="comment">// 获取目标函数偏移</span></span><br><span class="line">    <span class="keyword">var</span> sub_834_addr = base.add(<span class="number">0x835</span>) <span class="comment">// thumb 需要 +1</span></span><br><span class="line">    <span class="comment">// 使用 new NativeFunction 将函数注册到 js</span></span><br><span class="line">    <span class="keyword">var</span> sub_834 = <span class="keyword">new</span> NativeFunction(sub_834_addr, <span class="string">&#x27;pointer&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line">    <span class="comment">// 开辟内存, 创建入参</span></span><br><span class="line">    <span class="keyword">var</span> arg0 = Memory.alloc(<span class="number">10</span>);</span><br><span class="line">    ptr(arg0).writeUtf8String(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> result = sub_834(arg0);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;result is :&quot;</span>, hexdump(result));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>







<h1 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h1><h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>RC4是序列密码, 对明文逐字节进行加密; 不需要对明文进行填充;</p>
<p>关键点: 对明文使用同一个密钥异或两次最后是得到原文的!!</p>
<ol>
<li><p> 初始化秘钥：根据输入的秘钥key，使用密钥调度算法（KSA）生成一个256字节的sbox。</p>
</li>
<li><p> 再通过伪随机数生成算法（PRGA）得到密钥流（keystream）</p>
</li>
<li><p> 加密：密钥流与明文进行异或运算得到密文</p>
</li>
<li><p> 解密：秘文与密钥流进行异或运算得到明文</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="comment">//#include &quot;base64.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> ULONG;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rc4_init</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *s, <span class="keyword">unsigned</span> <span class="keyword">char</span> *key, <span class="keyword">unsigned</span> <span class="keyword">long</span> Len)</span> <span class="comment">//初始化函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i =<span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> k[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++) &#123;</span><br><span class="line">        s[i] = i;</span><br><span class="line">        k[i] = key[i%Len];  <span class="comment">// 循环使用 key 来填充 k 向量, [1,2,3,4,5,6,7,8,1,2,3,4,5,6,7,8]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++) &#123;</span><br><span class="line">        j=(j+s[i]+k[i])%<span class="number">256</span>;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j]; <span class="comment">//交换s[i]和s[j]</span></span><br><span class="line">        s[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rc4_crypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *s, <span class="keyword">unsigned</span> <span class="keyword">char</span> *Data, <span class="keyword">unsigned</span> <span class="keyword">long</span> Len)</span> <span class="comment">//加解密</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> tmp;</span><br><span class="line">    <span class="keyword">for</span>(k=<span class="number">0</span>;k&lt;Len;k++) &#123;</span><br><span class="line">        i=(i+<span class="number">1</span>)%<span class="number">256</span>;</span><br><span class="line">        j=(j+s[i])%<span class="number">256</span>;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j]; <span class="comment">//交换s[x]和s[y]</span></span><br><span class="line">        s[j] = tmp;</span><br><span class="line">        t=(s[i]+s[j])%<span class="number">256</span>;</span><br><span class="line">        Data[k] ^= s[t];</span><br><span class="line">     &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> s[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;; <span class="comment">//S-box</span></span><br><span class="line">    <span class="keyword">char</span> key[<span class="number">256</span>] = &#123;<span class="string">&quot;12345678&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">char</span> pData[<span class="number">512</span>] = <span class="string">&quot;人生若只如初见&quot;</span>;</span><br><span class="line">    ULONG len = <span class="built_in">strlen</span>(pData);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;key : %s\n&quot;</span>, key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;raw : %s\n&quot;</span>, pData);</span><br><span class="line">    </span><br><span class="line">    rc4_init(s,(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)key,<span class="built_in">strlen</span>(key)); <span class="comment">//已经完成了初始化</span></span><br><span class="line">    rc4_crypt(s,(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)pData,len);<span class="comment">//加密 s 经过打乱之后的 密钥, pData 等待加密的字符, len pData 长度</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;encrypt  : %s\n&quot;</span>, pData);</span><br><span class="line">    <span class="comment">// printf(&quot;encrypt64: %s\n&quot;, base64_encode(pData, len));</span></span><br><span class="line">    </span><br><span class="line">    rc4_init(s,(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)key, <span class="built_in">strlen</span>(key)); <span class="comment">//初始化密钥</span></span><br><span class="line">    rc4_crypt(s,(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)pData,len);<span class="comment">//解密</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decrypt  : %s\n&quot;</span>,pData);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="快速识别-1"><a href="#快速识别-1" class="headerlink" title="快速识别"></a>快速识别</h2><ol>
<li> 在 KSA 阶段, 需要有长度为256的状态向量, 即 s-box 的参与; 并会有两轮256大小的循环, 对状态向量 s-box 进行扰乱;</li>
<li> 在 PRGA 阶段, 会有循环次数为加密内容字节数的循环体, 每一次循环中都会有状态向量即 s-box 的参与, 并会重新扰乱 s-box 生成新的状态向量;</li>
<li> 明文和密文的长度相等, 可以使用 frida hook之后主动调用来查看长度</li>
<li> RC4作为对称密码中的序列密码, 没有特别的常量的存在, 256算是多次出现的数字;</li>
</ol>
<h1 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h1><h2 id="原理实现"><a href="#原理实现" class="headerlink" title="原理实现"></a>原理实现</h2><p>DES 为分组密码, 需要对明文进行填充;</p>
<p>DES 分组长度为: 64位</p>
<p>DES 加密中, 明文按64位进行分组, 密钥长度为64位, 而实际上是56位参与了 DES 运算 (第8, 16, 24, 32, 40, 48, 56, 64 是有效校验位); 分组后的明文组和56位的密钥按位替换或交换的方法形成密文组的加密方法;</p>
<p>DES 算法主要采用替换和移位的方式进行加密, 它用56位(64位密钥只有56位有效) 对64位二进制数据块进行加密, 每次加密对64位的输入数据进行16轮编码, 经过一系列替换和移位后, 输入的64位原数据转换成完全不同的64位输出数据; DES 作为分组密码, 主要的实现过程由两部分组成, 分别是密钥的生成以及明文的处理, 其中每一个分组的明文的处理分为16轮进行, 而对于每一轮都需要使用密钥编排部分生成的子密钥参与运算;</p>
<h2 id="android-实现"><a href="#android-实现" class="headerlink" title="android 实现"></a>android 实现</h2><p>android 本身提供了用于加解密的类, <code>javax.crypto.Cipher</code>类, 直接使用即可; 其中的 DES 代表使用 DES 加密算法, CBC 代表分组加密的工作模式, PKCS5Padding 代表分组的填充方式; 在加解密的过程中, 主要的密钥和 IV 是在 Cipher 类中的 init 函数中进行传递的, 因此, 只需要 hook 住该函数就可以获得密钥和 IV;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kanxue.desencrypt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Base64;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> java.security.Key;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.DESKeySpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DES</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ALGORITHM = <span class="string">&quot;DES&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String HEX = <span class="string">&quot;0123456789ABCDEF&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String IVPARAMETERSPEC = <span class="string">&quot;01020304&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SHA1PRNG = <span class="string">&quot;SHA1PRNG&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TRANSFORMATION = <span class="string">&quot;DES/CBC/PKCS5Padding&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes_key = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">20</span>];</span><br><span class="line">            SecureRandom.getInstance(SHA1PRNG).nextBytes(bytes_key);</span><br><span class="line">            <span class="keyword">return</span> toHex(bytes_key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encode</span><span class="params">(String key, String data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> encode(key, data.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Key <span class="title">getRawKey</span><span class="params">(String key)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SecretKeyFactory.getInstance(ALGORITHM).generateSecret(<span class="keyword">new</span> DESKeySpec(key.getBytes()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encode</span><span class="params">(String key, <span class="keyword">byte</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Cipher cipher = Cipher.getInstance(TRANSFORMATION);</span><br><span class="line">            cipher.init(<span class="number">1</span>, getRawKey(key), <span class="keyword">new</span> IvParameterSpec(IVPARAMETERSPEC.getBytes()));</span><br><span class="line">            <span class="keyword">return</span> Base64.encodeToString(cipher.doFinal(data), <span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Encrypt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String result = encode(IVPARAMETERSPEC, <span class="string">&quot;testdes&quot;</span>.getBytes());</span><br><span class="line">        Log.i(<span class="string">&quot;des&quot;</span>, <span class="string">&quot;content:testdes---&quot;</span> + result);</span><br><span class="line">        String result1 = encode(IVPARAMETERSPEC, <span class="string">&quot;testdesa&quot;</span>.getBytes());</span><br><span class="line">        Log.i(<span class="string">&quot;des&quot;</span>, <span class="string">&quot;content:testdesa---&quot;</span> + result1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toHex</span><span class="params">(<span class="keyword">byte</span>[] buf)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (buf == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> BuildConfig.FLAVOR;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuffer result = <span class="keyword">new</span> StringBuffer(buf.length * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> b : buf) &#123;</span><br><span class="line">            appendHex(result, b);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">appendHex</span><span class="params">(StringBuffer sb, <span class="keyword">byte</span> b)</span> </span>&#123;</span><br><span class="line">        sb.append(HEX.charAt((b &gt;&gt; <span class="number">4</span>) &amp; <span class="number">15</span>));</span><br><span class="line">        sb.append(HEX.charAt(b &amp; <span class="number">15</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="c-实现"><a href="#c-实现" class="headerlink" title="c 实现"></a>c 实现</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//IP初始置换表</span></span><br><span class="line"><span class="keyword">int</span> IP_Table[<span class="number">64</span>] = &#123;</span><br><span class="line">        <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">        <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,</span><br><span class="line">        <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line">        <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//IP逆置换表</span></span><br><span class="line"><span class="keyword">int</span> IPR_Table[<span class="number">64</span>] = &#123;</span><br><span class="line">        <span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line">        <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>, <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line">        <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>, <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line">        <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>, <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//f函数中E位选择表(扩展置换表)</span></span><br><span class="line"><span class="keyword">int</span> E_Table[<span class="number">48</span>] = &#123;</span><br><span class="line">        <span class="number">32</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>,</span><br><span class="line">        <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>,</span><br><span class="line">        <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>,</span><br><span class="line">        <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//f函数中的p表（4x8）</span></span><br><span class="line"><span class="keyword">int</span> P_Table[<span class="number">32</span>] = &#123;</span><br><span class="line">        <span class="number">16</span>, <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>,</span><br><span class="line">        <span class="number">2</span>, <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>, <span class="number">32</span>, <span class="number">27</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">25</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> PC1_Table[<span class="number">56</span>] = &#123;</span><br><span class="line">        <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>,</span><br><span class="line">        <span class="number">10</span>, <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>,</span><br><span class="line">        <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>,</span><br><span class="line">        <span class="number">14</span>, <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//PC2选位表(密钥生成置换表2)</span></span><br><span class="line"><span class="keyword">int</span> PC2_Table[<span class="number">48</span>] = &#123;</span><br><span class="line">        <span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">28</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span>,</span><br><span class="line">        <span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">26</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">2</span>,</span><br><span class="line">        <span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">55</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>,</span><br><span class="line">        <span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>, <span class="number">34</span>, <span class="number">53</span>, <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//左移位数表</span></span><br><span class="line"><span class="keyword">int</span> LOOP_Table[<span class="number">16</span>] = &#123;</span><br><span class="line">        <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// S盒</span></span><br><span class="line"><span class="keyword">int</span> S_Box[<span class="number">8</span>][<span class="number">4</span>][<span class="number">16</span>] = &#123;</span><br><span class="line">        <span class="comment">// S1</span></span><br><span class="line">        <span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">7</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">15</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">13</span>,</span><br><span class="line">        <span class="comment">//S2</span></span><br><span class="line">        <span class="number">15</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>,</span><br><span class="line">        <span class="number">3</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">5</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">15</span>,</span><br><span class="line">        <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">9</span>,</span><br><span class="line">        <span class="comment">//S3</span></span><br><span class="line">        <span class="number">10</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>,</span><br><span class="line">        <span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">1</span>,</span><br><span class="line">        <span class="number">13</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">7</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">12</span>,</span><br><span class="line">        <span class="comment">//S4</span></span><br><span class="line">        <span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">15</span>,</span><br><span class="line">        <span class="number">13</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">9</span>,</span><br><span class="line">        <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>,</span><br><span class="line">        <span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">14</span>,</span><br><span class="line">        <span class="comment">//S5</span></span><br><span class="line">        <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>,</span><br><span class="line">        <span class="number">14</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">14</span>,</span><br><span class="line">        <span class="number">11</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>,</span><br><span class="line">        <span class="comment">//S6</span></span><br><span class="line">        <span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>,</span><br><span class="line">        <span class="number">10</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">8</span>,</span><br><span class="line">        <span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>,</span><br><span class="line">        <span class="comment">//S7</span></span><br><span class="line">        <span class="number">4</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">1</span>,</span><br><span class="line">        <span class="number">13</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>,</span><br><span class="line">        <span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">12</span>,</span><br><span class="line">        <span class="comment">//S8</span></span><br><span class="line">        <span class="number">13</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">7</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">2</span>,</span><br><span class="line">        <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>,</span><br><span class="line">        <span class="number">2</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ShowArray</span><span class="params">(<span class="keyword">int</span> *<span class="built_in">array</span>, <span class="keyword">int</span> num)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BitsCopy</span><span class="params">(<span class="keyword">int</span> *DatOut, <span class="keyword">int</span> *DatIn, <span class="keyword">int</span> Len)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将字符数组转换成二进制数组</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CharToBit</span><span class="params">(<span class="keyword">char</span> *input, <span class="keyword">int</span> *output, <span class="keyword">int</span> bits)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; bits; i++) &#123;</span><br><span class="line">        output[i] = (input[i / <span class="number">8</span>] &gt;&gt; (i % <span class="number">8</span>)) &amp; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将二进制数组转换成字符数组</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BitToChar</span><span class="params">(<span class="keyword">int</span> *input, <span class="keyword">char</span> *output, <span class="keyword">int</span> bits)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; (bits / <span class="number">8</span>); i++) &#123;</span><br><span class="line">        output[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; bits; i++) &#123;</span><br><span class="line">        output[i / <span class="number">8</span>] |= input[i] &lt;&lt; (i % <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//完成异或操作</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Xor</span><span class="params">(<span class="keyword">int</span> InA[], <span class="keyword">int</span> InB[], <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        InA[i] = InA[i] ^ InB[i];                  <span class="comment">//按位异或</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//IP初始置换和逆置换函数,由table决定是逆置换还是初始置换</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IP_IPR</span><span class="params">(<span class="keyword">int</span> input[<span class="number">64</span>], <span class="keyword">int</span> output[<span class="number">64</span>], <span class="keyword">int</span> table[<span class="number">64</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">        output[i] = input[table[i] - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//E盒扩展</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">E</span><span class="params">(<span class="keyword">int</span> input[<span class="number">32</span>], <span class="keyword">int</span> output[<span class="number">48</span>], <span class="keyword">int</span> table[<span class="number">48</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++) &#123;</span><br><span class="line">        output[i] = input[table[i] - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//P盒替代</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">P</span><span class="params">(<span class="keyword">int</span> input[<span class="number">32</span>], <span class="keyword">int</span> output[<span class="number">32</span>], <span class="keyword">int</span> table[<span class="number">32</span>])</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        output[i] = input[table[i] - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//PC-1置换选择</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PC_1</span><span class="params">(<span class="keyword">int</span> input[<span class="number">64</span>], <span class="keyword">int</span> output[<span class="number">56</span>], <span class="keyword">int</span> table[<span class="number">56</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">56</span>; i++) &#123;</span><br><span class="line">        output[i] = input[table[i] - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//PC-2置换选择</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PC_2</span><span class="params">(<span class="keyword">int</span> input[<span class="number">56</span>], <span class="keyword">int</span> output[<span class="number">48</span>], <span class="keyword">int</span> table[<span class="number">48</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++) &#123;</span><br><span class="line">        output[i] = input[table[i] - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//S盒压缩</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">S</span><span class="params">(<span class="keyword">int</span> input[<span class="number">48</span>], <span class="keyword">int</span> output[<span class="number">32</span>], <span class="keyword">int</span> table[<span class="number">8</span>][<span class="number">4</span>][<span class="number">16</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, X, Y;                                    <span class="comment">// i为8个S盒</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, Y = <span class="number">0</span>, X = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++, input += <span class="number">6</span>, output += <span class="number">4</span>)   <span class="comment">// 每执行一次,输入数据偏移6位</span></span><br><span class="line">    &#123;                                              <span class="comment">// 每执行一次,输出数据偏移4位</span></span><br><span class="line">        Y = (input[<span class="number">0</span>] &lt;&lt; <span class="number">1</span>) + input[<span class="number">5</span>];                          <span class="comment">// af代表第几行</span></span><br><span class="line">        X = (input[<span class="number">1</span>] &lt;&lt; <span class="number">3</span>) + (input[<span class="number">2</span>] &lt;&lt; <span class="number">2</span>) + (input[<span class="number">3</span>] &lt;&lt; <span class="number">1</span>) + input[<span class="number">4</span>]; <span class="comment">// bcde代表第几列</span></span><br><span class="line">        <span class="keyword">char</span> temp = (<span class="keyword">char</span>) table[i][<span class="number">4</span>][<span class="number">16</span>];</span><br><span class="line">        CharToBit(&amp;temp, output, <span class="number">4</span>);      <span class="comment">// 把找到的点数据换为二进制</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//F轮函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">F_func</span><span class="params">(<span class="keyword">int</span> input[<span class="number">32</span>], <span class="keyword">int</span> subkey[<span class="number">48</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> MiR[<span class="number">48</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> temp[<span class="number">32</span>];</span><br><span class="line">    E(input, MiR, E_Table);                <span class="comment">// 输入32位通过E选位变为48位</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;E盒扩展：\n&quot;</span>);</span><br><span class="line">    ShowArray(MiR, <span class="number">48</span>);</span><br><span class="line">    Xor(MiR, subkey, <span class="number">48</span>);                   <span class="comment">// 和子密钥异或</span></span><br><span class="line">    S(MiR, input, S_Box);                 <span class="comment">// S盒变换</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;S盒替代:\n&quot;</span>);</span><br><span class="line">    ShowArray(input, <span class="number">32</span>);</span><br><span class="line">    BitsCopy(temp, input, <span class="number">32</span>);</span><br><span class="line">    P(temp, input, P_Table);  <span class="comment">// P置换后输出</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;P盒置换:\n&quot;</span>);</span><br><span class="line">    ShowArray(input, <span class="number">32</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*-------------------------------</span></span><br><span class="line"><span class="comment"> 把DatIn开始的长度位Len位的二进制</span></span><br><span class="line"><span class="comment"> 复制到DatOut后</span></span><br><span class="line"><span class="comment">--------------------------------*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BitsCopy</span><span class="params">(<span class="keyword">int</span> *DatOut, <span class="keyword">int</span> *DatIn, <span class="keyword">int</span> Len)</span>     <span class="comment">// 数组复制 OK</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Len; i++) &#123;</span><br><span class="line">        DatOut[i] = DatIn[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子秘钥中循环左移函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RotateL</span><span class="params">(<span class="keyword">int</span> input[<span class="number">28</span>], <span class="keyword">int</span> output[<span class="number">28</span>], <span class="keyword">int</span> loop)</span> </span>&#123;</span><br><span class="line">    BitsCopy(output, input + loop, <span class="number">28</span> - loop);</span><br><span class="line">    BitsCopy(output + <span class="number">28</span> - loop, input, loop);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子秘钥生成</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">subKey_fun</span><span class="params">(<span class="keyword">int</span> input[<span class="number">64</span>], <span class="keyword">int</span> Subkey[<span class="number">16</span>][<span class="number">48</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> temp[<span class="number">56</span>];</span><br><span class="line">    <span class="keyword">int</span> *KeyL = &amp;temp[<span class="number">0</span>], *KeyR = &amp;temp[<span class="number">28</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;***子秘钥的生成：***\n&quot;</span>);</span><br><span class="line">    PC_1(input, temp, PC1_Table);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;PC-1置换:\n&quot;</span>);</span><br><span class="line">    ShowArray(temp, <span class="number">56</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;子秘钥第%d:\n&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">        RotateL(KeyL, KeyL, LOOP_Table[i]);       <span class="comment">// 前28位左移</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;循环左移后左部:\n&quot;</span>);</span><br><span class="line">        ShowArray(KeyL, <span class="number">28</span>);</span><br><span class="line">        RotateL(KeyR, KeyR, LOOP_Table[i]);          <span class="comment">// 后28位左移</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;循环左移后右部:\n&quot;</span>);</span><br><span class="line">        ShowArray(KeyR, <span class="number">28</span>);</span><br><span class="line">        PC_2(temp, Subkey[i], PC2_Table);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;PC-2选择置换:\n&quot;</span>);</span><br><span class="line">        ShowArray(Subkey[i], <span class="number">48</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*----------------------------------</span></span><br><span class="line"><span class="comment"> 二进制密文转换为十六进制</span></span><br><span class="line"><span class="comment"> 需要16个字符表示</span></span><br><span class="line"><span class="comment">-----------------------------------*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BitToHex</span><span class="params">(<span class="keyword">char</span> *DatOut, <span class="keyword">int</span> *DatIn, <span class="keyword">int</span> Num)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Num / <span class="number">4</span>; i++) &#123;</span><br><span class="line">        DatOut[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Num / <span class="number">4</span>; i++) &#123;</span><br><span class="line">        DatOut[i] = DatIn[i * <span class="number">4</span>] + (DatIn[i * <span class="number">4</span> + <span class="number">1</span>] &lt;&lt; <span class="number">1</span>)</span><br><span class="line">                    + (DatIn[i * <span class="number">4</span> + <span class="number">2</span>] &lt;&lt; <span class="number">2</span>) + (DatIn[i * <span class="number">4</span> + <span class="number">3</span>] &lt;&lt; <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">if</span> ((DatOut[i] % <span class="number">16</span>) &gt; <span class="number">9</span>) &#123;</span><br><span class="line">            DatOut[i] = DatOut[i] % <span class="number">16</span> + <span class="string">&#x27;7&#x27;</span>;       <span class="comment">//  余数大于9时处理 10-15 to A-F</span></span><br><span class="line">        &#125;                                     <span class="comment">//  输出字符</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            DatOut[i] = DatOut[i] % <span class="number">16</span> + <span class="string">&#x27;0&#x27;</span>;       <span class="comment">//  输出字符</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//DES加密</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DES_Dfun</span><span class="params">(<span class="keyword">int</span> input[], <span class="keyword">char</span> key_in[], <span class="keyword">char</span> output[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ML[<span class="number">32</span>] = &#123;<span class="number">0</span>&#125;, MR[<span class="number">32</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> temp1[<span class="number">64</span>], temp2[<span class="number">32</span>], temp3[<span class="number">64</span>];</span><br><span class="line">    <span class="keyword">int</span> Subkey[<span class="number">16</span>][<span class="number">48</span>];</span><br><span class="line">    <span class="keyword">int</span> input_l[<span class="number">32</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> input_r[<span class="number">32</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> testi = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (testi = <span class="number">0</span>; testi &lt; <span class="number">32</span>; testi++) &#123;</span><br><span class="line">        input_l[testi] = input[testi];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (testi = <span class="number">0</span>; testi &lt; <span class="number">32</span>; testi++) &#123;</span><br><span class="line">        input_r[testi] = input[<span class="number">32</span> + testi];</span><br><span class="line">    &#125;</span><br><span class="line">    BitsCopy(ML, input_l, <span class="number">32</span>);</span><br><span class="line">    BitsCopy(MR, input_r, <span class="number">32</span>);</span><br><span class="line">    BitsCopy(temp1, input, <span class="number">64</span>);</span><br><span class="line">    IP_IPR(temp1, input, IP_Table); <span class="comment">//IP置换</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;IP初始置换：\n&quot;</span>);</span><br><span class="line">    ShowArray(input, <span class="number">64</span>);</span><br><span class="line">    CharToBit(key_in, temp3, <span class="number">64</span>);</span><br><span class="line">    subKey_fun(temp3, Subkey);   <span class="comment">//子秘钥的生成</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)                       <span class="comment">// 迭代16次</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;***第%d轮迭代:***\n&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">        BitsCopy(temp2, MR, <span class="number">32</span>);            <span class="comment">// 临时存储</span></span><br><span class="line">        F_func(MR, Subkey[i]);           <span class="comment">// F函数变换</span></span><br><span class="line">        Xor(MR, ML, <span class="number">32</span>);             <span class="comment">// 得到Ri</span></span><br><span class="line">        BitsCopy(ML, temp2, <span class="number">32</span>);            <span class="comment">// 得到Li</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ML:\n&quot;</span>);</span><br><span class="line">        ShowArray(ML, <span class="number">32</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;MR:\n&quot;</span>);</span><br><span class="line">        ShowArray(MR, <span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    IP_IPR(input, temp1, IPR_Table);</span><br><span class="line">    BitToHex(output, input, <span class="number">64</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出字符数组</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ShowArray</span><span class="params">(<span class="keyword">int</span> *<span class="built_in">array</span>, <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, <span class="built_in">array</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> MyKey[<span class="number">9</span>] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>&#125;;           <span class="comment">// 初始密钥 8字节*8</span></span><br><span class="line">    <span class="keyword">char</span> MyMessage[<span class="number">9</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">0</span>&#125;;       <span class="comment">// 初始明文</span></span><br><span class="line">    <span class="keyword">int</span> KeyBin[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;, MesBin[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">char</span> ciphertext[<span class="number">9</span>];</span><br><span class="line"><span class="comment">/*-----------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 密钥</span></span><br><span class="line">    CharToBit(MyMessage, MesBin, <span class="number">64</span>);</span><br><span class="line">    DES_Dfun(MesBin, MyKey, ciphertext);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;明文已被加密!\n&quot;</span>);  <span class="comment">// 信息已加密</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c &quot;</span>, ciphertext[i]);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">/*------------------------------------------------*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_desencrypt_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject <span class="comment">/* this */</span>) &#123;</span><br><span class="line">    main();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">&quot;Hello from C++&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="hook-android-des"><a href="#hook-android-des" class="headerlink" title="hook android des"></a>hook android des</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///&lt;reference path=&#x27;./index.d.ts&#x27;/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;执行 -&gt; &quot;</span>, <span class="string">&quot;hook&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> CipherClass = Java.use(<span class="string">&quot;javax.crypto.Cipher&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> KeyClass = Java.use(<span class="string">&quot;java.security.Key&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> IvClass = Java.use(<span class="string">&quot;javax.crypto.spec.IvParameterSpec&quot;</span>);</span><br><span class="line">        CipherClass.getInstance.overload(<span class="string">&quot;java.lang.String&quot;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">arg0</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;getInstance &quot;</span>, arg0);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.getInstance(arg0);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CipherClass.init.overload(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.security.Key&#x27;</span>, <span class="string">&#x27;java.security.spec.AlgorithmParameterSpec&#x27;</span>)</span><br><span class="line">            .implementation = <span class="function"><span class="keyword">function</span> (<span class="params">arg0, arg1, arg2</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;init&quot;</span>, <span class="string">&quot;int&quot;</span>, arg0);</span><br><span class="line">            <span class="keyword">var</span> keyobj = Java.cast(arg1,KeyClass)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;init&quot;</span>,<span class="string">&quot;key&quot;</span>,keyobj.getAlgorithm(),<span class="built_in">JSON</span>.stringify(keyobj.getEncoded()));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;init&quot;</span>,<span class="string">&quot;iv&quot;</span>, <span class="built_in">JSON</span>.stringify(Java.cast(arg2,IvClass).getIV()));</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.init(arg0, arg1, arg2);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CipherClass.doFinal.overload(<span class="string">&#x27;[B&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">byteArray</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;doFinal data&quot;</span>,<span class="built_in">JSON</span>.stringify(byteArray));</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">this</span>.doFinal(byteArray);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;doFinal result&quot;</span>,<span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    hook();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure>



<h1 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h1><h2 id="原理实现-1"><a href="#原理实现-1" class="headerlink" title="原理实现"></a>原理实现</h2><p>AES 是最常见的对称加密算法, 加密和解密使用的是相同的密钥;</p>
<p>AES 分组长度为: 128位</p>
<p>AES 为分组加密, 就是将明文分为不同的组, 每组长度相等, 直到加密完整个明文; 在 AES 标准规范中, 分组长度只能是128位, 也就是说每个分组为16个字节(每个字节8位), 密钥长度可以使用128位, 192位或256位, 密钥长度不同, 推荐加密轮数也不同;</p>
<table>
<thead>
<tr>
<th>AES</th>
<th>密钥长度（bit)</th>
<th>分组长度(bit)</th>
<th>加密轮数</th>
</tr>
</thead>
<tbody><tr>
<td>AES-128</td>
<td>128bit = 16字节</td>
<td>128bit = 16字节</td>
<td>10</td>
</tr>
<tr>
<td>AES-192</td>
<td>192bit = 24字节</td>
<td>128bit = 16字节</td>
<td>12</td>
</tr>
<tr>
<td>AES-256</td>
<td>256bit = 32字节</td>
<td>128bit = 16字节</td>
<td>14</td>
</tr>
</tbody></table>
<h2 id="android-实现-1"><a href="#android-实现-1" class="headerlink" title="android 实现"></a>android 实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Myaes</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String result = Encrypt(<span class="string">&quot;kanxuetest&quot;</span>, <span class="string">&quot;0102030405060708&quot;</span>);</span><br><span class="line">            String result1 = Decrypt(result, <span class="string">&quot;0102030405060708&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;加密结果:&quot;</span> + result + <span class="string">&quot;-----&quot;</span> + <span class="string">&quot;解密结果:&quot;</span> + result1);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">Encrypt</span><span class="params">(String sSrc, String sKey)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sKey == <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;Key为空null&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sKey.length() != <span class="number">16</span>) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;Key长度不是16位&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            SecretKeySpec skeySpec = <span class="keyword">new</span> SecretKeySpec(sKey.getBytes(<span class="string">&quot;utf-8&quot;</span>), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            Cipher cipher = Cipher.getInstance(<span class="string">&quot;AES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">            cipher.init(<span class="number">1</span>, skeySpec);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(Base64.getEncoder().encodeToString(cipher.doFinal(sSrc.getBytes(<span class="string">&quot;utf-8&quot;</span>))));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">Decrypt</span><span class="params">(String sSrc, String sKey)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sKey == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;Key为空null&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                System.out.println(ex.toString());</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sKey.length() != <span class="number">16</span>) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;Key长度不是16位&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            SecretKeySpec skeySpec = <span class="keyword">new</span> SecretKeySpec(sKey.getBytes(<span class="string">&quot;utf-8&quot;</span>), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            Cipher cipher = Cipher.getInstance(<span class="string">&quot;AES/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">            cipher.init(<span class="number">2</span>, skeySpec);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> String(cipher.doFinal(Base64.getDecoder().decode(sSrc.getBytes(<span class="string">&quot;UTF-8&quot;</span>))), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.out.println(e.toString());</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="hook-android-aes"><a href="#hook-android-aes" class="headerlink" title="hook android aes"></a>hook android aes</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///&lt;reference path=&#x27;./index.d.ts&#x27;/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//com.kanxue.aes_test</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;执行 -&gt; &quot;</span>, <span class="string">&quot;hook&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> SecretKeySpecClass = Java.use(<span class="string">&quot;javax.crypto.spec.SecretKeySpec&quot;</span>);</span><br><span class="line">        SecretKeySpecClass.$init.overload(<span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;java.lang.String&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">byteArray, str</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;SecretKeySpecClass.$init sKey Bytes&quot;</span>, <span class="built_in">JSON</span>.stringify(byteArray));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;SecretKeySpecClass.$init str&quot;</span>, str);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.$init(byteArray, str);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> CipherClass = Java.use(<span class="string">&quot;javax.crypto.Cipher&quot;</span>);</span><br><span class="line">        CipherClass.getInstance.overload(<span class="string">&#x27;java.lang.String&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;CipherClass.getInstance&quot;</span>, <span class="string">&quot;str&quot;</span>, str);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.getInstance(str);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CipherClass.init.overload(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.security.Key&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">inputInt, keySpec</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;CipherClass.$init&quot;</span>, <span class="string">&quot;inputInt&quot;</span>, inputInt);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;CipherClass.$init&quot;</span>, <span class="string">&quot;keySpec&quot;</span>, <span class="built_in">JSON</span>.stringify(Java.cast(keySpec, SecretKeySpecClass).getEncoded()));</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.init(inputInt, keySpec);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CipherClass.doFinal.overload(<span class="string">&#x27;[B&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">byteArray</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;CipherClass.doFinal byteArray&quot;</span>, <span class="built_in">JSON</span>.stringify(byteArray));</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">this</span>.doFinal(byteArray);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;CipherClass.doFinal result&quot;</span>,<span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    hook();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure>



<h1 id="分组密码填充和工作模式"><a href="#分组密码填充和工作模式" class="headerlink" title="分组密码填充和工作模式"></a>分组密码填充和工作模式</h1><h2 id="填充模式"><a href="#填充模式" class="headerlink" title="填充模式"></a>填充模式</h2><p>分组密码中, 需要将明文按照指定大小进行分组, 由于明文并非指定大小的整数倍, 因此在明文的最后一个分组需要将其填充到加密算法所要求的分组大小后才可以进行加密;</p>
<p>在解密的时候, 按照同样的填充将填充数据去除就可以进行解密了;</p>
<h3 id="NoPadding"><a href="#NoPadding" class="headerlink" title="NoPadding"></a>NoPadding</h3><p>不填充, 在此填充模式下原始数据必须是分组大小的整数倍, 非整数倍时无法使用该模式</p>
<h3 id="PKCS5Padding-PKCS7Padding"><a href="#PKCS5Padding-PKCS7Padding" class="headerlink" title="PKCS5Padding/PKCS7Padding"></a>PKCS5Padding/PKCS7Padding</h3><p>填充到符合块大小的整数倍, 填充值为填充数量数</p>
<p>PKCS5Padding的块大小应为8个字节, 而 PKCS7Padding的块大小可以在1-255的范围内; </p>
<ul>
<li>  原始: <code>FF FF FF FF FF FF FF FF FF</code></li>
<li>  填充: <code>FF FF FF FF FF FF FF FF FF 07 07 07 07 07 07 07 </code></li>
</ul>
<h3 id="ISO10126Padding"><a href="#ISO10126Padding" class="headerlink" title="ISO10126Padding"></a>ISO10126Padding</h3><p>填充至符合块大小的整数倍，填充值最后一个字节为填充的数量数，其他字节随机处理</p>
<ul>
<li>  原始：<code>FF FF FF FF FF FF FF FF FF</code></li>
<li>  填充：<code>FF FF FF FF FF FF FF FF FF 3F 7A B4 09 14 36 07</code></li>
</ul>
<h3 id="ZeroBytePadding"><a href="#ZeroBytePadding" class="headerlink" title="ZeroBytePadding"></a>ZeroBytePadding</h3><p>填充至符合块大小的整数倍，填充值为 0</p>
<ul>
<li>  原始：<code>FF FF FF FF FF FF FF FF FF</code></li>
<li>  填充：<code>FF FF FF FF FF FF FF FF FF 00 00 00 00 00 00 00</code></li>
</ul>
<h3 id="ISO7816-4Padding"><a href="#ISO7816-4Padding" class="headerlink" title="ISO7816-4Padding"></a>ISO7816-4Padding</h3><p>填充至符合块大小的整数倍，填充值第一个字节为 0x80，其他字节填 0</p>
<ul>
<li>  原始：<code>FF FF FF FF FF FF FF FF FF</code></li>
<li>  填充：<code>FF FF FF FF FF FF FF FF FF 80 00 00 00 00 00 00</code></li>
</ul>
<h3 id="X923Padding"><a href="#X923Padding" class="headerlink" title="X923Padding"></a>X923Padding</h3><p>填充至符合块大小的整数倍，填充值最后一个字节为填充的数量数，其他字节填 0</p>
<ul>
<li>  原始：<code>FF FF FF FF FF FF FF FF FF</code></li>
<li>  填充：<code>FF FF FF FF FF FF FF FF FF 00 00 00 00 00 00 07</code></li>
</ul>
<h2 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h2><h3 id="ECB模式（电子密码本模式）"><a href="#ECB模式（电子密码本模式）" class="headerlink" title="ECB模式（电子密码本模式）"></a><strong>ECB模式（电子密码本模式）</strong></h3><p>ECB模式是将明文消息分成固定大小的分组，当最后一个分组的内容小于分组长度时，需要用特定的数据进行填充以至于长度等于分组长度，每个分组的加密和解密都是独立的，可以进行并行操作，但是安全性较低。<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-15-050525.png" alt="ECB加密和解密"></p>
<h3 id="CBC模式（密码分组链接模式）"><a href="#CBC模式（密码分组链接模式）" class="headerlink" title="CBC模式（密码分组链接模式）"></a><strong>CBC模式（密码分组链接模式）</strong></h3><p>CBC模式中的第一个分组需要用初始化向量IV（一个随机的且长度为一个分组长度的比特序列）进行异或操作再进行加密，而后面的每一个分组都要先和前一个分组加密后的密文分组进行异或操作，然后再加密。加密是连续的，不能进行并行操作。<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-15-050458.png" alt="CBC加密和解密"></p>
<h3 id="CFB模式（密文反馈模式）"><a href="#CFB模式（密文反馈模式）" class="headerlink" title="CFB模式（密文反馈模式）"></a><strong>CFB模式（密文反馈模式）</strong></h3><p>CFB模式是将前一个分组的密文加密后和当前分组的明文进行异或操作生成当前分组的密文，第一个明文分组通过初始化向量lV进行加密再与之进行异或操作得到第一个密文分组。<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-15-050604.png" alt="CFB加密"><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-15-050622.png" alt="CFB解密"></p>
<h3 id="OFB模式（输出反馈模式）"><a href="#OFB模式（输出反馈模式）" class="headerlink" title="OFB模式（输出反馈模式）"></a><strong>OFB模式（输出反馈模式）</strong></h3><p>OFB模式是通过将明文分组和密码算法的输出进行异或操作来产生密文分组的，也需要使用初始化向量（IV）<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-15-050653.png" alt="OFB加密和解密"></p>
<h1 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h1><p>非对称加密算法;</p>
<h1 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h1><p>ida 中直接搜索常量字符串 67452301, 记住要勾选 <code>Find all occurentces</code></p>
<h1 id="test1"><a href="#test1" class="headerlink" title="test1"></a>test1</h1><p>反编译的密文: <code>sGpdX0nDoRPWnonSt0SQQXOk/0wID0jvtAqb2QxJoW4=</code></p>
<p>实际 hook 之后得到的并非该密文, 使用 cyber 解密之后得到 aes 解密结果为</p>
<p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-16-075917.png" alt="image-20210416155917339"></p>
<p>存在不可见字符所以使用 base64进行编码, 之后在脚本中对编码的结果进行解码, 调用 rc4方法进行最终解密</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///&lt;reference path=&#x27;./index.d.ts&#x27;/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;hook test1.js&quot;</span>);</span><br><span class="line">    <span class="comment">// 获取到真实的 cipher</span></span><br><span class="line">    <span class="comment">// var UtilsClass = Java.use(&quot;com.kanxue.test.Utils&quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// w7/Cn8Ozw6M1wqgDwpTDjExnCsOcw6bCkikAUXYhbcONF3M=</span></span><br><span class="line">    <span class="keyword">var</span> inputBse64Str = <span class="string">&quot;w7/Cn8Ozw6M1wqgDwpTDjExnCsOcw6bCkikAUXYhbcONF3M=&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> Base64Class = Java.use(<span class="string">&quot;android.util.Base64&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> byteArray = Base64Class.decode(inputBse64Str, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> StringClass = Java.use(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> cipher = StringClass.$new(byteArray);</span><br><span class="line">    <span class="keyword">var</span> UtilsClass = Java.use(<span class="string">&quot;com.kanxue.test.Utils&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> result = UtilsClass.bbbbb(<span class="string">&quot;kanxue&quot;</span>, cipher);</span><br><span class="line">    <span class="keyword">var</span> value = UtilsClass.cipher.value;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;UtilsClass.cipher.value&quot;</span>, value);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;UtilsClass.bbbbb result&quot;</span>,result);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h1 id="test2"><a href="#test2" class="headerlink" title="test2"></a>test2</h1><ol>
<li><p> 对于 ollvm 控制流混淆, 可以找到对应的入口函数, 对 sub 函数进行 hook, 打印出调用栈, 然后对每个函数进行分析, 确定该函数的作用;</p>
</li>
<li><p> 对于系统的库, 例如 libc.so 中的 strcmp, app 和系统都会进行调用, 防止打印信息过多, 可以hook 上临近的 sub之后, 再单独 hook libc.so 中的方法, 更加精准一些;</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///&lt;reference path=&#x27;./index.d.ts&#x27;/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> base_addr = Module.findBaseAddress(<span class="string">&quot;libnative-lib.so&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_sub_428BC</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> offset = <span class="number">0x428BC</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> sub_428BC_addr = base_addr.add(offset);</span><br><span class="line">    Interceptor.attach(sub_428BC_addr, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;------------------------- enter sub_428BC_func -------------------------&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">                <span class="built_in">eval</span>(<span class="string">&quot;this.arg&quot;</span> + i + <span class="string">&quot;=args[&quot;</span> + i + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;sub_428BC_func this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, args[i]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this.arg0&quot;</span>, hexdump(<span class="built_in">this</span>.arg0));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this.arg1&quot;</span>, hexdump(<span class="built_in">this</span>.arg1));</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">returnValue</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;========================= leave sub_428BC_func =========================&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;sub_428BC_func returnValue&quot;</span>, returnValue);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;sub_428BC_func this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, <span class="built_in">eval</span>(<span class="string">&quot;this.arg&quot;</span> + i));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this.arg0&quot;</span>, hexdump(<span class="built_in">this</span>.arg0));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this.arg1&quot;</span>, hexdump(<span class="built_in">this</span>.arg1));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_sub_8748</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> offset = <span class="number">0x8748</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> sub_8748_func = base_addr.add(offset);</span><br><span class="line">    Interceptor.attach(sub_8748_func, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;------------------------- enter sub_8748_func -------------------------&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">                <span class="built_in">eval</span>(<span class="string">&quot;this.arg&quot;</span> + i + <span class="string">&quot;=args[&quot;</span> + i + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;sub_8748_func this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, args[i]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this.arg0&quot;</span>, hexdump(<span class="built_in">this</span>.arg0));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this.arg1&quot;</span>, <span class="built_in">this</span>.arg1);</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">returnValue</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;========================= leave sub_8748_func =========================&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;sub_8748_func returnValue&quot;</span>, returnValue);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;sub_8748_func this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, <span class="built_in">eval</span>(<span class="string">&quot;this.arg&quot;</span> + i));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this.arg0&quot;</span>, hexdump(<span class="built_in">this</span>.arg0));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this.arg1&quot;</span>, <span class="built_in">this</span>.arg1);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;retvalue&quot;</span>, hexdump(returnValue));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_sub_D7EC</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> offset = <span class="number">0xD7EC</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> sub_D7EC_func = base_addr.add(offset);</span><br><span class="line">    Interceptor.attach(sub_D7EC_func, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;------------------------- enter sub_D7EC_func -------------------------&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">                <span class="built_in">eval</span>(<span class="string">&quot;this.arg&quot;</span> + i + <span class="string">&quot;=args[&quot;</span> + i + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;sub_D7EC_func this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, args[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this.arg0&quot;</span>, hexdump(<span class="built_in">this</span>.arg0));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this.arg1&quot;</span>, hexdump(<span class="built_in">this</span>.arg1));</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">returnValue</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;========================= leave sub_D7EC_func =========================&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;sub_D7EC_func returnValue&quot;</span>, returnValue);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;sub_D7EC_func this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, <span class="built_in">eval</span>(<span class="string">&quot;this.arg&quot;</span> + i));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this.arg0&quot;</span>, hexdump(<span class="built_in">this</span>.arg0));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this.arg1&quot;</span>, hexdump(<span class="built_in">this</span>.arg1));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;this retvalue&quot;</span>, hexdump(returnValue));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_libc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// hook libc.so</span></span><br><span class="line">    <span class="keyword">var</span> strcmp_addr = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(JSON.stringify(Process.enumerateModules()));</span></span><br><span class="line"><span class="comment">// Process.enumerateModules() 枚举加载的so文件</span></span><br><span class="line">    <span class="keyword">var</span> symbols = Process.findModuleByName(<span class="string">&quot;libc.so&quot;</span>).enumerateSymbols();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; symbols.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (symbols[i].name === <span class="string">&quot;strcmp&quot;</span>) &#123;</span><br><span class="line">            <span class="comment">// console.log(&quot;symbols name is -&gt; &quot; + symbols[i].name);</span></span><br><span class="line">            <span class="comment">// console.log(&quot;symbols address is -&gt; &quot; + symbols[i].address);</span></span><br><span class="line">            strcmp_addr = symbols[i].address;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(strcmp_addr, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;args is -&gt;&quot;</span> + ptr(args[<span class="number">0</span>]).readCString(), ptr(args[<span class="number">1</span>]).readCString());</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(retval);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_ollvm</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sub_42D00_addr = base_addr.add(<span class="number">0x42D00</span> + <span class="number">0x1</span>);</span><br><span class="line">    <span class="keyword">var</span> sub_428BC_addr = base_addr.add(<span class="number">0x428BC</span> + <span class="number">0x1</span>);</span><br><span class="line">    <span class="keyword">var</span> sub_42888_addr = base_addr.add(<span class="number">0x42888</span> + <span class="number">0x1</span>);</span><br><span class="line">    <span class="keyword">var</span> sub_D7EC_addr = base_addr.add(<span class="number">0xD7EC</span> + <span class="number">0x1</span>);</span><br><span class="line">    <span class="keyword">var</span> sub_8748_addr = base_addr.add(<span class="number">0x8748</span> + <span class="number">0x1</span>);</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(sub_42D00_addr, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;enter sub_42D00_addr &quot;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">returnValue</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;leave sub_42D00_addr &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(sub_428BC_addr, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;enter sub_428BC_addr &quot;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">returnValue</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;leave sub_428BC_addr &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(sub_42888_addr, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;enter sub_42888_addr &quot;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">returnValue</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;leave sub_42888_addr &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(sub_D7EC_addr, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;enter sub_D7EC_addr &quot;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">returnValue</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;leave sub_D7EC_addr &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(sub_8748_addr, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;enter sub_8748_addr &quot;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">returnValue</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;leave sub_8748_addr &quot;</span>);</span><br><span class="line">            hook_libc();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    hook_sub_428BC();</span><br><span class="line">    <span class="comment">// hook_sub_8748();</span></span><br><span class="line">    <span class="comment">// hook_sub_D7EC();</span></span><br><span class="line">    <span class="comment">// hook_libc();</span></span><br><span class="line">    <span class="comment">// hook_ollvm();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure>



<h1 id="压缩算法"><a href="#压缩算法" class="headerlink" title="压缩算法"></a>压缩算法</h1><p>压缩算法和对应文件头</p>
<table>
<thead>
<tr>
<th>压缩算法</th>
<th>模式</th>
<th>hex 标志头</th>
<th>base64后</th>
</tr>
</thead>
<tbody><tr>
<td>gzip</td>
<td>/</td>
<td>1F 8B 08</td>
<td>H4sl</td>
</tr>
<tr>
<td>lzma</td>
<td>FORMAT_XZ</td>
<td>FD 37 7A</td>
<td>/Td6</td>
</tr>
<tr>
<td>lzma</td>
<td>FORMAT_ALONE</td>
<td>5D 00 00</td>
<td>XQAA</td>
</tr>
<tr>
<td>zlib</td>
<td>/</td>
<td>78 9C</td>
<td>eJwr</td>
</tr>
</tbody></table>
<h1 id="python-常用加解密"><a href="#python-常用加解密" class="headerlink" title="python 常用加解密"></a>python 常用加解密</h1><p>安装 <code>pip install pycryptodome</code></p>
<h2 id="DES3"><a href="#DES3" class="headerlink" title="DES3"></a>DES3</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES3</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">des3Encrypt</span>(<span class="params">plain_text: <span class="built_in">str</span>, key: <span class="built_in">str</span>, iv: <span class="built_in">str</span></span>) -&gt; str:</span></span><br><span class="line">    des3 = DES3.new(key=key.encode(), mode=DES3.MODE_CBC, iv=iv.encode())</span><br><span class="line">    encrypted_data = des3.encrypt(pad(plain_text.encode(), DES3.block_size))</span><br><span class="line">    cipher_text = base64.b64encode(encrypted_data).decode()</span><br><span class="line">    <span class="keyword">return</span> cipher_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">des3Decrypt</span>(<span class="params">cipher_text: <span class="built_in">str</span>, key: <span class="built_in">str</span>, iv: <span class="built_in">str</span></span>) -&gt; str:</span></span><br><span class="line">    des3 = DES3.new(key=key.encode(), mode=DES3.MODE_CBC, iv=iv.encode())</span><br><span class="line">    decrypted_data = des3.decrypt(base64.b64decode(cipher_text))</span><br><span class="line">    plain_text = unpad(decrypted_data, DES3.block_size).decode()</span><br><span class="line">    <span class="keyword">return</span> plain_text</span><br></pre></td></tr></table></figure>



<h2 id="DES-1"><a href="#DES-1" class="headerlink" title="DES"></a>DES</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> a2b_hex</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">desEncrypt</span>(<span class="params">plain_text: <span class="built_in">str</span>, key: <span class="built_in">str</span></span>) -&gt; str:</span></span><br><span class="line">    des = DES.new(key=a2b_hex(key), mode=DES.MODE_ECB)</span><br><span class="line">    encrypted_data = des.encrypt(a2b_hex(plain_text))</span><br><span class="line">    <span class="keyword">return</span> b2a_hex(encrypted_data).decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">desDecrypt</span>(<span class="params">cipher_text: <span class="built_in">str</span>, key: <span class="built_in">str</span></span>) -&gt; str:</span></span><br><span class="line">    des = DES.new(key=a2b_hex(key), mode=DES.MODE_ECB)</span><br><span class="line">    decrypted_data = des.decrypt(a2b_hex(cipher_text))</span><br><span class="line">    <span class="keyword">return</span> b2a_hex(decrypted_data).decode()</span><br></pre></td></tr></table></figure>



<h2 id="AES-1"><a href="#AES-1" class="headerlink" title="AES"></a>AES</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> a2b_hex</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pkcs7padding</span>(<span class="params">text</span>):</span></span><br><span class="line">    bs = AES.block_size</span><br><span class="line">    length = <span class="built_in">len</span>(text)</span><br><span class="line">    bytes_length = <span class="built_in">len</span>(<span class="built_in">bytes</span>(text, encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    padding_size = length <span class="keyword">if</span> bytes_length == length <span class="keyword">else</span> bytes_length</span><br><span class="line">    padding = bs - padding_size % bs</span><br><span class="line">    padding_text = <span class="built_in">chr</span>(padding) * padding</span><br><span class="line">    <span class="keyword">return</span> text + padding_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pkcs7unpadding</span>(<span class="params">text</span>):</span></span><br><span class="line">    length = <span class="built_in">len</span>(text)</span><br><span class="line">    unpadding = <span class="built_in">ord</span>(text[length - <span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> text[<span class="number">0</span>:length - unpadding]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aesEncrypt</span>(<span class="params">content, key, iv=<span class="string">&quot;&quot;</span>, encode=<span class="string">&quot;BASE64&quot;</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    AES 加密</span></span><br><span class="line"><span class="string">    :param content: 待加密文本</span></span><br><span class="line"><span class="string">    :param key: AES key</span></span><br><span class="line"><span class="string">    :param iv: AES iv(CBC模式才需要)</span></span><br><span class="line"><span class="string">    :param encode: HEX/BASE64</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    mode = <span class="string">&quot;CBC&quot;</span> <span class="keyword">if</span> iv <span class="keyword">else</span> <span class="string">&quot;ECB&quot;</span></span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&quot;ECB&quot;</span>:</span><br><span class="line">        key_bytes = <span class="built_in">bytes</span>(key, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        cipher = AES.new(key_bytes, AES.MODE_ECB)</span><br><span class="line">        content_padding = pkcs7padding(content)</span><br><span class="line">        encrypt_bytes = cipher.encrypt(<span class="built_in">bytes</span>(content_padding, encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        key_bytes = <span class="built_in">bytes</span>(key, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        iv_bytes = <span class="built_in">bytes</span>(iv, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        cipher = AES.new(key_bytes, AES.MODE_CBC, iv_bytes)</span><br><span class="line">        content_padding = pkcs7padding(content)</span><br><span class="line">        encrypt_bytes = cipher.encrypt(<span class="built_in">bytes</span>(content_padding, encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> encode == <span class="string">&quot;BASE64&quot;</span>:</span><br><span class="line">        result = <span class="built_in">str</span>(base64.b64encode(encrypt_bytes), encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result = <span class="built_in">str</span>(b2a_hex(encrypt_bytes), encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aesDecrypt</span>(<span class="params">content, key, iv=<span class="string">&quot;&quot;</span>, encode=<span class="string">&quot;BASE64&quot;</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    AES 解密</span></span><br><span class="line"><span class="string">    :param content: 待解密文本</span></span><br><span class="line"><span class="string">    :param key: AES key</span></span><br><span class="line"><span class="string">    :param iv: AES iv(CBC模式才需要)</span></span><br><span class="line"><span class="string">    :param encode: BASE64/HEX</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    mode = <span class="string">&quot;CBC&quot;</span> <span class="keyword">if</span> iv <span class="keyword">else</span> <span class="string">&quot;ECB&quot;</span></span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&quot;EBC&quot;</span>:</span><br><span class="line">        key_bytes = <span class="built_in">bytes</span>(key, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        cipher = AES.new(key_bytes, AES.MODE_ECB)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        key_bytes = <span class="built_in">bytes</span>(key, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        iv_bytes = <span class="built_in">bytes</span>(iv, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        cipher = AES.new(key_bytes, AES.MODE_CBC, iv_bytes)</span><br><span class="line">    <span class="keyword">if</span> encode == <span class="string">&quot;BASE64&quot;</span>:</span><br><span class="line">        encrypt_bytes = base64.b64decode(content)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        encrypt_bytes = a2b_hex(content)</span><br><span class="line">    decrypt_bytes = cipher.decrypt(encrypt_bytes)</span><br><span class="line">    result = <span class="built_in">str</span>(decrypt_bytes, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    result = pkcs7unpadding(result)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>



<h2 id="RSA-1"><a href="#RSA-1" class="headerlink" title="RSA"></a>RSA</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> a2b_hex</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pkcs7padding</span>(<span class="params">text</span>):</span></span><br><span class="line">    bs = AES.block_size</span><br><span class="line">    length = <span class="built_in">len</span>(text)</span><br><span class="line">    bytes_length = <span class="built_in">len</span>(<span class="built_in">bytes</span>(text, encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    padding_size = length <span class="keyword">if</span> bytes_length == length <span class="keyword">else</span> bytes_length</span><br><span class="line">    padding = bs - padding_size % bs</span><br><span class="line">    padding_text = <span class="built_in">chr</span>(padding) * padding</span><br><span class="line">    <span class="keyword">return</span> text + padding_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pkcs7unpadding</span>(<span class="params">text</span>):</span></span><br><span class="line">    length = <span class="built_in">len</span>(text)</span><br><span class="line">    unpadding = <span class="built_in">ord</span>(text[length - <span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> text[<span class="number">0</span>:length - unpadding]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rsaEncryptByKey</span>(<span class="params">content, key, encode=<span class="string">&quot;BASE64&quot;</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param content: 待加密文本</span></span><br><span class="line"><span class="string">    :param key: PublicKey</span></span><br><span class="line"><span class="string">    :param encode: BASE64/HEX</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    key = <span class="string">&quot;-----BEGIN PUBLIC KEY-----\n&quot;</span> + key + <span class="string">&quot;\n-----END PUBLIC KEY-----&quot;</span></span><br><span class="line">    rsakey = RSA.importKey(key)</span><br><span class="line">    cipher = PKCS1_v1_5.new(rsakey)</span><br><span class="line">    <span class="keyword">if</span> encode == <span class="string">&quot;BASE64&quot;</span>:</span><br><span class="line">        cipher_text = base64.b64encode(cipher.encrypt(content.encode(<span class="string">&#x27;utf-8&#x27;</span>)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cipher_text = b2a_hex(cipher.encrypt(content.encode(<span class="string">&#x27;utf-8&#x27;</span>)))</span><br><span class="line">    <span class="keyword">return</span> cipher_text.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rsaEncryptByModule</span>(<span class="params">content, module, pubKey=<span class="string">&quot;10001&quot;</span>, encode=<span class="string">&quot;BASE64&quot;</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param content: 待加密文本</span></span><br><span class="line"><span class="string">    :param module: HEX 编码的 module</span></span><br><span class="line"><span class="string">    :param pubKey: 默认 10001</span></span><br><span class="line"><span class="string">    :param encode: BASE64/HEX</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    pubKey = <span class="built_in">int</span>(pubKey, <span class="number">16</span>)</span><br><span class="line">    modules = <span class="built_in">int</span>(module, <span class="number">16</span>)</span><br><span class="line">    pubobj = RSA.construct((modules, pubKey), <span class="literal">False</span>)</span><br><span class="line">    public_key = pubobj.publickey().exportKey().decode()</span><br><span class="line">    rsakey = RSA.importKey(public_key)</span><br><span class="line">    cipher = PKCS1_v1_5.new(rsakey)</span><br><span class="line">    <span class="keyword">if</span> encode == <span class="string">&quot;BASE64&quot;</span>:</span><br><span class="line">        cipher_text = base64.b64encode(cipher.encrypt(content.encode(<span class="string">&#x27;utf-8&#x27;</span>)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cipher_text = b2a_hex(cipher.encrypt(content.encode(<span class="string">&#x27;utf-8&#x27;</span>)))</span><br><span class="line">    <span class="keyword">return</span> cipher_text.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br></pre></td></tr></table></figure>

<!-- flag of hidden posts --></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Kevin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/secret/">http://example.com/secret/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">凡墙总是门</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/">加解密</a></div><div class="post_share"><div class="social-share" data-image="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-12-082615.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Kevin</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/kevinspider"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/kevinspider" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:zhangyang.spider@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%88%86%E7%B1%BB"><span class="toc-number">1.</span> <span class="toc-text">简单分类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#base64"><span class="toc-number">2.</span> <span class="toc-text">base64</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%8E%9F%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">编码原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E8%AF%86%E5%88%AB"><span class="toc-number">2.2.</span> <span class="toc-text">快速识别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#frida-%E5%AE%9E%E6%88%98"><span class="toc-number">2.3.</span> <span class="toc-text">frida 实战</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RC4"><span class="toc-number">3.</span> <span class="toc-text">RC4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">实现原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E8%AF%86%E5%88%AB-1"><span class="toc-number">3.2.</span> <span class="toc-text">快速识别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DES"><span class="toc-number">4.</span> <span class="toc-text">DES</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.1.</span> <span class="toc-text">原理实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#android-%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.</span> <span class="toc-text">android 实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#c-%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.3.</span> <span class="toc-text">c 实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hook-android-des"><span class="toc-number">4.4.</span> <span class="toc-text">hook android des</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AES"><span class="toc-number">5.</span> <span class="toc-text">AES</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">5.1.</span> <span class="toc-text">原理实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#android-%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">5.2.</span> <span class="toc-text">android 实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hook-android-aes"><span class="toc-number">5.3.</span> <span class="toc-text">hook android aes</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E5%A1%AB%E5%85%85%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">分组密码填充和工作模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A1%AB%E5%85%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.1.</span> <span class="toc-text">填充模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NoPadding"><span class="toc-number">6.1.1.</span> <span class="toc-text">NoPadding</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PKCS5Padding-PKCS7Padding"><span class="toc-number">6.1.2.</span> <span class="toc-text">PKCS5Padding&#x2F;PKCS7Padding</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ISO10126Padding"><span class="toc-number">6.1.3.</span> <span class="toc-text">ISO10126Padding</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ZeroBytePadding"><span class="toc-number">6.1.4.</span> <span class="toc-text">ZeroBytePadding</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ISO7816-4Padding"><span class="toc-number">6.1.5.</span> <span class="toc-text">ISO7816-4Padding</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#X923Padding"><span class="toc-number">6.1.6.</span> <span class="toc-text">X923Padding</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.2.</span> <span class="toc-text">工作模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ECB%E6%A8%A1%E5%BC%8F%EF%BC%88%E7%94%B5%E5%AD%90%E5%AF%86%E7%A0%81%E6%9C%AC%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-number">6.2.1.</span> <span class="toc-text">ECB模式（电子密码本模式）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CBC%E6%A8%A1%E5%BC%8F%EF%BC%88%E5%AF%86%E7%A0%81%E5%88%86%E7%BB%84%E9%93%BE%E6%8E%A5%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-number">6.2.2.</span> <span class="toc-text">CBC模式（密码分组链接模式）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CFB%E6%A8%A1%E5%BC%8F%EF%BC%88%E5%AF%86%E6%96%87%E5%8F%8D%E9%A6%88%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-number">6.2.3.</span> <span class="toc-text">CFB模式（密文反馈模式）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OFB%E6%A8%A1%E5%BC%8F%EF%BC%88%E8%BE%93%E5%87%BA%E5%8F%8D%E9%A6%88%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-number">6.2.4.</span> <span class="toc-text">OFB模式（输出反馈模式）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RSA"><span class="toc-number">7.</span> <span class="toc-text">RSA</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#md5"><span class="toc-number">8.</span> <span class="toc-text">md5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#test1"><span class="toc-number">9.</span> <span class="toc-text">test1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#test2"><span class="toc-number">10.</span> <span class="toc-text">test2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95"><span class="toc-number">11.</span> <span class="toc-text">压缩算法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#python-%E5%B8%B8%E7%94%A8%E5%8A%A0%E8%A7%A3%E5%AF%86"><span class="toc-number">12.</span> <span class="toc-text">python 常用加解密</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DES3"><span class="toc-number">12.1.</span> <span class="toc-text">DES3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DES-1"><span class="toc-number">12.2.</span> <span class="toc-text">DES</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AES-1"><span class="toc-number">12.3.</span> <span class="toc-text">AES</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RSA-1"><span class="toc-number">12.4.</span> <span class="toc-text">RSA</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/unidbg2/" title="跟着龙哥踩坑unidbg2"><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-24-055002.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="跟着龙哥踩坑unidbg2"/></a><div class="content"><a class="title" href="/unidbg2/" title="跟着龙哥踩坑unidbg2">跟着龙哥踩坑unidbg2</a><time datetime="2021-08-24T05:49:15.000Z" title="发表于 2021-08-24 13:49:15">2021-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/antijs/" title="js逆向"><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-17-021631.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="js逆向"/></a><div class="content"><a class="title" href="/antijs/" title="js逆向">js逆向</a><time datetime="2021-08-17T02:15:12.000Z" title="发表于 2021-08-17 10:15:12">2021-08-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/unidbg1/" title="跟着龙哥踩坑unidbg1"><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-12-015232.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="跟着龙哥踩坑unidbg1"/></a><div class="content"><a class="title" href="/unidbg1/" title="跟着龙哥踩坑unidbg1">跟着龙哥踩坑unidbg1</a><time datetime="2021-08-12T01:50:15.000Z" title="发表于 2021-08-12 09:50:15">2021-08-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/books-coder/" title="程序员的自我修养"><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-29-055533.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="程序员的自我修养"/></a><div class="content"><a class="title" href="/books-coder/" title="程序员的自我修养">程序员的自我修养</a><time datetime="2021-07-29T05:54:37.000Z" title="发表于 2021-07-29 13:54:37">2021-07-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/so1/" title="so基础入门"><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-15-050409.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="so基础入门"/></a><div class="content"><a class="title" href="/so1/" title="so基础入门">so基础入门</a><time datetime="2021-07-15T05:02:50.000Z" title="发表于 2021-07-15 13:02:50">2021-07-15</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Kevin</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: 'e26403e0bb1e289c53e6',
      clientSecret: '5826f8314e51e7f17499d405d916c47d2bae3ec4',
      repo: 'kevinspider.github.io',
      owner: 'kevinspider',
      admin: ['kevinspider'],
      id: '38c1a76acc9d51fb442e53285650f0e8',
      language: 'en',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script async data-pjax src="//cdn.jsdelivr.net/gh/sukkaw/busuanzi@2.3/bsz.pure.mini.js"></script></div></body></html>