<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>跟着龙哥踩坑unidbg2</title>
      <link href="unidbg2/"/>
      <url>unidbg2/</url>
      
        <content type="html"><![CDATA[<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-24-055106.png"></p><p><a href="https://blog.csdn.net/qq_38851536/article/details/117419041?spm=1001.2014.3001.5501">https://blog.csdn.net/qq_38851536/article/details/117419041?spm=1001.2014.3001.5501</a></p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>下载 app: <a href="https://pan.baidu.com/s/18_WCIb_KaKCAgxLj_1bLMA">https://pan.baidu.com/s/18_WCIb_KaKCAgxLj_1bLMA</a> 提取码：k1f3</p><p>不需要脱壳, 直接使用 jadx 打开即可;</p><h2 id="java-层定位"><a href="#java-层定位" class="headerlink" title="java 层定位"></a>java 层定位</h2><p>在登录界面, 输入用户名和密码后点击登录, 抓包可以看到 post 请求中有一个参数 s; 每次输入的用户名和密码不同时 s 的值也不相同; 当输入的值固定时, s 每次的结果都相同; </p><p>jadx 中直接搜索”s”, 可以发现:</p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-24-061242.png" style="zoom: 50%;" /><p>查看 ParamsKey 中 s 属性的调用, 可以定位到 <code>com.weico.international.activity.SinaWeiboUserLoginActivity.doLogin</code>方法: </p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-24-061540.png" style="zoom:50%;" /><p>进入<code>calculateSInJava</code>中, 可以看到最终调用的是<code>com.sina.weibo.security.WeiboSecurityUtils.calculateS</code>方法, 该方法是一个 native 方法; 使用 frida 对该方法进行 hook , 验证静态分析的结果;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookJava</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;执行 -&gt; &quot;</span>,<span class="string">&quot;hookJava&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> utilClass = Java.use(<span class="string">&quot;com.sina.weibo.security.WeiboSecurityUtils&quot;</span>);</span><br><span class="line">        utilClass.calculateSInJava.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">context, srcArray, pin</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;context&quot;</span>, context);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;srcArray&quot;</span>, srcArray);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;pin&quot;</span>, pin);</span><br><span class="line">            <span class="keyword">var</span> s = <span class="built_in">this</span>.calculateSInJava(context, srcArray, pin);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;s&quot;</span>, s);</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//[Huawei Nexus 6P::微博国际版]-&gt; context com.weico.international.WApplication@90cde8a</span></span><br><span class="line"><span class="comment">//srcArray user123password123</span></span><br><span class="line"><span class="comment">//pin CypCHG2kSlRkdvr2RG1QF8b2lCWXl7k7</span></span><br><span class="line"><span class="comment">//s 6eb4b2db</span></span><br></pre></td></tr></table></figure><p>第一个参数是 context, 第二个参数是输入的用户名+输入的密码; 第三个参数是定值字符串; 结果和抓包结果对比也一致;</p><h2 id="java-层主动调用"><a href="#java-层主动调用" class="headerlink" title="java 层主动调用"></a>java 层主动调用</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主动调用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> context = Java.use(<span class="string">&quot;android.app.ActivityThread&quot;</span>).currentApplication().getApplicationContext();</span><br><span class="line">        <span class="keyword">var</span> username = <span class="string">&quot;user123&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> password = <span class="string">&quot;password123&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> WeiboSecurityUtilsObj = <span class="literal">null</span>;</span><br><span class="line">        Java.choose(<span class="string">&quot;com.sina.weibo.security.WeiboSecurityUtils&quot;</span>, &#123;</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span> (<span class="params">ins</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;find ins&quot;</span>, ins);</span><br><span class="line">                WeiboSecurityUtilsObj = ins;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;complete&quot;</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (WeiboSecurityUtilsObj) &#123;</span><br><span class="line">            <span class="keyword">var</span> s = WeiboSecurityUtilsObj.calculateS(context, username + password, <span class="string">&quot;CypCHG2kSlRkdvr2RG1QF8b2lCWXl7k7&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;s&quot;</span>, s);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;WeiboSecurityUtilsObj&quot;</span>, WeiboSecurityUtilsObj);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="native-层分析"><a href="#native-层分析" class="headerlink" title="native 层分析"></a>native 层分析</h2><p>对 apk 解包, 找到<code>libutility.so</code>, 拖进 ida 中; 发现直接在 exports 中搜索 <code>calculateS</code>可以看到导出函数, 说明该方法是静态注册;</p><p>先将入参JNIEnv 等设置为正确的类型, 读起来还是比较明晰的; </p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-24-062711.png" style="zoom:50%;" /><p>最终结果是来自 v20, 而 v20 其实是由 v12 产生的, v12 是 MDStringOld(v10) 的结果, 而 v10 其实是输入的两个字符串参数拼接的结果; 使用 frida hook 验证猜想;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> baseAddr = Module.findBaseAddress(<span class="string">&quot;libutility.so&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_md5</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> addr_1BD0 = baseAddr.add(<span class="number">0x1BD0</span> + <span class="number">1</span>);</span><br><span class="line">    Interceptor.attach(addr_1BD0,&#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;------------------------- enter addr_1BD0 -------------------------&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> hexdump_str = <span class="string">&quot;0&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">1</span>; i++) &#123;</span><br><span class="line">                <span class="built_in">eval</span>(<span class="string">&quot;this.arg&quot;</span> + i + <span class="string">&quot;=args[&quot;</span> + i + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (hexdump_str.indexOf(i) &gt; -<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;addr_1BD0 this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, hexdump(args[i]));</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;addr_1BD0 this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, args[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">returnValue</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;========================= leave addr_1BD0 =========================&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> hexdump_str = <span class="string">&quot;0&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">1</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (hexdump_str.indexOf(i) &gt; -<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;addr_1BD0 this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, hexdump(<span class="built_in">eval</span>(<span class="string">&quot;this.arg&quot;</span> + i)));</span><br><span class="line"></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;addr_1BD0 this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, <span class="built_in">eval</span>(<span class="string">&quot;this.arg&quot;</span> + i));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">String</span>(returnValue).length &gt; <span class="number">4</span>)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;addr_1BD0 returnValue hexdump&quot;</span>, hexdump(returnValue));</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;addr_1BD0 returnValue&quot;</span>, returnValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-24-063052.png" style="zoom:50%;" /><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-24-063145.png"></p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-24-063215.png"></p><p>使用 cyberchef 验证, 确实是标准的 md5 的结果, 接下来就是对 md5 结果的截取的位置调换, 形成最终的s;</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">v11 = MDStringOld(v10);</span><br><span class="line">v12 = (jbyte *)j_malloc(<span class="number">9</span>);</span><br><span class="line">*v12 = v11[<span class="number">1</span>];</span><br><span class="line">v12[<span class="number">1</span>] = v11[<span class="number">5</span>];</span><br><span class="line">v12[<span class="number">2</span>] = v11[<span class="number">2</span>];</span><br><span class="line">v12[<span class="number">3</span>] = v11[<span class="number">10</span>];</span><br><span class="line">v12[<span class="number">4</span>] = v11[<span class="number">17</span>];</span><br><span class="line">v12[<span class="number">5</span>] = v11[<span class="number">9</span>];</span><br><span class="line">v12[<span class="number">6</span>] = v11[<span class="number">25</span>];</span><br><span class="line">v13 = v11[<span class="number">27</span>];</span><br><span class="line">v12[<span class="number">8</span>] = <span class="number">0</span>;</span><br><span class="line">v12[<span class="number">7</span>] = v13;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line">__author__ = <span class="string">&quot;Kevin&quot;</span></span><br><span class="line">__time__ = <span class="string">&quot;2021/8/24&quot;</span></span><br><span class="line">__blog__ = <span class="string">&quot;https://kevinspider.github.io/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getS</span>(<span class="params"><span class="built_in">input</span></span>):</span></span><br><span class="line">    v11 = hashlib.md5(<span class="built_in">input</span>.encode()).hexdigest()</span><br><span class="line">    v12 = []</span><br><span class="line">    v12.append(v11[<span class="number">1</span>])</span><br><span class="line">    v12.append(v11[<span class="number">5</span>])</span><br><span class="line">    v12.append(v11[<span class="number">2</span>])</span><br><span class="line">    v12.append(v11[<span class="number">10</span>])</span><br><span class="line">    v12.append(v11[<span class="number">17</span>])</span><br><span class="line">    v12.append(v11[<span class="number">9</span>])</span><br><span class="line">    v12.append(v11[<span class="number">25</span>])</span><br><span class="line">    v12.append(v11[<span class="number">27</span>])</span><br><span class="line">    s = <span class="string">&quot;&quot;</span>.join(v12)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = getS(<span class="string">&quot;user123password123CypCHG2kSlRkdvr2RG1QF8b2lCWXl7k7&quot;</span>)</span><br><span class="line">print(s) // 6eb4b2db</span><br></pre></td></tr></table></figure><h2 id="unidbg"><a href="#unidbg" class="headerlink" title="unidbg"></a>unidbg</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sina.international;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入通用库</span></span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.AbstractJni;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.AndroidEmulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">sUtil</span> <span class="keyword">extends</span> <span class="title">AbstractJni</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DalvikModule dm;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line">    sUtil()&#123;</span><br><span class="line">        <span class="comment">// 创建模拟器实例, 进程名使用 adb shell dumpsys window | grep mCurrentFocus 获取实际的进程名</span></span><br><span class="line">        emulator = AndroidEmulatorBuilder.for32Bit().setProcessName(<span class="string">&quot;com.weico.international&quot;</span>).build();</span><br><span class="line">        <span class="comment">// 获取模拟器的内存操作接口</span></span><br><span class="line">        <span class="keyword">final</span> Memory memory = emulator.getMemory();</span><br><span class="line">        <span class="comment">// 设置系统类库解析</span></span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> AndroidResolver(<span class="number">23</span>));</span><br><span class="line">        <span class="comment">// 创建 Android 虚拟机, 传入 apk;</span></span><br><span class="line">        vm = emulator.createDalvikVM(<span class="keyword">new</span> File(<span class="string">&quot;unidbg-android/src/test/java/com/sina/international/sinaInternational.apk&quot;</span>));</span><br><span class="line">        <span class="comment">// 加载目标 so</span></span><br><span class="line">        dm = vm.loadLibrary(<span class="keyword">new</span> File(<span class="string">&quot;unidbg-android/src/test/java/com/sina/international/libutility.so&quot;</span>), <span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 获取 so 模块的句柄</span></span><br><span class="line">        <span class="keyword">module</span> = dm.getModule();</span><br><span class="line">        <span class="comment">// 设置 jni</span></span><br><span class="line">        vm.setJni(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// 设置日志</span></span><br><span class="line">        vm.setVerbose(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 调用 JNI_Onload</span></span><br><span class="line">        <span class="comment">// dm.callJNI_OnLoad(emulator);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        sUtil test = <span class="keyword">new</span> sUtil();</span><br><span class="line">        <span class="comment">// 手动 patch</span></span><br><span class="line">        test.patch();</span><br><span class="line">        String s = test.calculateS();</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主动调用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">calculateS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 第一个参数 env</span></span><br><span class="line">        list.add(vm.getJNIEnv());</span><br><span class="line">        <span class="comment">// 第二个参数 jobject</span></span><br><span class="line">        list.add(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 第三个参数 context</span></span><br><span class="line">        DvmObject&lt;?&gt; context = vm.resolveClass(<span class="string">&quot;android/context/Context&quot;</span>).newObject(<span class="keyword">null</span>);</span><br><span class="line">        list.add(vm.addLocalObject(context));</span><br><span class="line">        <span class="comment">// 第四个参数 字符串 username+password</span></span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> StringObject(vm, <span class="string">&quot;user123password123&quot;</span>)));</span><br><span class="line">        <span class="comment">// 第五个参数 固定字符串 pin</span></span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> StringObject((vm), <span class="string">&quot;CypCHG2kSlRkdvr2RG1QF8b2lCWXl7k7&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 主动调用</span></span><br><span class="line">        Number number = <span class="keyword">module</span>.callFunction(emulator, <span class="number">0x1E7C</span> + <span class="number">1</span>, list.toArray())[<span class="number">0</span>];</span><br><span class="line">        String s = vm.getObject(number.intValue()).getValue().toString();</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 手动 patch 直接设置返回值为 0x1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">patch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> patchCode = <span class="number">0x4FF00100</span>;</span><br><span class="line">        emulator.getMemory().pointer(<span class="keyword">module</span>.base + <span class="number">0x1E86</span>).setInt(<span class="number">0</span>,patchCode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>脚本直接使用 Unidbg 运行会出现报错, 龙哥给出的是 patch 的方式直接跳过判断函数的执行, 设置 r0 寄存器的值为 1; <a href="https://armconverter.com/?code=mov%20r0,1">https://armconverter.com/?code=mov%20r0,1</a>, 获得 thumb 的cpcode 为: <code>4FF00100</code>; 使用 unidbg 设置 patch</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">patch</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> patchCode = <span class="number">0x4FF00100</span>;</span><br><span class="line">    emulator.getMemory().pointer(<span class="keyword">module</span>.base+<span class="number">0x1E86</span>).setInt(<span class="number">0</span>,patchCode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或者直接使用 010Editor 打开目标 so, 将原 cpcode <code>FF F7 EB FE</code>修改成<code>4F F0 01 00</code>然后运行, 测试也是可以的;</p>]]></content>
      
      
      <categories>
          
          <category> so </category>
          
      </categories>
      
      
        <tags>
            
            <tag> so </tag>
            
            <tag> unidbg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js逆向</title>
      <link href="antijs/"/>
      <url>antijs/</url>
      
        <content type="html"><![CDATA[<h2 id="算法还原"><a href="#算法还原" class="headerlink" title="算法还原"></a>算法还原</h2><h3 id="白盒还原"><a href="#白盒还原" class="headerlink" title="白盒还原"></a>白盒还原</h3><ul><li>  直接扣算法, 或者是标准算法</li><li>  理解对方 js 的意思, 能够翻译成其他语言, 可能会占用较长的分析时间</li></ul><h3 id="黑盒还原"><a href="#黑盒还原" class="headerlink" title="黑盒还原"></a>黑盒还原</h3><ul><li>  直接整体调用(加密复杂, 更新频繁, 整体关联度高)</li><li>  不需要关注算法逻辑, 需要模拟浏览器环境, 需要对抗环境检测</li></ul><h3 id="rpc-调用"><a href="#rpc-调用" class="headerlink" title="rpc 调用"></a>rpc 调用</h3><ul><li>  算法复杂度高, 浏览器环境难以模拟</li><li>  找到算法位置, 暴露出来, 直接 rpc 调用, 需要保证浏览器状态(内存泄漏, 保活)</li></ul><h3 id="浏览器自动化"><a href="#浏览器自动化" class="headerlink" title="浏览器自动化"></a>浏览器自动化</h3><ul><li>  无法逆向</li><li>  接近真人, 但是有大量的自动化痕迹;</li></ul><h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><ul><li>  数值 (Number): 整数和小数</li><li>  字符串 (String): 文本</li><li>  布尔值(Boolean): 布尔值, true 表示真, false 表示假</li><li>  undefined: 未定义, 或者不存在</li><li>  null: 表示空值</li><li>  对象 (Object): 各种值组成的集合</li></ul><h3 id="原始类型"><a href="#原始类型" class="headerlink" title="原始类型"></a>原始类型</h3><ol><li>  数值</li><li>  字符串</li><li>  布尔值</li></ol><p>原始类型就是最基本的数据类型, 不能再进行细分;</p><p>undefined 和 null 一般看成是两个特殊值;</p><h3 id="合成类型"><a href="#合成类型" class="headerlink" title="合成类型"></a>合成类型</h3><ul><li>对象<ul><li>  狭义的对象 Object</li><li>  数组 Array</li><li>  函数 Function</li></ul></li></ul><p>一个对象往往是由多个类型的值组成, 可以看成是一个存放各种值的容器</p><h3 id="查看类型"><a href="#查看类型" class="headerlink" title="查看类型"></a>查看类型</h3><ul><li>  typeof: 返回一个值的数据类型</li><li>  instanceof: 表示对象是否是某个构造函数的实例</li><li>  Object.prototype.toString</li></ul><p><code>typeof</code> 可以用来检查一个未声明的变量, 而不报错;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基本数据类型</span></span><br><span class="line"><span class="keyword">var</span> tmp1 = <span class="string">&quot;字符串&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> tmp2 = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> tmp3 = <span class="number">1.1</span>;</span><br><span class="line"><span class="keyword">var</span> tmp4 = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 特殊类型</span></span><br><span class="line"><span class="keyword">var</span> tmp5=  <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">var</span> tmp6 = <span class="literal">null</span>; <span class="comment">// null 是一个 object</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象</span></span><br><span class="line"><span class="keyword">var</span> tmp7 = &#123;&#125;; <span class="comment">// 对象</span></span><br><span class="line"><span class="keyword">var</span> tmp8 = []; <span class="comment">// 数组</span></span><br><span class="line"><span class="keyword">var</span> tmp9 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// 函数</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;typeof(tmp1)&quot;</span>, <span class="keyword">typeof</span> (tmp1));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;typeof(tmp2)&quot;</span>, <span class="keyword">typeof</span> (tmp2));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;typeof(tmp3)&quot;</span>, <span class="keyword">typeof</span> (tmp3));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;typeof(tmp4)&quot;</span>, <span class="keyword">typeof</span> (tmp4));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;typeof(tmp5)&quot;</span>, <span class="keyword">typeof</span> (tmp5));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;typeof(tmp6)&quot;</span>, <span class="keyword">typeof</span> (tmp6));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;typeof(tmp7)&quot;</span>, <span class="keyword">typeof</span> (tmp7));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;typeof(tmp8)&quot;</span>, <span class="keyword">typeof</span> (tmp8));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;typeof(tmp9)&quot;</span>, <span class="keyword">typeof</span> (tmp9));</span><br><span class="line"></span><br><span class="line"><span class="comment">// function 因为有类object 的操作, 所以也属于 object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;tmp9.name&quot;</span>, tmp9.name); <span class="comment">// 获取函数名</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//typeof(tmp1) string</span></span><br><span class="line"><span class="comment">//typeof(tmp2) number</span></span><br><span class="line"><span class="comment">//typeof(tmp3) number</span></span><br><span class="line"><span class="comment">//typeof(tmp4) boolean</span></span><br><span class="line"><span class="comment">//typeof(tmp5) undefined</span></span><br><span class="line"><span class="comment">//typeof(tmp6) object</span></span><br><span class="line"><span class="comment">//typeof(tmp7) object</span></span><br><span class="line"><span class="comment">//typeof(tmp8) object</span></span><br><span class="line"><span class="comment">//typeof(tmp9) function</span></span><br><span class="line"><span class="comment">//tmp9.name tmp9</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="null-undefined-和布尔值"><a href="#null-undefined-和布尔值" class="headerlink" title="null undefined 和布尔值"></a>null undefined 和布尔值</h3><blockquote><p>  null 和 undefined 的区别</p></blockquote><ul><li>  null 表示一个空对象, undefined 表示未定义;</li><li>  null 转为数值的时候为 0, undefined 转为数值的实收为 NaN;</li></ul><blockquote><p>  boolean</p></blockquote><p>布尔值表示真和假, true 表示真, false 表示假;</p><p>下列运算符会返回布尔值:</p><ol><li>  ! (not)</li><li>  相等运算符: ===, ==, !==, !===</li><li>  比较运算符: &gt;=, &lt;=, &lt;, &gt;</li></ol><blockquote><p>  表示 false 的值</p></blockquote><p>在自动数据转换中, 下列值会表示 false:</p><ol><li>  undefined</li><li>  null</li><li>  false</li><li>  0</li><li>  NaN</li><li>  “” 或者 ‘’ 空字符串</li></ol><p>其他的值都会被当成 true;</p><p>空数组[]和空对象{}对应的布尔值都是 true;</p><h3 id="数值"><a href="#数值" class="headerlink" title="数值"></a>数值</h3><p>在 js 中, 所有的数值都是 64 位浮点数的形式进行存储的, 也就是说在 js 底层, 没有整数只有浮点数;</p><p>因为浮点数精度的问题, js 在进行浮点数运算的时候经常会出现问题:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">0.1</span> + <span class="number">0.2</span>);</span><br><span class="line"><span class="comment">// 0.30000000000000004</span></span><br></pre></td></tr></table></figure><h4 id="进制"><a href="#进制" class="headerlink" title="进制"></a>进制</h4><ul><li>  十进制: 没有前导, 直接用数值表示</li><li>  八进制: 有前缀 0o 或者 0O</li><li>  十六进制: 有前缀 0x 或者 0X</li><li>  二进制: 有前缀 0b 或者 0B</li></ul><p>默认情况下, js 内部会将八进制, 十六进制, 二进制转为十进制;</p><h4 id="NaN"><a href="#NaN" class="headerlink" title="NaN"></a>NaN</h4><p>NaN 是 js 中的特殊值, 表示非数字(Not a Number), 主要出现在字符串解析成数字出错的时候;</p><ol><li>  NaN 不是独立的数据类型, 它是一个特殊值, 它的数据类型依然是 Number</li><li>  NaN 不等于任何值, 包括它本身 (不等于本身可以用来检测某个值是否是 NaN)</li><li>  NaN 和任何数运算, 得到的结果都是 NaN;</li></ol><h4 id="Infinity"><a href="#Infinity" class="headerlink" title="Infinity"></a>Infinity</h4><p>Infinity 用来表示无穷, 一般出现在两种场景下:</p><ol><li>  正数的数值太大, 或者负数的数值太小;</li><li>  非 0 的数除以 0, 得到 Infinity</li></ol><ul><li>  js 中数值正向溢出或者负向溢出或者被 0 除都不会报错, 所以单纯的数学运算几乎没有可能抛出异常</li><li>  Infinity 大于一切数值(除了 NaN); -Infinity 小于一切数值(除了 NaN)</li><li>  Infinity 和 NaN 比较, 总是返回 false;</li></ul><h4 id="全局-api"><a href="#全局-api" class="headerlink" title="全局 api"></a>全局 api</h4><blockquote><p>  parseInt(string[,radix]) </p></blockquote><p><code>parseInt(string[,radix])</code>将字符串解析成数值; 如果入参非字符串, 则会调用入参的<code>toString</code>方法转换为字符串再进行转换; 如果设置了第二个参数 radix, 则会将字符串按指定的 radix 进制转换成十进制; 返回数值或者 NaN</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&#x27;0xf&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a, <span class="number">16</span>); <span class="comment">// 将 16 进制的 0xf 转为十进制</span></span><br><span class="line"><span class="comment">// 15</span></span><br></pre></td></tr></table></figure><blockquote><p>  parseFloat(string)</p></blockquote><p><code>parseFloat(string)</code>将字符串入参解析成浮点数; 返回浮点数或者 NaN ;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;4.567&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">parseFloat</span>(a)); <span class="comment">// 4.567</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当入参有非法字符, 则只保留合法部分进行转换</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;4.567abcd&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">parseFloat</span>(b)); <span class="comment">// 4.567</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二个小数点忽略</span></span><br><span class="line"><span class="keyword">var</span> c = <span class="string">&quot;1.2.3&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">parseFloat</span>(c)); <span class="comment">// 1.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 起始为非法字符则直接返回 NaN</span></span><br><span class="line"><span class="keyword">var</span> d = <span class="string">&quot;aaa1.2&quot;</span>; <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">parseFloat</span>(d));</span><br></pre></td></tr></table></figure><blockquote><p>  isNaN()</p></blockquote><p>判断某个入参是否是 NaN; 可以利用 NaN 的不等性来进行判断</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="literal">NaN</span>;</span><br><span class="line"><span class="keyword">if</span> (a != a )&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;it is NaN&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>  isFinite()</p></blockquote><p>判断某个入参是否是 Infinity;</p><h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><ul><li>  字符串和数组相似, 都支持使用[]运算符来通过指定索引来获取值; </li><li>  length: 可以获取字符串的长度</li><li>  字符串不能通过[]运算符和索引来修改字符串的值</li></ul><h4 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h4><p>js 中使用的字符集为 Unicode 字符集, 所有的字符串都使用 Unicode 表示;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f\u006F\u006F = <span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(f\u006F\u006F);</span><br></pre></td></tr></table></figure><h4 id="base64-转码"><a href="#base64-转码" class="headerlink" title="base64 转码"></a>base64 转码</h4><ul><li>浏览器:<ul><li>  btoa(): 任意值转为 base64 编码</li><li>  atob(): base64 值解码</li><li>非 ASCII 码(如中文)要转码之后再 base64; <ul><li>  <code>encodeURIComponent</code></li><li>  <code>decodeURIComponent</code></li></ul></li></ul></li><li>Nodejs<ul><li>  <code>var base64encode = Buffer.from(&quot;js&quot;).toString(&quot;base64&quot;);</code></li><li>  <code>var base64decode = Buffer.from(base64encode,&#39;base64&#39;).toString();</code></li></ul></li></ul><h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><ul><li>  对象就是一组键值对 key-value 的集合, 是一种无序的复合数据集合</li><li>  对象的每个键名又称为属性 property; 它的值可以是任意数据类型;</li><li>  如果一个对象的某个属性的值是函数, 则通常将这个属性称为该对象的方法, 可以像函数一样调用这个方法;</li><li>  属性可以动态创建, 不必在对象声明的时候就全部定义;</li></ul><h4 id="对象引用"><a href="#对象引用" class="headerlink" title="对象引用"></a>对象引用</h4><ul><li>  如果不同的变量名指向同一个对象, 那么他们都是对这个对象的引用; 也就是说这些变量都指向了同一个内存地址, 修改其中任意一个的值都会影响到其他的变量;</li><li>  如果取消某一个变量对于原对象的引用, 不会影响到其他引用该对象的变量</li><li>  这种引用只局限于对象, 如果两个变量指向同一个原始类型的值, 这些变量都是对原始类型的值的拷贝, 改变任意变量都不会影响其他变量</li></ul><h4 id="属性查看"><a href="#属性查看" class="headerlink" title="属性查看"></a>属性查看</h4><p><code>Obejct.keys()</code>可以查看该对象自身的属性, 继承来的属性无法查看</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    hello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        consoel.log(<span class="string">&quot;hi&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    table: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    name: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">    age: <span class="number">21</span>,</span><br><span class="line">    married: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(a));</span><br><span class="line"></span><br><span class="line"><span class="comment">//[ &#x27;hello&#x27;, &#x27;table&#x27;, &#x27;name&#x27;, &#x27;age&#x27;, &#x27;married&#x27; ]</span></span><br></pre></td></tr></table></figure><h4 id="属性删除"><a href="#属性删除" class="headerlink" title="属性删除"></a>属性删除</h4><ul><li>  delete 用于删除对象的属性, 删除成功后返回 true</li><li>  删除一个不存在的属性, delete 不会报错, 而且返回 true</li><li>  只有一种情况, delete 命令会返回 false; 那就是删除一条存在的属性, 但是这条属性被定义成不能删除; (定义该属性不能删除 defineProperty)</li><li>  只能删除对象自身的属性, 继承来的属性不能删除</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    hello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        consoel.log(<span class="string">&quot;hi&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    table: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    name: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">    age: <span class="number">21</span>,</span><br><span class="line">    married: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> a.age, <span class="keyword">delete</span> a.hello;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(a));</span><br><span class="line"><span class="comment">// [ &#x27;table&#x27;, &#x27;name&#x27;, &#x27;married&#x27; ]</span></span><br></pre></td></tr></table></figure><h4 id="属性存在判断"><a href="#属性存在判断" class="headerlink" title="属性存在判断"></a>属性存在判断</h4><ul><li>  in 运算符可以用于检查对象是否包含某个属性; 检查的是键名, 存在这个属性返回 true, 不存在则返回 false;</li><li>  <code>hasOwnProperty()</code>: 判断某个属性是否是该对象自身的属性;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    hello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        consoel.log(<span class="string">&quot;hi&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    table: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    name: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">    age: <span class="number">21</span>,</span><br><span class="line">    married: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a.hasOwnProperty(<span class="string">&#x27;table&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;table&quot;</span> <span class="keyword">in</span> a) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;table is property of a&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="属性遍历"><a href="#属性遍历" class="headerlink" title="属性遍历"></a>属性遍历</h4><ul><li>  for in 循环可以用于遍历对象的全部属性; 不仅可以遍历对象自身的属性, 还可以遍历对象继承来的属性;</li><li>  如果只想遍历对象自身的属性, 可以配合 <code>hasOwnProperty()</code>进行筛选</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    hello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        consoel.log(<span class="string">&quot;hi&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    table: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    name: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">    age: <span class="number">21</span>,</span><br><span class="line">    married: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> aKey <span class="keyword">in</span> a) &#123;</span><br><span class="line">    <span class="comment">// 使用 hasOwnProperty 进行筛选</span></span><br><span class="line">    <span class="keyword">if</span> (a.hasOwnProperty(aKey)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(aKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h4><p>js 中函数声明有三种方式</p><ol><li>  使用 function 申明 <code>function a()&#123;&#125;</code></li><li>  函数表达式 <code>var a = function()&#123;&#125;</code></li><li>  Function 构造函数 <code>var a = Function(&quot;a&quot;,&quot;b&quot;, &quot;return a+b&quot;)</code>或者<code>var a = new Function(&quot;a&quot;,&quot;b&quot;, &quot;return a+b&quot;)</code> 这两种方式效果一样</li></ol><h4 id="函数是一等公民"><a href="#函数是一等公民" class="headerlink" title="函数是一等公民"></a>函数是一等公民</h4><p>js 将函数看成是一个值, 与其他数据类型一样, 凡是可以使用其他数据类型的地方都可以使用函数, 例如:</p><ol><li>  可以将函数赋值给变量或者对象的属性</li><li>  可以将函数作为参数传递给其他函数</li><li>  可以将函数作为其他函数的返回值</li></ol><h4 id="函数变量名提升"><a href="#函数变量名提升" class="headerlink" title="函数变量名提升"></a>函数变量名提升</h4><p>js 中全局变量名存在变量提升, 函数内部的局部变量也存在变量提升;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outer</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a); <span class="comment">// undefined 说明全局变量存在变量提升</span></span><br><span class="line">    <span class="built_in">console</span>.log(b); <span class="comment">// undefined 说明局部变量存在变量提升</span></span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">outer();</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>js 中函数的声明也存在变量提升, 可以先调用该方法, 再定义该方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;b called&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="函数的属性和方法"><a href="#函数的属性和方法" class="headerlink" title="函数的属性和方法"></a>函数的属性和方法</h4><ul><li>  name (属性): 返回函数的名字</li><li>  length(属性): 返回函数预期传入的形参数量</li><li>  toString()方法: 返回函数的字符串源码</li></ul><h4 id="函数作用域"><a href="#函数作用域" class="headerlink" title="函数作用域"></a>函数作用域</h4><ul><li>作用域 scope 是指变量存在的范围<ul><li>es5 中 js 只有两个作用域<ul><li>  全局作用域: 变量在整个程序中一直存在, 所有地方都可以读取到该变量</li><li>  函数作用域: 变量只在函数内部存在</li></ul></li><li>  es6 中新增了块级作用域</li></ul></li><li>  函数外部声明的变量就是全局变量, 它可以在函数内部读取到;</li><li>  在函数内部声明的变量就是局部变量, 函数外部无法读取;</li><li>  函数本身的作用域就是其声明时所在的作用域, 与其运行时的作用域无关;</li><li>  函数内部声明的函数, 作用域绑定函数内部(闭包)</li></ul><h4 id="函数参数省略"><a href="#函数参数省略" class="headerlink" title="函数参数省略"></a>函数参数省略</h4><p>js 中函数的参数不是必须的, 允许省略函数的参数;</p><p>函数的 length 属性只和函数声明时形参的个数有关, 和实际调用时传入的参数个数无关;</p><h4 id="参数传递方式"><a href="#参数传递方式" class="headerlink" title="参数传递方式"></a>参数传递方式</h4><ul><li>  函数的参数如果是原始数据类型 (数值, 字符串, 布尔), 参数传递使用按值传递的方式, 在函数内部修改参数的值不会影响函数外部</li><li>  如果函数的参数是复合数据类型(数组, 对象, 其他函数), 参数的传递方式是按址传递, 传入的是引用的地址, 因此在函数内部修改参数, 会影响到原始值;</li></ul><h4 id="arguments-对象"><a href="#arguments-对象" class="headerlink" title="arguments 对象"></a>arguments 对象</h4><ul><li>  因为 js 允许函数有不定数目的参数, 所以需要在函数体的内部可以读取到所有参数, 这就是 arguments 对象的由来</li><li>  arguments 对象包含了函数运行时的所有参数, 这是一个类数组对象, <code>arguments[0]</code>就是第一个参数;</li><li>  arguments 对象只能在函数内部使用</li><li>  arguments.length 可以获取函数调用时入参的真正个数</li><li>  arguments.callee 属性可以获取对应的原函数</li><li>arguments 对象是一个类数组对象, 如果要让他使用真正的数组方法, 需要将 arguments 转换成数组:<ul><li>  <code>Array.prototype.slice.call(arguments)</code></li><li>  新建数组, 遍历 arguments 将元素 push 到新数组中;</li></ul></li></ul><h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><ul><li>要理解闭包首先要理解 js 的作用域; 前面提到的 js 在 es5 中只有两种作用域:<ul><li>  全局作用域</li><li>  函数作用域</li></ul></li><li>  在函数的内部可以全局作用域的变量</li><li>  js 中特有的链式作用域结构, 子级会向上一级一级寻找所有父级的变量, 父级的所有变量对于子级来说都是可见的, 反之不成立;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(a,b);</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> b = <span class="number">4</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(a,b);</span><br><span class="line">    &#125;</span><br><span class="line">    f1();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f();</span><br><span class="line"><span class="comment">// 1 3</span></span><br><span class="line"><span class="comment">// 1 4</span></span><br></pre></td></tr></table></figure><blockquote><p>  链式作用域查找</p></blockquote><p>子级会优先使用自己的作用域, 如果变量存在则使用, 不存在则会依次向上寻找, 直至全局作用域;</p><blockquote><p>  闭包定义</p></blockquote><ul><li>  闭包可以简单理解成定义在一个函数内部的函数</li><li>  闭包最大的特点就是它可以记住自己诞生的环境, 本质上, 闭包就是将函数内部和函数外部连接起来的桥梁;</li><li>闭包最大的用处有两个<ol><li>  可以直接读取到外层函数内部的变量</li><li>  可以让这些变量始终保存在内存中, 闭包让自己诞生的环境一直存在</li></ol></li></ul><p>通过闭包实现简单的计数器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">count</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;count&quot;</span>, count);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f = count();</span><br><span class="line"></span><br><span class="line">f();</span><br><span class="line">f();</span><br><span class="line">f();</span><br></pre></td></tr></table></figure><h4 id="立即调用函数表达式"><a href="#立即调用函数表达式" class="headerlink" title="立即调用函数表达式"></a>立即调用函数表达式</h4><p>js 中有三种立即调用函数的方式</p><ol><li>  <code>var f = function()&#123;&#125;();</code></li><li>  <code>(function()&#123;&#125;())</code></li><li>  <code>(function()&#123;&#125;)()</code></li></ol><p>通常情况下, 只对匿名函数使用这种立即执行的表达式, 这样有两个目的:</p><ol><li>  不必为函数命名, 避免污染全局环境</li><li>  立即调用函数的内部会形成单独的作用域, 可以封装一些外部无法读取的私有变量</li></ol><h4 id="eval-命令"><a href="#eval-命令" class="headerlink" title="eval 命令"></a>eval 命令</h4><ul><li>  eval 可以接受一个字符串, 并将字符串当做代码执行</li><li>  eval 没有自己的作用域, 都是使用当前运行的作用域, 所以 eval 会修改当前作用域下的变量的值</li><li>  eval 的本质是在当前作用域中, 注入代码, 经常用于混淆和反爬</li></ul><blockquote><p>  eval 别名调用</p></blockquote><p>eval 的别名调用在 nodejs 下无法跑通, 需要在浏览器下运行; </p><p>需要注意, 在 eval 通过别名调用的时候, 作用域永远是全局作用域;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> e = <span class="built_in">eval</span>;</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">    e(<span class="string">&quot;console.log(a);&quot;</span>); <span class="comment">// eval 在别名调用的时候使用全局作用域</span></span><br><span class="line">&#125;())</span><br></pre></td></tr></table></figure><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><ul><li>  数组 Array 是按次序排列的一组值</li><li>  每个值的位置都有对应的索引</li><li>  数组使用 [ ] 来表示</li><li>  任何类型的数据都可以放入数组中</li><li>  本质上, 数组是特殊的对象, typeof 查看数组的类型返回的是 object</li><li>  Object.keys() 可以返回数组的键名(索引)</li></ul><h4 id="数组的属性"><a href="#数组的属性" class="headerlink" title="数组的属性"></a>数组的属性</h4><ul><li>  length: 表示数组的元素个数, 这个属性是可写的, 可以直接修改数组的 length 属性, 来实现清空数组或删除数组中元素的效果</li><li>  数组本质上是特殊的对象, 支持使用点操作符对数组添加属性;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, <span class="number">1.1</span>, <span class="literal">true</span>, &#123;&#125;, [], <span class="string">&quot;hello&quot;</span>, <span class="literal">null</span>, <span class="literal">undefined</span>];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;a.length&quot;</span>, a.length);</span><br><span class="line"></span><br><span class="line">a.name = <span class="string">&quot;add a.name property&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> aKey <span class="keyword">in</span> a) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(aKey, a[aKey]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Object.keys(a)&quot;</span>, <span class="built_in">Object</span>.keys(a));</span><br><span class="line"></span><br><span class="line">a.length = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>, a);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;a[&#x27;name&#x27;]&quot;</span>, a[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;a.name&quot;</span>, a.name);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;a[0]&quot;</span>, a[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure><h4 id="数组循环"><a href="#数组循环" class="headerlink" title="数组循环"></a>数组循环</h4><ul><li>  for in 循环</li><li>  for 循环</li><li>  while 循环</li><li>  forEach : 只有数组才有该方法; 该方法接受一个回调函数, 回调函数入参为 value 和 key;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, <span class="number">1.1</span>, <span class="literal">true</span>, &#123;&#125;, [], <span class="string">&quot;hello&quot;</span>, <span class="literal">null</span>, <span class="literal">undefined</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// for in</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> aKey <span class="keyword">in</span> a) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;aKey:&quot;</span>, aKey, <span class="string">&quot;value:&quot;</span>, a[aKey]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;-------------------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// for</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= a.length; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;index:&quot;</span>, i, <span class="string">&quot;value:&quot;</span>, a[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;-------------------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// while</span></span><br><span class="line"><span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (index &lt;= a.length) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;index:&quot;</span>, index, <span class="string">&quot;value:&quot;</span>, a[index]);</span><br><span class="line">    index++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;-------------------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// forEach</span></span><br><span class="line">a.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">value,key</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;key:&quot;</span>, key, <span class="string">&quot;value:&quot;</span>, value);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="数组空值"><a href="#数组空值" class="headerlink" title="数组空值"></a>数组空值</h4><p>js 中的数组支持空值, 出现空值时会占用该索引位, 但是遍历的时候不会遍历该索引的值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, , <span class="number">5</span>];</span><br><span class="line">a.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">value,key</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;key&quot;</span>, key, <span class="string">&quot;value&quot;</span>, value);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// key 0 value 1</span></span><br><span class="line"><span class="comment">// key 1 value 2</span></span><br><span class="line"><span class="comment">// key 2 value 3</span></span><br><span class="line"><span class="comment">// key 4 value 5</span></span><br></pre></td></tr></table></figure><h4 id="类数组对象"><a href="#类数组对象" class="headerlink" title="类数组对象"></a>类数组对象</h4><ul><li>  如果一个对象的所有键名都是正整数或者 0, 且有 length 属性, 那么这个对象就是类数组对象</li><li>  典型的类数组对象有 arguments 对象, 字符串, 以及大部分的 dom 元素集</li><li>  数组的 slice 方法可以将类似数组的对象变成真正的数组 <code>var arr = Array.prototype.slice.call(arrayLike);</code></li><li>  除了将类数组对象转成真正的数组, 还可以使用 call() 将数组的方法直接放到类数组对象上使用 <code>Array.prototype.forEach.call(arrayLike, function()&#123;&#125;);</code></li></ul><h2 id="数据类型转换"><a href="#数据类型转换" class="headerlink" title="数据类型转换"></a>数据类型转换</h2><h3 id="自动数据类型转换"><a href="#自动数据类型转换" class="headerlink" title="自动数据类型转换"></a>自动数据类型转换</h3><h4 id="其他类型转字符串"><a href="#其他类型转字符串" class="headerlink" title="其他类型转字符串"></a>其他类型转字符串</h4><p>当<code>+</code>加号作为操作符, 且操作数中含有字符串时, 会自动将另一个操作数转为字符串;</p><p>规则如下:</p><ol><li>  字符串+基础数据类型: 会直接将基础数据类型转为和字面量相同的字符串</li><li>  字符串+复合数据类型: 复合数据类型会先调用 <code>valueOf()</code>方法, 如果该方法返回基础数据类型则将其转为字符串, 如果返回的是复合数据类型, 则调用<code>toString()</code>方法, 如果返回的是基础数据类型则将其转为字符串, 如果不是则报错;</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础类型</span></span><br><span class="line"><span class="comment">// 自动数据类型转换</span></span><br><span class="line"><span class="comment">// + 字符串</span></span><br><span class="line"><span class="comment">// 1. 字符串 + 基础数据类型: 会直接将基础数据类型转为和字面量相同的字符串</span></span><br><span class="line"><span class="keyword">var</span> tmp1 = <span class="string">&quot;&quot;</span> + <span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;tmp1&quot;</span>, tmp1); <span class="comment">// tmp1 &quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tmp2 = <span class="string">&quot;&quot;</span> + <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;tmp2&quot;</span>, tmp2); <span class="comment">// tmp2 &quot;true&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tmp3 = <span class="string">&quot;&quot;</span> + <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;tmp3&quot;</span>, tmp3); <span class="comment">// tmp3 &quot;undefined&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tmp4 = <span class="string">&quot;&quot;</span> + <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;tmp4&quot;</span>, tmp4); <span class="comment">// tmp4 &quot;null&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串+复合数据类型: 复合数据类型会先调用 valueOf 方法, 如果此方法返回的是引用类型, 则再调用 toString()方法, 最后将返回值转为字符串类型</span></span><br><span class="line"><span class="keyword">var</span> tmp5 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] + <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;tmp5&quot;</span>, tmp5); <span class="comment">// tmp5 1,2,3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tmp6 = &#123;&#125; + <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;tmp6&quot;</span>, tmp6); <span class="comment">// tmp6 [object Object]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 toString 方法</span></span><br><span class="line"><span class="keyword">var</span> o = &#123;</span><br><span class="line">    toString: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tmp7 = o + <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;tmp7&quot;</span>, tmp7) <span class="comment">// tmp7 &quot;1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 valueOf 方法</span></span><br><span class="line">o.valueOf = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> tmp8 = <span class="string">&quot;&quot;</span> + o;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;tmp8&quot;</span>, tmp8); <span class="comment">// tmp8 2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    valueOf: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    toString: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;toString&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;&quot;</span> + a); <span class="comment">// toString</span></span><br></pre></td></tr></table></figure><h4 id="其他类型转布尔值"><a href="#其他类型转布尔值" class="headerlink" title="其他类型转布尔值"></a>其他类型转布尔值</h4><blockquote><p>  数值转布尔值</p></blockquote><p>数值在逻辑判断条件下会自动转成布尔值; +-0 和 NaN 为 false, 其他数值都是 true;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;0 is true&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;0 is false&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">NaN</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;NaN is true&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;NaN is false&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (-<span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;-0 is true&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;-0 is false&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 0 is false</span></span><br><span class="line"><span class="comment">// NaN is false</span></span><br><span class="line"><span class="comment">// -0 is false</span></span><br></pre></td></tr></table></figure><blockquote><p>  字符串转布尔值</p></blockquote><p>空字符串””或者’’为 false, 其他都是 true</p><blockquote><p>  undefined 和 null 转布尔值</p></blockquote><p>undefined 和 null 转为布尔值都是 false</p><blockquote><p>  对象转布尔值</p></blockquote><p>只有对象为 null 或者 undefined 时, 转为布尔值才是 false; 其他情况下(包括空对象{}和空数组[])转为布尔值都是 true;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;&#125;;</span><br><span class="line"><span class="keyword">if</span>(o)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;&#123;&#125; is true&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;[] is true&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &#123;&#125; is true ; 空数组[] 同理</span></span><br></pre></td></tr></table></figure><h4 id="其他类型转为数值"><a href="#其他类型转为数值" class="headerlink" title="其他类型转为数值"></a>其他类型转为数值</h4><p>一元操作符<code>+</code>和<code>-</code>都会触发其他类型转为数值;</p><p>数学运算符操作的两个操作数都不是字符串时, 也会触发其他类型转为数值的操作;</p><p>转化规则如下:</p><ol><li>  字符串转数值: 空字符串转为 0, 非空字符串转为对应的数字; 不合法则返回 NaN;</li><li>  布尔值转数值: true 为 1, false 为 0;</li><li>  null 转为数值为 0</li><li>  undefined 转数值为 NaN</li><li>  对象转数值会先调用 <code>valueOf()</code>方法, 如果其返回值是基础数据类型, 则将其转为数值返回, 如果是复合数据类型, 则会调用<code>toString()</code>方法, 再将其转为数值, 如果不合法则返回 NaN;</li></ol><h3 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h3><ul><li>  Number(): 将其他类型转为数值; 将对象转为数值时, 会先调用对象的<code>valueOf()</code>方法, 不满足条件再调用<code>toString()</code>方法</li><li>  String(): 将其他类型转为字符串; 将对象转为字符串时, 会先调用对象的<code>toString()</code>方法, 不满足条件时再调用对象的<code>valueOf()</code>方法;</li><li>  Boolean(): 将其他类型转为布尔值</li></ul><h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><h3 id="Error-对象"><a href="#Error-对象" class="headerlink" title="Error 对象"></a>Error 对象</h3><p>Error 对象通常包含常用的三个属性, 且必须包含 message 属性;</p><ol><li>  name: 异常名</li><li>  message: 异常提示信息</li><li>  stack: 异常调用栈信息</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> e = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;自定义异常触发&quot;</span>);</span><br><span class="line">e.name = <span class="string">&quot;自定义异常名称&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(e.name);</span><br><span class="line"><span class="built_in">console</span>.log(e.message);</span><br><span class="line"><span class="built_in">console</span>.log(e.stack);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">自定义异常名称</span></span><br><span class="line"><span class="comment">自定义异常触发</span></span><br><span class="line"><span class="comment">自定义异常名称: 自定义异常触发</span></span><br><span class="line"><span class="comment">    at Object.&lt;anonymous&gt; (/Users/zhangyang/codes/antiJs/js_learn/_03_基本数据类型(下)/tmp.js:201:9)</span></span><br><span class="line"><span class="comment">    at Module._compile (internal/modules/cjs/loader.js:1085:14)</span></span><br><span class="line"><span class="comment">    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1114:10)</span></span><br><span class="line"><span class="comment">    at Module.load (internal/modules/cjs/loader.js:950:32)</span></span><br><span class="line"><span class="comment">    at Function.Module._load (internal/modules/cjs/loader.js:790:14)</span></span><br><span class="line"><span class="comment">    at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:76:12)</span></span><br><span class="line"><span class="comment">    at internal/main/run_main_module.js:17:47</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="try-catch-finally"><a href="#try-catch-finally" class="headerlink" title="try catch finally"></a>try catch finally</h3><p>手动抛出异常并捕获</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> e = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;message 自定义异常&quot;</span>);</span><br><span class="line">    e.name = <span class="string">&quot;自定义异常名称&quot;</span>;</span><br><span class="line">    <span class="keyword">throw</span> e;</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;e.name&quot;</span>, e.name, <span class="string">&quot;e.message&quot;</span>, e.message);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;e.stack&quot;</span>, e.stack);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>  throw</p></blockquote><p><code>throw</code>语句用来抛出用户定义的异常, 当前函数的执行将被停止, <code>throw</code>之后的代码不会被执行; 并且代码将会进入调用栈中第一个<code>catch</code>块中; 如果没有<code>catch</code>块, 程序将会终止;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;before throw error&quot;</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;throw error&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;after throw error&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;catch error&quot;</span>, e.message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// before throw error</span></span><br><span class="line"><span class="comment">// catch error throw error</span></span><br></pre></td></tr></table></figure><blockquote><p>   try/catch/finally</p></blockquote><p>try 的三种声明形式:</p><ol><li>  try…catch</li><li>  try…finally</li><li>  try…catch…finally</li></ol><p>try/catch 主要用于捕获异常, try/catch 语句包含一个 try 块, 和至少一个 catch 块或者一个 finally 块;</p><ul><li><p>  try: try 块中放入可能会产生异常的语句或者函数</p></li><li><p>  catch: catch 块中包含要执行的语句, 当 try 块中抛出异常时, catch 块会捕获这个异常, 并执行 catch 块中的代码; 如果 try 块中没有异常抛出, 则 catch 块会被跳过;</p></li><li><p>finally: finally 块在 try 块和 catch 块之后执行, 无论是否有异常产生, finally 块都会执行; 当 finally 块中有异常产生时, 会覆盖掉 try 块中的异常信息;</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;error1&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;error2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;e.message&quot;</span>, e.message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// e.message error2</span></span><br></pre></td></tr></table></figure></li><li><p>如果 finally 块中返回一个值, 那么这个值将会作为整个 try/catch/finally 的返回值, 无论在 try 和 catch 有没有 return, 都是返回 finally 中的值;</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;error1&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;error2&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;test()&quot;</span>, test());</span><br><span class="line"><span class="comment">// test() 3</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="对象详解和-hook"><a href="#对象详解和-hook" class="headerlink" title="对象详解和 hook"></a>对象详解和 hook</h2><h3 id="Object-静态方法和实例方法"><a href="#Object-静态方法和实例方法" class="headerlink" title="Object 静态方法和实例方法"></a>Object 静态方法和实例方法</h3><ul><li>  js 中所有其他对象都是继承自 Object ; 即所有对象都是 Object 的实例;</li><li>Object 的原生方法分为两类: Object 本身的方法和 Object 的实例方法<ol><li>  Object 本身的方法: 直接定义在 Object 上的方法, 相当于 java 的静态方法</li><li>  Object 的实例方法: 定义在 Object 的原型对象 Object.prototype 上的方法; 相当于 java 中的动态方法, 可以被 Object 对象直接使用</li></ol></li></ul><h4 id="Object-的静态方法"><a href="#Object-的静态方法" class="headerlink" title="Object 的静态方法"></a>Object 的静态方法</h4><p>所谓静态方法, 就是设置在 Object 类上的方法;</p><ul><li>  Object.keys(): 遍历对象的属性, 返回可枚举的属性名; 这个方法只能查看对象自身的属性, 继承来的属性无法查看</li><li>  Object.getOwnpeopertyNames(): 遍历对象的属性, 可以返回不可枚举的属性名;</li><li>  Object.getOwnPropertyDescriptors(): 获取对象所有属性的描述对象;</li><li>  Object.defineProperty(): 通过描述对象, 定义某个属性, 可以重写 get 和 set 方法来进行 hook</li><li>  Object.defineProperties(): 通过描述对象, 定义多个属性, 可以重写 set 和 get 方法来进行 hook</li><li>  Object.getPrototypeOf(): 返回参数对象的原型, 可以用于环境监测;</li><li>  Object.setPrototypeOf(): 为参数对象设置原型, 返回该参数对象; 它接收两个参数, 第一个是现有对象, 第二个是原型对象;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.a = a;</span><br><span class="line">    <span class="built_in">this</span>.b = b;</span><br><span class="line">    <span class="built_in">this</span>.c = c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> test = <span class="keyword">new</span> Test(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(test,<span class="string">&quot;d&quot;</span>,&#123;</span><br><span class="line">    configurable: <span class="literal">false</span>, <span class="comment">// 是否可以删除 默认 false 不可删除</span></span><br><span class="line">    enumerable: <span class="literal">false</span>,  <span class="comment">// 是否是可迭代字段</span></span><br><span class="line">    value: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">    writable: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 使用Object.defineProperty() 定义对象属性时，如已设置 set 或 get, 就不能设置 writable 和 value 中的任何一个了</span></span><br><span class="line">    <span class="comment">// get: function()&#123;</span></span><br><span class="line">    <span class="comment">//     return this.d;</span></span><br><span class="line">    <span class="comment">// &#125;,</span></span><br><span class="line">    <span class="comment">// set: function (value) &#123;</span></span><br><span class="line">    <span class="comment">//     this.d = value;</span></span><br><span class="line">    <span class="comment">//     return this.d;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历对象的属性, 返回可枚举的属性名, 仅可查看变量本身的属性, 不能查看继承来的属性</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(test)); <span class="comment">// [ &#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27; ]</span></span><br><span class="line"><span class="comment">// 遍历对象的属性, 可以返回不可枚举的类型</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyNames(test)); <span class="comment">// [ &#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27; ]</span></span><br><span class="line"><span class="comment">// 获取对象的所有属性的描述对象</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptors(test));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* &#123;</span></span><br><span class="line"><span class="comment">  a: &#123; value: 1, writable: true, enumerable: true, configurable: true &#125;,</span></span><br><span class="line"><span class="comment">  b: &#123; value: 2, writable: true, enumerable: true, configurable: true &#125;,</span></span><br><span class="line"><span class="comment">  c: &#123; value: 3, writable: true, enumerable: true, configurable: true &#125;,</span></span><br><span class="line"><span class="comment">  d: &#123;</span></span><br><span class="line"><span class="comment">    value: &#x27;4&#x27;,</span></span><br><span class="line"><span class="comment">    writable: true,</span></span><br><span class="line"><span class="comment">    enumerable: false,</span></span><br><span class="line"><span class="comment">    configurable: false</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 设置对象的原型</span></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(test, Test);</span><br><span class="line"><span class="comment">// 获取对象的原型对象, 可以用于原型检测</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getPrototypeOf(test));</span><br></pre></td></tr></table></figure><h4 id="Object-的实例方法"><a href="#Object-的实例方法" class="headerlink" title="Object 的实例方法"></a>Object 的实例方法</h4><ul><li>  Object.prototype.valueOf(): 返回当前对象对应的值</li><li>Object.prototype.toString(): 返回当前对象对应的字符串形式<ul><li>  因为实例对象可能自定义了 toString 方法, 覆盖了 Object.prototype.toString 方法; 所以为了得到类型字符串, 最好使用 Object.prototype.toString 方法, 通过 call 的方式可以在任意对象上调用这个方法, 帮助判断;</li></ul></li><li>  Object.prototype.hasOwnProperty(): 判断某个属性是否是当前对象自身的属性, 可以区分某个属性是对象自身的还是继承来的;</li><li>  Object.prototype.isPrototypeOf(): 判断当前对象是否是另一个对象的原型;</li><li>  Object.prototype.propertyIsEnumerable(): 判断某个属性是否是可枚举的</li></ul><h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3><ul><li>  典型的面向对象的变成语言都有类的概念, 所谓类就是对象的模板, 对象就是类的实例;</li><li>  js 不是基于类的, 而是基于构造函数和原型链;</li><li>  构造函数就是一个简单的函数, 当函数和 new 关键字配合使用, 就可以返回一个实例对象;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span> (<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.a = a;</span><br><span class="line">    <span class="built_in">this</span>.b = b;</span><br><span class="line">    <span class="built_in">this</span>.c = c;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> initObj = <span class="keyword">new</span> init(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;initObj&quot;</span>, initObj);</span><br></pre></td></tr></table></figure><h3 id="创建对象的方式"><a href="#创建对象的方式" class="headerlink" title="创建对象的方式"></a>创建对象的方式</h3><ol><li>  直接赋值, <code>var obj = &#123;&#125;;</code>或者<code>var obj=Object(&#123;&#125;);</code>(强制转为对象)</li><li>  new 关键字创建: <code>var obj = new Object();</code></li><li>  Object.create(arg, property): 以传入的对象的构造函数作为模板, 可以生成实例对象; 一般用于在拿不到构造函数时, 直接通过现有的实例作为参数, 来构造新的实例;</li></ol><p>这三种创建对象方式的区别:</p><ol><li>  字面量和 new 关键字创建的对象是 Object 的实例, 原型指向 Object.prototype; 继承内置对象 Object</li><li>  Object.create(arg, property) 创建的对象的原型取决入参 arg, arg 为 null 时, 创建的是空对象; arg 为指定对象时, 则新对象的原型指向指定对象, 继承指定对象;</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span> (<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.a = a;</span><br><span class="line">    <span class="built_in">this</span>.b = b;</span><br><span class="line">    <span class="built_in">this</span>.c = c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> init(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = <span class="built_in">Object</span>.create(obj,&#123;</span><br><span class="line">    <span class="string">&quot;p&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;p1&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;obj2&quot;</span>, obj2); <span class="comment">// obj2 init &#123;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;obj2.p&quot;</span>, obj2.p);<span class="comment">// obj2.p p1</span></span><br></pre></td></tr></table></figure><h3 id="原型对象-Object-prototype"><a href="#原型对象-Object-prototype" class="headerlink" title="原型对象 Object.prototype"></a>原型对象 Object.prototype</h3><ul><li>  js 的继承机制的设计思想是: 原型对象上的所有属性和方法, 都能被实例对象共享; 也就是说, 如果属性和方法定义在原型对象上, 那么所有的实例都可以共享这些属性和方法;</li><li>  js 规定, 每个对象都有一个 <code>__proto__</code>指向原型对象</li><li>  js 规定, 每个函数除了有<code>__proto__</code>之外, 还有一个<code>prototype</code>属性; <code>__proto__</code>指向函数原型 Function.prototype, <code>prototype</code>指向一个原型对象;</li><li>  原型对象上定义的属性和方法不是实例对象自身的, 所以修改原型对象上的属性和方法, 这种变动会影响到所有实例属性;</li><li>  当实例本身没有某个属性或者方法的时候, 它会到原型对象上寻找该属性和方法, 类似 java 的双亲委派机制;</li></ul><blockquote><p><code>prototype</code> 和 <code>__proto__</code> 区别</p></blockquote><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-20-072915.jpg"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(test.prototype.__proto__.__proto__); <span class="comment">// null</span></span><br><span class="line"><span class="built_in">console</span>.log(test.__proto__.__proto__.__proto__); <span class="comment">// null</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DTA</span>(<span class="params">boss, employee</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.boss = boss;</span><br><span class="line">    <span class="built_in">this</span>.employee = employee;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DTA.prototype.room = &#123;</span><br><span class="line">    <span class="string">&quot;roomNum&quot;</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">DTA.prototype.name = <span class="string">&quot;kevin&quot;</span>;</span><br><span class="line"></span><br><span class="line">DTA.prototype.dowork = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.boss +<span class="string">&quot; &quot;</span> + <span class="built_in">this</span>.employee +<span class="string">&quot; &quot;</span>+ <span class="string">&quot;do work now&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dta = <span class="keyword">new</span> DTA(<span class="string">&quot;kevin&quot;</span>, <span class="string">&quot;rub&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> dta2 = <span class="keyword">new</span> DTA(<span class="string">&quot;kevin2&quot;</span>, <span class="string">&quot;rub2&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改 DTA.prototype 原型上的属性, 会影响到所有的实例</span></span><br><span class="line">DTA.prototype.name = <span class="string">&quot;change&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(dta2.__proto__ === DTA.prototype); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(dta2.name); <span class="comment">// change</span></span><br><span class="line"></span><br><span class="line">dta2.room.roomNum = <span class="number">2</span>; <span class="comment">// 从其他对象上修改原型对象的属性, 也会影响其他对象</span></span><br><span class="line">dta2.__proto__.name = <span class="string">&quot;change2&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(dta.name); <span class="comment">// change2</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;dta.boss&quot;</span>, dta.boss);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;dta.employee&quot;</span>, dta.employee);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;dta.dowork()&quot;</span>, dta.dowork());</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;dta.room.roomNum&quot;</span>, dta.room.roomNum); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><h3 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h3><ul><li>  js 规定, 所有对象都有自己的原型对象 prototype;</li><li>  任何一个对象都可以充当其他对象的原型;</li><li>  由于原型也是一个对象, 所以它也有自己的原型对象, 最终形成一个原型链, 对象 –&gt;  原型 –&gt;  另一个原型…</li></ul><h3 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h3><ul><li>  原型对象 property 有一个 constructor 属性, 这个属性指向 prototype 对象所在的构造函数</li><li>  constructor 属性的作用是: 可以得知某一个实例对象, 到底是由哪一个构造函数产生的</li><li>  有了 constructor 属性, 就可以找到构造函数, 可以通过一个实例对象来新建另一个实例</li><li>constructor 还可以用来设置一些环境监测:<ol><li>  <code>document.constructor === HTMLDocument</code></li><li>  <code>navigator.constructor === Navigator</code></li><li>  经常和<code>toString()</code>配合进行检测, 这样在 node 中运行不会报错,更难发现; <code>navigator.constructor.toString() === &quot;function Navigator() &#123; [native code] &#125;&quot;</code></li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数的 .prototype.constructor 等于函数本身</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(test.prototype.constructor === test);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 环境监测 document.constructor === HTMLDocument</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HTMLDocument</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">document</span> = <span class="keyword">new</span> HTMLDocument();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">document</span>.constructor === HTMLDocument);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> document2 = <span class="keyword">new</span> <span class="built_in">document</span>.__proto__.constructor();</span><br><span class="line"><span class="built_in">console</span>.log(document2.constructor === HTMLDocument);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 环境监测 navigator.constructor === Navigator</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Navigator</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> navigator = <span class="keyword">new</span> Navigator();</span><br><span class="line"><span class="built_in">console</span>.log(navigator.constructor === Navigator);</span><br><span class="line"><span class="keyword">var</span> navigator2 = <span class="keyword">new</span> navigator.constructor();</span><br><span class="line"><span class="built_in">console</span>.log(navigator2.constructor === Navigator); <span class="comment">// 不带__proto__也可以, 默认会自动去原型链上查找</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 环境监测 配合 toString()进行检测,node 下不会报错, 更难发现</span></span><br><span class="line"><span class="comment">// navigator.constructor.toString() === &quot;function Navigator() &#123; [native code] &#125;&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Navigator</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">Navigator.toString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// Navigator.prototype.constructor.toString</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;function Navigator() &#123; [native code] &#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> navigator = <span class="keyword">new</span> Navigator();</span><br><span class="line"><span class="built_in">console</span>.log(navigator.constructor.toString());</span><br><span class="line"><span class="built_in">console</span>.log(navigator.constructor.toString() === <span class="string">&quot;function Navigator() &#123; [native code] &#125;&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="hook-cookie"><a href="#hook-cookie" class="headerlink" title="hook cookie"></a>hook cookie</h3><p>简易版 hook cookie</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cookie = <span class="built_in">document</span>.cookie;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(<span class="built_in">document</span>, <span class="string">&#x27;cookie&#x27;</span>, &#123;</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;getter:&quot;</span> + cookie);</span><br><span class="line">        <span class="keyword">return</span> cookie;</span><br><span class="line">    &#125;,</span><br><span class="line">    set: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;setter:&quot;</span> + cookie);</span><br><span class="line">        <span class="keyword">if</span> (value.indexOf(<span class="string">&quot;targetCookie&quot;</span>) &gt; -<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">debugger</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cookie = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>油猴 hook cookie</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name        Hook Cookie</span></span><br><span class="line"><span class="comment">// @namespace   http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version     0.1</span></span><br><span class="line"><span class="comment">// @description try to take over the world!</span></span><br><span class="line"><span class="comment">// @author      You</span></span><br><span class="line"><span class="comment">// @include     *</span></span><br><span class="line"><span class="comment">// @grant       none</span></span><br><span class="line"><span class="comment">// @run-at      document-start</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    &#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;hook cookies start ...&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> cookie_cache = <span class="built_in">document</span>.cookie;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(<span class="built_in">document</span>, <span class="string">&#x27;cookie&#x27;</span>, &#123;</span><br><span class="line">        get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;get cookie:&quot;</span> + cookie_cache);</span><br><span class="line">            <span class="keyword">return</span> cookie_cache;</span><br><span class="line">        &#125;,</span><br><span class="line">        set: <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;Setting cookie&#x27;</span>, val);</span><br><span class="line">            <span class="comment">// 填写cookie名</span></span><br><span class="line">            <span class="keyword">if</span> (val.indexOf(<span class="string">&#x27;w_token&#x27;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">debugger</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> cookie = val.split(<span class="string">&quot;;&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">var</span> ncookie = cookie.split(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">var</span> cache = cookie_cache.split(<span class="string">&quot;; &quot;</span>);</span><br><span class="line">            cache = cache.map(<span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (a.split(<span class="string">&quot;=&quot;</span>)[<span class="number">0</span>] === ncookie[<span class="number">0</span>]) &#123;</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">return</span> cookie;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> a;</span><br><span class="line">            &#125;)</span><br><span class="line">            cookie_cache = cache.join(<span class="string">&quot;; &quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">                cookie_cache += cookie + <span class="string">&quot;; &quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> cookie_cache;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h3 id="object-copy"><a href="#object-copy" class="headerlink" title="object copy"></a>object copy</h3><p>对象拷贝需要做到两件事:</p><ol><li>  确保拷贝后的对象, 与原对象具有相同的原型</li><li>  确保拷贝后的对象, 与原对象具有同样的实例属性</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copyObj</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.create(</span><br><span class="line">    <span class="built_in">Object</span>.getPrototypeOf(obj),</span><br><span class="line">        <span class="built_in">Object</span>.getOwnPropertyDescriptors(obj)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">kevin</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.a = a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> kevinObj = <span class="keyword">new</span> kevin(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> kevinObj2 = copyObj(kevinObj);</span><br></pre></td></tr></table></figure><h3 id="Array-对象"><a href="#Array-对象" class="headerlink" title="Array 对象"></a>Array 对象</h3><ul><li>  isArray(): 返回一个布尔值, 表示参数是否是一个数组, 可以弥补 typeof 运算符的不足</li><li>push(), pop()<ul><li>  push: 数组的末端添加一个或者多个元素, 并返回添加新元素后的数组长度</li><li>  pop: 删除数组的最后一个元素, 并返回该元素</li></ul></li><li>shift(), unshift()<ul><li>  shift: 用于删除数组的第一个元素, 并返回该元素</li><li>  unshift: 用于在数组的第一个位置添加元素, 并返回添加新元素后数组长度</li></ul></li><li>  join(): 以指定的参数作为分隔符, 将数组中所有成员连接成一个字符串并返回, 如果不指定分隔符, 则默认使用逗号分隔</li><li>  concat(): 用于多个数组合并, 将新数组的成员添加到原数组成员的后面, 然后返回一个新数组, 原数组保持不变</li><li>  reverse(): 用于颠倒排列数组元素, 返回改变后的数组, 该方法将会改变原数组</li><li>  slice(): 提取目标数组的一部分, 返回一个新数组, 原数组保持不变</li><li>  splice(): 删除原数组的一部分, 并可以在删除的位置添加新的数组成员, 返回值是被删除的元素, 该方法会改变原数组;</li><li>  sort(): 对数组成员进行排序, 默认是按照字典顺序排序, 排序后原数组将改变</li><li>  map(): 将数组的所有成员依次传入回调函数中, 然后把回调函数每一次执行结果组成一个新数组返回</li><li>  forEach(): 与 map()类似, 无返回值, 只是操作原数组</li><li>  filter(): 用于过滤数组成员, 满足条件的成员组成一个新数组返回;</li><li>  indexOf(): 返回给定元素在数组中第一次出现的位置, 如果没有出现则返回-1;</li></ul><h3 id="包装对象"><a href="#包装对象" class="headerlink" title="包装对象"></a>包装对象</h3><p>三种原始类型的值在一定条件下也会自动转为对象, Boolean(), String()和 Number();</p><p>当使用 new 关键字的时候就会创建一个新的包装对象, 当不使用 new 关键字时就是强制类型转换;</p><h3 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h3><ul><li>  Math.abs(): 返回入参的绝对值</li><li>  Math.ceil(): 返回入参向上取整之后的值</li><li>  Math.floor(): 返回入参向下取整之后的值</li><li>  Math.max(): 返回数组中的最大值</li><li>  Math.min(): 返回数组中的最小值</li><li>  Math.random(): 返回 0-1 的伪随机值</li><li>  Math.round(): 返回入参四舍五入后的整数</li></ul><h3 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h3><p>创建一个新的 Date 对象的唯一方式是通过 new 操作符;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(value);</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(dateString);</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(year, monthIndex [, day [, hours [, minutes [, seconds [, milliseconds]]]]]);</span><br></pre></td></tr></table></figure><ul><li>  Date.now(): 返回当前时间戳</li><li>  Date.parse(): 解析时间字符串, 返回时间戳</li></ul><h3 id="控制台-API"><a href="#控制台-API" class="headerlink" title="控制台 API"></a>控制台 API</h3><ul><li>  inspect(obj): 打开相关面板并选中相应的元素, 展示它的细节</li><li>  getEventListeners(): 返回一个对象, 该对象的键为事件, 值为数组; 数组的成员为该事件的回调函数;</li><li>  keys(), values(): 返回一个数组, 包含 object 的所有键名和值</li><li>monitorEvents(object,[,events]): 监听特定对象上发生的特定事件; 事件发生时, 会返回一个 Event 对象; 包含该事件的相关信息; unmonitorEvents 方法用来停止监听;<ul><li>monitorEvents: 允许监听同一大类的事件, 所有事件可以分为四大类:<ol><li>  mouse: mousedown, mouseup, click, dblclick, mousemove, mouseover, mouseout, mousewheel</li><li>  key: keydown, keyup, keypress, textInput</li><li>  touch: touchstart, touchmove, touchend, touchcancel</li><li>  control: resize, scroll, zoom, focus, blur, select, change, submit, reset</li></ol></li></ul></li><li>  copy(obj): 复制特定对象到剪贴板</li><li>  debugger: 断点</li></ul><h3 id="this-关键字"><a href="#this-关键字" class="headerlink" title="this 关键字"></a>this 关键字</h3><ul><li>  this 就是属性或者方法当前所在的对象</li><li>this 主要使用场景:<ol><li>  全局环境使用 this, 它指的就是顶层对象 window</li><li>  构造函数中使用 this, 它指的就是实例对象</li><li>  如果对象的方法包含 this, this 的指向就是方法运行时所在的对象; 该方法赋值给另一个对象, 就会改变 this 的指向;</li></ol></li></ul><h4 id="绑定-this-的方法"><a href="#绑定-this-的方法" class="headerlink" title="绑定 this 的方法"></a>绑定 this 的方法</h4><ol><li>  Function.prototype.call(thisValue, arg1, arg2 …) : 函数实例的 call 方法, 可以指定函数内部的 this 的指向(即函数执行时所在的作用域); 然后在指定作用域中调用该函数</li><li>  Function.prototype.apply(thisValue, [arg1, arg2. ..]): apply 和 call 方法类似, 都是可以改变 this 的指向; 唯一区别就是它接受一个数组作为函数执行时的参数;</li><li>  Function.prototype.bind(thisValue, arg1, arg2. ..): 将函数体内的 this 绑定到某个对象, 然后返回一个新函数;</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="built_in">console</span>.log(d.getTime());</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getTime = d.getTime;</span><br><span class="line">getTime(); <span class="comment">// 直接调用 error, this is not a Date object</span></span><br><span class="line"><span class="keyword">var</span> d_getTime = getTime.bind(d, []);</span><br><span class="line"><span class="built_in">console</span>.log(d_getTime());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="keyword">var</span> getTime = d.getTime;</span><br><span class="line"><span class="keyword">var</span> result = getTime.apply(d, []);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="keyword">var</span> getTime = d.getTime;</span><br><span class="line"><span class="keyword">var</span> result = getTime.call(d);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="es6-部分新特性"><a href="#es6-部分新特性" class="headerlink" title="es6 部分新特性"></a>es6 部分新特性</h2><p>es6 是 js 语言的下一代标准, 在 2015 年 6 月正式发布; 它的目标是让 js 语言可以用来编写复杂的大型应用程序; es 和 js 的关系是: es 是 js 的规格, js 是 es 的实现;</p><h3 id="块级作用域"><a href="#块级作用域" class="headerlink" title="块级作用域"></a>块级作用域</h3><p>es6 中提出了两个新的变量声明命令: let 和 const; let 可以完全取代 var; var 命令存在变量提升的效果, let 命令则不存在这个问题; 所以尽量使用 let, 减少 var 的使用;</p><p>在全局环境中使用 var 声明变量, 会直接将变量定义到全局环境中, 在全局环境中使用 let 和 const 是不会直接将变量定义到全局环境上的;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在浏览器环境下运行</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> c = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.a); <span class="comment">// 10</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.b); <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.c); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p>在 es5 中, 只有函数作用域和全局作用域; 在 es6 中新增了块级作用域; 比如典型的 for 循环; 使用 var 会导致变量泄漏到全局环境中, 使用 let 就不会存在该问题;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(i);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> a = <span class="number">0</span>; a &lt; <span class="number">10</span>; a++)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><h3 id="属性简洁表达"><a href="#属性简洁表达" class="headerlink" title="属性简洁表达"></a>属性简洁表达</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// es5</span></span><br><span class="line"><span class="comment">// var team = &#123;company: &quot;dta&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// es6</span></span><br><span class="line"><span class="keyword">const</span> company = <span class="string">&quot;dta&quot;</span>; <span class="comment">// 先定义属性</span></span><br><span class="line"><span class="keyword">const</span> team = &#123;company&#125;;  <span class="comment">// 再定义对象</span></span><br><span class="line"><span class="built_in">console</span>.log(team);</span><br><span class="line"></span><br><span class="line"><span class="comment">// es6</span></span><br><span class="line"><span class="keyword">let</span> boss = <span class="string">&quot;Dta boss&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> Dta = &#123;</span><br><span class="line">    [boss]: <span class="string">&quot;roysue&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Dta[&#x27;Dta boss&#x27;]&quot;</span>, Dta[<span class="string">&#x27;Dta boss&#x27;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="对象方法简洁表达"><a href="#对象方法简洁表达" class="headerlink" title="对象方法简洁表达"></a>对象方法简洁表达</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// es5</span></span><br><span class="line"><span class="keyword">var</span> team = &#123;</span><br><span class="line">    dowork: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;work!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// es6</span></span><br><span class="line"><span class="keyword">var</span> team = &#123;</span><br><span class="line">    <span class="function"><span class="title">dowork</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;work&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="字符串模板"><a href="#字符串模板" class="headerlink" title="字符串模板"></a>字符串模板</h3><p>在 es6 中新增了动态的字符串模板, 使用反引号表示, 使用${}进行填充;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;kevin&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`hi, <span class="subst">$&#123;name&#125;</span>`</span>);</span><br></pre></td></tr></table></figure><h3 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h3><blockquote><p>  数组解构</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line"><span class="keyword">const</span> [first, second] = arr; <span class="comment">// first = arr[0], second = arr[1];</span></span><br><span class="line"><span class="built_in">console</span>.log(first, second); <span class="comment">// 1,2</span></span><br></pre></td></tr></table></figure><blockquote><p>  对象解构</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    firstName: <span class="string">&quot;chen&quot;</span>,</span><br><span class="line">    lastName: <span class="string">&quot;guilin&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFullName</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;firstName, lastName&#125; = obj;</span><br><span class="line">    <span class="built_in">console</span>.log(firstName, lastName); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getFullName(obj); <span class="comment">// chen guilin</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure><blockquote><p>  快速复制对象</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Dta = &#123;</span><br><span class="line">    name: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">    age: <span class="number">29</span>,</span><br><span class="line">    <span class="function"><span class="title">dowork</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;work&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newDta = &#123;...Dta&#125;; <span class="comment">// 用于取出参数对象的所有可遍历属性, 拷贝到当前对象中</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;newDta&quot;</span>, newDta);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其实是调用了 Object.assign()方法</span></span><br><span class="line"><span class="keyword">let</span> roysue = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> r1ysue = <span class="built_in">Object</span>.assign(&#123;&#125;, roysue);</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">let</span> r2ysue = &#123;...roysue&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他快速克隆对象的方法</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> clone1 = &#123;</span><br><span class="line">    __proto__: <span class="built_in">Object</span>.getPrototypeOf(obj),</span><br><span class="line">    ...obj</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clone2 = <span class="built_in">Object</span>.assign(</span><br><span class="line">    <span class="built_in">Object</span>.create(<span class="built_in">Object</span>.getPrototypeOf(obj),</span><br><span class="line">    obj</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clone3 = <span class="built_in">Object</span>.create(</span><br><span class="line">    <span class="built_in">Object</span>.getPrototypeOf(obj),</span><br><span class="line">    <span class="built_in">Object</span>.getOwnPropertyDescriptors(obj)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><blockquote><p>  数组创建对象</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processInput</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> [a,b,c,d] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">return</span> &#123;a,b,c,d&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(processInput()); <span class="comment">// &#123;a:1, b:2, c:3, d:4&#125;;</span></span><br></pre></td></tr></table></figure><h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><p>立即执行函数可以写成箭头函数的形式:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;welcome to the DTA&quot;</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>在那些使用匿名函数当做参数的场景下, 尽量使用箭头函数作为替代, 因为使用箭头函数更加简洁, 而且箭头函数在定义函数的时候就绑定了 this; 不需要在执行的时候考虑 this 的问题;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].map(<span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>, a); <span class="comment">// [1,4,9]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.s1 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.s2 = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function">()=&gt;</span>&#123;<span class="built_in">this</span>.s1++;&#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.s2++;</span><br><span class="line">     &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> test = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(test.s1);</span><br><span class="line">&#125;, <span class="number">3000</span>); <span class="comment">// 2 5 ...</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(test.s2);</span><br><span class="line">&#125;, <span class="number">3000</span>); <span class="comment">// 0 0 ...</span></span><br></pre></td></tr></table></figure><h3 id="模块的引入"><a href="#模块的引入" class="headerlink" title="模块的引入"></a>模块的引入</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// commonJs 模块引入 node 还是使用这个</span></span><br><span class="line"><span class="keyword">let</span> &#123;stat, exists, readfile&#125; = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">let</span> _fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> stat = _fs.stat;</span><br><span class="line"><span class="keyword">let</span> exists = _fs.exists;</span><br><span class="line"><span class="keyword">let</span> readfile = _fs.readfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">// es6 模块</span></span><br><span class="line"><span class="keyword">import</span> &#123;stat, exists, readfile&#125; <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br></pre></td></tr></table></figure><p>在 js 中引入其他文件中的函数或者对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当前目录下新建 testImport.js 文件</span></span><br><span class="line"><span class="keyword">var</span> dta = &#123;</span><br><span class="line">    name: <span class="string">&quot;dta&quot;</span>,</span><br><span class="line">    version : <span class="string">&#x27;1.0.0&#x27;</span>,</span><br><span class="line">    boss: <span class="string">&quot;roysue&quot;</span>,</span><br><span class="line">    dowork: <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span> is working`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = dta; <span class="comment">// 将当前对象导出</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在其他文件中引入</span></span><br><span class="line"><span class="keyword">let</span> dta = <span class="built_in">require</span>(<span class="string">&quot;./testImport&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(dta);</span><br><span class="line">dta.dowork();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在当前目录下新建 testImport.js 文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x+y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.add = add;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在其他文件中引入</span></span><br><span class="line"><span class="keyword">let</span> &#123;add&#125; = <span class="built_in">require</span>(<span class="string">&quot;./testImport&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> result = add(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;result&quot;</span>,result);</span><br></pre></td></tr></table></figure><h3 id="链式判断运算符"><a href="#链式判断运算符" class="headerlink" title="链式判断运算符"></a>链式判断运算符</h3><p>如果读取对象内部的某个属性, 往往需要判断一下该对象是否存在这属性; 比如 <code>message.body.user.firstName</code>, 安全的写法为:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> firstName = (message &amp;&amp; message.body &amp;&amp; message.body.user &amp;&amp; message.body.user.firstName) || <span class="string">&#x27;default&#x27;</span>;</span><br></pre></td></tr></table></figure><p>这样写相对比较麻烦, 在 es6 中可以使用链式判断运算符进行判断;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Dta = &#123;</span><br><span class="line">    name: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">    age: <span class="number">29</span>,</span><br><span class="line">    <span class="function"><span class="title">dowork</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;work&quot;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    room: &#123;</span><br><span class="line">        r1: &#123;</span><br><span class="line">            l: <span class="string">&quot;l1&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Dta.room.r1.l); <span class="comment">// l1</span></span><br><span class="line"><span class="built_in">console</span>.log(Dta?.room?.r1?.l?.f || <span class="string">&quot;default&quot;</span>); <span class="comment">// default</span></span><br></pre></td></tr></table></figure><h3 id="null-判断运算符"><a href="#null-判断运算符" class="headerlink" title="null 判断运算符"></a>null 判断运算符</h3><p>在读取对象属性的时候, 如果该属性是 null 或者 undefined, 可以通过 || 设置默认值<code>const roysue = Dta.Boss.roysue || &#39;roysue&#39;</code> 但是这样写的话在, 当<code>Dta.Boss.roysue</code>的值为空字符串或者 false 或者 0 的时候也会触发默认值;</p><p>为了避免这个错误, es6 中新增了 null 判断运算符 ??; 只有当运算符的左侧值为 null 或者 undefined 时, 才会返回右侧的默认值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> roysue = Dta.Boss.roysue ?? <span class="string">&#x27;roysue&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="对象的新增方法"><a href="#对象的新增方法" class="headerlink" title="对象的新增方法"></a>对象的新增方法</h3><ul><li>  Object.is(a,b) 用来比较两个值是否是严格相等; 与严格比较符 === 基本一致;</li><li>Object.assign(target, source1, source2): 用于对象的合并, 将原对象 source 的所有可枚举属性, 全部复制到 target 对象中;<ul><li>注意点:<ul><li>  浅拷贝: 如果原对象某个属性是对象, 那么目标对象拷贝得到的属性时这个对象属性的引用;</li><li>  同名属性替换: 一旦遇到同名的属性, Object.assign()处理的方法是替换, 而不是添加</li></ul></li><li>常见用途:<ul><li>  为对象添加属性</li><li>  为对象添加方法</li><li>  克隆对象: 只能克隆对象自身的值, 不能克隆它继承的值</li><li>  合并多个对象</li></ul></li></ul></li><li>  Object.getOwnPropertyDescriptors(): 返回指定对象的所有自身属性的描述对象(非继承来的属性)</li><li>  <code>__proto__</code>: 该属性可以用来读取和设置当前对象的原型对象(prototype);</li></ul><h3 id="类的表示"><a href="#类的表示" class="headerlink" title="类的表示"></a>类的表示</h3><p>在 es5 中, 类的表示通常是:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dta</span>(<span class="params">boss, employee</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.boss = boss;</span><br><span class="line">    <span class="built_in">this</span>.employee = employee;</span><br><span class="line">&#125;</span><br><span class="line">Dta.prototype.toString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;(&#x27;</span> + <span class="built_in">this</span>.boss + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">this</span>.employee + <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dta = <span class="keyword">new</span> Dta(<span class="string">&#x27;kevin&#x27;</span>, <span class="string">&#x27;rub&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(dta.toString());</span><br></pre></td></tr></table></figure><p>在 es6 中, 为了让类的概念更接近 java 和 c++的类, 新增了 class 关键字;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dta</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">boss, employee</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.boss = boss;</span><br><span class="line">        <span class="built_in">this</span>.employee = employee;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;(&#x27;</span> + <span class="built_in">this</span>.boss + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">this</span>.employee + <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dta = <span class="keyword">new</span> Dta(<span class="string">&quot;kevin&quot;</span>, <span class="string">&quot;rub&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(dta.toString());</span><br></pre></td></tr></table></figure><h2 id="Proxy-和-Reflect"><a href="#Proxy-和-Reflect" class="headerlink" title="Proxy 和 Reflect"></a>Proxy 和 Reflect</h2><ul><li>Proxy 可以理解成, 在目标对象之前架设一层拦截, 外界对该对象的访问, 都必须先通过这一层拦截; 因此提供了一种机制, 可以对外界的访问进行过滤和改写; Proxy 这个词的原意是代理, 在这里可以理解成 Proxy 为一个代理器;<ul><li>Proxy 支持的 13 中拦截操作<ul><li>  get(target, propertyKey, receiver): 拦截对象属性的读取, 比如: proxy.foo 或者 proxy[‘foo’];</li><li>  set(target, propertyKey, propertyValue, receiver): 拦截对象属性的设置, 比如 proxy.foo=1或者proxy[‘foo’]=1; 返回布尔值</li><li>  has(target, propertyKey): 拦截 propertyKey in proxy 的操作, 返回布尔值;</li><li>  deleteProperty(target, propertyKey): 拦截 delete proxy[propertyKey]的操作, 返回布尔值;</li><li>  ownKeys(target): 拦截 Object.getOwnPropertyNames(), Obejct.getOwnPropertySymbols(),Obejct.keys(),for..in 循环; 返回数组, 该方法返回目标对象所有自身的属性的属性名; 而 Object.keys()仅返回目标对象自身可遍历的属性名;</li><li>  getOwnPropertyDescriptor(target, propertyKey): 拦截 Object.getOwnPropertyDescriptor(); 返回属性的描述对象</li><li>  defineProperty(target, propertyKey, propertyDesc): 拦截 Object.defineProperty()和 Object.defineProperties(), 返回布尔值;</li><li>  preventExtensions(target): 拦截 Object.preventExtensions()返回布尔值</li><li>  getPrototypeOf(target): 拦截 Object.getPrototypeOf(), 返回一个对象;</li><li>  isExtensible(target): 拦截 Object.isExtensible(), 返回布尔值;</li><li>  setPrototypeOf(target, proto): 拦截 Object.setPrototypeOf(), 返回布尔值;</li><li>  apply(target, object, args): 拦截 proxy 实例作为函数调用的操作; 比如 proxy(..args), proxy.call(obj, args), proxy.apply(…) ;</li><li>  construct: 拦截 proxy 实例作为构造函数调用的操作, 比如 new proxy(…args);</li></ul></li></ul></li><li>Reflect 对象和 Proxy 对象一样, 是 es6 为了操作对象而提供的新 API; 大部分与 Object 对象的同名方法的作用都是相同的; 而且 Reflect 与 Proxy 对象的方法是一一对应的;<ul><li>Reflect 设计的目的:<ol><li> 将 Object 对象的一些明显属于语言内部的方法(Object.defineProperty)放在 Reflect 对象上; 现阶段某些方法同时在 Object 和 Reflect 对象上部署, 未来新的方法只能部署在 Reflect 对象上; 也就是说 Reflect 可以拿到语言内部的方法</li><li> 修改某些 Object 方法的返回结果, 让其变得更合理</li><li> 让 Object 操作都变成函数行为</li><li> Reflect 对象的方法和 Proxy 对象的方法一一对应;</li></ol></li><li>Reflect 静态方法<ul><li>  Reflect.get(target, propertyName, receiver): 查找并返回 target 对象的 name 属性, receiver 绑定 this;</li><li>  Reflect.set(target, propertyName, propertyValue, receiver): 设置 target 对象的 propertyName 属性等于 propertyValue</li><li>  Reflect.has(obj, propertyName): 判断 propertyName 是否存在在对象中, 相当于 in</li><li>  Reflect.deleteProperty(obj, propertyName): 方法等同于 delete obj[propertyName]; 用于删除对象的属性</li><li>  Reflect.construct(target, args): 等同于 new target(args); 调用构造函数的方法</li><li>  Reflect.getPrototypeOf(obj): 读取对象的<code>__proto__</code>属性; 对应 Object.getPrototypeOf()</li><li>  Reflect.setPrototypeOf(obj, newProto): 设置目标对象的原型, 对应 Object.setPrototypeOf();</li><li>  Reflect.apply(func, thisArg, args): 等同于 Function.prototype.apply.call(func, thisArg, args)</li><li>  Reflect.defineProperty(target, propertyKey, attributes): 等同于 Obejct.defineProperty();</li><li>  Reflect.getOwnPropertyDescriptor(target, propertyKey): 等同于 Object.getOwnPropertyDescriptor();</li><li>  Reflect.isExtensible(target): 对应 Object.isExtensible()表示当前对象是否可扩展;</li><li>  Reflect.preventExtensions(target): 对用 Object.preventExtensions()让一个对象变为不可扩展</li><li>  Reflect.ownKeys(target): 返回对象的所有属性, 可以返回 Symbol 对象;</li></ul></li></ul></li></ul><blockquote><p>  代理器案例</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Proxy 和 Reflect</span></span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">target, p, receiver</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`get <span class="subst">$&#123;p&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, p, receiver);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">target, p, value, receiver</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`set key: <span class="subst">$&#123;p&#125;</span>, value: <span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target, p, value, receiver);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">obj.name = <span class="string">&quot;kevin&quot;</span>;</span><br><span class="line">obj.name;</span><br></pre></td></tr></table></figure><blockquote><p>  Proxy 作为其他对象的原型</p></blockquote><p>Proxy 实例也可以作为其他对象的原型对象, 可以用来拦截原型链的访问:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params">target, propertyKey, receiver</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">35</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = <span class="built_in">Object</span>.create(proxy);</span><br><span class="line"><span class="built_in">console</span>.log(obj.time); <span class="comment">// 35</span></span><br></pre></td></tr></table></figure><blockquote><p>  Proxy 拦截函数调用</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Proxy 拦截函数调用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test = <span class="keyword">new</span> <span class="built_in">Proxy</span>(test, &#123;</span><br><span class="line">    <span class="function"><span class="title">apply</span>(<span class="params">target, thisArg, argArray</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;thisArg&quot;</span>, thisArg);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;target&quot;</span>, target);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;argArray&quot;</span>, argArray);</span><br><span class="line">        <span class="keyword">let</span> result = <span class="built_in">Reflect</span>.apply(target, thisArg, argArray);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;result&quot;</span>, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">thisArg undefined</span></span><br><span class="line"><span class="comment">target [Function: test]</span></span><br><span class="line"><span class="comment">argArray [ 1, 2 ]</span></span><br><span class="line"><span class="comment">result 3</span></span><br><span class="line"><span class="comment">* */</span></span><br></pre></td></tr></table></figure><blockquote><p>  Proxy 监控构造函数的调用</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Proxy 监控构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.a = a;</span><br><span class="line">    <span class="built_in">this</span>.b = b;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Test = <span class="keyword">new</span> <span class="built_in">Proxy</span>(Test, &#123;</span><br><span class="line">    <span class="function"><span class="title">construct</span>(<span class="params">target, argArray, newTarget</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;target&quot;</span>, target);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;argArray&quot;</span>, argArray);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;newTarget&quot;</span>, newTarget);</span><br><span class="line">        <span class="keyword">var</span> result =  <span class="built_in">Reflect</span>.construct(target, argArray, newTarget);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;result&quot;</span>, <span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> test = <span class="keyword">new</span> Test(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;test&quot;</span>, test);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">target [Function: Test]</span></span><br><span class="line"><span class="comment">argArray [ 1, 2 ]</span></span><br><span class="line"><span class="comment">newTarget [Function: Test]</span></span><br><span class="line"><span class="comment">result &#123;&quot;a&quot;:1,&quot;b&quot;:2&#125;</span></span><br><span class="line"><span class="comment">test Test &#123; a: 1, b: 2 &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="window-和-navigator-Proxy-实战"><a href="#window-和-navigator-Proxy-实战" class="headerlink" title="window 和 navigator Proxy 实战"></a>window 和 navigator Proxy 实战</h2><p>采用 Proxy 帮助补充环境</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mywindow = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> mynavigator = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rawstringify = <span class="built_in">JSON</span>.stringify;</span><br><span class="line"><span class="built_in">JSON</span>.stringify = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">Object</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>((<span class="built_in">Object</span>?.value ?? <span class="built_in">Object</span>) === <span class="built_in">global</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;global&quot;</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rawstringify(<span class="built_in">Object</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkproxy</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//Object.keys(window)</span></span><br><span class="line">    <span class="built_in">window</span>.a = &#123;</span><br><span class="line">        <span class="string">&quot;b&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;c&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;d&quot;</span>:<span class="number">123</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">window</span>.a.b.c.d = <span class="number">456</span></span><br><span class="line">    <span class="built_in">window</span>.a.b</span><br><span class="line">    <span class="built_in">window</span>.btoa(<span class="string">&quot;123&quot;</span>)</span><br><span class="line">    <span class="built_in">window</span>.atob.name</span><br><span class="line">    <span class="string">&quot;c&quot;</span> <span class="keyword">in</span> <span class="built_in">window</span>.a</span><br><span class="line">    <span class="keyword">delete</span> <span class="built_in">window</span>.a.b</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(<span class="built_in">window</span>, <span class="string">&quot;b&quot;</span>,&#123;</span><br><span class="line">        value:<span class="string">&quot;bbb&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">Object</span>.getOwnPropertyDescriptor(<span class="built_in">window</span>,<span class="string">&quot;b&quot;</span>)</span><br><span class="line">    <span class="built_in">Object</span>.getPrototypeOf(<span class="built_in">window</span>)</span><br><span class="line">    <span class="built_in">Object</span>.setPrototypeOf(<span class="built_in">window</span>,&#123;<span class="string">&quot;dta&quot;</span>:<span class="string">&quot;dta&quot;</span>&#125;)</span><br><span class="line">    <span class="comment">// for (let windowKey in window) &#123;</span></span><br><span class="line">    <span class="comment">//     windowKey</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="built_in">Object</span>.preventExtensions(<span class="built_in">window</span>)</span><br><span class="line">    <span class="built_in">Object</span>.isExtensible(<span class="built_in">window</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMethodHandler</span>(<span class="params">WatchName</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> methodhandler = &#123;</span><br><span class="line">      <span class="function"><span class="title">apply</span>(<span class="params">target, thisArg, argArray</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> result = <span class="built_in">Reflect</span>.apply(target, thisArg, argArray)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] apply function name is [<span class="subst">$&#123;target.name&#125;</span>], argArray is [<span class="subst">$&#123;argArray&#125;</span>], result is [<span class="subst">$&#123;result&#125;</span>].`</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">construct</span>(<span class="params">target, argArray, newTarget</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="built_in">Reflect</span>.construct(target, argArray, newTarget)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] construct function name is [<span class="subst">$&#123;target.name&#125;</span>], argArray is [<span class="subst">$&#123;argArray&#125;</span>], result is [<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(result)&#125;</span>].`</span>)</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> methodhandler</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getObjhandler</span>(<span class="params">WatchName</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> handler = &#123;</span><br><span class="line">        <span class="function"><span class="title">get</span>(<span class="params">target, propKey, receiver</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> result = <span class="built_in">Reflect</span>.get(target, propKey, receiver)</span><br><span class="line">            <span class="keyword">if</span> (result <span class="keyword">instanceof</span> <span class="built_in">Object</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> result === <span class="string">&quot;function&quot;</span>)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] getting propKey is [<span class="subst">$&#123;propKey&#125;</span>] , it is function`</span>)</span><br><span class="line">                    <span class="comment">//return new Proxy(result,getMethodHandler(WatchName))</span></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] getting propKey is [<span class="subst">$&#123;propKey&#125;</span>], result is [<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(result)&#125;</span>]`</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(result,getObjhandler(<span class="string">`<span class="subst">$&#123;WatchName&#125;</span>.<span class="subst">$&#123;propKey&#125;</span>`</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] getting propKey is [<span class="subst">$&#123;propKey&#125;</span>], result is [<span class="subst">$&#123;result&#125;</span>]`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">set</span>(<span class="params">target, propKey, value, receiver</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(value <span class="keyword">instanceof</span> <span class="built_in">Object</span>)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] setting propKey is [<span class="subst">$&#123;propKey&#125;</span>], value is [<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(value)&#125;</span>]`</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] setting propKey is [<span class="subst">$&#123;propKey&#125;</span>], value is [<span class="subst">$&#123;value&#125;</span>]`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target, propKey, value, receiver);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">has</span>(<span class="params">target, propKey</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">Reflect</span>.has(target, propKey);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] has propKey [<span class="subst">$&#123;propKey&#125;</span>], result is [<span class="subst">$&#123;result&#125;</span>]`</span>)</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">deleteProperty</span>(<span class="params">target, propKey</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">Reflect</span>.deleteProperty(target, propKey);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] delete propKey [<span class="subst">$&#123;propKey&#125;</span>], result is [<span class="subst">$&#123;result&#125;</span>]`</span>)</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">getOwnPropertyDescriptor</span>(<span class="params">target, propKey</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">Reflect</span>.getOwnPropertyDescriptor(target, propKey);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] getOwnPropertyDescriptor  propKey [<span class="subst">$&#123;propKey&#125;</span>] result is [<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(result)&#125;</span>]`</span>)</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">defineProperty</span>(<span class="params">target, propKey, attributes</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">Reflect</span>.defineProperty(target, propKey, attributes);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] defineProperty propKey [<span class="subst">$&#123;propKey&#125;</span>] attributes is [<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(attributes)&#125;</span>], result is [<span class="subst">$&#123;result&#125;</span>]`</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">getPrototypeOf</span>(<span class="params">target</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">Reflect</span>.getPrototypeOf(target)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] getPrototypeOf result is [<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(result)&#125;</span>]`</span>)</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">setPrototypeOf</span>(<span class="params">target, proto</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] setPrototypeOf proto is [<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(proto)&#125;</span>]`</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Reflect</span>.setPrototypeOf(target, proto);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">preventExtensions</span>(<span class="params">target</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] preventExtensions`</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Reflect</span>.preventExtensions(target);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">isExtensible</span>(<span class="params">target</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">Reflect</span>.isExtensible(target)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] isExtensible, result is [<span class="subst">$&#123;result&#125;</span>]`</span>)</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">ownKeys</span>(<span class="params">target</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">Reflect</span>.ownKeys(target)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] invoke ownkeys, result is [<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(result)&#125;</span>]`</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">apply</span>(<span class="params">target, thisArg, argArray</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> result = <span class="built_in">Reflect</span>.apply(target, thisArg, argArray)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] apply function name is [<span class="subst">$&#123;target.name&#125;</span>], argArray is [<span class="subst">$&#123;argArray&#125;</span>], result is [<span class="subst">$&#123;result&#125;</span>].`</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">          &#125;,</span><br><span class="line">        <span class="function"><span class="title">construct</span>(<span class="params">target, argArray, newTarget</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">Reflect</span>.construct(target, argArray, newTarget)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`[<span class="subst">$&#123;WatchName&#125;</span>] construct function name is [<span class="subst">$&#123;target.name&#125;</span>], argArray is [<span class="subst">$&#123;argArray&#125;</span>], result is [<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(result)&#125;</span>].`</span>)</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> handler;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">window</span> = <span class="keyword">new</span> <span class="built_in">Proxy</span>(<span class="built_in">Object</span>.assign(<span class="built_in">global</span>,mywindow), getObjhandler(<span class="string">&quot;window&quot;</span>));</span><br><span class="line"><span class="keyword">const</span> navigator = <span class="keyword">new</span> <span class="built_in">Proxy</span>(<span class="built_in">Object</span>.create(mynavigator), getObjhandler(<span class="string">&quot;navigator&quot;</span>));</span><br><span class="line"></span><br><span class="line">checkproxy()</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">window</span>,</span><br><span class="line">    navigator</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="异步操作与-Ajax"><a href="#异步操作与-Ajax" class="headerlink" title="异步操作与 Ajax"></a>异步操作与 Ajax</h2><h3 id="单线程模型"><a href="#单线程模型" class="headerlink" title="单线程模型"></a>单线程模型</h3><ul><li>  单线程模型指的是: js 只在一个线程上运行, 也就是说, js 同时只能执行一个任务, 其他任务都必须在后面排队等待</li><li>  js 只在一个线程上运行, 不代表 js 引擎只有一个线程, 实际上 js 引擎有多个线程, 单个脚本只能在一个线程上运行(主线程); 其他线程都在后台配合主线程;</li></ul><h3 id="同步任务和异步任务"><a href="#同步任务和异步任务" class="headerlink" title="同步任务和异步任务"></a>同步任务和异步任务</h3><ul><li>  同步任务是那些没有被引擎挂起, 在主线程上排队执行的任务; 只有前一个任务执行完毕, 才能执行后一个任务;</li><li>  异步任务是那些被引擎放在一边, 不进入主线程, 而是会进入任务队列的任务; 只有引擎认为某些异步任务可以执行了(比如 Ajax 操作从服务器得到了响应), 该任务(采用回调函数的形式) 才会进入到主线程进行执行; 排在异步任务后面的代码不用等待异步任务结束就可以马上开始运行, 所以说异步任务不会阻塞其他任务代码;</li></ul><p>Ajax 操作可以被当做同步任务处理, 也可以当做异步任务处理, 由参数 async 控制; 如果是同步任务, 主线程就会一直等待 Ajax 操作返回结果, 才会继续执行后面的代码; 如果是异步任务, 那么主线程发出 Ajax 请求后会直接向下执行其他代码, 等到 Ajax 操作有了结果, 引擎会其对应的回调函数放入主线程进行处理;</p><h3 id="任务队列和事件循环"><a href="#任务队列和事件循环" class="headerlink" title="任务队列和事件循环"></a>任务队列和事件循环</h3><ul><li>  js 运行时, 除了正在运行的主线程, 引擎还提供了一个任务队列(task queue); 任务队列中是各种需要当前程序处理的异步任务;</li><li>  首先, 主线程会执行所有的同步任务, 等到同步任务全部执行完成, 主线程才会去任务队列中寻找异步任务; </li><li>  如果异步任务满足执行条件, 则异步任务重新进入到主线程中执行, 此时异步任务就变成了同步任务; 当这个异步任务执行完成, 下一个异步任务再进入主线程进行执行, 一旦任务队列被清空, 程序就结束运行;</li><li>  事件循环指的是只要同步任务执行完成, 引擎就会不断去检查那些挂起的异步任务是不是满足进入主线程的条件; 这种循环机制就叫做事件循环, 是一种程序结构, 用于等待和发送消息和事件;</li></ul><h3 id="异步操作模式"><a href="#异步操作模式" class="headerlink" title="异步操作模式"></a>异步操作模式</h3><ol><li>回调函数<ul><li>  回调函数是异步操作最简单的方法</li><li>  回调函数的优点是简单, 容易理解和实现; 缺点是不利于代码的阅读和维护; 多个部分之间高度耦合; 在多个回调函数相互嵌套的情况下, 会导致程序结构混乱, 难以阅读和追踪;</li></ul></li><li>事件监听<ul><li>  采用事件驱动模式, 异步任务的执行不取决于代码的顺序, 而是取决于某个事件是否发生;</li><li>  优点是比较容易理解, 可以绑定多个事件, 每个事件可以指定多个回调函数; 可以解耦, 实现模块化; 缺点是整个程序都要变成事件驱动型, 运行流程不清晰, 阅读难以看出主流程;</li></ul></li><li>发布/订阅<ul><li>  这种方式的性质和事件监听类似; 但是可以通过查看消息, 了解存在多少信号, 每个信号有多少个订阅者, 从而监控程序的运行;</li></ul></li></ol><h3 id="定时器"><a href="#定时器" class="headerlink" title="定时器"></a>定时器</h3><p>定时器是 js 中提供定时执行代码的功能; 主要由<code>setTimeout()</code>和<code>setInterval()</code>这两个函数来完成; 它们可以向任务队列中添加定时任务;</p><blockquote><p>  运行机制</p></blockquote><ul><li>  setTimeout 和 setInterval 的运行机制, 是将指定的代码移出本轮事件循环, 等到下一轮事件循环, 再检测是否满足指定时间, 如果满足就执行对应的代码, 如果不满足则继续等待;</li><li>  setTimeout 和 setInterval 指定的回调函数, 必须等到本轮事件循环的所有同步任务都执行完, 才会开始执行; 由于前面的任务到底需要多少时间执行是不确定的, 所以没有办法保证 setTimeout 和 setInterval 指定的任务一定会按照预定时间执行;</li><li>  setTimeout(f,0); 也不会立即执行, f 方法会被移出本轮事件循环;</li></ul><blockquote><p>  setTimeout</p></blockquote><ul><li>  <code>function setTimeout(callback, ms, ...args)</code></li><li>  setTimeout 函数用于指定某个函数或者某段代码在多少毫秒之后执行; 它返回一个整数, 该整数表示定时器的编号, 之后可以通过这个编号取消该定时器;</li><li>需要注意: node 中如果回调函数是对象的方法, 那么 setTimeout 会使方法内部的 this 关键字指向全局环境, 而不是定义这个方法时的那个对象;<ul><li>  为了防止该问题, 可以将对象的方法放在一个函数内</li><li>  使用 bind 方法, 将对象的方法 bind 到对象上</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setTimeout()</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="string">&quot;from window&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    x: <span class="string">&quot;from obj&quot;</span>,</span><br><span class="line">    y: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(obj.y, <span class="number">1000</span>); <span class="comment">// node 环境下输出 undefined, 浏览器下输出 from window</span></span><br><span class="line"><span class="comment">// 将该方法放在一个函数中, 防止 this 指向全局环境</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    obj.y(); <span class="comment">// node 和浏览器下都输出 from obj;</span></span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(obj.y.bind(obj), <span class="number">1000</span>); <span class="comment">// node 和 浏览器下都输入 from obj</span></span><br></pre></td></tr></table></figure><p>setTimeout 也可以实现指定间隔时间执行, 相当于下面的 setInterval 方法; 区别在于 setTimeout 会考虑自身的运行时间,可以保证严格的间隔时间;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">    i++;</span><br><span class="line">    <span class="built_in">setTimeout</span>(f, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(f, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><blockquote><p>  setInterval</p></blockquote><ul><li>  setInterval 函数的用法和 setTimeout 完全一致, 区别仅仅是在以 setInterval 指定某个任务每隔一段时间就执行一次, 也就是无限次的定时执行;</li><li>  setInterval 指定的是开始执行的间隔时间, 并不考虑每次任务执行本身所消耗的时间, 所以两次执行之间的间隔会小于指定的时间;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="string">&quot;from global&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    a : <span class="number">1</span>,</span><br><span class="line">    i: <span class="string">&quot;from obj&quot;</span>,</span><br><span class="line">    f: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;this.i&quot;</span>, <span class="built_in">this</span>.i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(obj.f, <span class="number">1000</span>); <span class="comment">// node 下输出为 undefined, 浏览器下输出为 from global</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    obj.f();</span><br><span class="line">&#125;, <span class="number">1000</span>) <span class="comment">// from obj</span></span><br><span class="line"><span class="built_in">setInterval</span>(obj.f.bind(obj), <span class="number">1000</span>); <span class="comment">// from obj</span></span><br></pre></td></tr></table></figure><blockquote><p>  清除定时器</p></blockquote><ul><li>  可以使用 clearTimeout()和 clearInterval()方法来清除定时器</li><li>  setTimeout()和 setInterval()都返回一个整数值, 该整数值表示定时器编号; 将这个编号传入 clearTimeout()和 clearInterval()就可以取消对应的定时器;</li><li>  需要注意, setTimeout 和 setInterval 返回的定时器编号的数值都是连续的且单调递增的, 可以利用这一点取消所有的定时器 (过一部分检测)</li><li>  在 node 环境下, setTimeout 和 setInterval 返回的不是定时器编号, 而是一个定时器对象;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清除所有定时器</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> gid = <span class="built_in">setInterval</span>(clearAllTimeouts,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(gid);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">clearAllTimeouts</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> id = <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">while</span> (id &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (id !== gid)&#123;</span><br><span class="line">                <span class="built_in">clearTimeout</span>(id);</span><br><span class="line">            &#125;</span><br><span class="line">            id--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><h3 id="Promise-对象"><a href="#Promise-对象" class="headerlink" title="Promise 对象"></a>Promise 对象</h3><ul><li>  Promise 对象是 js 的异步操作解决方案, 为异步操作提供了统一的接口; 它起到了代理作用, 充当异步操作与回调函数之间的中介; 让异步操作具备同步操作的接口; Promise 可以让异步操作写起来就像在写同步操作的流程, 而不必一层层嵌套回调函数;</li><li>  Promise 是一个对象, 也是一个构造函数;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> objPromise = <span class="function"><span class="keyword">function</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">        obj.name = input;</span><br><span class="line">        <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>, obj.name);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;继续执行&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve2</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;name2&quot;</span>, name);</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">objPromise(<span class="string">&quot;kevin&quot;</span>).then(resolve).then(resolve2).catch(<span class="function">(<span class="params">error</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;error&quot;</span>, error);&#125;);</span><br></pre></td></tr></table></figure><p>使用 Promise 的时候, 业务逻辑代码都在 newPromise 和 then 的回调方法中; </p><h3 id="Ajax-请求"><a href="#Ajax-请求" class="headerlink" title="Ajax 请求"></a>Ajax 请求</h3><ul><li>  Ajax 是一种在无需重新加载整个页面的情况下, 能够更新部分网页的技术;</li><li>  Ajax = 异步 js 和 xml</li><li>  传统的页面如果需要更新内容, 必须要重新加载整个页面; Ajax 可以使网页实现异步更新, 在不加载整个页面的情况下,对页面的部分进行更新;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 XMLHttpRequest 对象</span></span><br><span class="line"><span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="comment">// 和服务器建立连接</span></span><br><span class="line">xmlhttp.open(<span class="string">&quot;method&quot;</span>, <span class="string">&quot;url&quot;</span>, <span class="keyword">async</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">method: 请求的类型, GET POST</span></span><br><span class="line"><span class="comment">url: url 地址</span></span><br><span class="line"><span class="comment">async: true(异步), false(同步);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 发送请求</span></span><br><span class="line">xmlhttp.send(string); <span class="comment">// string 仅用于 post 请求</span></span><br></pre></td></tr></table></figure><p>在异步 async 为 true 时, 需要设置 XMLHttpRequest 对象的onreadystatechange 一个回调函数; 或者设置 XMLHttpReuqest 对象的 onload 一个回调函数;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.readyState === <span class="number">4</span>) &amp;&amp; (xmlhttp.status === <span class="number">200</span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(xmlhttp.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or </span></span><br><span class="line"></span><br><span class="line">xmlhttp.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.readyState === <span class="number">4</span>) &amp;&amp; (xmlhttp.status === <span class="number">200</span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(xmlhttp.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>  简单示例</p></blockquote><p>python 服务端代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line">__author__ = <span class="string">&quot;Kevin&quot;</span></span><br><span class="line">__time__ = <span class="string">&quot;2021/8/26&quot;</span></span><br><span class="line">__blog__ = <span class="string">&quot;https://kevinspider.github.io/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.middleware.cors <span class="keyword">import</span> CORSMiddleware</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">origins = [<span class="string">&quot;*&quot;</span>]</span><br><span class="line"></span><br><span class="line">app.add_middleware(</span><br><span class="line">    CORSMiddleware,</span><br><span class="line">    allow_origins=origins,</span><br><span class="line">    allow_credentials=<span class="literal">True</span>,</span><br><span class="line">    allow_methods=[<span class="string">&quot;*&quot;</span>],</span><br><span class="line">    allow_headers=[<span class="string">&quot;*&quot;</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">root</span>():</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>html 请求页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:v-on</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../snip/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;request&quot;</span> <span class="attr">v-on:click</span>=<span class="string">&quot;promiseOnloadRequest&quot;</span>&gt;</span>发送请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> vue = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&quot;#root&quot;</span>,</span></span><br><span class="line">        methods: &#123;</span><br><span class="line"><span class="javascript">            request: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// 发送请求</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">                <span class="comment">// 设置回调函数</span></span></span><br><span class="line"><span class="javascript">                xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line">                    if (xmlhttp.readyState == 4 &amp;&amp; xmlhttp.status == 200) &#123;</span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">&quot;success: &quot;</span>, xmlhttp.status);</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">&quot;xmlhttp.responseText: &quot;</span>, xmlhttp.responseText);</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="javascript">                xmlhttp.open(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://127.0.0.1:8000&quot;</span>, <span class="literal">true</span>);</span></span><br><span class="line">                xmlhttp.send()</span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            promiseRequest: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">                    xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line">                        if ((xmlhttp.readyState === 4) &amp;&amp; (xmlhttp.status == 200)) &#123;</span><br><span class="line">                            resolve(xmlhttp.responseText);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"><span class="javascript">                    xmlhttp.open(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://127.0.0.1:8000&quot;</span>, <span class="literal">true</span>);</span></span><br><span class="line">                    xmlhttp.send()</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">res</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="string">&quot;use promiseRequest&quot;</span>);</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="string">&quot;res&quot;</span>, res);</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">                promise.then(f).catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(error);</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            promiseOnloadRequest: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> xml = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">                    xml.open(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://127.0.0.1:8000&quot;</span>, <span class="literal">true</span>);</span></span><br><span class="line">                    xml.onload = resolve;</span><br><span class="line">                    xml.send()</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> <span class="title">parseResponse</span>(<span class="params">res</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="string">&quot;promiseOnloadRequest&quot;</span>, res);</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> <span class="title">parseError</span>(<span class="params">error</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="string">&quot;error&quot;</span>, error);</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                promise.then(parseResponse).catch(parseError);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Dom-和浏览器模型"><a href="#Dom-和浏览器模型" class="headerlink" title="Dom 和浏览器模型"></a>Dom 和浏览器模型</h2><h3 id="Dom-简介"><a href="#Dom-简介" class="headerlink" title="Dom 简介"></a>Dom 简介</h3><ul><li>  Dom 是 js 操作网页的接口, 全称是文档对象模型; 它的作用是将网页转为一个 js 对象, 从而可以通过用脚本进行各种操作(增删改查)</li><li>  浏览器会根据 Dom 模型, 将结构化的文档(html 或 XML) 解析成一系列的节点, 再由这些节点组成一个树状结构; 所有的节点和最终的树状结构都有规范的对外接口;</li><li>  Dom 是一个接口规范, 可以用任何语言实现; 严格来说 Dom 不是 js 语法的一部分, 但是 Dom 操作是 js 最常见的操作, 离开了 Dom, js 就无法控制网页; 另一方面, js 也是最常用于操作 Dom 的语言;</li></ul><h3 id="节点"><a href="#节点" class="headerlink" title="节点"></a>节点</h3><ul><li>  Dom 的最小组成单位是节点(node); 文档的树形结构就是由各种不同类型的节点组成;</li><li>节点一共有七种:<ol><li> Document: 整个文档树的顶层节点</li><li> DocumentType: doctype 标签 <code>&lt;! DOCTYPE html&gt;</code></li><li> Element: 网页的各种 HTML 标签, 比如 <code>&lt;body&gt; &lt;a&gt;</code>等</li><li> Attr: 网页元素的属性 比如<code>class=&quot;right&quot;</code></li><li> Text: 标签之间或标签包含的文本</li><li> Comment: 注释</li><li> DocumentFragment: 文档的片段</li><li> 浏览器提供一个原生的节点对象 Node, 上面这七种节点都继承了 Node, 因此具有一些相同的属性和方法</li></ol></li></ul><h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p>事件名称参照: <a href="https://developer.mozilla.org/zh-CN/docs/Web/Events">https://developer.mozilla.org/zh-CN/docs/Web/Events</a></p><ul><li>  事件的本质是程序各个组成部分之间的一种通信方式, 也是异步编程的一种实现; Dom 支持大量的事件</li><li>  Dom 的事件操作(监听和触发) 都定义在 EventTarget 接口; 所有节点对象都部署在这个接口, 其他一些需要事件通信的浏览器内置对象(比如 XMLHttpRequest, AudioNode, AudioContext等)也都部署了这个接口;</li><li>EventTarget 接口主要提供了三个方法<ul><li>  addEventListener(type, listener[,useCapture]): 绑定事件的监听函数</li><li>  removeEventListener(type, listener[,useCapture]): 移除事件的监听函数</li><li>  dispatchEvent(event): 触发事件</li></ul></li></ul><blockquote><p>  事件传播</p></blockquote><ul><li>一个事件发生后, 会在子元素和父元素之间传播, 这种传播分成三个阶段:<ol><li> 第一个阶段: 从 window 对象传导到目标节点 (上层传到底层), 称为捕获阶段;</li><li> 第二个阶段: 在目标节点上触发, 称为目标阶段</li><li> 第三个阶段: 从目标节点传导回 window 对象 (从底层传回上层); 称为冒泡阶段;</li></ol></li><li>  三种阶段的传播模型, 让同一个事件会在多个节点上触发;</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>节点<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p&quot;</span>&gt;</span>点击触发<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> phases = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">&quot;1&quot;</span>: <span class="string">&quot;capture&quot;</span>, <span class="comment">// 捕获阶段</span></span></span><br><span class="line"><span class="javascript">        <span class="string">&quot;2&quot;</span>: <span class="string">&quot;target&quot;</span>, <span class="comment">// 目标阶段</span></span></span><br><span class="line"><span class="javascript">        <span class="string">&quot;3&quot;</span>: <span class="string">&quot;bubble&quot;</span> <span class="comment">// 冒泡阶段</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">&quot;div&quot;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> p = <span class="built_in">document</span>.getElementById(<span class="string">&quot;p&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> tag = event.currentTarget.tagName;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> phase = phases[event.eventPhase];</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;tag&quot;</span>, tag);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;phase&quot;</span>, phase);</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="comment">// 当 addEventListener 第三个参数设置为 true 时, 会先触发父节点的事件, phase 为 capture; 再触发 target 目标, phase 为 target;</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// div.addEventListener(&quot;click&quot;, callback, true);</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// p.addEventListener(&quot;click&quot;, callback, true);</span></span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="comment">// 当 addEventListener 第三个参数设置为 false 时, 会先触发子节点的事件, phase 为 target; 再触发冒泡, 回传到父节点, phase 为 bubble; </span></span></span><br><span class="line"><span class="javascript">    div.addEventListener(<span class="string">&quot;click&quot;</span>, callback, <span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">    p.addEventListener(<span class="string">&quot;click&quot;</span>, callback, <span class="literal">false</span>);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>  Event 对象</p></blockquote><ul><li>  事件发生后, 会产生一个事件对象, 作为参数传递给监听函数; 浏览器原生提供了一个 Event 对象, 所有的事件都是这个对象的实例, 或者说所有的事件都继承了 Event.prototype 对象;</li><li>  Event 对象本身就是一个构造函数, 可以用来生成一个新的事件实例; <code>var event = new Event(type, options);</code></li><li>Event 构造函数接受两个参数, 第一个参数 type 是字符串, 表示事件的名称; 第二个参数 options 是一个对象, 表示事件对象的配置; 该对象主要有两个属性:<ul><li>  bubbles: 布尔值, 可选, 默认是 false; 表示事件对象是否冒泡;</li><li>  cancelable: 布尔值, 可选, 默认是 false; 表示事件是否可以被取消, 即能否用<code>Event.proventDefault()</code>取消这个事件; 一旦事件被取消, 就好像没有发生过一样, 不会触发浏览器对该事件的默认行为;</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>节点<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p&quot;</span>&gt;</span>点击触发<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> phases = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">&quot;1&quot;</span>: <span class="string">&quot;capture&quot;</span>, <span class="comment">// 捕获阶段</span></span></span><br><span class="line"><span class="javascript">        <span class="string">&quot;2&quot;</span>: <span class="string">&quot;target&quot;</span>, <span class="comment">// 目标阶段</span></span></span><br><span class="line"><span class="javascript">        <span class="string">&quot;3&quot;</span>: <span class="string">&quot;bubble&quot;</span> <span class="comment">// 冒泡阶段</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">&quot;div&quot;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> p = <span class="built_in">document</span>.getElementById(<span class="string">&quot;p&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> tag = event.currentTarget.tagName;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> phase = phases[event.eventPhase];</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;tag&quot;</span>, tag);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;phase&quot;</span>, phase);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> event = <span class="keyword">new</span> Event(<span class="string">&quot;look&quot;</span>, &#123;</span></span><br><span class="line"><span class="javascript">        bubbles: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">        cancelable: <span class="literal">true</span></span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">    p.addEventListener(<span class="string">&quot;click&quot;</span>, callback, <span class="literal">false</span>);</span></span><br><span class="line">    p.dispatchEvent(event);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>  监听函数</p></blockquote><ul><li><p>  浏览器的事件模型, 就是通过监听函数(listener)对事件作出反应; 事件发生后, 浏览器监听到了这个事件, 就会执行对应的监听函数;</p></li><li><p>三种方式为事件绑定监听函数</p><ul><li><p>HTML 的 on -属性</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;btnClick()&quot;</span>&gt;</span>点击触发<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">btnClick</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;event&quot;</span>, event);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;button clicked&quot;</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>元素节点的事件属性</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;button&quot;</span>&gt;</span>点击触发<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> button = <span class="built_in">document</span>.getElementById(<span class="string">&quot;button&quot;</span>);</span></span><br><span class="line"><span class="javascript">    button.onclick = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">       <span class="built_in">console</span>.log(<span class="string">&quot;event&quot;</span>, event);</span></span><br><span class="line"><span class="javascript">       <span class="built_in">console</span>.log(<span class="string">&quot;按钮点击&quot;</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>EventTarget.addEventListener()</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;button&quot;</span>&gt;</span>点击触发<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> button = <span class="built_in">document</span>.getElementById(<span class="string">&quot;button&quot;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">btnClick</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;event&quot;</span>, event);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;addEventListener&quot;</span>, <span class="string">&quot;clicked&quot;</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    button.addEventListener(<span class="string">&quot;click&quot;</span>, btnClick);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="window"><a href="#window" class="headerlink" title="window"></a>window</h3><p>浏览器中, window 对象指的是当前的浏览器窗口; 它也是当前页面的顶层对象, 它也是当前页面的顶层对象, 即最高一层的对象, 所有其他对象都是它的下属, 一个变量如果未声明, 那么默认就是顶层对象的一个属性;</p><h4 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h4><ul><li>  document 节点对象代表整个文档, 每个网页都有自己的 document 对象; window.document 属性就指向了这个对象; 只要浏览器开始载入 HTML 文档, 该对象就存在了, 可以直接使用;</li><li>document 对象有不同的办法可以获取<ul><li>  正常的网页, 直接使用 document 或者 window.document 获取</li><li>  iframe 框架里面的网页, 使用 iframe 节点的 contentDocuemnt 属性</li><li>  Ajax 操作返回的文档, 使用 XMLHttpRequest 对象的 responseXML 属性;</li><li>  内部节点的 ownerDocument 属性</li><li>  document 对象继承了 EventTarget 接口和 Node 接口; 还 mixin 了 ParentNode 接口;</li></ul></li></ul><blockquote><p>  Document 常用方法</p></blockquote><ul><li>  document.open(): 清除当前文档的所有内容, 让文档处于可写状态, 供 document.write()方法写入内容</li><li>  document.write(): 写入内容</li><li>  document.close(): 关闭文档</li><li>  document.querySelector(): 接受一个 css 选择器作为参数, 返回匹配到该选择器的元素节点; 如果有多个节点满足匹配条件, 则返回第一个匹配的节点; 如果没有发现匹配的节点, 返回 null;</li><li>  document.querySelectorAll(): 接受一个 css 选择器作为参数, 返回匹配到该选择器的所有元素节点数组; 如果没有发现匹配的节点, 返回 null;</li><li>  document.getElementsByClassName(): 返回一个类似数组的对象, 包括了所有 class 名字符合指定条件的元素;</li><li>  document.getElementsByName(): 返回一个类似数组的对象, 包含了所有 name 属性满足条件的元素;</li><li>  document.getElementById(): 返回匹配指定 id 的元素</li></ul><h4 id="navigator"><a href="#navigator" class="headerlink" title="navigator"></a>navigator</h4><p>navigator 对象的属性:</p><ul><li>  navigator.userAgent: 浏览器请求头</li><li>  navigator.plugins: 返回一个类数组的对象, 成员是 plugin;</li><li>  navigator.platform: 返回用户的操作系统信息</li><li>  navigator.onLine: 表示当前用户在线还是离线</li><li>  navigator.languages: 表示当前浏览器语言</li><li>  navigator.language: 表示当前浏览器的首选语言</li><li>  navigator.geolocation: 返回一个 Geolocation 地理位置对象</li><li>  navigator.cookieEnabled: 表示浏览器的 Cookie功能是否开启</li></ul><p>navigator 对象的方法</p><ul><li>  navigator.javaEnabled(): 表示浏览器是否能运行 Java Applet 小程序</li><li>  navigator.sendBeacon(): 用于向服务器异步发送数据</li><li>  navigator.deviceMemory(): 返回当前计算机的内存数量(单位为 G)</li><li>  navigator.connection(): 包含当前网络连接的相关信息;</li></ul><h4 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h4><ul><li>  screen.height: 浏览器窗口所在的屏幕的高度(单位像素)</li><li>  screen.width: 浏览器窗口所在的屏幕的宽度(单位像素)</li><li>  screen.availHeight: 浏览器窗口可用的屏幕高度(单位像素); 因为部分空间可能不可以用, 比如系统的任务栏或者 mac 系统屏幕底部的 Dock 区;这个属性等于 height 减去那些被系统占用的组件的高度;</li><li>  screen.availWidth: 浏览器窗口可用的屏幕宽度(单位像素);</li><li>  screen.pixelDepth: 整数, 表示屏幕的色彩位数, 比如 24 表示屏幕提供 24 位的色彩</li><li>  screen.colorDepth: screen.pixelDepth 的别名, 严格来说, colorDepth 表示应用程序的颜色深度, pixelDepth 表示屏幕的颜色深度, 绝大多数情况下, 它们都是相同的一件事;</li><li>  screen.orientation: 返回一个对象, 表示屏幕的方向;</li></ul><h4 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h4><ul><li>  cookie 是服务器保存在浏览器的一小段文本信息, 一般大小不能超过 4KB; 浏览器每次向服务器发出请求, 会自动附上这段信息</li><li>cookie 主要保存状态信息, 一般用于:<ol><li> 对话 session 管理; 保存登录, 购物车等需要记录的信息</li><li> 个性化信息: 保存用户偏好, 比如网页的字体大小, 背景色等;</li><li> 追踪用户: 记录和分析用户的行为和偏好</li></ol></li></ul><blockquote><p>  cookie 的生成</p></blockquote><ul><li>  服务器如果希望在浏览器保存 cookie, 就需要在 http 的 response 中设置 Set-Cookie 字段;</li><li>  document.cookie 用于读写当前页面的 cookie; 读取的时候, 会返回当前网页中所有的不含 HttpOnly 属性的 cookie 信息;</li><li>  document.cookie 属性时可写的; 可以通过对 document.cookie 设置值来添加 cookie;</li><li>  <code>document.cookie = &quot;dta=dta; expires=Mon, Aug 30 2021 15:44:17 GMT; path=/; domain=www.dtasecurity.cn&quot;</code></li><li>  删除现有的 cookie 的唯一方法, 就是设置它的 expires 属性为一个过去的时间;</li></ul><h4 id="storage"><a href="#storage" class="headerlink" title="storage"></a>storage</h4><ul><li>  window.sessionStorage 和 window.localStorage 接口都实现了 Storage 接口;</li><li>  window.sessionStorage 保存的数据用于浏览器的一次会话; 当会话结束(通常是窗口关闭), 数据被清空;</li><li>  localStorage 保存的数据长期存在, 下一次访问该网站的时候, 网页可以直接读取以前的数据</li><li>  除了保存数据的时间长短不同, 这个两个对象其他方面都基本一致</li></ul><blockquote><p>  Storage 属性</p></blockquote><ul><li>  Storage.length: 返回保存的数据个数</li></ul><blockquote><p>  Storage 方法</p></blockquote><ul><li>  Storage.setItem(): 接受两个参数, 一个是键名, 一个是要保存的数据; 写入不一定要用这个方法, 也可以直接赋值</li><li>  Storage.getItem(): 用于读取数据, 它只有一个参数, 就是键名;</li><li>  Storage.removeItem(): 用于清除某个键名对应的键值</li><li>  Storage.clear(): 用于清除所有保存的数据</li><li>  Storage.key(): 接受一个整数作为参数, 返回该位置对应的键名; 结合 Storage.length 属性和 Storage.key()方法, 可以遍历所有的键;</li></ul><h4 id="history"><a href="#history" class="headerlink" title="history"></a>history</h4><ul><li>  window.history 属性指向 History 对象, 它表示当前窗口的浏览历史;</li><li>  History.length: 当前窗口访问过的网址数量(包括当前页面)</li><li>  History.state: History 堆栈最上层的状态值, 通常是 undefined;</li><li>  History.back(): 移动到上一个网址, 等同于点击浏览器的后退键</li><li>  History.forward(): 移动到下一个网址, 等同于点击浏览器的前进键;</li><li>  History.go(): 接受一个整数作为参数, 以当前网址作为基准, 移动到参数指定的网址</li><li>  History.pushState(): 在历史记录中添加一条记录</li><li>  History.replaceState(): 修改 History 对象的当前记录;</li></ul><h4 id="location"><a href="#location" class="headerlink" title="location"></a>location</h4><p>location 对象是浏览器提供的原生对象, 提供 URL 相关的信息和操作方法; 通过 window.location 或者 document.location 都可以获得这个对象;</p><blockquote><p>  location 属性</p></blockquote><ul><li>  location.href: 整个 URL</li><li>  location.protocol: 当前 URL 的协议, 包括冒号(:)</li><li>  location.host: 主机, 如果端口不是协议默认的 80 和 443, 则还会返回冒号和端口号</li><li>  location.hostname: 主机名, 不包括端口号;</li><li>  location.port: 端口号</li><li>  location.pathname: URL 的路径部分, 从根路径/开始</li><li>  location.search: 查询字符串部分, 从?开始;</li><li>  location.hash: 片段字符串部分, 从#开始</li><li>  location.username: 域名签名的用户名</li><li>  location.password: 域名前面的密码;</li><li>  location.origin: URL 的协议, 主机名和端口</li></ul><blockquote><p>  location 方法</p></blockquote><ul><li><p>  location.assign(): 接受一个 URL 字符串参数, 让浏览器立即跳转到新的 URL;</p></li><li><p>  location.replace(): 同上, 但是会在浏览器的历史 history 里面删除当前网址;</p></li><li><p>  location.reload(): 使得浏览器重新加载当前网址, 相当于刷新</p></li><li><p>  location.toString(): 返回整个 URL 字符串, 相当于读取了 location.href 属性;</p></li><li><p>location.encodeURI(): 会将除了元字符和语义字符之外的字符都进行转义, 一般用于转义整个 url;</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">&quot;https://www.baidu.com?q=你好&quot;</span>;</span><br><span class="line"><span class="built_in">encodeURI</span>(url);</span><br><span class="line"><span class="comment">// &quot;https://www.baidu.com?q=%E4%BD%A0%E5%A5%BD&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>location.encodeURIComponent(): 会将除了语义字符之外的所有字符都转义, 一般用于转义部分 url;</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">&quot;https://www.baidu.com?q=你好&quot;</span>;</span><br><span class="line"><span class="built_in">encodeURIComponent</span>(url);</span><br><span class="line"><span class="comment">// &quot;https%3A%2F%2Fwww.baidu.com%3Fq%3D%E4%BD%A0%E5%A5%BD&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>  location.decodeURI(): encodeURI()方法的逆运算</p></li><li><p>  location.decodeURIComponent(): encodeURIComponent()方法的逆运算</p></li></ul><h2 id="滑块"><a href="#滑块" class="headerlink" title="滑块"></a>滑块</h2><h3 id="hook-定位"><a href="#hook-定位" class="headerlink" title="hook 定位"></a>hook 定位</h3><p>比较常见的通过 Canvas 绘制滑块验证码的 hook 点:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    &#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="comment">// Your code here...</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;hook CanvasRenderingContext2D&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> _drawImage = CanvasRenderingContext2D.prototype.drawImage;</span><br><span class="line">    <span class="keyword">var</span> _putImageData = CanvasRenderingContext2D.prototype.putImageData;</span><br><span class="line">    CanvasRenderingContext2D.prototype.drawImage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;CanvasRenderingContext2D.prototype.drawImage&quot;</span>, <span class="built_in">arguments</span>);</span><br><span class="line">        <span class="keyword">debugger</span>;</span><br><span class="line">        <span class="keyword">return</span> _drawImage.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    CanvasRenderingContext2D.prototype.putImageData = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;CanvasRenderingContext2D.prototype.putImageData&quot;</span>, <span class="built_in">arguments</span>);</span><br><span class="line">        <span class="keyword">debugger</span>;</span><br><span class="line">        <span class="keyword">return</span> _putImageData.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>通过 hook 追踪堆栈, 找到 js 中是如何对正序数组进行还原的;</p><h3 id="hook-获取轨迹"><a href="#hook-获取轨迹" class="headerlink" title="hook 获取轨迹"></a>hook 获取轨迹</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name        hook trail</span></span><br><span class="line"><span class="comment">// @namespace   http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version     0.1</span></span><br><span class="line"><span class="comment">// @description try to take over the world!</span></span><br><span class="line"><span class="comment">// @author      You</span></span><br><span class="line"><span class="comment">// @include     *</span></span><br><span class="line"><span class="comment">// @grant       none</span></span><br><span class="line"><span class="comment">// @run-at      document-start</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> _addEventListener = EventTarget.prototype.addEventListener;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">window</span>.zedtail = [];</span><br><span class="line">    <span class="built_in">window</span>.start_x;</span><br><span class="line">    <span class="built_in">window</span>.start_y;</span><br><span class="line">    <span class="built_in">window</span>.start_t;</span><br><span class="line"></span><br><span class="line">    EventTarget.prototype.addEventListener = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> eventname = <span class="built_in">arguments</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">let</span> eventfunc = <span class="built_in">arguments</span>[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">let</span> neweventfunc = <span class="function"><span class="keyword">function</span> (<span class="params">events</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (events.type === <span class="string">&quot;mousedown&quot;</span>) &#123;</span><br><span class="line">                <span class="built_in">window</span>.zedtail = [];</span><br><span class="line">                <span class="built_in">window</span>.start_x = events.clientX;</span><br><span class="line">                <span class="built_in">window</span>.start_y = events.clientY;</span><br><span class="line">                <span class="built_in">window</span>.start_t = +<span class="keyword">new</span> <span class="built_in">Date</span>;</span><br><span class="line">                <span class="built_in">window</span>.flag = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (events.type === <span class="string">&quot;mousemove&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">window</span>.flag) &#123;</span><br><span class="line">                    <span class="keyword">let</span> movex = <span class="built_in">parseInt</span>(events.clientX - <span class="built_in">window</span>.start_x);</span><br><span class="line">                    <span class="keyword">let</span> movey = <span class="built_in">parseInt</span>(events.clientY - <span class="built_in">window</span>.start_y);</span><br><span class="line">                    <span class="keyword">let</span> movet = (<span class="keyword">new</span> <span class="built_in">Date</span>).getTime() - <span class="built_in">window</span>.start_t;</span><br><span class="line">                    <span class="built_in">console</span>.log([movex, movey, movet]);</span><br><span class="line">                    <span class="built_in">window</span>.zedtail.push([movex, movey, movet]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (events.type === <span class="string">&quot;mouseup&quot;</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="built_in">window</span>.zedtail);</span><br><span class="line">                <span class="built_in">window</span>.flag = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            eventfunc(events);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="built_in">console</span>.log(eventname, eventfunc.toString());</span><br><span class="line">        <span class="keyword">return</span> _addEventListener.apply(<span class="built_in">this</span>, [eventname, neweventfunc]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><p> 通过正序数组将乱序图片还原成正序图片</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line">__author__ = <span class="string">&quot;Kevin&quot;</span></span><br><span class="line">__time__ = <span class="string">&quot;2021/9/1&quot;</span></span><br><span class="line">__blog__ = <span class="string">&quot;https://kevinspider.github.io/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">e.canvasCtx.drawImage(</span></span><br><span class="line"><span class="string">    e.img, </span></span><br><span class="line"><span class="string">    30 * a,             sx可选 需要绘制到目标上下文中的，image的矩形（裁剪）选择框的左上角 X 轴坐标。 </span></span><br><span class="line"><span class="string">    0,                  sy可选 需要绘制到目标上下文中的，image的矩形（裁剪）选择框的左上角 Y 轴坐标。</span></span><br><span class="line"><span class="string">    30,                 sWidth可选 需要绘制到目标上下文中的，image的矩形（裁剪）选择框的宽度。如果不说明，整个矩形（裁剪）从坐标的sx和sy开始，到image的右下角结束。</span></span><br><span class="line"><span class="string">    400,                sHeight可选  需要绘制到目标上下文中的，image的矩形（裁剪）选择框的高度。</span></span><br><span class="line"><span class="string">    30 * t[a] / 1.5,    dx image的左上角在目标canvas上 X 轴坐标。</span></span><br><span class="line"><span class="string">    0,                  dy  image的左上角在目标canvas上 Y 轴坐标。</span></span><br><span class="line"><span class="string">    20,                 image 在目标canvas上绘制的宽度。 允许对绘制的image进行缩放。 如果不说明， 在绘制时image宽度不会缩放。</span></span><br><span class="line"><span class="string">    200)                dHeight可选 image在目标canvas上绘制的高度。 允许对绘制的image进行缩放。 如果不说明， 在绘制时image高度不会缩放。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.获取滑块图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getImg</span>():</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Pragma&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Cache-Control&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Origin&#x27;</span>: <span class="string">&#x27;http://www.dtasecurity.cn:30080&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://www.dtasecurity.cn:30080/&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh,zh-CN;q=0.9&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = (</span><br><span class="line">        (<span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;400&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;200&#x27;</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    response = requests.get(<span class="string">&#x27;http://www.dtasecurity.cn:35555/picture&#x27;</span>, headers=headers, params=params, verify=<span class="literal">False</span>)</span><br><span class="line">    data = json.loads(response.text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 验证码 id , 之后需要回传进行验证</span></span><br><span class="line">    sid = data[<span class="string">&#x27;sid&#x27;</span>]</span><br><span class="line">    <span class="comment"># 加密之后的正序数组, 需要解密</span></span><br><span class="line">    c = data[<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line">    p1_path = <span class="string">&quot;./p1.jpeg&quot;</span></span><br><span class="line">    p2_path = <span class="string">&quot;./p2.jpeg&quot;</span></span><br><span class="line">    <span class="comment"># 乱序图片 &quot;data:image/jpeg;base64,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&quot;</span></span><br><span class="line">    p1 = data[<span class="string">&#x27;p1&#x27;</span>].split(<span class="string">&#x27;,&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># 滑块图片 &quot;data:image/jpeg;base64,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&quot;</span></span><br><span class="line">    p2 = data[<span class="string">&#x27;p2&#x27;</span>].split(<span class="string">&#x27;,&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(p1_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(base64.b64decode(p1))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(p2_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(base64.b64decode(p2))</span><br><span class="line">    <span class="comment"># 滑块对应的 y 坐标</span></span><br><span class="line">    y = data[<span class="string">&#x27;y&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> sid, c, p1_path, p2_path, y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. python 还原 js 中获取真实排序数组的方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decodeKey</span>(<span class="params"><span class="built_in">input</span></span>):</span></span><br><span class="line">    order_list = []</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> <span class="built_in">input</span>:</span><br><span class="line">        order_list.append(<span class="built_in">ord</span>(each) ^ <span class="number">66</span>)</span><br><span class="line">    print(order_list)</span><br><span class="line">    <span class="keyword">return</span> order_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 将下载下来的乱序图片还原</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getRightImg</span>(<span class="params">path, order_list, offset</span>):</span></span><br><span class="line">    right_path = <span class="string">&quot;./right.jpg&quot;</span></span><br><span class="line">    wrong_img = Image.<span class="built_in">open</span>(path)</span><br><span class="line">    width, height = wrong_img.size</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化正确顺序的列表容器</span></span><br><span class="line">    right_order = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(order_list)):</span><br><span class="line">        right_order.append(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 遍历传入的数组, 按数组指定的顺序将每个片段插入到列表容器中</span></span><br><span class="line">    <span class="keyword">for</span> index, i <span class="keyword">in</span> <span class="built_in">enumerate</span>(order_list):</span><br><span class="line">        box = (index * offset, <span class="number">0</span>, (index + <span class="number">1</span>) * offset, height)</span><br><span class="line">        tmp_img = wrong_img.crop(box)</span><br><span class="line">        right_order[i] = tmp_img</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将排序之后的片段重新写入图片</span></span><br><span class="line">    x = y = <span class="number">0</span></span><br><span class="line">    right_img = Image.new(<span class="string">&quot;RGB&quot;</span>, (width, height), <span class="number">255</span>)</span><br><span class="line">    <span class="keyword">for</span> img <span class="keyword">in</span> right_order:</span><br><span class="line">        right_img.paste(img, (x, y))</span><br><span class="line">        x += offset</span><br><span class="line"></span><br><span class="line">    <span class="comment"># right_img.show()</span></span><br><span class="line">    right_img.save(right_path)</span><br><span class="line">    <span class="keyword">return</span> right_path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 灰度 高斯滤波器(降噪) 边缘检测 调参, 模板匹配</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDistance</span>(<span class="params">right_path, p2_path</span>):</span></span><br><span class="line">    <span class="comment"># 模板匹配</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_template</span>(<span class="params">canny_img, canny_slide_img</span>):</span></span><br><span class="line">        result = cv.matchTemplate(canny_img, canny_slide_img, cv.TM_CCOEFF_NORMED)</span><br><span class="line">        min_val, max_val, min_loc, max_loc = cv.minMaxLoc(result)</span><br><span class="line">        <span class="keyword">return</span> min_val, max_val, min_loc, max_loc</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取灰度图片 cv.IMREAD_GRAYSCALE</span></span><br><span class="line">    gray_img = cv.imread(right_path, cv.IMREAD_GRAYSCALE)</span><br><span class="line">    gray_slide_img = cv.imread(p2_path, cv.IMREAD_GRAYSCALE)</span><br><span class="line">    <span class="comment"># 去除噪声 高斯模糊</span></span><br><span class="line">    gs_img = cv.GaussianBlur(gray_img, (<span class="number">5</span>, <span class="number">5</span>), <span class="number">0</span>)</span><br><span class="line">    gs_slide_img = cv.GaussianBlur(gray_slide_img, (<span class="number">5</span>, <span class="number">5</span>), <span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 边缘检测</span></span><br><span class="line">    canny_img = cv.Canny(gs_img, <span class="number">25</span>, <span class="number">45</span>)</span><br><span class="line">    canny_slide_img = cv.Canny(gs_slide_img, <span class="number">25</span>, <span class="number">45</span>)</span><br><span class="line"></span><br><span class="line">    result = find_template(canny_img, canny_slide_img)</span><br><span class="line">    print(result)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 通过 tracebar 进行参数调节 mac 上就没成功过</span></span><br><span class="line">    <span class="comment"># def tracebar(x):</span></span><br><span class="line">    <span class="comment">#     threshold1 = cv.getTrackbarPos(&quot;threshold1&quot;, &quot;test&quot;)</span></span><br><span class="line">    <span class="comment">#     threshold2 = cv.getTrackbarPos(&quot;threshold2&quot;, &quot;test&quot;)</span></span><br><span class="line">    <span class="comment">#     canny_img = cv.Canny(gs_img, threshold1, threshold2)</span></span><br><span class="line">    <span class="comment">#     cv.imshow(&quot;canny_img&quot;, canny_img)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># cv.namedWindow(&quot;test&quot;)</span></span><br><span class="line">    <span class="comment"># cv.createTrackbar(&quot;threshold1&quot;, &quot;test&quot;, 0, 255, tracebar)</span></span><br><span class="line">    <span class="comment"># cv.createTrackbar(&quot;threshold2&quot;, &quot;test&quot;, 0, 255, tracebar)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 显示图片测试</span></span><br><span class="line">    <span class="comment"># cv.imshow(&quot;gray_img&quot;, gray_img)</span></span><br><span class="line">    <span class="comment"># cv.imshow(&quot;gs_img&quot;, gs_img)</span></span><br><span class="line">    <span class="comment"># cv.waitKey()</span></span><br><span class="line">    <span class="comment"># cv.destroyAllWindows()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 获取轨迹(jshook打印 or 直接还原编码后的轨迹信息)</span></span><br><span class="line"><span class="comment"># 油猴 hook 脚本 ./hookTrail.js</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 画出轨迹图像 找缓动函数相同形状</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_plt</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">        trail_list = <span class="built_in">eval</span>(<span class="string">f&quot;trail_<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">        print(<span class="string">f&quot;trail_<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">        x_trail = []</span><br><span class="line">        y_trail = []</span><br><span class="line">        t_trail = []</span><br><span class="line">        <span class="keyword">for</span> trail <span class="keyword">in</span> trail_list:</span><br><span class="line">            x = trail[<span class="number">0</span>]</span><br><span class="line">            y = trail[<span class="number">1</span>]</span><br><span class="line">            t = trail[<span class="number">2</span>]</span><br><span class="line">            x_trail.append(x)</span><br><span class="line">            y_trail.append(y)</span><br><span class="line">            t_trail.append(t)</span><br><span class="line">        print(np.diff(x_trail))</span><br><span class="line">        <span class="comment"># 打印 t 轴</span></span><br><span class="line">        <span class="comment"># print(t_trail)</span></span><br><span class="line">        plt.plot(t_trail, x_trail)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 绘制缓动函数 找到符合形状的作用域</span></span><br><span class="line"><span class="comment"># 8. 根据图片调整 np.linspace 的作用域, 最终调整为 -0.5 到 1;</span></span><br><span class="line"><span class="comment"># 9. 找到作用域内最大值 最小值 上下移动 *距离系数</span></span><br><span class="line"><span class="comment"># 10. 替换时间（t）轴为自己的</span></span><br><span class="line"><span class="comment"># 11. 高斯函数增加波动</span></span><br><span class="line"><span class="comment"># 缓动函数速查表  https://www.xuanfengge.com/easeing/easeing/</span></span><br><span class="line"><span class="comment"># 对应实现: https://github.com/gdsmith/jquery.easing</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_easeOutQuint</span>(<span class="params">distance</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1</span> - <span class="built_in">pow</span>(<span class="number">1</span> - x, <span class="number">5</span>)) + <span class="number">6.59375</span>  <span class="comment"># 6.59375 最小值, 整体上移</span></span><br><span class="line"></span><br><span class="line">    size = <span class="number">400</span></span><br><span class="line">    <span class="comment"># 作用域 -0.5 到 1, 400 个点</span></span><br><span class="line">    x = np.linspace(-<span class="number">0.5</span>, <span class="number">1</span>, size)</span><br><span class="line">    <span class="comment"># 获取 y 的最大值和最小值, 修改 func 函数, 让图片整体向上移动到 x 轴上方</span></span><br><span class="line">    print(func(-<span class="number">0.5</span>), func(<span class="number">1</span>))</span><br><span class="line">    <span class="comment"># y 的最大值为最终要滑动的距离, 所以 func(1)的值要等于传入的滑动距离, func(1) * distance/y当前最大值</span></span><br><span class="line">    <span class="comment"># y = [distance/7.59375 * func(i) for i in x]</span></span><br><span class="line">    y = [func(i) <span class="keyword">for</span> i <span class="keyword">in</span> x]</span><br><span class="line">    plt.plot(x, y)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将 x 轴换成我们的时间 t, 打印时间 t 查看大概的时间区间</span></span><br><span class="line">    t = np.linspace(<span class="number">200</span>, <span class="number">3000</span>, size)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用高斯函数对 y 增加噪点波动</span></span><br><span class="line">    delta_pt = <span class="built_in">abs</span>(np.random.normal(scale=<span class="number">1.1</span>, size=size))</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(delta_pt)):</span><br><span class="line">        change_y = <span class="built_in">int</span>(x[index] + delta_pt[index])</span><br><span class="line">        <span class="keyword">if</span> (index + <span class="number">1</span> &lt; size <span class="keyword">and</span> y[index + <span class="number">1</span>] &gt; change_y):</span><br><span class="line">            y[index] += change_y</span><br><span class="line">            <span class="comment"># y[index] = int(y[index])</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;np.diff(y)&quot;</span>, np.diff(y))</span><br><span class="line">    plt.plot(t, y)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10. 细节修改 最终版本</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_trail</span>(<span class="params">move_distence, show=<span class="literal">False</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">easeOutQuint</span>(<span class="params">x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1</span> - math.<span class="built_in">pow</span>(<span class="number">1</span> - x, <span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set_pt_time</span>(<span class="params">_dist</span>):</span></span><br><span class="line">        <span class="keyword">if</span> _dist &lt; <span class="number">100</span>:</span><br><span class="line">            __need_time = <span class="built_in">int</span>(random.uniform(<span class="number">500</span>, <span class="number">1500</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            __need_time = <span class="built_in">int</span>(random.uniform(<span class="number">1000</span>, <span class="number">2000</span>))</span><br><span class="line">        __end_pt_time = []</span><br><span class="line">        __move_pt_time = []</span><br><span class="line">        __pos_z = []</span><br><span class="line"></span><br><span class="line">        total_move_time = __need_time * random.uniform(<span class="number">0.8</span>, <span class="number">0.9</span>)</span><br><span class="line">        start_point_time = random.uniform(<span class="number">110</span>, <span class="number">200</span>)</span><br><span class="line">        __start_pt_time = [<span class="built_in">int</span>(start_point_time)]</span><br><span class="line"></span><br><span class="line">        sum_move_time = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        _tmp_total_move_time = total_move_time</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            delta_time = random.uniform(<span class="number">15</span>, <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">if</span> _tmp_total_move_time &lt; delta_time:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            sum_move_time += delta_time</span><br><span class="line">            _tmp_total_move_time -= delta_time</span><br><span class="line">            __move_pt_time.append(<span class="built_in">int</span>(start_point_time + sum_move_time))</span><br><span class="line"></span><br><span class="line">        last_pt_time = __move_pt_time[-<span class="number">1</span>]</span><br><span class="line">        __move_pt_time.append(<span class="built_in">int</span>(last_pt_time + _tmp_total_move_time))</span><br><span class="line"></span><br><span class="line">        sum_end_time = start_point_time + total_move_time</span><br><span class="line">        other_point_time = __need_time - sum_end_time</span><br><span class="line">        end_first_ptime = other_point_time / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            delta_time = random.uniform(<span class="number">110</span>, <span class="number">200</span>)</span><br><span class="line">            <span class="keyword">if</span> end_first_ptime - delta_time &lt;= <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            end_first_ptime -= delta_time</span><br><span class="line">            sum_end_time += delta_time</span><br><span class="line">            __end_pt_time.append(<span class="built_in">int</span>(sum_end_time))</span><br><span class="line"></span><br><span class="line">        __end_pt_time.append(<span class="built_in">int</span>(sum_end_time + (other_point_time / <span class="number">2</span> + end_first_ptime)))</span><br><span class="line">        __pos_z.extend(__start_pt_time)</span><br><span class="line">        __pos_z.extend(__move_pt_time)</span><br><span class="line">        __pos_z.extend(__end_pt_time)</span><br><span class="line">        <span class="keyword">return</span> __pos_z</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get_pos_y</span>(<span class="params">point_count</span>):</span></span><br><span class="line">        _pos_y = []</span><br><span class="line">        start_y = random.randint(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        end_y = random.randint(-<span class="number">13</span>, -<span class="number">5</span>)</span><br><span class="line">        x = np.linspace(start_y, end_y, point_count)</span><br><span class="line">        <span class="keyword">for</span> _, val <span class="keyword">in</span> <span class="built_in">enumerate</span>(x):</span><br><span class="line">            _pos_y.append(<span class="built_in">int</span>(val))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _pos_y</span><br><span class="line"></span><br><span class="line">    time_list = __set_pt_time(move_distence)</span><br><span class="line">    trail_length = <span class="built_in">len</span>(time_list)</span><br><span class="line">    t = np.linspace(-<span class="number">0.5</span>, <span class="number">1</span>, trail_length)  <span class="comment"># t</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># -6.59375 1.0 先进行向上平移, + 6.59375 =&gt; 平移后最大值变为 1.0 + 6.59375 = 7.59375</span></span><br><span class="line">    print(easeOutQuint(-<span class="number">0.5</span>), easeOutQuint(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    mult = move_distence / <span class="number">7.59375</span></span><br><span class="line"></span><br><span class="line">    x = [<span class="built_in">int</span>(mult * (easeOutQuint(i) + <span class="number">6.59375</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> t]</span><br><span class="line">    y = __get_pos_y(trail_length)</span><br><span class="line">    <span class="comment"># t=-0.5 x=-6.59375</span></span><br><span class="line">    <span class="comment"># t=1 x=7.59375</span></span><br><span class="line">    delta_pt = <span class="built_in">abs</span>(np.random.normal(scale=<span class="number">3</span>, size=trail_length))</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(delta_pt)):</span><br><span class="line">        change_x = <span class="built_in">int</span>(x[index] + delta_pt[index])</span><br><span class="line">        <span class="keyword">if</span> index + <span class="number">1</span> &lt; trail_length <span class="keyword">and</span> x[index + <span class="number">1</span>] &gt; change_x:</span><br><span class="line">            x[index] = change_x</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> show:</span><br><span class="line">        delta_t = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(trail_length)]</span><br><span class="line">        plt.plot(delta_t, delta_pt, color=<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line">        plt.plot(time_list, x, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">        plt.show()</span><br><span class="line"></span><br><span class="line">    result = []</span><br><span class="line">    print(x[-<span class="number">1</span>] - x[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(trail_length):</span><br><span class="line">        result.append([x[idx], y[idx], time_list[idx]])</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 11. 提交数据加密</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encodeData</span>(<span class="params">trail</span>):</span></span><br><span class="line">    postStr = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> trail:</span><br><span class="line">        x = each[<span class="number">0</span>]</span><br><span class="line">        y = each[<span class="number">1</span>]</span><br><span class="line">        t = each[<span class="number">2</span>]</span><br><span class="line">        tmp = <span class="string">f&quot;<span class="subst">&#123;x&#125;</span>,<span class="subst">&#123;y&#125;</span>,<span class="subst">&#123;t&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        postStr += base64.b64encode(tmp.encode()).decode() + <span class="string">&quot;*&quot;</span></span><br><span class="line">    postStr = postStr.rstrip(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> postStr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 12. 提交滑块</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">postData</span>(<span class="params">postStr, sid</span>):</span></span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Pragma&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Cache-Control&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json;charset=UTF-8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Origin&#x27;</span>: <span class="string">&#x27;http://www.dtasecurity.cn:30080&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://www.dtasecurity.cn:30080/&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh,zh-CN;q=0.9&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;sid&quot;</span>: sid,</span><br><span class="line">        <span class="string">&quot;trail&quot;</span>: postStr</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = requests.post(<span class="string">&#x27;http://www.dtasecurity.cn:35555/slide&#x27;</span>,</span><br><span class="line">                             headers=headers, json=data, verify=<span class="literal">False</span>)</span><br><span class="line">    print(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    sid, c, p1_path, p2_path, y = getImg()</span><br><span class="line">    print(sid, c, p1_path, p2_path, y)</span><br><span class="line"></span><br><span class="line">    order_list = decodeKey(c)</span><br><span class="line">    right_path = getRightImg(p1_path, order_list, <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">    min_val, max_val, min_loc, max_loc = getDistance(right_path, p2_path)</span><br><span class="line"></span><br><span class="line">    distance = max_loc[<span class="number">0</span>]</span><br><span class="line">    trail = get_trail(distance / (<span class="number">30</span> / <span class="number">20</span>), <span class="literal">True</span>)  <span class="comment"># 30 原始图片截取宽度 20 写入的时候的宽度</span></span><br><span class="line">    postStr = encodeData(trail)</span><br><span class="line">    postData(postStr,sid)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># show_plt()</span></span><br><span class="line">    <span class="comment"># distance = 100</span></span><br><span class="line">    <span class="comment"># show_easeOutQuint(100)</span></span><br><span class="line">    <span class="comment"># result = get_trail(100, True)</span></span><br><span class="line">    <span class="comment"># print(result)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="v8-引擎代替-node"><a href="#v8-引擎代替-node" class="headerlink" title="v8 引擎代替 node"></a>v8 引擎代替 node</h2><p>v8 引擎内置的对象参考链接: <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects</a></p><p>除了上述文档中的内容, 其他的内容都是浏览器实现的;</p><h3 id="补环境"><a href="#补环境" class="headerlink" title="补环境"></a>补环境</h3><p>难点: </p><ol><li>  如何找到缺少哪些环境</li><li>  如何实现虚拟环境</li></ol><blockquote><p>  如何找到缺少哪些环境</p></blockquote><ol><li></li></ol>]]></content>
      
      
      <categories>
          
          <category> js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>跟着龙哥踩坑unidbg1</title>
      <link href="unidbg1/"/>
      <url>unidbg1/</url>
      
        <content type="html"><![CDATA[<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-12-092149.png"></p><p><a href="https://blog.csdn.net/qq_38851536/article/details/117418582?spm=1001.2014.3001.5501">https://blog.csdn.net/qq_38851536/article/details/117418582?spm=1001.2014.3001.5501</a></p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>案例: <a href="https://www.wandoujia.com/apps/8059828/history_v153">https://www.wandoujia.com/apps/8059828/history_v153</a></p><p>登录 app 之后, 在请求任意列表页面的时候抓包可以看到在 <code>Query String</code>里面有加密参数<code>sign</code>;  </p><p>直接打开 apk 后发现是加固后的;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-13-055238.png"></p><p>使用 dexdump 脱壳;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.sina.oasis explore</span><br><span class="line">Using USB device `Huawei Nexus 6P`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A newer version of objection is available!</span><br><span class="line">You have v1.8.4 and v1.11.0 is ready <span class="keyword">for</span> download.</span><br><span class="line"></span><br><span class="line">Upgrade with: pip3 install objection --upgrade</span><br><span class="line">For more information, please see: https://github.com/sensepost/objection/wiki/Updating</span><br><span class="line"></span><br><span class="line">Agent injected and responds ok!</span><br><span class="line"></span><br><span class="line">     _   _         _   _</span><br><span class="line"> ___| |_|_|___ ___| |_|_|___ ___</span><br><span class="line">| . | . | | -_|  _|  _| | . |   |</span><br><span class="line">|___|___| |___|___|_| |_|___|_|_|</span><br><span class="line">      |___|(object)inject(ion) v1.8.4</span><br><span class="line"></span><br><span class="line">     Runtime Mobile Exploration</span><br><span class="line">        by: @leonjza from @sensepost</span><br><span class="line"></span><br><span class="line">[tab] <span class="keyword">for</span> <span class="built_in">command</span> suggestions</span><br><span class="line">com.sina.oasis on (google: 8.1.0) [usb] <span class="comment"># plugin load /Users/zhangyang/.objection/plugins/dexdump</span></span><br><span class="line">Loaded plugin: dexdump</span><br><span class="line">com.sina.oasis on (google: 8.1.0) [usb] <span class="comment"># plugin dexdump dump</span></span><br><span class="line">[DEXDump]: DexSize=0x6eb0, DexMd5=d1d843137aa5b91f78bf4f8b0d6dea5f, SavePath=/Users/zhangyang/com.sina.oasis/0xd1506000.dex</span><br><span class="line">[DEXDump]: DexSize=0x765b64, DexMd5=9062750059a2da98b9b61b08a2957bc3, SavePath=/Users/zhangyang/com.sina.oasis/0xd32e5000.dex</span><br><span class="line">[DEXDump]: DexSize=0x6a6f04, DexMd5=6a2d85f57a680950306f27ea35cf206a, SavePath=/Users/zhangyang/com.sina.oasis/0xd3a52000.dex</span><br><span class="line">[DEXDump]: DexSize=0x64a210, DexMd5=fb90ebd6d2bc446e48248a8566ae7ff3, SavePath=/Users/zhangyang/com.sina.oasis/0xd2c94000.dex</span><br><span class="line">[DEXDump]: Skip duplicate dex 0xd4c00000&lt;d1d843137aa5b91f78bf4f8b0d6dea5f&gt;</span><br><span class="line">[DEXDump]: DexSize=0x11c, DexMd5=f1771b68f5f9b168b79ff59ae2daabe4, SavePath=/Users/zhangyang/com.sina.oasis/0xd5974628.dex</span><br><span class="line">[DEXDump]: DexSize=0x6eb0, DexMd5=0a9f080b7f25365f7995fa388cd5ba9d, SavePath=/Users/zhangyang/com.sina.oasis/0xd60d501c.dex</span><br></pre></td></tr></table></figure><p> 再使用 dex2apk 重新组装成 apk后用 jadx 打开</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">python dex2apk.py -a ~/Downloads/lvzhou3.5.8 -i ~/com.sina.oasis</span><br><span class="line">[*] 重命名完毕</span><br><span class="line">flag INFO  - loading ...</span><br><span class="line">INFO  - processing ...</span><br><span class="line">INFO  - <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">校验成功</span><br><span class="line">flag INFO  - loading ...</span><br><span class="line">INFO  - processing ...</span><br><span class="line">INFO  - <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">校验成功</span><br><span class="line">flag INFO  - loading ...</span><br><span class="line">INFO  - processing ...</span><br><span class="line">INFO  - <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">校验成功</span><br><span class="line">flag INFO  - loading ...</span><br><span class="line">INFO  - processing ...</span><br><span class="line">ERROR - finished with errors, count: 2</span><br><span class="line"></span><br><span class="line">校验失败, 删除文件/Users/zhangyang/com.sina.oasis/classes.dex</span><br><span class="line">flag INFO  - loading ...</span><br><span class="line">INFO  - processing ...</span><br><span class="line">INFO  - <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">校验成功</span><br><span class="line">flag INFO  - loading ...</span><br><span class="line">INFO  - processing ...</span><br><span class="line">INFO  - <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">校验成功</span><br><span class="line">[-] /Users/zhangyang/Downloads/lvzhou3.5.8 不是一个APK文件</span><br><span class="line">[*] APK打包成功，你可以拖入APK进行分析啦！</span><br></pre></td></tr></table></figure><p>直接使用 jadx 打开重新打包好的 apk 即可 <code>jadx-gui repacked.apk</code></p><h2 id="Java-层定位"><a href="#Java-层定位" class="headerlink" title="Java 层定位"></a>Java 层定位</h2><p>直接在 jadx 中搜索 “sign”, 可以定位到可疑的加密位置:</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-13-060204.png"></p><p>使用 objection 进一步确认</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">com.sina.oasis on (google: 8.1.0) [usb] <span class="comment"># android hooking watch class_method g.a.c.b.c --dump-args --</span></span><br><span class="line">dump-backtrace --dump-return</span><br><span class="line">(agent) Attempting to watch class g.a.c.b and method c.</span><br><span class="line">(agent) Hooking g.a.c.b.c([B, boolean)</span><br><span class="line">(agent) Registering job mj63c9d243. Type: watch-method <span class="keyword">for</span>: g.a.c.b.c</span><br><span class="line">com.sina.oasis on (google: 8.1.0) [usb] <span class="comment"># (agent) [mj63c9d243] Called g.a.c.b.c([B, boolean)</span></span><br><span class="line">(agent) [mj63c9d243] Backtrace:</span><br><span class="line">g.a.c.b.c(Native Method)</span><br><span class="line">        g.a.c.g.c.a(ApiInterceptor.kt:59)</span><br><span class="line">i2.o0.h.g.c(RealInterceptorChain.kt:14)</span><br><span class="line">g.a.c.g.i.a(CoroutineInterceptor.kt:3)</span><br><span class="line">i2.o0.h.g.c(RealInterceptorChain.kt:14)</span><br><span class="line">i2.o0.g.e.i(RealCall.kt:25)</span><br><span class="line">i2.o0.g.e<span class="variable">$a</span>.run(RealCall.kt:12)</span><br><span class="line">java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1162)</span><br><span class="line">java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:636)</span><br><span class="line">java.lang.Thread.run(Thread.java:764)</span><br><span class="line"></span><br><span class="line">(agent) [mj63c9d243] Arguments g.a.c.b.c([object Object], (none))</span><br><span class="line">(agent) [mj63c9d243] Return Value: 635e79ef06849283aa5fe547e080aeb2</span><br></pre></td></tr></table></figure><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-13-065959.png"></p><p>使用 frida 打印一下入参, 确定一下传入的参数是什么, 之后方便固定参数进行逆向;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bytesToString</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    arr = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(arr);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> arr) &#123;</span><br><span class="line">        str += <span class="built_in">String</span>.fromCharCode(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;执行 -&gt; &quot;</span>,<span class="string">&quot;hook_2&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> bClass = Java.use(<span class="string">&quot;g.a.c.b&quot;</span>);</span><br><span class="line">        bClass.c.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">bArr, z</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;bArr&quot;</span>, bytesToString(bArr));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;z&quot;</span>, z);</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">this</span>.c(bArr, z);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;result&quot;</span>, result);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Huawei Nexus 6P::绿洲]-&gt; bArr aid=01A0ytCBlv2wmeJam2KiVPmdYrL2sZDf2qMlSXuHJoEzvpbs4.&amp;cfrom=28B5295010&amp;cuid=7465622707&amp;noncestr=xv2qJed62F79Yx2gMS9s108F0r425U&amp;platform=ANDROID&amp;timestamp=1628838577570&amp;ua=Huawei-Nexus6P__oasis__3.5.8__Android__Android8.1.0&amp;version=3.5.8&amp;vid=2002867034357&amp;wm=20004_90024</span><br><span class="line">z <span class="literal">false</span></span><br><span class="line">result 01ccabfc1f50dc3d4db1dd9fcd7e6910</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="主动调用"><a href="#主动调用" class="headerlink" title="主动调用"></a>主动调用</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> bClass = Java.use(<span class="string">&quot;g.a.c.b&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> StringClass = Java.use(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> str = StringClass.$new(<span class="string">&quot;aid=01A0ytCBlv2wmeJam2KiVPmdYrL2sZDf2qMlSXuHJoEzvpbs4.&amp;cfrom=28B5295010&amp;cuid=7465622707&amp;noncestr=xv2qJed62F79Yx2gMS9s108F0r425U&amp;platform=ANDROID&amp;timestamp=1628838577570&amp;ua=Huawei-Nexus6P__oasis__3.5.8__Android__Android8.1.0&amp;version=3.5.8&amp;vid=2002867034357&amp;wm=20004_90024&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> byteArray = str.getBytes();</span><br><span class="line">        <span class="keyword">var</span> result = bClass.c(byteArray, <span class="literal">false</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;result&quot;</span>, result);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果 01ccabfc1f50dc3d4db1dd9fcd7e6910</span></span><br></pre></td></tr></table></figure><p>主动调用的结果和之前 frida 打印的结果相同, 说明该算法中应该没有随机数的参与; 看这个 sign 的长度是一个 32 chars, 猜测是一个 md5 之后的结果; 用CyberChef 验证一下, 发现结果不对, 很可能是加盐了;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-13-071429.png"></p><p>只能到 native 层继续查看了;</p><h2 id="native-层定位"><a href="#native-层定位" class="headerlink" title="native 层定位"></a>native 层定位</h2><p>定位到加密接口, 跟进去看一下就可以定位到 native 层;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-13-070105.png"></p><p>使用杨神的脚本, 对动态注册进行 hook 打印, 因为我在安装 apk 的时候指定了在 arm32 位下运行, 所以这个地址区别于 arm64 下的地址;</p><p><code>frida -U --no-pause -f com.sina.oasis -l hook_RegisterNatives.js</code></p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-13-071904.png"></p><p>找到对应的 s 方法, 偏移为 0xc365; 函数签名([BZ]), 返回值为 String;</p><p>frida 版本切换到 14, ida 打开目标 so, 跳转到 0xc365; 直接使用 traceNatives 进行 trace, 然后主动调用, 获取到调用的路径;</p><p><code>frida-trace -UF -O /Users/zhangyang/Downloads/lvzhou3.5.8/lib/armeabi-v7a/liboasiscore_1628839431.txt</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">         /* TID 0x29ef */</span><br><span class="line">22235 ms  sub_c365()</span><br><span class="line">22235 ms     | sub_10dc1()</span><br><span class="line">22235 ms     | sub_d249()</span><br><span class="line">22235 ms     |    | sub_10dc1()</span><br><span class="line">22235 ms     | sub_d4b1()</span><br><span class="line">22235 ms     | sub_d4b1()</span><br><span class="line">22235 ms     |    | sub_d839()</span><br><span class="line">22235 ms     |    |    | sub_10dc1()</span><br><span class="line">22235 ms     | sub_8975()</span><br><span class="line">22235 ms     |    | sub_8ab3()</span><br><span class="line">22235 ms     |    |    | sub_8ef1()</span><br><span class="line">22235 ms     |    |    |    | sub_aaf3()</span><br><span class="line">22235 ms     |    |    | sub_8ef1()</span><br><span class="line">22235 ms     |    |    |    | sub_aaf3()</span><br><span class="line">22235 ms     |    |    | sub_8ef1()</span><br><span class="line">22235 ms     |    |    |    | sub_aaf3()</span><br><span class="line">22235 ms     |    |    | sub_8ef1()</span><br><span class="line">22235 ms     |    |    |    | sub_aaf3()</span><br><span class="line">22235 ms     | sub_ac0d()</span><br><span class="line">22235 ms     |    | sub_8ce1()</span><br><span class="line">22235 ms     |    |    | sub_8e19()</span><br><span class="line">22235 ms     |    |    | sub_8ab3()</span><br><span class="line">22235 ms     |    |    | sub_8ab3()</span><br><span class="line">22235 ms     |    |    |    | sub_8ef1()</span><br><span class="line">22235 ms     |    |    |    |    | sub_aaf3()</span><br><span class="line">22235 ms     |    |    | sub_8e19()</span><br><span class="line">22235 ms     |    | sub_ad41()</span><br><span class="line">22235 ms     |    |    | sub_10dc1()</span><br><span class="line">22235 ms     |    | sub_b1d1()</span><br><span class="line">22235 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br><span class="line">22236 ms     |    | sub_b1d1()</span><br></pre></td></tr></table></figure><p>之前就怀疑是 md5, 可以使用 findhash 进行可疑的函数定位, 方便快速找到加密位置;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-13-073105.png"></p><p>在 0x8975 地址, 在主动调用过程中 traceNatives 经过了该方法, findhash 中判断该方法中有魔数初始化, 我们重点关注这个方法, 最终可以在该方法调用 sub_8AB2 的时候进行 hook, 获取到入参和结果;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base_addr = Module.findBaseAddress(<span class="string">&quot;liboasiscore.so&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;base_addr&quot;</span>, base_addr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// hook sub_8ab3</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sub_8AB2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sub_8AB2 = base_addr.add(<span class="number">0x8AB2</span> + <span class="number">1</span>);</span><br><span class="line">    Interceptor.attach(sub_8AB2,&#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;------------------------- enter sub_8ab3 -------------------------&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> hexdump_str = <span class="string">&quot;0,1&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">                <span class="built_in">eval</span>(<span class="string">&quot;this.arg&quot;</span> + i + <span class="string">&quot;=args[&quot;</span> + i + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (hexdump_str.indexOf(i) &gt; -<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;sub_8ab3 this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, hexdump(args[i]));</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;sub_8ab3 this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, args[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">returnValue</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;========================= leave sub_8ab3 =========================&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> hexdump_str = <span class="string">&quot;0,1&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;<span class="number">3</span> ; i++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (hexdump_str.indexOf(i) &gt; -<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;sub_8ab3 this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, hexdump(<span class="built_in">eval</span>(<span class="string">&quot;this.arg&quot;</span> + i)));</span><br><span class="line">    </span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;sub_8ab3 this.arg&quot;</span> + i + <span class="string">&quot;:&quot;</span>, <span class="built_in">eval</span>(<span class="string">&quot;this.arg&quot;</span> + i));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">String</span>(returnValue).length &gt; <span class="number">4</span>)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;sub_8ab3 returnValue hexdump&quot;</span>, hexdump(returnValue));</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;sub_8ab3 returnValue&quot;</span>, returnValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>invoke 的结果为: 01ccabfc1f50dc3d4db1dd9fcd7e6910</p><p>观察 hook 的结果, 可以看到入参的盐为固定的: <code>YP1Vty&amp;$Xm*kJkoR,Opk&amp;</code></p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-13-074322.png" alt="image-20210813154317911"></p><p>md5 之后的结果在 arg0中可以找到:</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-13-074528.png" alt="image-20210813154524093"></p><p>使用 CyberChef 确认一下, 结果是正确的;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-13-074121.png" alt="image-20210813154121293"></p><h2 id="unidbg-调用"><a href="#unidbg-调用" class="headerlink" title="unidbg 调用"></a>unidbg 调用</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sina.oasis;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入通用且标准的类库</span></span><br><span class="line"><span class="comment">// 导入通用且标准的类库</span></span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.AbstractJni;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.AndroidEmulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.DalvikModule;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.VM;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.array.ByteArray;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SignUtil</span> <span class="keyword">extends</span> <span class="title">AbstractJni</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SignUtil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建模拟器实例, 进程名建议依照实际进程名填写, 可以规避针对进程名的检验</span></span><br><span class="line">        emulator = AndroidEmulatorBuilder.for32Bit().setProcessName(<span class="string">&quot;com.sina.oasis&quot;</span>).build();</span><br><span class="line">        <span class="comment">// 获取模拟器的内存操作接口</span></span><br><span class="line">        <span class="keyword">final</span> Memory memory = emulator.getMemory();</span><br><span class="line">        <span class="comment">// 设置内存中系统类库解析</span></span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> AndroidResolver(<span class="number">23</span>));</span><br><span class="line">        <span class="comment">// 创建 Android 虚拟机, 传入 apk, Unidbg 可以代替我们完成部分签名校验的工作</span></span><br><span class="line">        vm = emulator.createDalvikVM(<span class="keyword">new</span> File(<span class="string">&quot;unidbg-android/src/test/java/com/sina/oasis/lvzhou3.5.8.apk&quot;</span>));</span><br><span class="line">        <span class="comment">// 加载目标 so</span></span><br><span class="line">        DalvikModule dalvikModule = vm.loadLibrary(<span class="keyword">new</span> File(<span class="string">&quot;unidbg-android/src/test/java/com/sina/oasis/liboasiscore.so&quot;</span>), <span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 获取本 so 模块的句柄, 后续需要用到它</span></span><br><span class="line">        <span class="keyword">module</span> = dalvikModule.getModule();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置 jni</span></span><br><span class="line">        vm.setJni(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// 设置日志</span></span><br><span class="line">        vm.setVerbose(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用 JNI Onload</span></span><br><span class="line">        dalvikModule.callJNI_OnLoad(emulator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSign</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// args list</span></span><br><span class="line">        List&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// arg0 env</span></span><br><span class="line">        list.add(vm.getJNIEnv());</span><br><span class="line">        <span class="comment">// arg1 jobject/jclass 取决于该方法是 objec 方法还是 class 方法</span></span><br><span class="line">        list.add(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// arg2 bytes</span></span><br><span class="line">        String input = <span class="string">&quot;aid=01A0ytCBlv2wmeJam2KiVPmdYrL2sZDf2qMlSXuHJoEzvpbs4.&amp;cfrom=28B5295010&amp;cuid=7465622707&amp;noncestr=xv2qJed62F79Yx2gMS9s108F0r425U&amp;platform=ANDROID&amp;timestamp=1628838577570&amp;ua=Huawei-Nexus6P__oasis__3.5.8__Android__Android8.1.0&amp;version=3.5.8&amp;vid=2002867034357&amp;wm=20004_90024&quot;</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes =  input.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">        <span class="comment">// 将 java 的 byte[] 转为 native 的 ByteArray</span></span><br><span class="line">        ByteArray inputByteArray = <span class="keyword">new</span> ByteArray(vm, bytes);</span><br><span class="line">        list.add(vm.addLocalObject(inputByteArray));</span><br><span class="line">        <span class="comment">// arg3 boolean false  --&gt;  0</span></span><br><span class="line">        list.add(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// call 主动调用</span></span><br><span class="line">        Number number = <span class="keyword">module</span>.callFunction(emulator, <span class="number">0xC365</span>, list.toArray())[<span class="number">0</span>];</span><br><span class="line">        String result = vm.getObject(number.intValue()).getValue().toString();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 启动</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SignUtil signUtil = <span class="keyword">new</span> SignUtil();</span><br><span class="line">        String sign = signUtil.getSign();</span><br><span class="line">        System.out.println(<span class="string">&quot;sign: &quot;</span> + sign);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> so </category>
          
      </categories>
      
      
        <tags>
            
            <tag> so </tag>
            
            <tag> unidbg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>程序员的自我修养</title>
      <link href="books-coder/"/>
      <url>books-coder/</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><h2 id="PC-架构演变"><a href="#PC-架构演变" class="headerlink" title="PC 架构演变"></a>PC 架构演变</h2><p>计算机中最重要的三个部件, CPU, 内存和 I/O 控制芯片;</p><blockquote><p>  早期架构</p></blockquote><p>早期的计算机, CPU 的核心频率不高, 和内存的频率一样, 他们都直接连接在同一个总线上;</p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-29-055918.png"  /><blockquote><p>  系统总线的产生</p></blockquote><p>后来, CPU核心频率提升, 内存开始跟不上 CPU 的速度, 于是产生了与内存频率一致的系统总线, 而 CPU 采用倍频的方式与系统总线进行通信;</p><blockquote><p>  北桥的产生</p></blockquote><p>随着图形化界面的普及, 图形芯片和 CPU 和内存之间需要大量交换数据, 慢速的 I/O总线已经没办法满足这个需求; 为了协调 CPU , 内存和图形设备, 北桥芯片产生了;</p><blockquote><p>  南桥的产生</p></blockquote><p>因为北桥的运行速度高, 所有相对低速的设备如果都直接连接在北桥上, 北桥要处理高速设备, 又要处理低速设备, 设计会十分复杂; 所以专门设计了处理低速设备的南桥芯片, 磁盘, USB, 鼠标等设备都连接在南桥上, 由南桥将他们汇总后连接到北桥上;</p><blockquote><p>  现代 PC 架构图</p></blockquote><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-29-061347.jpg" style="zoom:67%;" /><h2 id="SMP-和多核"><a href="#SMP-和多核" class="headerlink" title="SMP 和多核"></a>SMP 和多核</h2><p>人类在制造 CPU 的工艺目前已经达到物理极限了, 除非再有突破, 否则目前 CPU 的频率将会一直被目前4GHz 的天花板限制; 因为频率没有办法增加了, 于是人们开始增加 CPU 的数量来提高 CPU 的速度;</p><blockquote><p>  SMP</p></blockquote><p>对称多处理器 SMP; 每个 CPU 在系统中所处的地位和所发挥的功能是一样的, 是相互对称的; </p><blockquote><p>  多核处理器</p></blockquote><p>在个人电脑中, 使用多处理器是一个奢侈的行为, 于是处理器厂商将多个处理器打包出售, 这些处理器之间共享比较昂贵的缓存部分, 只保留多个核心, 并且以一个处理器的外包装进行出售;</p><h2 id="系统软件"><a href="#系统软件" class="headerlink" title="系统软件"></a>系统软件</h2><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-29-062340.png"></p><p>计算机科学领域的任何问题, 都可以通过增加一个中间层来解决;</p><p>每一个中间层都是对下面的那层的包装和扩展;</p><blockquote><p>  接口</p></blockquote><p>每一个层之间都需要相互通信, 要通信就必须要有一个通信的协议, 这就是接口; 接口下面那层是接口的提供者, 由它定义接口; 接口上面那层是接口的使用者, 它使用接口来实现所需要的功能;</p><h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><p>操作系统的的一个功能是提供抽象的接口, 另一个是管理硬件资源;</p><p>操作系统需要将所管理的硬件资源的效率提高, 充分挖掘他们的潜力; 主要管理对象就是 CPU, 存储器和 I/O 设备;</p><h3 id="提升-CPU-的效率"><a href="#提升-CPU-的效率" class="headerlink" title="提升 CPU 的效率"></a>提升 CPU 的效率</h3><blockquote><p>  分时系统</p></blockquote><p>程序运行模式是一种协作的模式, 即每个程序运行一段时间后都主动让出 CPU 给其他程序, 使得每个时间段每个程序都有机会运行一小段时间; 这种协作模式叫做分时系统; 但是早期的分时系统还不完善, 如果有一个程序在进行一个很耗时的计算, 一直霸占着 CPU, 操作系统也没办法, 其他程序都只能等着, 如果一个程序进入了死循环, 那么整个系统都会停止;</p><blockquote><p>  多任务系统</p></blockquote><p>为了解决分时系统的弊端, 当代计算机采用了更先进的多任务系统;</p><p>操作系统接管了所有的硬件资源, 并且本身运行在一个受硬件保护的级别; 所有的应用程序都以进程 Process 的方式运行在比操作系统权限更低的级别; </p><p>每个进程都有自己独立的地址空间, 使得进程之间的地址空间相互隔离;</p><p>CPU 由操作系统统一进行分配, 每个进程根据优先级的高低都会有机会得到 CPU 的使用权; 但是, 如果运行时间超过一定的时间, 操作系统会暂停该进程, 将 CPU 资源分配给其他等待运行的进程; 这种 CPU 的分配方式就是所谓的抢占式;</p><h3 id="提升硬件效率"><a href="#提升硬件效率" class="headerlink" title="提升硬件效率"></a>提升硬件效率</h3><p>操作系统出现后, 硬件逐渐被抽象成一系列概念; 操作系统中的硬件驱动实现了操作系统和硬件之间交互; 驱动程序可以看成是操作系统的一部分, 它往往和操作系统内核一起运行在特权级, 但是它又与操作系统内核之间有一定独立性, 使得驱动程序有比较好的灵活性; 这些驱动程序的开发工作通常都是由硬件生产的厂商来完成, 操作系统为硬件厂商提供了一系列的接口和框架, 凡是按照这个接口和框架开发的驱动程序都可以在该操作系统上面使用;</p><h3 id="提升内存效率"><a href="#提升内存效率" class="headerlink" title="提升内存效率"></a>提升内存效率</h3><blockquote><p>  早期, 程序直接运行在物理内存上, 产生了大量的问题</p></blockquote><p>早期, 程序直接运行在物理内存上, 也就是说, 程序运行时访问的地址都是物理地址; 这样产生很多问题,如:</p><ol><li>  内存不足: PC 上运行多个程序的时候, 物理内存不足, 没办法同时将多个程序都装载进来;</li><li>  地址空间不隔离: 所有程序都直接访问物理地址, 程序所使用的内存空间不是相互隔离的; 恶意程序可以随意修改其他程序的内存数据; 一个程序出问题也可能会影响其他程序的运行;</li><li>  内存使用效率低下: 因为没有有效的内存管理, 当我们需要运行 C 程序时, 内存不足, 可能需要将 A 程序和 B 程序都从内存中释放, 再将 C 载入到内存中, 内存的使用效率很低</li><li>  程序运行的地址不确定: 程序每次装入运行时, 都要给它从内存中分配空间, 这个空间的位置是不确定的, 但是程序在编写的时候, 它访问的数据和指令跳转的目标地址很多都是固定的, 这设计了程序的重定向问题;</li></ol><h4 id="虚拟地址"><a href="#虚拟地址" class="headerlink" title="虚拟地址"></a>虚拟地址</h4><p>将程序给出的地址看成是一个虚拟地址, 然后通过物理地址和虚拟地址之间映射, 将虚拟地址转换成实际的物理地址; 只要管理虚拟地址到物理地址的映射就可以保证任意一个程序能访问的物理内存区域和另一个程序互相不重叠;</p><h4 id="进程地址隔离"><a href="#进程地址隔离" class="headerlink" title="进程地址隔离"></a>进程地址隔离</h4><p>所谓的地址空间是一个比较抽象的概念, 可以把地址空间想象成一个很大的数组, 数组中的每个元素是一个字节, 这个数组的大小由地址空间的地址长度决定;</p><blockquote><p>  物理地址空间</p></blockquote><p>物理地址空间是实实在在存在的, 存在于计算机中, 而且对于每一台计算机来说只有唯一的一个; 可以把物理地址空间当做物理内存; </p><blockquote><p>  虚拟地址空间</p></blockquote><p>虚拟地址空间是指虚拟的, 人们想象出来的地址空间, 其实它不是真的存在, 每个进程都有自己独立的虚拟空间, 而且每个进程也只能访问自己的地址空间; </p><p>通过虚拟地址空间可以实现有效的进程的地址隔离;</p><h4 id="分段"><a href="#分段" class="headerlink" title="分段"></a>分段</h4><p>分段的基本思路是: 把一段程序所需要使用的内存空间大小的虚拟空间映射到物理内存中, 比如一个程序需要使用 10MB 的虚拟空间, 那么就将 10MB 的虚拟空间映射到实际物理空间中, 即虚拟空间中的每个字节对应物理空间中的每个字节; </p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-29-090500.png" style="zoom:50%;" /><p>这个映射过程由操作系统来完成, 实际的地址转换过程由硬件完成; 比如程序 A 要访问虚拟地址 0x00001000 时, CPU 会将这个虚拟地址转换成实际在物理内存中的映射地址;</p><p>分段解决了地址隔离问题和程序地址硬编码问题:</p><ol><li>  隔离问题: 因为程序 A 和程序 B 被映射到两个完全不同的空间区域, 它们之间没有任何重叠, 一旦程序 A 访问的虚拟空间地址超出了 0x00A00000, 那么硬件就会判断这是一个非法的访问, 拒绝这个地址的请求;</li><li>  程序地址硬编码: 无论程序被真实分配到哪个物理内存, 对于程序本身来说都是透明的, 程序不再需要关心物理地址的变化, 只需要按照 0x00000000 到 0x00A00000 来编写程序, 放置变量即可, 真实的寻址工作由 CPU 来完成, 程序本身不需要重定位;</li></ol><h4 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h4><blockquote><p>  分页解决的问题</p></blockquote><p>分段的方式没有解决内存使用效率的问题, 分段对内存区域的映射还是按照程序为单位, 如果内存不足, 被换入和换出到磁盘的都是整个程序, 这样会造成大量的磁盘访问操作, 从而严重影响速度;</p><p>采用分页的方式还可以为每个页设置权限, 谁可以修改, 谁可以访问等, 而只有操作系统可以修改这些权限, 起到了保护的作用;</p><blockquote><p>  分页原理</p></blockquote><p>根据程序的局部性原理, 当一个程序在运行时, 在某个时间段内, 它频繁用到了一小部分数据; 即程序的很多数据其实在一个时间段内都不会被用到; 所以可以采用更小粒度的内存分割和映射的方法, 让程序的局部性原理充分得到利用, 这种方法就是分页;</p><blockquote><p>  分页实现</p></blockquote><p>分页的基本方法是将虚拟地址空间和物理地址空间人为分成固定大小的页, 每一页的大小由硬件或者操作系统决定; 虚拟地址空间和物理地址空间每页的大小一致;</p><blockquote><p>  分页案例</p></blockquote><p>假设, 每个虚拟地址空间有 8 页, 每页大小为 1KB; 那么虚拟地址空间就是 8KB; 物理地址空间为 6KB, 每页大小为 1KB; </p><p>当程勋运行起来, 我们把常用的数据和代码装载到内存中, 不常用的代码和数据仍然保存在磁盘中; 当需要使用这些不常用的代码时, 再从磁盘中将这些代码读取出来; </p><p>如果有两个进程 Process1 和 Process2; VP0, VP1, VP7 虚拟页映射到了 PP0, PP2, PP3 物理页上, 其他部分页面仍保存在磁盘中, 比如 VP2 和 VP3 位于磁盘页 DP0, DP1 中; </p><p>Process1 的 VP2 和 VP3 不在内存中, 但是当进程用到这个两个页的时候, 硬件会捕获到这个信息, 也就是所谓的<code>页错误</code>; 然后操作系统接管进程, 负责将 VP2 和 VP3 对应在磁盘DP0, DP1 中的数据读取到物理内存中, 再将成功装载这两页的物理内存页和 VP2, VP3 进行映射; </p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-29-093241.png" style="zoom:50%;" /><blockquote><p>  MMU</p></blockquote><p>虚拟存储的实现需要硬件的支持, 对于不同的 CPU 来说是不同的, 但是几乎所有的硬件都采用 MMU部件来进行页映射; </p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-29-093532.png"></p><p>在页映射模式下, CPU 发出的是虚拟地址, 也就是程序中看到的虚拟地址; 经过 MMU 的转换以后就变成了物理地址, 现在 MMU 一般都集成在 CPU 内部, 不会以单独的部件存在了;</p>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>so基础入门</title>
      <link href="so1/"/>
      <url>so1/</url>
      
        <content type="html"><![CDATA[<h2 id="ARM-基础"><a href="#ARM-基础" class="headerlink" title="ARM 基础"></a>ARM 基础</h2><h3 id="三级流水"><a href="#三级流水" class="headerlink" title="三级流水"></a>三级流水</h3><p>PC 代表程序技术器, 三级流水是一个指令执行的三个阶段</p><ol><li> 取指(从存储器中装载一条指令)</li><li> 译码(识别将要执行的指令)</li><li> 执行(处理指令并将结果写回寄存器)</li></ol><p>PC 总是指向<code>正在取指</code>的指令, 而不是指向正在执行或者正在译码的指令;</p><p>假设当前在 arm 指令下, 每条指令占用 4 个字节; 那么 pc 指向的是正在取指的指令地址, cpu 正在译指的地址是 PC-4; cpu 正在执行的指令地址是 pc-8; </p><p>也就是说 PC 所指向的地址和现在所执行的指令地址相差 8;</p><h2 id="ELF-文件"><a href="#ELF-文件" class="headerlink" title="ELF 文件"></a>ELF 文件</h2><ul><li>为什么要学习 ELF parser<ul><li>  文件格式要跟着解析器一起学习</li></ul></li><li>为什么要 dump so; <ul><li>  很多加固和混淆的 so 在静态看的时候是无法正常查看的</li><li>  在静态 –&gt;  so 解密 –&gt;  加载到内存中 –&gt;   dump 下来的是经过解密之后的 so</li></ul></li><li>为什么 dump 下来的 so 无法直接反汇编<ul><li>  在 elf 文件装载过程中会丢失信息, 需要重新建立这些信息才能反汇编</li></ul></li><li>  dump 下来的 so 如何进行修复</li><li>  为什么修复之后就可以反汇编了</li></ul><h3 id="结构综述"><a href="#结构综述" class="headerlink" title="结构综述"></a>结构综述</h3><p>ELF 文件的开头是一个文件头, 它描述了整个文件的文件属性, 包括文件是否可执行, 是静态链接还是动态链接以及入口地址 (如果是可执行文件), 目标硬件, 目标操作系统等信息;</p><p> 文件头还包括一个段表(Section Table), 段表其实是一个描述文件中各个段的数组, 段表描述了文件中各个段在文件中的偏移位置以及段的属性等, 从段表中可以得到每个段的所有信息;</p><p>文件头后面就是就是各个段的内容, 比如代码段保存的就是程序的指令, 数据段保存的就是程序的静态变量等; 一般 C 语言编译后执行语句都编译成机器码, 保存在.text 段中; 已经初始化的全局变量和局部静态变量都保存在.data 段; 未初始化的全局变量和局部静态变量一般放在.bss 段中; .bss 段只是为未初始化的全局变量和局部静态变量预留位置而已, 它并没有内容, 所以它在文件中也不占据空间;</p><p>总体来说, 程序源代码编译之后主要分成两种段: 程序指令和程序数据; 代码段属于程序指令, 而数据段和.bss 段属于程序数据;</p><h3 id="文件头"><a href="#文件头" class="headerlink" title="文件头"></a>文件头</h3><p>可以使用 readelf 命令来查看 elf 文件; <code>readelf -h &lt;soPath&gt;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ELF Header:</span><br><span class="line">  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00</span><br><span class="line">  Class:                             ELF32</span><br><span class="line">  Data:                              2<span class="string">&#x27;s complement, little endian</span></span><br><span class="line"><span class="string">  Version:                           1 (current)</span></span><br><span class="line"><span class="string">  OS/ABI:                            UNIX - System V</span></span><br><span class="line"><span class="string">  ABI Version:                       0</span></span><br><span class="line"><span class="string">  Type:                              DYN (Shared object file)</span></span><br><span class="line"><span class="string">  Machine:                           ARM</span></span><br><span class="line"><span class="string">  Version:                           0x1</span></span><br><span class="line"><span class="string">  Entry point address:               0x0</span></span><br><span class="line"><span class="string">  Start of program headers:          52 (bytes into file)</span></span><br><span class="line"><span class="string">  Start of section headers:          29216 (bytes into file)</span></span><br><span class="line"><span class="string">  Flags:                             0x5000200, Version5 EABI, soft-float ABI</span></span><br><span class="line"><span class="string">  Size of this header:               52 (bytes)</span></span><br><span class="line"><span class="string">  Size of program headers:           32 (bytes)</span></span><br><span class="line"><span class="string">  Number of program headers:         8</span></span><br><span class="line"><span class="string">  Size of section headers:           40 (bytes)</span></span><br><span class="line"><span class="string">  Number of section headers:         27</span></span><br><span class="line"><span class="string">  Section header string table index: 26</span></span><br></pre></td></tr></table></figure><p>ELF Header 数据结构</p><ol><li>e_ident 数组<ol><li> EI_MAG0 文件标识  –&gt;  7f</li><li> EI_MAG1 文件标识  –&gt;  45  –&gt;  E</li><li> EI_MAG2 文件标识  –&gt;  4c  –&gt;  L</li><li> EI_MAG3 文件标识  –&gt;  46  –&gt;  F</li><li>EL_CLASS 文件类型<ol><li> 0 非法类型</li><li> 1 32 位目标 ELFCLASS32</li><li> 2 64 位目标 ELFCLASS64</li></ol></li><li>EI_DATA<ol><li> 0 ELFDATANONE 非法数据编码</li><li> 1 ELFDATA2LSB 小端 高位在前</li><li> 2 ELFDATA2MSB 大端 低位在前</li></ol></li><li> EI_VERSION ELF 头部的版本号码, 目前必须是 EV_CURRENT</li><li> EI_PAD 标记 e_ident 中未使用字节的开始, 初始化为 0;</li></ol></li><li>e_type 目标文件类型<ol><li> 0 ET_NONE 未知目标文件格式</li><li> 1 ET_REL 可重定位文件</li><li> 2 ET_EXEC 可执行文件</li><li> 3 ET_DYN 共享目标文件, 一般为 so 文件</li><li> 4 ET_CORE Core 文件</li><li> 0xff00 ET_LOPPOC 特定处理器文件</li><li> 0xffff ET_HIPROC 特定处理器文件</li></ol></li><li>e_machine 给出文件的目标体系结构类型<ol><li> 0 EM_NONE 未指定</li><li> 1 EM_M32 AT&amp;T WE 32100</li><li> 2 EM_SPARC SPARC</li><li> 3 EM_386 INTEL80386</li><li> 4 EM_68K MOTOROLA 68000</li><li> 5 EM_88K MOTOROLA 88000</li><li> 7 EM_860 INTEL 80860</li><li> 8 EM_MIPS MIPS RS3000</li><li> 其他的都是保留的, 特定处理器 elf 名称会使用机器名进行区分</li></ol></li><li>e_version 目标文件版本<ol><li> 0 EV_NONE 非法版本</li><li> 1 EV_CURRENT 当前版本</li></ol></li><li> e_entry 程序入口的虚拟地址, 如果目标文件没有程序入口, 可以为 0</li><li> e_phoff 程序头部表格 Program Header Table 的偏移量, 如果程序没有头部表格, 可以为 0</li><li> e_shoff 节区头部表格 Section Header Table 的偏移量, 如果文件没有节区头部表格, 可以为 0</li><li> e_flags 保存与文件相关的特定处理器的标志</li><li> e_ehsize elf 头部的大小(以字节计算)</li><li> e_phentsize 程序头部表格的表项大小, 按字节计算</li><li> e_phnum 程序头部表格的表项数数量, 可以为 0</li><li> e_shentsize 节区头部表格的表项大小, 按字节计算</li><li> e_shnum 节区头部表格的表项数目, 可以为 0</li><li> e_shstrndx 节区头部表格中与节区名称字符串表相关的表项的索引, 如果文件没有节区名称字符串表, 此参数可以为 SHN_UNDEF</li></ol><h3 id="段表"><a href="#段表" class="headerlink" title="段表"></a>段表</h3><p>ELF 文件中有很多各种各样的段, 每个段表 Section Header Table 就是保存这些段的基本属性的结构; 段表是 ELF 文件中除了文件头以外最重要的结构, 它描述 了 ELF 的各个段的信息; 比如段的段名, 段的长度, 在文件中的偏移, 读写权限, 段的其他属性; </p><p>ELF 文件的段结构就是由段表决定的, 编译器,链接器和装载器都是根据段表来定位和访问各个段的属性的; 段表在 ELF 文件中由 ELF 文件头的 e_shoff 成员决定;</p><p>可以使用 <code>readelf -S &lt;soPath&gt;</code> 来查看段表结构;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">There are 27 section headers, starting at offset 0x7220:</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span><br><span class="line">  [ 0]                   NULL            00000000 000000 000000 00      0   0  0</span><br><span class="line">  [ 1] .note.androi[...] NOTE            00000134 000134 000098 00   A  0   0  4</span><br><span class="line">  [ 2] .note.gnu.bu[...] NOTE            000001cc 0001cc 000024 00   A  0   0  4</span><br><span class="line">  [ 3] .dynsym           DYNSYM          000001f0 0001f0 000770 10   A  4   1  4</span><br><span class="line">  [ 4] .dynstr           STRTAB          00000960 000960 0015ea 00   A  0   0  1</span><br><span class="line">  [ 5] .gnu.hash         GNU_HASH        00001f4c 001f4c 000284 04   A  3   0  4</span><br><span class="line">  [ 6] .<span class="built_in">hash</span>             HASH            000021d0 0021d0 000368 04   A  3   0  4</span><br><span class="line">  [ 7] .gnu.version      VERSYM          00002538 002538 0000ee 02   A  3   0  2</span><br><span class="line">  [ 8] .gnu.version_d    VERDEF          00002628 002628 00001c 00   A  4   1  4</span><br><span class="line">  [ 9] .gnu.version_r    VERNEED         00002644 002644 000040 00   A  4   2  4</span><br><span class="line">  [10] .rel.dyn          REL             00002684 002684 000318 08   A  3   0  4</span><br><span class="line">  [11] .rel.plt          REL             0000299c 00299c 0002a0 08   A  3   0  4</span><br><span class="line">  [12] .plt              PROGBITS        00002c3c 002c3c 000404 00  AX  0   0  4</span><br><span class="line">  [13] .text             PROGBITS        00003040 003040 00253c 00  AX  0   0  4</span><br><span class="line">  [14] .ARM.exidx        ARM_EXIDX       0000557c 00557c 000390 08  AL 13   0  4</span><br><span class="line">  [15] .ARM.extab        PROGBITS        0000590c 00590c 0004a4 00   A  0   0  4</span><br><span class="line">  [16] .rodata           PROGBITS        00005db0 005db0 000627 00   A  0   0  1</span><br><span class="line">  [17] .data.rel.ro      PROGBITS        00007bc4 006bc4 000188 00  WA  0   0  4</span><br><span class="line">  [18] .fini_array       FINI_ARRAY      00007d4c 006d4c 000008 00  WA  0   0  4</span><br><span class="line">  [19] .dynamic          DYNAMIC         00007d54 006d54 000118 08  WA  4   0  4</span><br><span class="line">  [20] .got              PROGBITS        00007e6c 006e6c 000194 00  WA  0   0  4</span><br><span class="line">  [21] .data             PROGBITS        00008000 007000 000004 00  WA  0   0  4</span><br><span class="line">  [22] .bss              NOBITS          00008004 007004 000001 00  WA  0   0  1</span><br><span class="line">  [23] .comment          PROGBITS        00000000 007004 0000b5 01  MS  0   0  1</span><br><span class="line">  [24] .note.gnu.go[...] NOTE            00000000 0070bc 00001c 00      0   0  4</span><br><span class="line">  [25] .ARM.attributes   ARM_ATTRIBUTES  00000000 0070d8 000036 00      0   0  1</span><br><span class="line">  [26] .shstrtab         STRTAB          00000000 00710e 00010f 00      0   0  1</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</span><br><span class="line">  L (link order), O (extra OS processing required), G (group), T (TLS),</span><br><span class="line">  C (compressed), x (unknown), o (OS specific), E (exclude),</span><br><span class="line">  y (purecode), p (processor specific)</span><br></pre></td></tr></table></figure><p>段表结构比较简单, 它是一个以<code>Elf32_Shdr</code>结构体为元素的数组, 数组元素的个数等于段的个数, 每个<code>Elf32_Shdr</code>结构体对应一个段, <code>Elf32_Shar</code>又被称为段描述符, 上面的 so 文件一共有0-26 个段描述符, 也就是由 27 个元素的数组; ELF 段表的第一个元素是无效的段描述符, 它的类型是 NULL; 除此之外每个段描述符都对应一个段, 也就是说该 so 文件共有 26 个有效的段;</p><p>简而言之, 段表就是一个大数组, 数组中每一个元素都是一个段描述符的结构体;</p><h4 id="段描述符"><a href="#段描述符" class="headerlink" title="段描述符"></a>段描述符</h4><ol><li> sh_name: Section name 段名; 段名是个字符串, 它位于一个叫做 .shstrtab 的字符串表, sh_name 是段名字符串在 .shstrtab 中的偏移;</li><li> sh_type: Section type 段的类型, 参考后面 –&gt;  段的类型</li><li> sh_flags: Section flag 段的标志位, 参考后面 –&gt;  段的标志位</li><li> sh_addr: Section Address 段虚拟地址; 如果该段可以被加载, 那么 sh_addr 为该段被加载后在进程地址空间中的虚拟地址, 否则为 0</li><li> sh_offset: Section Offset 段偏移; 如果该段存在于文件中, 则表示该段在文件中的偏移; 否则无意义; 例如, sh_offset 对于 BSS 段来说就没有意义</li><li> sh_size: Section Size 段的长度;</li><li> sh_link 和 sh_info: Section link 和 Section Information 段链接信息, 参考后面 –&gt;  段的链接信息</li><li> sh_addralign: 段地址对齐; 有些段对段地址对齐有要求, 由于地址对齐的数量都是 2 的指数倍, sh_addralign 表示地址对齐数量中的指数, 3 表示 2^3, 如果 sh_addralign 为 0 或 1, 则表示该段没有对齐要求</li><li> sh_entsize: Section Entry Size 项的长度; 有些段包含了一些固定大小的项, 比如符号表, 它包含的每个符号占用的大小都是一样的, 对于这种段, sh_entsize 表示每个项的大小, 如果为 0, 则表示该段不包含固定大小的项;</li></ol><h4 id="段的类型"><a href="#段的类型" class="headerlink" title="段的类型"></a>段的类型</h4><p>段的名字只在链接和编译的过程中有意义, 对于编译器和链接器而言, 主要决定段的属性的是段的类型和段的标志位, 段的类型如下, 主要以商量 SHT 开头</p><table><thead><tr><th>常量</th><th>值</th><th>含义</th></tr></thead><tbody><tr><td>SHT_NULL</td><td>0</td><td>无效段</td></tr><tr><td>SHT_PROGBITS</td><td>1</td><td>程序段, 代码段, 数据段都是这种类型的</td></tr><tr><td>SHT_SYMTAB</td><td>2</td><td>表示该段的内容是符号表</td></tr><tr><td>SHT_STRTAB</td><td>3</td><td>表示该段的内容为字符串表</td></tr><tr><td>SHT_RELA</td><td>4</td><td>重定位表, 该段包含了重定位信息, 可以参考后面的重定位</td></tr><tr><td>SHT_HASH</td><td>5</td><td>符号表的哈希表, 参考符号表</td></tr><tr><td>SHT_DYNAMIC</td><td>6</td><td>动态链接信息, 参考动态链接</td></tr><tr><td>SHT_NOTE</td><td>7</td><td>提示信息</td></tr><tr><td>SHT_NOBITS</td><td>8</td><td>表示该段在文件中没有内容, 比如.bss 段</td></tr><tr><td>SHT_REL</td><td>9</td><td>该段包含了重定位信息, 具体参考重定位</td></tr><tr><td>SHT_SHLIB</td><td>10</td><td>保留</td></tr><tr><td>SHT_DNYSYM</td><td>11</td><td>动态链接的符号表, 参考动态链接</td></tr></tbody></table><h4 id="段的标志位"><a href="#段的标志位" class="headerlink" title="段的标志位"></a>段的标志位</h4><p>段的标志位表示该段在程序虚拟地址空间中的属性, 比如是否可写, 是否可执行等; 相关常量通常以 SHF_开头;</p><table><thead><tr><th>常量</th><th>值</th><th>含义</th></tr></thead><tbody><tr><td>SHF_WRITE</td><td>1</td><td>表示该段在进程空间站中可写</td></tr><tr><td>SHF_ALLOC</td><td>2</td><td>表示该段在进程空间中需要分配空间, 像代码段,数据段和.bss 段都会有这个标志位</td></tr><tr><td>SHF_EXECINSTR</td><td>4</td><td>表示该段在进程空间中可以被执行, 一般指代码段</td></tr></tbody></table><p>系统保留段的属性</p><table><thead><tr><th>Name</th><th>sh_type</th><th>sh_flag</th></tr></thead><tbody><tr><td>.bss</td><td>SHT_NOBITS</td><td>SHF_ALLOC+SHF_WRITE</td></tr><tr><td>.comment</td><td>SHT_PROGBITS</td><td>none</td></tr><tr><td>.data</td><td>SHT_PROGBITS</td><td>SHF_ALLOC+SHF_WRITE</td></tr><tr><td>.data1</td><td>SHT_PROGBITS</td><td>SHF_ALLOC+SHF_WRITE</td></tr><tr><td>.debug</td><td>SHT_PROGBITS</td><td>none</td></tr><tr><td>.dynamic</td><td>SHT_DYNAMIC</td><td>SHF_ALLOC+SHF_WRITE</td></tr><tr><td>.hash</td><td>SHT_HASH</td><td>SHF_ALLOC</td></tr><tr><td>.line</td><td>SHT_PROGBITS</td><td>none</td></tr><tr><td>.note</td><td>SHT_NOTE</td><td>none</td></tr><tr><td>.rodata</td><td>SHT_PROGBITS</td><td>SHF_ALLOC</td></tr><tr><td>.rodata1</td><td>SHT_PROGBITS</td><td>SHF_ALLOC</td></tr><tr><td>.shstrtab</td><td>SHT_STRTAB</td><td>none</td></tr><tr><td>.strtab</td><td>SHT_STRTAB</td><td>如果该 ELF 文件中有可装载的段需要用到该字符串表, 那么该字符串表也将被装载到进程空间, 则有 SHF_ALLOC 标志位</td></tr><tr><td>.symtab</td><td>SHT_SYMTAB</td><td>同字符串表</td></tr><tr><td>.text</td><td>SHT_PROGBITS</td><td>SHF_ALLOC+SHF_EXECINSTR</td></tr></tbody></table><h4 id="段的链接信息"><a href="#段的链接信息" class="headerlink" title="段的链接信息"></a>段的链接信息</h4><p>如果段的类型是与链接相关的, 不论是动态链接或者静态链接, 比如重定位表, 符号表等; 那么 sh_link 和 sh_info 这两个成员所包含的意义如下图; 对于其他类型的段, 这两个成员没有意义;</p><table><thead><tr><th>sh_type</th><th>sh_link</th><th>sh_ info</th></tr></thead><tbody><tr><td>SHT_DYNAMIC</td><td>该段所使用的字符串在段表中的下标</td><td>0</td></tr><tr><td>SHT_HASH</td><td>该段所使用的符号表在段表中的下标</td><td>0</td></tr><tr><td>SHT_REL\SHT_RELA</td><td>该段所使用的相应符号表在段表中的下标</td><td>该重定向表所作用的段在段表中的下标</td></tr><tr><td>SHT_SYMTAB/SHT_DYNSYM</td><td>操作系统相关</td><td>操作系统相关</td></tr><tr><td>other</td><td>SHN_UNDEF</td><td>0</td></tr></tbody></table><h4 id="重定位表"><a href="#重定位表" class="headerlink" title="重定位表"></a>重定位表</h4><p>链接器在处理目标文件时, 需要对目标文件中某些部位进行重定位, 即代码段和数据段中那些对绝对地址的引用的位置; 这些重定位信息都会记录在 ELF 文件的重定位表里面; 对于每个需要重定位的代码段或者数据段, 都会有一个相应的重定位表; 比如 <code>.rel.text</code>就是对<code>.text</code>段的重定位表; <code>.rel.data</code>就是对 <code>.data</code>段的重定位表;</p><p>一个重定位表同时也是 ELF 的一个段, 那么这个段的类型就是 SHT_REL类型; 它的 sh_link 表示符号表的下标; 它的 sh_info 表示它作用于那个段; 比如 .rel.text 作用于 .text, 而.text 段的下标是 1, 那么 .rel.text 的 sh_info 为 1;</p><h4 id="字符串表"><a href="#字符串表" class="headerlink" title="字符串表"></a>字符串表</h4><p>ELF 文件中用到了很多字符串, 比如段名, 变量名等; 因为字符串的长度往往是不定的, 所以很难用固定的结构来表示; 常见的方式是把字符串集中起来放在一个表里, 然后使用字符串在表中的偏移来引用字符串;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-19-063649.png"></p><p>在 ELF 文件中引用字符串值需要给出一个数字下标即可; 不用考虑字符串的长度问题; 一般字符串在 ELF 文件中也以段的形式保存, 常见的段名为<code>.strtab</code>或者 <code>.shstrtab</code>; 这两个字符串表分别为字符串表和段表字符串表; .strtab 字符串表就是用来保存普通的字符串, 比如符号的名字; 段表字符串表用来保存段中用到的字符串, 最常见的就是段名(sh_name);</p><p>e_shstrndx 是 ELF32_Ehdr 的最后一个成员, 是 Section header string table index 的缩写, 我们知道段表字符串本身也是 ELF 文件中的一个普通的段, 知道它的名字往往叫做 .shstrtab; 那么这个 e_shstrndx 就是表示 .shstrtab 在段表中的下标; 即段表字符串表在段表中的下标; </p><p>只有分析 ELF 文件头, 才可以得到段表和段表字符串表的位置, 从而才能解析整个 ELF 文件;</p><h4 id="代码段"><a href="#代码段" class="headerlink" title="代码段"></a>代码段</h4><p><code>objdump -h &lt;soPath&gt;</code> -h 参数可以将 ELF 文件中各个段的基本信息打印出来; 或者使用 -x 参数, 打印更详细的信息;</p><p><code>objdump -s -d &lt;soPath&gt;</code> -s 参数可以将所有段的内容以十六进制的方式打印出来, -d 参数可以将所有的包含指令的段反汇编; </p><h4 id="数据段和只读数据段"><a href="#数据段和只读数据段" class="headerlink" title="数据段和只读数据段"></a>数据段和只读数据段</h4><p>.data 段保存的是已经初始化的全局静态变量和局部静态变量;</p><p>.rodata 段存放的是只读数据, 一般是程序中只读变量,(如 const 修改的变量) 和字符串常量; 有时候编译器会把字符串常量放在 .data 段, 而不会单独放在.rodata段; </p><h4 id="bss-段"><a href="#bss-段" class="headerlink" title="bss 段"></a>bss 段</h4><p>.bss 段存放的是未初始化的全局变量和局部静态变量; </p><h4 id="其他段"><a href="#其他段" class="headerlink" title="其他段"></a>其他段</h4><table><thead><tr><th>常用的段名</th><th>说明</th></tr></thead><tbody><tr><td>.rodata1</td><td>Read only Data. 在这种段里存放的是只读数据, 比如字符常量, 全局 const 变量, 和 .rodata 一样</td></tr><tr><td>.comment</td><td>存放的是编译器版本信息, 比如字符串: “GCC: (GNU) 4.2.0”</td></tr><tr><td>.debug</td><td>调试信息</td></tr><tr><td>.dynamic</td><td>动态链接信息</td></tr><tr><td>.hash</td><td>符号哈希表</td></tr><tr><td>.line</td><td>调试时的行号表</td></tr><tr><td>.note</td><td>额外的编译器信息, 比如程序的公司名, 发布版本号等</td></tr><tr><td>.strtab</td><td>String Table 字符串表, 用于存储 ELF 文件中用到的各种字符串</td></tr><tr><td>.symtab</td><td>Symbol Table 符号表</td></tr><tr><td>.shstrtab</td><td>Section String Table 段名表</td></tr><tr><td>.plt .got</td><td>动态链接的跳转表和全局入口表</td></tr><tr><td>.init .fini</td><td>程序初始化与终结代码段</td></tr></tbody></table><h4 id="自定义段"><a href="#自定义段" class="headerlink" title="自定义段"></a>自定义段</h4><p>正常情况下, GCC 编译出来的目标文件中, 代码会被放在.text 段中; 初始化的全局变量和局部静态变量会被放到.data 段中; 未初始化的全局变量和静态变量会被放到.bss 段中; 如果想要某些部分的代码或者变量放到自己指定的段中, 可以通过通过下面代码指定变量所处的段:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__attribute__((section(<span class="string">&quot;FOO&quot;</span>))) <span class="keyword">int</span> global = <span class="number">42</span>;</span><br><span class="line">__attribute__((section(<span class="string">&quot;BAR&quot;</span>))) <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br></pre></td></tr></table></figure><p>我们通过在全局变量或者函数前面加上<code>__attribute__((section(&quot;name&quot;)))</code>属性就可以将相应的变量或者函数放到以 name 命名的段中;</p><h3 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h3><h4 id="符号定义"><a href="#符号定义" class="headerlink" title="符号定义"></a>符号定义</h4><h5 id="链接本质"><a href="#链接本质" class="headerlink" title="链接本质"></a>链接本质</h5><p>链接过程的本质就是将多个不同的目标文件之间相互粘在一起; 或者说是就像拼积木一样拼装成一个整体; 在链接中, 目标文件之间相互拼合实际上是对目标文件之间对地址的引用; </p><h5 id="定义和引用"><a href="#定义和引用" class="headerlink" title="定义和引用"></a>定义和引用</h5><p>比如目标文件 B 要用到目标文件 A 中的函数 foo, 那么目标文件 A 定义了函数 foo, 目标文件 B 引用了目标文件 A 中的函数 foo; 这个概念也同样适用于变量;</p><h5 id="符号名和符号值"><a href="#符号名和符号值" class="headerlink" title="符号名和符号值"></a>符号名和符号值</h5><p>在链接中, 我们将函数和变量统称为符号, 函数名和变量名就是符号名; </p><p>每个目标文件都会有一个相应的符号表, 这个表里记录了目标文件中所用到的所有符号; 每个定义的符号都有一个对应的值, 叫做符号值, 对于函数和变量来说, 符号值就是他们的地址;</p><h5 id="符号分类"><a href="#符号分类" class="headerlink" title="符号分类"></a>符号分类</h5><ul><li>  全局符号: 定义在本目标文件的全局符号, 可以被其他目标文件引用; </li><li>  外部符号: 在本目标文件中引用的全局符号, 却没有定义在本目标文件, 也叫做符号引用;</li><li>  段名: 一般是编译器产生的, 它的值就是该段的起始地址</li><li>  局部符号: 只在编译单元内部可见; 这些局部符号对于链接过程没有作用. 链接器也往往忽略它们;</li><li>  行号信息: 目标文件指令和源代码中代码行的对应关系, 可选;</li></ul><p>一般值得关注的就是全局符号和外部符号; 因为链接过程只关心全局符号的相互粘合;</p><h4 id="查看文件符号"><a href="#查看文件符号" class="headerlink" title="查看文件符号"></a>查看文件符号</h4><p><code>nm &lt;soPath&gt;</code></p><p><code>readelf -s &lt;soPath&gt;</code></p><h3 id="符号表结构"><a href="#符号表结构" class="headerlink" title="符号表结构"></a>符号表结构</h3><p>ELF 文件中的符号往往是一个文件中的一个段, 段名一般是<code>.symtab</code>; 符号表的结构比较简单, 它是一个 Elf32_Sym 结构的数组; 数组中的每个元素对应一个符号; 数组中的第一个元素也就是下标 0 的元素为无效的未定义符号; </p><p>数组中每个元素的结构如下:</p><table><thead><tr><th>名称</th><th>含义</th></tr></thead><tbody><tr><td>st_name</td><td>符号名, 包含了该符号名在字符串表中的下标</td></tr><tr><td>st_value</td><td>符号相对应的值, 这个值和符号有关, 可能是一个绝对值, 也可能是一个地址等; 不同的符号, 它所对应的值含义不同; 参考 –&gt;  符号值</td></tr><tr><td>st_size</td><td>符号大小, 对于包含数据的符号, 这个值是该数据类型的大小; 如果该值为 0, 则表示该符号大小为 0 或者未知;</td></tr><tr><td>st_info</td><td>符号类型和绑定信息</td></tr><tr><td>st_other</td><td>该成员目前是 0,没用</td></tr><tr><td>st_shndx</td><td>符号所在的段, 参考 –&gt;  符号所在段</td></tr></tbody></table><h4 id="st-info-符号类型和绑定信息"><a href="#st-info-符号类型和绑定信息" class="headerlink" title="st_info 符号类型和绑定信息"></a>st_info 符号类型和绑定信息</h4><p>该成员低 4 位表示符号的类型(Symbol Type), 高 28 位表示符号绑定信息(Symbol Binding):</p><p>符号绑定信息表:</p><table><thead><tr><th>名称</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td>STB_LOCAL</td><td>0</td><td>局部符号, 对于目标文件的外部不可见</td></tr><tr><td>STB_GLOBAL</td><td>1</td><td>全局符号, 外部可见</td></tr><tr><td>STB_WEAK</td><td>2</td><td>弱引用, 参考 –&gt;  弱符号和强符号</td></tr></tbody></table><p>符号类型表:</p><table><thead><tr><th>名称</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td>STT_NOTYPE</td><td>0</td><td>未知类型符号</td></tr><tr><td>STT_OBJECT</td><td>1</td><td>该符号是个数据对象, 比如变量, 数组等</td></tr><tr><td>STT_FUNC</td><td>2</td><td>该符号是个函数或者其他科执行代码</td></tr><tr><td>STT_SECTION</td><td>3</td><td>该符号表示一个段, 这种符号必须是 STB_LOCAL</td></tr><tr><td>STT_FILE</td><td>4</td><td>该符号表示文件名, 一般都是该目标文件所对应的源文件名; 它一定是 STB_LOCAL 类型的, 而且它的 st_shndx 一定是 SHN_ABS</td></tr></tbody></table><h4 id="st-shndx-符号所在段"><a href="#st-shndx-符号所在段" class="headerlink" title="st_shndx 符号所在段"></a>st_shndx 符号所在段</h4><p>如果符号定义在本目标文件中, 那么这个成员表示符号所在的段在段表中的下标; 如果符号不是定义在本目标文件中, 或者对于有些特殊符号, sh_shndx 的值有些特殊:</p><table><thead><tr><th>名称</th><th>值</th><th>含义</th></tr></thead><tbody><tr><td>SHN_ABS</td><td>0xfff1</td><td>该符号包含了一个绝对的值, 比如文件名符号就属于这种类型</td></tr><tr><td>SHN_COMMON</td><td>0xfff2</td><td>该符号是一个 COMMON 块类型的符号, 一般未初始化的全局符号定义就是这种类型的; 参考 –&gt;   COMMON 块</td></tr><tr><td>SHN_UNDEF</td><td>0</td><td>表示该符号未定义, 这个符号表示该符号在本目标文件被引用到, 但是定义在其他目标文件中;</td></tr></tbody></table><h4 id="st-value-符号值"><a href="#st-value-符号值" class="headerlink" title="st_value 符号值"></a>st_value 符号值</h4><p>每个符号都有对应的值, 如果这个符号是一个函数或者变量, 那么符号的值就是这个函数或者变量的地址; 但是这个地址需要分下面的情况区别对待:</p><ol><li> 在目标文件中, 如果是符号的定义且该符号不是 COMMON 块 (st_shndx 不是 SHN_COMMON), 则 st_value 表示该符号在段中的偏移; 也就是说符号所对应的函数或者变量位于由 st_shndx 指定的段, 偏移 st_value 的位置;</li><li> 在目标文件中, 如果符号是 COMMON 块, 即 st_shndx 为 SHN_COMMON 则 st_value 表示该符号的对齐属性;</li><li> 在可执行文件中, st_value 表示符号的虚拟地址; 这个虚拟地址对于动态链接器来说十分有用;</li></ol><p>使用 readelf 可以查看符号表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">Symbol table <span class="string">&#x27;.dynsym&#x27;</span> contains 119 entries:</span><br><span class="line">   Num:    Value  Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND</span><br><span class="line">     1: 00000000     0 OBJECT  GLOBAL DEFAULT  UND __stack[...]@LIBC (2)</span><br><span class="line">     2: 00000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_atexit@LIBC (2)</span><br><span class="line">     3: 00000000     0 FUNC    GLOBAL DEFAULT  UND strlen@LIBC (2)</span><br><span class="line">     4: 00000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_f[...]@LIBC (2)</span><br><span class="line">     5: 00000000     0 FUNC    GLOBAL DEFAULT  UND __stack[...]@LIBC (2)</span><br><span class="line">     6: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZN4test5TestBEv</span><br><span class="line">     7: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZNKSt6__ndk16lo[...]</span><br><span class="line">     8: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZNKSt6__ndk18io[...]</span><br><span class="line">     9: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZNSt11logic_err[...]</span><br><span class="line">    10: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZNSt12length_er[...]</span><br><span class="line">    11: 00000000     0 FUNC    GLOBAL DEFAULT  UND snprintf@LIBC (2)</span><br><span class="line">    12: 00000000     0 OBJECT  GLOBAL DEFAULT  UND _ZNSt6__ndk15cty[...]</span><br><span class="line">    13: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZNSt6__ndk16loc[...]</span><br><span class="line">    14: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZNSt6__ndk16loc[...]</span><br><span class="line">    15: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZNSt6__ndk18ios[...]</span><br><span class="line">    16: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZNSt6__ndk18ios[...]</span><br><span class="line">    17: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZNSt6__ndk18ios[...]</span><br><span class="line">    18: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZNSt6__ndk18ios[...]</span><br><span class="line">    19: 00000000     0 FUNC    GLOBAL DEFAULT  UND abort@LIBC (2)</span><br><span class="line">    20: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZSt18uncaught_e[...]</span><br><span class="line">    21: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZSt9terminatev</span><br><span class="line">    22: 00000000     0 OBJECT  GLOBAL DEFAULT  UND _ZTINSt6__ndk18i[...]</span><br><span class="line">    23: 00000000     0 OBJECT  GLOBAL DEFAULT  UND _ZTISt12length_error</span><br><span class="line">    24: 00000000     0 OBJECT  GLOBAL DEFAULT  UND _ZTVN10__cxxabiv[...]</span><br><span class="line">    25: 00000000     0 OBJECT  GLOBAL DEFAULT  UND _ZTVN10__cxxabiv[...]</span><br><span class="line">    26: 00000000     0 OBJECT  GLOBAL DEFAULT  UND _ZTVN10__cxxabiv[...]</span><br><span class="line">    27: 00000000     0 OBJECT  GLOBAL DEFAULT  UND __sF@LIBC (2)</span><br><span class="line">    28: 00000000     0 OBJECT  GLOBAL DEFAULT  UND _ZTVSt12length_error</span><br><span class="line">    29: 00000000     0 FUNC    GLOBAL DEFAULT  UND dladdr@LIBC (3)</span><br><span class="line">    30: 00000000     0 FUNC    GLOBAL DEFAULT  UND _ZdlPv</span><br><span class="line">    31: 00000000     0 FUNC    GLOBAL DEFAULT  UND fprintf@LIBC (2)</span><br><span class="line">    32: 00000000     0 FUNC    GLOBAL DEFAULT  UND _Znwj</span><br><span class="line">    33: 00000000     0 FUNC    GLOBAL DEFAULT  UND fflush@LIBC (2)</span><br><span class="line">    34: 00000000     0 FUNC    GLOBAL DEFAULT  UND __aeabi_memcpy</span><br><span class="line">    35: 00000000     0 FUNC    GLOBAL DEFAULT  UND __aeabi_memset</span><br><span class="line">    36: 00000000     0 FUNC    GLOBAL DEFAULT  UND __android_log_write</span><br><span class="line">    37: 00000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_allocate_e[...]</span><br><span class="line">    38: 00000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_begin_catch</span><br><span class="line">    39: 00000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_end_catch</span><br><span class="line">    40: 00000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_free_exception</span><br><span class="line">    41: 00000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_throw</span><br><span class="line">    42: 00000000     0 FUNC    GLOBAL DEFAULT  UND __gxx_personality_v0</span><br><span class="line">    43: 00000000     0 FUNC    GLOBAL DEFAULT  UND __aeabi_memclr</span><br><span class="line">    44: 00000000     0 FUNC    GLOBAL DEFAULT  UND __gnu_Unwind_Fin[...]</span><br><span class="line">    45: 00007c08    16 OBJECT  WEAK   DEFAULT   17 _ZTTNSt6__ndk119[...]</span><br><span class="line">    46: 00003319    12 FUNC    WEAK   DEFAULT   13 _ZTv0_n12_NSt6__[...]</span><br><span class="line">    47: 000062b6    50 OBJECT  WEAK   DEFAULT   16 _ZTSNSt6__ndk113[...]</span><br><span class="line">    48: 000034d9    88 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    49: 00003739    14 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    50: 00007cc4    64 OBJECT  WEAK   DEFAULT   17 _ZTVNSt6__ndk115[...]</span><br><span class="line">    51: 000062a0    22 OBJECT  WEAK   DEFAULT   16 _ZTSN6Zhenxi10Lo[...]</span><br><span class="line">    52: 000034d1     4 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    53: 00003709    32 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    54: 00007cb8    12 OBJECT  WEAK   DEFAULT   17 _ZTINSt6__ndk115[...]</span><br><span class="line">    55: 00003d03    92 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk113ba[...]</span><br><span class="line">    56: 00007c18    40 OBJECT  WEAK   DEFAULT   17 _ZTCNSt6__ndk119[...]</span><br><span class="line">    57: 00007c40    12 OBJECT  WEAK   DEFAULT   17 _ZTINSt6__ndk19b[...]</span><br><span class="line">    58: 00007bd8     8 OBJECT  WEAK   DEFAULT   17 _ZTIN6Zhenxi10Lo[...]</span><br><span class="line">    59: 000032d9    12 FUNC    WEAK   DEFAULT   13 _ZTv0_n12_NSt6__[...]</span><br><span class="line">    60: 00003085   128 FUNC    GLOBAL DEFAULT   13 JNI_OnLoad</span><br><span class="line">    61: 00003ad9    96 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk112ba[...]</span><br><span class="line">    62: 00003a91    72 FUNC    WEAK   DEFAULT   13 _ZNKSt6__ndk115b[...]</span><br><span class="line">    63: 00003391    40 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    64: 00003a07    28 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk119ba[...]</span><br><span class="line">    65: 000063a3    52 OBJECT  WEAK   DEFAULT   16 _ZTSNSt6__ndk115[...]</span><br><span class="line">    66: 00007c4c    24 OBJECT  WEAK   DEFAULT   17 _ZTINSt6__ndk113[...]</span><br><span class="line">    67: 00007cb0     8 OBJECT  WEAK   DEFAULT   17 _ZTINSt6__ndk115[...]</span><br><span class="line">    68: 0000355f    34 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    69: 00003a25   108 FUNC    WEAK   DEFAULT   13 _ZN6Zhenxi10LogM[...]</span><br><span class="line">    70: 00003d61   168 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk113ba[...]</span><br><span class="line">    71: 00003185    88 FUNC    GLOBAL DEFAULT   13 Java_com_kejian_[...]</span><br><span class="line">    72: 000031dd     4 FUNC    GLOBAL DEFAULT   13 Java_com_kejian_[...]</span><br><span class="line">    73: 00003149    60 FUNC    WEAK   DEFAULT   13 _ZN6Zhenxi10LogM[...]</span><br><span class="line">    74: 00003531    46 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    75: 00003bfd    40 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk113ba[...]</span><br><span class="line">    76: 00003581    76 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    77: 000032cb    14 FUNC    WEAK   DEFAULT   13 _ZTv0_n12_NSt6__[...]</span><br><span class="line">    78: 00007be0    40 OBJECT  WEAK   DEFAULT   17 _ZTVNSt6__ndk119[...]</span><br><span class="line">    79: 00003105    28 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk1lsIN[...]</span><br><span class="line">    80: 000033c9     2 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    81: 00003747    14 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    82: 00007c64    12 OBJECT  WEAK   DEFAULT   17 _ZTINSt6__ndk119[...]</span><br><span class="line">    83: 00003629   224 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    84: 00007bc8    16 OBJECT  WEAK   DEFAULT   17 _ZTVN6Zhenxi10Lo[...]</span><br><span class="line">    85: 00003b39   196 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk124__[...]</span><br><span class="line">    86: 00006315    73 OBJECT  WEAK   DEFAULT   16 _ZTSNSt6__ndk119[...]</span><br><span class="line">    87: 000032b5    22 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk113ba[...]</span><br><span class="line">    88: 00007c70    64 OBJECT  WEAK   DEFAULT   17 _ZTVNSt6__ndk115[...]</span><br><span class="line">    89: 00003729    16 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    90: 000033cd   236 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    91: 00003e21    82 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk112ba[...]</span><br><span class="line">    92: 000033cb     2 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    93: 00003797    18 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk111ch[...]</span><br><span class="line">    94: 000039f5    18 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk111ch[...]</span><br><span class="line">    95: 00003831   168 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk112ba[...]</span><br><span class="line">    96: 00003755     6 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    97: 000062e8    45 OBJECT  WEAK   DEFAULT   16 _ZTSNSt6__ndk19b[...]</span><br><span class="line">    98: 0000375b     6 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">    99: 000033b9    16 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">   100: 00003309    16 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk119ba[...]</span><br><span class="line">   101: 00003781    22 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk112ba[...]</span><br><span class="line">   102: 00003349    48 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">   103: 00008004     0 NOTYPE  GLOBAL DEFAULT  ABS _edata</span><br><span class="line">   104: 00003325    12 FUNC    WEAK   DEFAULT   13 _ZTv0_n12_NSt6__[...]</span><br><span class="line">   105: 000035cd    92 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">   106: 000032a5    16 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk113ba[...]</span><br><span class="line">   107: 00008005     0 NOTYPE  GLOBAL DEFAULT  ABS _end</span><br><span class="line">   108: 00003121    40 FUNC    WEAK   DEFAULT   13 _ZN6Zhenxi10LogM[...]</span><br><span class="line">   109: 00003245    16 FUNC    WEAK   DEFAULT   13 _ZN6Zhenxi10LogM[...]</span><br><span class="line">   110: 0000393d    36 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk112ba[...]</span><br><span class="line">   111: 0000635e    69 OBJECT  WEAK   DEFAULT   16 _ZTSNSt6__ndk115[...]</span><br><span class="line">   112: 000037a9   104 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk112ba[...]</span><br><span class="line">   113: 000038d9    16 FUNC    WEAK   DEFAULT   13 _ZNKSt6__ndk121_[...]</span><br><span class="line">   114: 000032e5    36 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk119ba[...]</span><br><span class="line">   115: 00003961   120 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk112ba[...]</span><br><span class="line">   116: 00008004     0 NOTYPE  GLOBAL DEFAULT  ABS __bss_start</span><br><span class="line">   117: 00003761     6 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br><span class="line">   118: 000034d5     4 FUNC    WEAK   DEFAULT   13 _ZNSt6__ndk115ba[...]</span><br></pre></td></tr></table></figure><p>第一列 num 表示符号表数组的下标; 第二列 value 就是符号值, 即 st_value; 第三列 Size 表示符号大小, 即 st_size; 第四列和第五列分别为符号类型和绑定信息, 即 st_info 的低 4 位和高 28 位;第六列 Vis 目前没用; 第七列 Ndx 就是 st_shndx, 表示符号所属的段; 最后一列是符号名称, 即 st_name;</p><h3 id="特殊符号"><a href="#特殊符号" class="headerlink" title="特殊符号"></a>特殊符号</h3><p>使用 ld 作为链接器来链接生产科执行文件时, 它会为我们定义很多特殊的符号, 这些符号我们可以直接声明并使用, 我们称这些链接器产生的符号为特殊符号;</p><ul><li>  <code>__executable_start</code>: 该符号是程序起始地址, 不是入口地址, 是程序最开始的地址</li><li>  <code>__etext</code>或者<code>_etext</code>或者<code>etext</code>: 该符号是代码段结束地址, 也就是代码段最末尾地址</li><li>  <code>_edata</code>或者<code>edata</code>: 该符号是数据段结束地址, 即数据段最末尾的地址</li><li>  <code>_end</code>或<code>end</code>: 该符号位程序结束地址</li></ul><h3 id="符号改编和函数签名"><a href="#符号改编和函数签名" class="headerlink" title="符号改编和函数签名"></a>符号改编和函数签名</h3><p>函数签名, 包含了一个函数的信息, 包括函数名, 它的参数类型, 它所在的类和名称空间及其他信息; 函数签名用于识别不同的函数; 函数的名字只是函数签名的一部分, 同名函数因为参数类型不同, 所在的类不同, 名称空间不同等都会产生不同的函数签名; </p><p>在编译器和链接器处理符号时, 会使用符号改编 (name mangline) 对函数和变量进行改编, 形成符号名; 也就是说 C++的源代码编译后的目标文件中所使用的符号名是相应的函数和变量经过修饰之后的名称;</p><p>可以使用 <code>c++filt -n 修饰后的符号名</code>来还原原始的函数名或者变量名;</p><h3 id="extern-“C”"><a href="#extern-“C”" class="headerlink" title="extern “C”"></a>extern “C”</h3><p>C++为了和 C 兼容, 在符号管理上, C++有一个用来声明或定义一个 C 的符号的<code> extern &quot;C&quot;</code>关键字用法</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="keyword">int</span> var;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>C++编译器会将在<code>extern &quot;C&quot;</code>的大括号内的代码当做 C 语言的代码处理; 所以此时 C++的符号改编机制就不会起作用;</p><p>我们可以通过 C++的宏<code> __cplusplus</code>来判断当前编译单元是不是 C++代码;</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cpluscplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> *<span class="built_in">memset</span> &#123;<span class="keyword">void</span> *, <span class="keyword">int</span>, <span class="keyword">size_t</span>&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>如果当前编译单元是 C++代码, 那么 memset 会在 <code>extern &quot;C&quot;</code>里面被声明; 如果是 C 代码, 则直接声明;</p><h3 id="弱符号和强符号"><a href="#弱符号和强符号" class="headerlink" title="弱符号和强符号"></a>弱符号和强符号</h3><p>符号重复定义: 多个目标文件中含有相同名字全局符号的定义, 这些目标文件链接的时候将会出现符号重复定义的错误; 比如: 目标文件 A 和目标文件 B 都定义了一个全局整型变量 global, 并将它们都初始化了, 那么链接器将 A 和 B 进行链接的时候会报错;</p><p>在 C/C++中默认函数和初始化了的全局变量为强符号, 未初始化的全局变量为弱符号; 可以通过<code>__attribute__((weak))</code>来将任何一个强符号转化为弱符号; 这里的强符号和弱符号是针对定义来说的, 不是针对符号的引用;</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> ext; <span class="comment">// 外部变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> weak; <span class="comment">// 未初始化全局变量</span></span><br><span class="line"><span class="keyword">int</span> strong = <span class="number">1</span>; <span class="comment">// 初始化全局变量</span></span><br><span class="line"></span><br><span class="line">__attribute__((weak)) weak2 = <span class="number">2</span>; <span class="comment">// weak2 转弱符号</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>  weak 和 weak2 是弱符号</li><li>  strong 和 main 是强符号</li><li>  ext 不是强符号也不是弱符号, 是一个外部变量的引用</li></ul><p>全局符号处理规则:</p><ol><li> 不允许强符号被多次定义(不同的文件中不能有同名的强符号); 如果有多个强符号定义, 则链接器报符号重复定义错误</li><li> 如果一个符号在某个目标文件中是强符号, 在其他文件中都是弱符号, 那么选择强符号</li><li> 如果一个符号在所有目标文件中都是弱符号, 那么选择其中占用空间最大的一个; 比如目标文件 A 定义全局变量 global 为 int 型, 占 4 个字节; 目标文件 B 定义 global 为 double 型, 占 8 个字节; 那么目标 A 文件和目标 B 文件链接后, 符号 global 占 8 字节;</li></ol><h3 id="弱引用和强引用"><a href="#弱引用和强引用" class="headerlink" title="弱引用和强引用"></a>弱引用和强引用</h3><p>如果没有找到该符号的定义, 链接器就会报未定义错误, 这种被称为强引用; 与之相应的还有一种弱引用, 在处理弱引用时, 如果该符号有定义, 则链接器将该符号的引用决议; 如果该符号未被定义, 则链接器对于该引用不会报错; </p><p>在 GCC 中, 我们可以通过<code>__attribute__((weakref))</code>这个扩展关键字来声明对一个外部函数的引用为弱引用; 比如:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__attribute__((weakref)) <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    foo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将上面代码编译成一个可执行文件, GCC 并不会报链接错误; 但是运行这个可执行文件, 会发生运行错误; 因为 main 函数调用 foo 函数时, foo 函数的地址为 0,于是发生了非法地址访问的错误; 可以改为:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__attribute__((weakref)) <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (foo) foo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这种弱符号和弱引用对于库来说十分有用, 比如库中定义的弱符号可以被用户定义的强符号所覆盖, 从而使得程序可以使用自定义版本的库函数; 或者程序可以对某些扩展功能模块的引用定义为弱引用; 当我们将扩展模块与程序链接起来时, 功能模块就可以正常使用了, 如果我们去掉了某些功能模块, 那么程序也可以正常链接, 只是缺少了相应的功能; 这使得程序的功能更加容易裁剪和组合;</p><h3 id="调试信息"><a href="#调试信息" class="headerlink" title="调试信息"></a>调试信息</h3><p>目标文件里面还有可能保存的是调试信息; 几乎所有现代的编译器都支持源代码级别的调试, 比如我们可以在函数里面设置断点, 可以监视变量变化, 可以单步等; </p><p>在 GCC 编译时加上-g 参数, 编译器就会在产生的目标文件里面加上调试信息. 通过 readelf 可以查看到目标文件中增加了很多 debug 相关的段;</p><p>  现在的 ELF 文件采用 DWARF 的标准的调试信息格式; 在 Linux 下, 可以使用 strip 命令来去掉 ELF 文件中的调试信息;</p><p><code> strip foo</code></p><h2 id="静态链接"><a href="#静态链接" class="headerlink" title="静态链接"></a>静态链接</h2><p>有两个目标文件, 如何将它们链接起来形成一个可执行文件, 这就是链接的核心内容: 静态链接;</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.c</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> shared;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">100</span>;</span><br><span class="line">    swap( &amp;a, &amp;shared );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// b.c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> shared = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>* a, <span class="keyword">int</span>* b)</span></span>&#123;</span><br><span class="line">    *a ^= *b ^= *a ^= *b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>假设程序只有两个模块 a.c 和 b.c; 使用 gcc 将 a.c 和 b.c 分别编译成目标文件 a.o 和 b.o; <code>gcc -c a.c b.c</code></p><p>经过编译获得了 a.o 和 b.o 两个目标文件, b.c 中一共定义了两个全局符号, 一个是全局变量 shared, 和一个函数 swap; a.c 里面定义了一个全局符号就是 main; 模块 a.c 里面引用了 b.c 里面的 swap 和 shared; 接下来就是将两个目标文件链接在一起形成一个可执行文件 ab;</p><h3 id="空间与地址分配"><a href="#空间与地址分配" class="headerlink" title="空间与地址分配"></a>空间与地址分配</h3><p>对于链接器来说, 整个链接过程中, 它就是将几个输入目标文件加工后合并成一个输出文件; 在这个案例中, 输入文件就是 a.o 和 b.o;输出就是可执行文件 ab; 可执行文件的代码段和数据段都是由输入的目标文件合并而来的, 这就产生了问题: 对于多个输入的目标文件, 链接器如何将它们的各个段合并到输出文件中? 或者说, 输出文件中的空间是如何分配给输入文件的?</p><h4 id="按序叠加"><a href="#按序叠加" class="headerlink" title="按序叠加"></a>按序叠加</h4><p>最简单的方案就是按序叠加, 将输入的目标文件依照次序叠加起来;</p><p>但是这样会产生问题, 在有多个输入文件的情况下, 输出文件会产生多个零散的段; 比如一个稍大的应用程序可能会有数百个目标文件, 如果每个目标文件都分别有.text 段和.data 段和.bss 段, 最后输出文件将会有很多个零散的段; 这种做法很浪费空间, 因为每个段都必须要有一定的地址和空间对齐要求, 比如对于 x86 硬件来说, 段的装载地址和空间的对齐单位是页, 也就是 4096 字节, 那么就是说如果一个段的长度只有 1 个字节, 它也要在内存中占用 4096 字节; 这样会造成空间浪费;</p><h4 id="相似段合并"><a href="#相似段合并" class="headerlink" title="相似段合并"></a>相似段合并</h4><p>更实际的做法是将相同性质的段合并到一起, 比如将所有输入文件的.text 合并到输出文件的.text 段; 将所有输入文件的.data 段, .bss 段全部合并到输出文件的.data 段和.bss 段中; </p><p>.bss 段在前面说了, 在目标文件和可执行文件中都不占用文件的空间, 但是它在装载的时候占用地址空间, 所以链接器在合并各个段的同时, 也将.bss 段合并, 并且分配了虚拟空间; </p><h4 id="空间和地址"><a href="#空间和地址" class="headerlink" title="空间和地址"></a>空间和地址</h4><p>空间和地址有两个含义:</p><ol><li> 第一个是输出的可执行文件的空间</li><li> 第二个是在装载后的虚拟地址中的虚拟地址空间</li></ol><p>对于有实际数据的段, 比如 .text 和 .data 来说, 他们在文件中和在虚拟地址中都要分配空间, 因为它们在这两者中都存在; 而对于.bss 这样的段来说, 分配空间的意义只局限于虚拟地址空间, 因为它在文件中并没有内容; 事实上, 我们在这里谈的空间只关注于虚拟地址空间的分配, 因为这个关系到链接器后面关于地址计算的步骤, 而可执行文件本身的空间分配与链接过程关系并不大;</p><p>现在链接器空间分配策略都是采用相似段合并的方式, 并且都使用两步链接的方法:</p><ol><li>空间与地址分配<ol><li> 扫描所有输入目标文件, 并且获得他们的各个段的长度, 属性和位置</li><li> 将输入文件中的符号表中的所有符号定义和符号引用都收集起来, 统一放到一个全局符号表中</li><li> 将输入文件的所有段合并, 并计算出申诉出文件中各个段合并后的长度和位置, 建立映射关系</li></ol></li><li>符号解析和重定位<ol><li> 从第一步获取到输入文件中端的数据, 重定位信息, 并且进行符号解析与重定位, 调整代码中的地址等;</li><li> 符号解析和重定位是链接过程的核心</li></ol></li></ol><p>使用 ld 将 a.o 和 b.o 链接起来:  <code>ld a.o b.o -e main -o ab</code>; -e main 表示将 main 作为程序的入口, ld 链接器默认的程序入口为_start; -o ab 表示链接输入文件名为 ab, 默认为 a.out;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-20-053440.png"></p><p>VMA Virtual Memory Address 表示虚拟地址, LMA 表示 Load Memory Address, 即加载地址, 正常情况下这两个值应该是一样的, 但是在有些嵌入式系统中, 特别是那些程序放在 ROM 的系统中时, LMA 和 VMA 是不相同的; 这里只需要关注 VMA 即可;</p><h4 id="符号地址的确定"><a href="#符号地址的确定" class="headerlink" title="符号地址的确定"></a>符号地址的确定</h4><p>在第一步的扫描和空间分配阶段, 链接器按照前面介绍的空间分配方法进行分配, 这时候输入文件中的各个段在链接后的虚拟地址就已经确定了; 比如.text 段起始地址是: 0x08048094; .data 段的起始地址为 0x0849108;</p><p>当前面一步完成之后, 链接器开始计算各个符号的虚拟地址; 因为各个符号在段内的相对位置是固定的, 所以这个时候其实 main, shared 和 swap 的地址就已经确定了; 只不过链接器要给每个符号加上一个偏移量, 让它们能够调整到正确的虚拟地址; 比如假设 a.o 中的 main 函数相对于 a.o 的 .text段的偏移是 X;通过 objdump 看到 main 方法在 a.o 中.text 段的最开始, 但是经过链接合并之后, 所以 main 这个符号在最终的输出文件中的地址为 0x08048094 + 0; 通过这样的方法可以获取到所有符号的地址;</p><h3 id="符号解析与重定位"><a href="#符号解析与重定位" class="headerlink" title="符号解析与重定位"></a>符号解析与重定位</h3><h4 id="重定位"><a href="#重定位" class="headerlink" title="重定位"></a>重定位</h4><p>在完成了空间和地址分配之后, 链接器就进入了符号解析与重定位的步骤, 这也是静态链接的核心内容; 在分析符号解析和重定位之前, 看一下原始的 a.o 中是如何处理这两个外部符号 shared 变量和 swap 函数的:</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-20-060631.png"></p><ul><li>  程序的代码里面使用的都是虚拟地址, 这里 main 的起始地址时 0x00000000; 因为在未进行前面提到的空间分配之前, 目标文件代码中的起始地址以 0x00000000 开始, 等到空间分配完成之后, 各个函数才会确定自己在虚拟空间中的位置;</li><li>  在 a.c 的源代码被编译成目标文件时, 编译器并不知道 shared 和 swap 的地址, 因为它们定义在其他目标文件中, 所以编译器就暂时把地址 0 看做是 shared 的地址; 0xFFFFFFFC也是一个临时的假地址, 用作 swap 的临时地址, 因为编译器不知道 swap 的真正地址;</li><li>  编译器把这两条指令的地址部分暂时用地址 0x00000000 和 0xFFFFFFFC 代替, 把真正的地址计算工作留给了链接器; 通过前面的空间和地址分配, 链接器完成地址和空间分配之后, 就可以知道所有符号的虚拟地址了, 那么链接器就可以根据符号的地址对每个需要重定位的指令进行修正; </li></ul><p>看一下 ab 代码中, main 函数中的两个需要重定位的入口已经被修正: shared 和 swap 都已经获得了真实地址;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-20-061650.png"></p><h4 id="重定位表-1"><a href="#重定位表-1" class="headerlink" title="重定位表"></a>重定位表</h4><p>链接器如何知道哪些指令是需要被调整的? 事实上在 ELF 文件中, 有一个叫重定位表的结构专门用来保存这些与重定位相关的信息; 对于重定位的 ELF 的文件来说, 它必须包含有重定位表, 用来表述如何修改相应的段里的内容; 每一个需要被重定位的 ELF 段都有一个对应的重定位表, 而一个重定位表往往就是 ELF 文件中的一个段, 所以其实重定位表也可以叫做重定位段; 比如代码段 .text 如果要被重定位, 那么会有一个相应的 .rel.text 的段保留了代码段的重定位表;如果代码段.data 有要被重定位的地方, 会有一个相应的 .rel.data 的段保存数据段的重定位表; </p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-20-062648.png"></p><p>使用 <code>objdump -r </code>可以查看重定位表, 可以看到 a.o 中所有引用了外部符号的地址; 每一个要被重定位的地方叫做重定位入口; a.o 中有两个需要被重定位的重定位入口, 重定位入口的 OFFSET 偏移表示该入口在要被重定位的段中的位置; RELOCATION RECORDS FOR [.text] 表示这个重定位表示代码段的重定位表; 所以偏移表示代码段中需要被调整的位置, 对照前面反汇编的结构, 0x1c 和 0x27 分别就是 mov 指令和 call 指令的地址部分;</p><p>重定位表的结构也很简单, 是一个 Elf32_Rel 结构的数组, 每个数组元素对应一个重定位入口, 定义如下:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Elf32_Addr r_offset;</span><br><span class="line">    Elf32_Word r_info;</span><br><span class="line">&#125;Elf32_Rel;</span><br></pre></td></tr></table></figure><ol><li> r_offset: 重定位入口的偏移, 对于可重定位文件来说, 这个值就是重定位入口所要修正的位置的第一个字节相对于段起始的偏移; 对于可执行文件或者共享对象文件来说, 这个值就是该重定位入口所要修正的位置的第一个字节的虚拟地址;</li><li> r_info: 重定位入口的类型和符号, 这个成员的低 8 位表示重定位入口的类型, 高 24 位表示重定位入口的符号在符号表中的下标;</li></ol><h4 id="符号解析"><a href="#符号解析" class="headerlink" title="符号解析"></a>符号解析</h4><p>链接是因为我们目标文件中用到的符号被定义在其他目标文件里, 所以要将它们链接进来; 其实在前面重定向的过程中, 也伴随着符号的解析过程; 重定位的过程中, 每个重定位的入口都是对一个符号的引用; 当链接器需要对某个符号的引用进行重定位时, 它就要确定这个符号的目标地址; 这个时候链接器就会去查找由所有输入文件符号表组成的全局符号表, 找到相应的符号后进行重定位;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-20-065935.png"></p><ul><li>  Global 类型的符号除了 main 是定义在代码段中的, 其他两个 shared 和 swap 都是 UND, 即 undefind 未定义类型;</li><li>  这种未定义的符号都是因为该目标文件中有关于它们的重定位项;</li><li>  在链接器扫描完所有的输入目标文件后, 所有这些未定义的符号都应该能够在全局符号表中找到, 否则链接器就会报未定义错误;</li></ul><h3 id="COMMON-块"><a href="#COMMON-块" class="headerlink" title="COMMON 块"></a>COMMON 块</h3><p>链接器本身不支持符号的类型, 即变量类型对于链接器来说是透明的, 它只知道一个符号的名字, 并不知道类型是否一致; 以下分三种情况讨论类型不一致的的时候链接器如何处理:</p><ol><li> 两个或两个以上的强符号类型不一致 –&gt;  直接报错, 符号多重定义错误</li><li> 有一个强符号, 其他都是弱符号, 出现类型不一致 –&gt;  以强符号所占空间为准</li><li> 两个或者两个以上的弱符号类型不一致 –&gt;  以输入文件中占用空间最大的那个为准</li></ol><p>使用 COMMON 块的方法是一种取巧的行为, 因为编译器和链接器允许不同类型的弱符号存在, 但最本质的原因还是链接器不支持符号类型, 即链接器无法判断各个符号的类型是否一致;</p><p>编译器为什么使用 COMMON块来标记弱符号, 而不是将弱符号当做局部变量在.bss 段中分配空间来处理?</p><ol><li> 编译器不能确定弱符号最终的大小; 因为如果编译器包含了弱符号(未初始化的全局变量就是典型的弱符号). 那么该符号最终占用的空间大小此时还是未知的, 有可能其他编译单元中该符号所占用的空间比本编译单元该符号所占用空间要大, 所以此时编译器并不能为该弱符号在.bss 段中分配空间;</li><li> 链接器在链接过程中可以确定弱符号的大小, 因为当链接器读取所有输入目标文件后, 任何一个弱符号的最终大小都可以确定, 所以它可以在最终输出文件的 BSS 段为其分配空间</li><li> 总体来看, 未初始化全局变量最终还是被放在 bss 段中, 只是是由链接器将其放入 bss 段的;</li></ol><p>开发人员可以通过 <code>__attribute__((nocommon));</code>扩展来让未初始化的全局变量不以 COMMON 块的形式处理</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> global __attribute__((nocommon));</span><br></pre></td></tr></table></figure><p>一旦一个未初始化的全局变量是不以 COMMON 块的形式存在的, 那么它就相当于一个强符号, 如果其他目标文件中还有一个同名的强符号定义, 那么链接时就会发成符号重复定义错误; </p><h2 id="可执行文件的装载与进程"><a href="#可执行文件的装载与进程" class="headerlink" title="可执行文件的装载与进程"></a>可执行文件的装载与进程</h2><ol><li> 什么是进程的虚拟地址空间?</li><li> 为什么进程要有自己独立的虚拟地址空间?</li><li> 装载的几种方式?</li><li> 虚拟地址空间分布情况, 代码块, 数据段, bss 段, 堆,栈分别在进程地址空间中怎么分布, 它们的位置和长度如何决定?</li></ol><h3 id="进程虚拟空间地址"><a href="#进程虚拟空间地址" class="headerlink" title="进程虚拟空间地址"></a>进程虚拟空间地址</h3><p>每个程序运行起来以后, 它都将拥有自己独立的虚拟地址空间, 这个虚拟地址空间的大小由计算机的硬件平台决定, 具体说就是由 CPU 的位数决定; 硬件决定了地址空间的最大理论上限, 即硬件的寻址空间大小; 比如 32 位的硬件平台决定了虚拟地址空间的地址为 0 ~ 2^32-1, 也就是0x0000 0000 ~ 0xFFFF FFFF, 也就是常说的 4G 虚拟空间大小; 而 64 位的硬件平台具有64 位寻址能力, 它的虚拟地址空间达到了 2^64 字节, 也就是 0x0000000000000000~0xFFFFFFFFFFFFFFFF, 总共是 17179869184GB;</p><p>一般来说, 我们可以通过 C 语言指针大小的位数来判断虚拟空间的大小, C 语言指针大小的位数与虚拟空间的位数相同, 如 32 位平台下面指针为 32 位, 即 4 个字节; 64 位平台下的指针为 64 位, 即 8 个字节;</p><p>32 位下, 程序在运行的时候不是完全使用4GB虚拟地址空间, 4GB 虚拟地址空间被划分成两部分, 其中操作系统本身要用去一部分, 从地址 0xC0000000到 0xFFFFFFFF 共1GB; 剩下的从 0x00000000 到 0xBFFFFFFF 共 3GB 的空间留给进程使用; </p><p>从原则上说我们的进程最多可以使用3GB 的虚拟地址空间, 但是并不是进程只能使用 3GB 的空间, 这个空间如果理解成虚拟地址空间的话, 那么 32 位的 cpu 只能使用 32 位的指针, 最大寻址范围是 0 到 4GB; 如果这个空间理解成计算机的内存空间, 那么其实可以使用更大的空间, 因为像 intel 从1995 年开始就采用了 36 位的物理地址, 也就是可以访问 64GB 的物理内存; intel 在扩展了 36 位地址线之后, 修改了页映射方式, 使得新的映射方式可以访问到更多的物理内存, 这种地址扩展方式被叫做 PAE;</p><h3 id="装载的方式"><a href="#装载的方式" class="headerlink" title="装载的方式"></a>装载的方式</h3><p>静态装载: 将程序运行所需要的指令和数据全部都装入内存中, 这样程序就可以顺利运行了; 但是很多情况下, 程序所需要的内存是远大于物理内存的数量的, 所以静态装入的方式现在很少使用;</p><p>动态装载: 覆盖装入和页映射是两种很典型的动态装载方式, 动态装载的思想就是程序要用到哪个模块, 就将哪个模块装入内存, 如果暂时不用, 就不装入内存, 存放在磁盘中;</p><h4 id="覆盖装入"><a href="#覆盖装入" class="headerlink" title="覆盖装入"></a>覆盖装入</h4><p>在没有发明虚拟存储之前应用广泛, 现在几乎被淘汰了; </p><p>覆盖装入的方法将挖掘内存潜力的任务交给了程序员, 程序员在编写程序的时候必须手动将程序划分成若干个块, 然后编写一个小的辅助代码来管理这些模块应该何时驻留在内存何时被替换掉; 这个小的辅助代码就是覆盖管理器; 最简单的案例, 一个主程序 main, main 会分别调用模块 A 和模块 B; 但是 A 和 B 之间不会相互调用, 那么我们可以用覆盖装入, 让模块 A 和模块 B 在内存中相互覆盖, 即这两个模块共享块内存区域; 当 main 调用模块 A 的时候, 覆盖管理器保证将模块 A从文件中读入内存, 当 main 调用模块 B 时, 则覆盖管理器将 B 从文件中读入内存, 因为此时 A 不再使用, 所以 B 会装入原先 A 所占用的内存空间;</p><h4 id="页映射"><a href="#页映射" class="headerlink" title="页映射"></a>页映射</h4><p>页映射是虚拟存储机制的一部分, 它随着虚拟存储的发明而诞生; 与覆盖装入的原理相似, 页映射也不是一下子就把程序的所有数据和指令都装入内存, 而是将内存和所有磁盘中的数据和指令按照页 Page 为单位划分成若干个页; 以后所有的装载和操作的单位都是页; 以目前的情况, 硬件规定的页大小都是 4096 字节, 8192 字节, 2MB 和 4MB 等; </p><p>为了演示页映射的基本机制, 假设我们的 32 位机器有 16KB 的内存, 每个页大小为 4096 字节, 则一共有 4 个页;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-21-021059.png"></p><p>假设所有的指令和数据总和有 32KB, 那么程序总共被分为 8 个页, 我们给他们编号为 P0-P7; 内存 16KB, 程序总共 32KB, 所以无法同时将 32KB 的程序装入内存, 我们将按照动态装入的原理来进行整个装入过程; </p><ul><li>  如果程序刚开始执行的入口在页 P0 中, 此时装载管理器发现程序 P0 不在内存中, 于是将内存 F0 分配给 P0, 将 P0 内容装入 F0; </li><li>  运行一段时间后, 程序发现需要使用 P5, 于是装载器将 P5 装入 F1, </li><li>  当程序用到 P3 和 P6 的时候, 它们分别被装入 F2 和 F3;</li></ul><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-21-021608.png"></p><p>当要使用到新的程序页的时候, 就需要使用内存页来加载这个新的程序页; 比如如果现在要使用到 P4, 则必须放弃内存页中原有的内容来装载 P4; 我们可以依据先进先出的原则, 放弃 F0 原有的内容, 用 F0 来加载 P4; 也可以根据最少使用算法 LUR, 发现哪个使用的较少, 可以将对应的内存页释放来加载 P4;</p><h3 id="从操作系统角度看可执行文件的装载"><a href="#从操作系统角度看可执行文件的装载" class="headerlink" title="从操作系统角度看可执行文件的装载"></a>从操作系统角度看可执行文件的装载</h3><p> 从上面的页映射的动态装入的方式可以看出, 可执行文件中的页可能被装入内存中的任意页; 在虚拟存储中, 现代硬件的 MMU 都提供了地址转换的功能, 有了硬件的地址转换和页映射机制, 操作系统动态加载可执行文件的方式和静态加载有了很大的区别;</p><h4 id="进程的建立"><a href="#进程的建立" class="headerlink" title="进程的建立"></a>进程的建立</h4><p>从操作系统的角度来看, 一个进程最关键的特征是它拥有独立的虚拟地址空间, 这让它有别于其他进程; 创建一个进程, 然后装载相应的可执行文件并且执行在有虚拟存储的情况下, 最开始只要做三件事:</p><ol><li> 创建一个独立的虚拟地址空间</li><li> 读取可执行文件头, 并且建立虚拟空间与可执行文件的映射关系</li><li> 将 CPU 的指令寄存器设置为客户自行文件的入口地址, 启动运行</li></ol><p>首先是创建虚拟地址空间; 虚拟地址空间由一组页映射函数将虚拟空间的各个页映射至相应的物理空间, 所以建立虚拟空间实际上并不是创建空间空间, 而是创建映射函数所需要的相应的数据结构; Linux 下创建虚拟地址空间实际上只是分配了一个页目录 Page Directory就可以了, 甚至都不需要设置页映射关系, 这些映射关系等到后面程序发生页错误的时候再设置;</p><p>读取可执行文件头, 并且建立虚拟空间与可执行文件的映射关系: 上一步的页映射关系函数是对虚拟空间到物理内存的映射关系; 而这一步所做的是虚拟空间和可执行文件的映射关系; 当程序发生页错误的时候, 操作系统将从物理内存里面分配一个物理页, 然后将该缺页从磁盘中读取到内存中, 再设置缺页的虚拟页和物理页的映射关系; 当操作系统捕获到缺页错误时, 它应当知道程序当前所需要的页在可执行文件中的哪个位置, 这就是虚拟空间和可执行文件之间的映射关系; </p><p>将 CPU 指令寄存器设置成可执行文件入口, 启动运行; 操作系统通过设置 CPU 的指令寄存器将控制权交给进程, 由此进程开始执行; 从进程的角度来看就是操作系统执行了一个跳转指令, 直接跳转到可执行文件的入口地址; 这个地址就是 ELF文件头中保存的入口地址;</p><h4 id="页错误"><a href="#页错误" class="headerlink" title="页错误"></a>页错误</h4><p>上面的步骤执行完成后, 其实可执行文件的真正指令和数据都没有被装入内存中; 操作系统只是通过可执行文件头部的信息建立起可执行文件和进程虚拟空间之间的映射关系;</p><p>假设上面的例子, 程序的入口地址是 0x08048000,即刚好是.text 段的起始地址, 当 CPU 开始打算执行这个地址的指令时, 发现页面 0x08048000~08049000 是一个空页面, 于是它就认为这个是一个页错误; CPU将控制权交给操作系统, 操作系统通过前面我们装载过程中提到的第二步建立的虚拟空间页和 ELF 文件映射的数据结构, 查询出空页面所在的 VMA 虚拟内存区域(virtual memory areas), 计算出相应的页面在可执行文件中的偏移, 然后再物理内存中分配一个物理页面, 将进程中该虚拟页与分配的物理页之间建立映射关系, 然后把控制权交给进程, 进程从刚才页错误的位置重新开始执行;</p><p>随着进程的执行, 页错误会不断产生, 操作系统也会为进程分配相应的物理页面来满足进程执行的需求;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-21-033123.png"></p><h3 id="进程虚拟空间分布"><a href="#进程虚拟空间分布" class="headerlink" title="进程虚拟空间分布"></a>进程虚拟空间分布</h3><h4 id="ELF-文件链接视图和执行视图"><a href="#ELF-文件链接视图和执行视图" class="headerlink" title="ELF 文件链接视图和执行视图"></a>ELF 文件链接视图和执行视图</h4><p>ELF 文件被映射的时候, 是以系统的页长度作为单位的, 那么每个段在映射时的长度应该是系统页长度的整数倍; 如果不是, 那么多余部分也会占用一个一个页; 一般的 ELF 文件都有十几个段, 那么内存空间就会产生大量的浪费; </p><p>操作系统一般只关心一些和装载相关的问题, 最重要的就是段的权限, 可读,可写,可执行; ELF 文件中, 段的权限往往只有为数不多的几种组合, 基本上是三种: </p><ol><li> 以代码段为代表的权限为可读可执行的段</li><li> 以数据段和 bss 段为代表的权限为可读可写的段</li><li> 以只读数据段为代表的权限为只读的段</li></ol><p>对于相同权限的段, 把它们合并到一起当做一个段进行映射; 比如有两个段分别为 .text 和 .init, 他们分别是程序的可执行代码和初始化代码, 并且它们的权限相同, 都是可读并且可执行的; 假设.text 为 4097 字节, .init 为 512 字节, 这两个段分别映射的话就要占用三个页面; 但是如果将它们合并成一起映射的话, 就只要占据两个页面;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-21-060209.png"></p><p>ELF 可执行文件引入了一个概念叫做 Segment; 一个 Segment 包含一个或者多个属性类似的 Section; 如果将.text 段和.init 段合并在一起看做是一个 Segment 的话, 那么装载的时候会将它们看做是一个整体一起映射, 也就是说映射以后在进程虚拟空间只有一个相对应的 VMA, 而不是两个, 这样做的好处是可以很明显减少页面内部碎片, 从而减少内存空间;</p><p>从链接的角度来看, ELF 文件是按 Section 存储的, 从装载的角度来看, ELF 文件又可以按照 Segment 划分;</p><p>Segment 的概念实际上是从装载的角度重新划分了 ELF 的各个段, 在将目标文件链接成可执行文件的时候, 链接器会尽量把相同权限属性的段分配在同一空间; 比如可读可执行的段都放在一起,典型的是代码段; 可读可写的段都放在一起, 典型的是数据段; ELF 把这些属性相似的有连在一起的段叫做 Segment, 而系统正是按照 Segment 而不是 Section 来映射可执行文件的;</p><p>使用 <code>readelf -l &lt;soPath&gt;</code> 可以查看 ELF 的 Segment; </p><p>使用 <code>readelf -S &lt;soPath&gt;</code>可以查看 ELF 的 Section;</p><p>描述 Section 属性的结构叫做段表, 描述 Segment 的结构叫做程序头 (Program Header), 它描述了 ELF 文件该如何被操作系统映射到进程的虚拟空间;</p><p>总体来说, Segment 和 Section 是从不同的角度来划分同一个 ELF 文件; 这个在 ELF 中被称为不同的视图 View; 从 Section的角度来看 ELF 文件就是链接视图 (Linking View); 从 Segment 的角度来看就是执行视图 (Execution View); 当在 ELF 装载过程中, 段专门指 Segment, 在其他情况下, 段指的是 Section;</p><p>ELF 可执行文件中有一个专门的数据结构叫做程序头表, 用来保存 Segment 的信息; 因为 ELF 目标文件不需要被装载, 所以它没有程序头表; 而 ELF 的可执行文件和共享库文件都有, 和段表结构一样, 程序头表也是一个结构体数组, 结构如下:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    ELF32_Word p_type;</span><br><span class="line">    ELF32_Off p_offset;</span><br><span class="line">    ELF32_Addr p_vaddr;</span><br><span class="line">    ELF32_Addr p_paddr;</span><br><span class="line">    ELF32_Word p_filesz;</span><br><span class="line">    ELF32_Word p_memsz;</span><br><span class="line">    ELF32_Word p_flags;</span><br><span class="line">    ELF32_Word p_align;</span><br><span class="line">&#125;Elf32_Phdr;</span><br></pre></td></tr></table></figure><table><thead><tr><th>成员</th><th>含义</th></tr></thead><tbody><tr><td>p_type</td><td>Segment 的类型, 基本上我们这里只关注 Load 类型的 Segment; Load 类型的常量为 1; 还有几种诸如 Dynamic 和 Interp 在动态链接的时候会碰到</td></tr><tr><td>p_offset</td><td>Segment 在文件中的偏移</td></tr><tr><td>p_vaddr</td><td>Segment 的第一个字节在进程虚拟地址空间中的起始位置; 整个程序头表中, 所有 Load 类型的元素按照 p_vaddr 从小到大排序</td></tr><tr><td>p_paddr</td><td>Segment 的物理装载地址, 一般情况下物理装载地址就是 LMA, p_paddr 的值在一般情况下和 p_vaddr 是一样的;</td></tr><tr><td>p_filesz</td><td>Segment 在 ELF 文件中所占空间的长度, 它的值可能是 0; 因为有可能这个 Segment 在 ELF 文件中不存在</td></tr><tr><td>p_memse</td><td>Segment 在进程虚拟地址空间所占用的长度, 它的值可能是 0;</td></tr><tr><td>p_flags</td><td>Segment 的权限属性, 比如可读 R, 可写 W 和可执行 X</td></tr><tr><td>p_align</td><td>Segment 的对齐属性, 实际对齐字节等于 2的 p_align 次; 比如 p_align 等于 10, 那么实际的对齐对齐属性就是 2 的 10 次方;</td></tr></tbody></table><p>对于 Load 类型的Segment 来说, p_memsz 的值不可以小于 p_filesz, 否则就是不符合常理的; 如果 p_memsz 的值大于 p_filesz 就表示该 Segment 在内存中所分配的空间大小超过文件实际的大小, 这部分多余的部分会全部填充为 0; 这样做的好处就是, 我们在构造 ELF 可执行文件时, 不需要额外再设立 bss 的 Segment 了, 可以把数据 Segment 的 p_memsz 扩大, 这些额外的部分就是 BSS; </p><p>数据段和 bss 的唯一区别就是, 数据段从文件中初始化内容, 而 bss 段的内容全部初始化为 0, 这也就是我们在前面例子中只看到两个 Load 类型的段, 而不是三个, bss 已经合并到数据类型的段里面;</p><h4 id="堆和栈"><a href="#堆和栈" class="headerlink" title="堆和栈"></a>堆和栈</h4><p>VMA 除了被用来映射可执行文件中的各个 Segment 以外, 它还可以有其他的作用, 操作系统通过 VMA 来对进程的地址空间进行管理; 进程在执行的时候它还需要用到堆和栈等空间; 事实上它们在进程的虚拟空间中的表现也是以 VMA 的形式存在的;很多情况下, 一个进程中的堆和栈分别都有一个对应的 VMA; 在 Linux 下, 我们可以通过查看 <code>/proc</code>来查看进程的虚拟空间分布;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-21-070315.png"></p><p>第一列是 VMA 的地址范围, 第二列是 VMA 的权限, r 表示可读, w 表示可写, x 表示可执行; p 表示私有, s 表示共享; 第三列是偏移, 表示 VMA 对应的 Segment 在映像文件中的偏移; 第四列表示映像文件所在设备的主设备号和次设备号, 第五列表示映像文件的节点号; 最后一列是映像文件的路径;</p><p>可以看到进程中有 5 个 VMA, 只有前两个是映射到可执行文件中的两个 Segment; 另外三个段的文件所在设备主设备号和次设备号及文件节点都是 0, 则表示它们没有映射到文件中, 这种 VMA 叫做匿名虚拟内存区域; Heap 和 Stack 它们大小分别为 140KB 和 88KB; 这两个 VMA 几乎在所有的进程中存在, 我们在 C 语言中最常用的 malloc() 内存分配函数就是从堆里面分配, 堆由系统库管理;</p><ul><li>  代码 VMA, 权限只读, 可执行, 有映像文件</li><li>  数据 VMA, 权限可读可写可执行, 有映像文件</li><li>  堆 VMA, 权限可读写, 可执行, 无映像文件, 匿名, 可以向上扩展</li><li>  栈 VMA, 权限可读写, 不可执行, 无映像文件, 匿名, 可向下扩展</li></ul><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-07-21-071820.png" style="zoom:50%;" /><h3 id="Linux-内核装载-ELF-过程简介"><a href="#Linux-内核装载-ELF-过程简介" class="headerlink" title="Linux 内核装载 ELF 过程简介"></a>Linux 内核装载 ELF 过程简介</h3><h2 id="动态链接"><a href="#动态链接" class="headerlink" title="动态链接"></a>动态链接</h2><h3 id="为什么要动态链接"><a href="#为什么要动态链接" class="headerlink" title="为什么要动态链接"></a>为什么要动态链接</h3><h3 id="简单的动态链接案例"><a href="#简单的动态链接案例" class="headerlink" title="简单的动态链接案例"></a>简单的动态链接案例</h3><h3 id="地址无关代码"><a href="#地址无关代码" class="headerlink" title="地址无关代码"></a>地址无关代码</h3><h3 id="延迟绑定"><a href="#延迟绑定" class="headerlink" title="延迟绑定"></a>延迟绑定</h3><h3 id="动态链接相关结构"><a href="#动态链接相关结构" class="headerlink" title="动态链接相关结构"></a>动态链接相关结构</h3><h3 id="动态链接的步骤和实现"><a href="#动态链接的步骤和实现" class="headerlink" title="动态链接的步骤和实现"></a>动态链接的步骤和实现</h3><h3 id="显示运行时链接"><a href="#显示运行时链接" class="headerlink" title="显示运行时链接"></a>显示运行时链接</h3><h2 id="Linux-共享库的组织"><a href="#Linux-共享库的组织" class="headerlink" title="Linux 共享库的组织"></a>Linux 共享库的组织</h2><h3 id="共享库版本"><a href="#共享库版本" class="headerlink" title="共享库版本"></a>共享库版本</h3><h3 id="符号版本"><a href="#符号版本" class="headerlink" title="符号版本"></a>符号版本</h3><h3 id="共享库系统路径"><a href="#共享库系统路径" class="headerlink" title="共享库系统路径"></a>共享库系统路径</h3><h3 id="共享库查找过程"><a href="#共享库查找过程" class="headerlink" title="共享库查找过程"></a>共享库查找过程</h3><h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><h3 id="共享库的创建和安装"><a href="#共享库的创建和安装" class="headerlink" title="共享库的创建和安装"></a>共享库的创建和安装</h3><h2 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h2><h3 id="程序的内存分布"><a href="#程序的内存分布" class="headerlink" title="程序的内存分布"></a>程序的内存分布</h3><h3 id="栈与调用惯例"><a href="#栈与调用惯例" class="headerlink" title="栈与调用惯例"></a>栈与调用惯例</h3><h3 id="堆与内存管理"><a href="#堆与内存管理" class="headerlink" title="堆与内存管理"></a>堆与内存管理</h3><h2 id="运行库"><a href="#运行库" class="headerlink" title="运行库"></a>运行库</h2><h3 id="入口函数与程序初始化"><a href="#入口函数与程序初始化" class="headerlink" title="入口函数与程序初始化"></a>入口函数与程序初始化</h3><h3 id="C-C-运行库"><a href="#C-C-运行库" class="headerlink" title="C/C++运行库"></a>C/C++运行库</h3><h3 id="运行库与多线程"><a href="#运行库与多线程" class="headerlink" title="运行库与多线程"></a>运行库与多线程</h3><h3 id="C-全局构造与析构"><a href="#C-全局构造与析构" class="headerlink" title="C++全局构造与析构"></a>C++全局构造与析构</h3><h3 id="fread-实现"><a href="#fread-实现" class="headerlink" title="fread 实现"></a>fread 实现</h3><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
      
      
      <categories>
          
          <category> so </category>
          
      </categories>
      
      
        <tags>
            
            <tag> so </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>unidbg</title>
      <link href="unidbg/"/>
      <url>unidbg/</url>
      
        <content type="html"><![CDATA[<h1 id="unidbg-基本框架"><a href="#unidbg-基本框架" class="headerlink" title="unidbg 基本框架"></a>unidbg 基本框架</h1><h2 id="unidbg-构建-ByteArray-对象"><a href="#unidbg-构建-ByteArray-对象" class="headerlink" title="unidbg 构建 ByteArray 对象"></a>unidbg 构建 ByteArray 对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入通用且标准的类库</span></span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.EmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.AbstractJni;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.AndroidEmulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.array.ByteArray;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">oasis</span> <span class="keyword">extends</span> <span class="title">AbstractJni</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造方法</span></span><br><span class="line">    oasis()&#123;</span><br><span class="line">        <span class="comment">// 创建模拟器实例, 进程名称建议依照时机进程名填写, 可以规避针对进程名的校验</span></span><br><span class="line">        emulator = AndroidEmulatorBuilder.for32Bit().setProcessName(<span class="string">&quot;com.sina.oasis&quot;</span>).build();</span><br><span class="line">        <span class="comment">// 获取模拟器的内存操作接口</span></span><br><span class="line">        <span class="keyword">final</span> Memory memory = emulator.getMemory();</span><br><span class="line">        <span class="comment">// 设置系统类库解析</span></span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> AndroidResolver(<span class="number">23</span>));</span><br><span class="line">        <span class="comment">// 创建 Android 虚拟机, 传入 apk, Unidbg 可以帮助我们做部分前面检验工作</span></span><br><span class="line">        vm = emulator.createDalvikVM(<span class="keyword">new</span> File(<span class="string">&quot;./unidbg-android/src/test/java/com/lession1/lvzhou.apk&quot;</span>));</span><br><span class="line">        <span class="comment">// 加载目标 so, true 表示是否自动调用 init_array 中方法</span></span><br><span class="line">        DalvikModule dm = vm.loadLibrary(<span class="keyword">new</span> File(<span class="string">&quot;./unidbg-android/src/test/java/com/lession1/liboasiscore.so&quot;</span>), <span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 获取加载的 so 模块的句柄</span></span><br><span class="line">        <span class="keyword">module</span> = dm.getModule();</span><br><span class="line">        <span class="comment">// 设置 jni</span></span><br><span class="line">        vm.setJni(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// 打印日志</span></span><br><span class="line">        vm.setVerbose(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 调用 JNI_Onload</span></span><br><span class="line">        dm.callJNI_OnLoad(emulator);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">invokeS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 构建参数</span></span><br><span class="line">        List&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(vm.getJNIEnv()); <span class="comment">// a1</span></span><br><span class="line">        list.add(<span class="number">0</span>); <span class="comment">// a2 jobject or jclass 一般用不到, 可以填 0</span></span><br><span class="line">        String input = <span class="string">&quot;aid=01A-khBWIm48A079Pz_DMW6PyZR8&quot;</span> +</span><br><span class="line">                <span class="string">&quot;uyTumcCNm4e8awxyC2ANU.&amp;cfrom=28B529501&quot;</span> +</span><br><span class="line">                <span class="string">&quot;0&amp;cuid=5999578300&amp;noncestr=46274W9279Hr1&quot;</span> +</span><br><span class="line">                <span class="string">&quot;X49A5X058z7ZVz024&amp;platform=ANDROID&amp;timestamp&quot;</span> +</span><br><span class="line">                <span class="string">&quot;=1621437643609&amp;ua=Xiaomi-MIX2S__oasis__3.5.8_&quot;</span> +</span><br><span class="line">                <span class="string">&quot;_Android__Android10&amp;version=3.5.8&amp;vid=10190135&quot;</span> +</span><br><span class="line">                <span class="string">&quot;94003&amp;wm=20004_90024&quot;</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] inputBytes = input.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">        ByteArray byteArray = <span class="keyword">new</span> ByteArray(vm,inputBytes);</span><br><span class="line">        list.add(vm.addLocalObject(byteArray));</span><br><span class="line">        list.add(<span class="number">0</span>); <span class="comment">// a4 boolean true 1 false 0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据地址进行函数调用</span></span><br><span class="line">        Number number = <span class="keyword">module</span>.callFunction(emulator, <span class="number">0xc365</span>, list.toArray())[<span class="number">0</span>];</span><br><span class="line">        String result = vm.getObject(number.intValue()).getValue().toString();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        oasis oasisObj = <span class="keyword">new</span> oasis();</span><br><span class="line">        String result = oasisObj.invokeS();</span><br><span class="line">        System.out.println(<span class="string">&quot;result: &quot;</span>+ result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="unidbg-构建参数"><a href="#unidbg-构建参数" class="headerlink" title="unidbg 构建参数"></a>unidbg 构建参数</h2><h2 id="unidbg-构建-String-对象"><a href="#unidbg-构建-String-对象" class="headerlink" title="unidbg 构建 String 对象"></a>unidbg 构建 String 对象</h2><h2 id="unidbg-构建-context-对象"><a href="#unidbg-构建-context-对象" class="headerlink" title="unidbg 构建 context 对象"></a>unidbg 构建 context 对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lesson2;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入通用且标准的类库</span></span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.AbstractJni;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.AndroidEmulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.pointer.UnidbgPointer;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.utils.Inspector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> keystone.Keystone;</span><br><span class="line"><span class="keyword">import</span> keystone.KeystoneArchitecture;</span><br><span class="line"><span class="keyword">import</span> keystone.KeystoneEncoded;</span><br><span class="line"><span class="keyword">import</span> keystone.KeystoneMode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">sina</span> <span class="keyword">extends</span> <span class="title">AbstractJni</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator androidEmulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DalvikModule dm;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line">    sina() &#123;</span><br><span class="line">        <span class="comment">// 创建模拟器实例</span></span><br><span class="line">        androidEmulator =  AndroidEmulatorBuilder.for32Bit().setProcessName(<span class="string">&quot;com.weico.international&quot;</span>).build();</span><br><span class="line">        <span class="comment">// 获取模拟器内存操作接口</span></span><br><span class="line">        <span class="keyword">final</span> Memory memory = androidEmulator.getMemory();</span><br><span class="line">        <span class="comment">// 设置系统类库解析</span></span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> AndroidResolver(<span class="number">23</span>));</span><br><span class="line">        <span class="comment">// 创建 Android 虚拟机, 传入 apk, Unidbg 可以替我们做部分签名校验</span></span><br><span class="line">        vm = androidEmulator.createDalvikVM(<span class="keyword">new</span> File(<span class="string">&quot;./LibAndApk/sinaInternational.apk&quot;</span>));</span><br><span class="line">        <span class="comment">// 加载目标 so</span></span><br><span class="line">        dm = vm.loadLibrary(<span class="keyword">new</span> File(<span class="string">&quot;./LibAndApk/libutility.so&quot;</span>), <span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 获取 so 模块的句柄, 后续需要使用</span></span><br><span class="line">        <span class="keyword">module</span> = dm.getModule();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置 JNI</span></span><br><span class="line">        vm.setJni(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// 设置日志</span></span><br><span class="line">        vm.setVerbose(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">calculateS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 构建参数 List</span></span><br><span class="line">        ArrayList&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">        list.add(vm.getJNIEnv()); <span class="comment">// 第一个参数 JNIEnv</span></span><br><span class="line">        list.add(<span class="number">0</span>); <span class="comment">// 第二个参数 jobject this 并未用到  传入 0</span></span><br><span class="line">        <span class="comment">// 第三个参数 context, 使用 vm.resolveClass 获取 java 层的类, className 使用类签名, newObject() 新建对象</span></span><br><span class="line">        DvmObject&lt;?&gt; context = vm.resolveClass(<span class="string">&quot;android/content/Context&quot;</span>).newObject(<span class="keyword">null</span>); <span class="comment">// context</span></span><br><span class="line">        <span class="comment">// 除了基本类型，比如 int，long 等，其他的对象类型一律要手动 addLocalObject。</span></span><br><span class="line">        list.add(vm.addLocalObject(context));</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> StringObject(vm,<span class="string">&quot;aa123&quot;</span>)));</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> StringObject(vm, <span class="string">&quot;CypCHG2kSlRkdvr2RG1QF8b2lCWXl7k7&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 主动调用 因为是 thumb 指令集, 需要地址+1</span></span><br><span class="line">        Number number = <span class="keyword">module</span>.callFunction(androidEmulator, <span class="number">0x1E7C</span> + <span class="number">1</span>, list.toArray())[<span class="number">0</span>];</span><br><span class="line">        String result = vm.getObject(number.intValue()).getValue().toString();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        sina test = <span class="keyword">new</span> sina();</span><br><span class="line">        test.calculateS();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="unidbg-添加-patch"><a href="#unidbg-添加-patch" class="headerlink" title="unidbg 添加 patch"></a>unidbg 添加 patch</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lesson2;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入通用且标准的类库</span></span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.AbstractJni;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.AndroidEmulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.pointer.UnidbgPointer;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.utils.Inspector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> keystone.Keystone;</span><br><span class="line"><span class="keyword">import</span> keystone.KeystoneArchitecture;</span><br><span class="line"><span class="keyword">import</span> keystone.KeystoneEncoded;</span><br><span class="line"><span class="keyword">import</span> keystone.KeystoneMode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">sina</span> <span class="keyword">extends</span> <span class="title">AbstractJni</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator androidEmulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DalvikModule dm;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line">    sina() &#123;</span><br><span class="line">        <span class="comment">// 创建模拟器实例</span></span><br><span class="line">        androidEmulator =  AndroidEmulatorBuilder.for32Bit().setProcessName(<span class="string">&quot;com.weico.international&quot;</span>).build();</span><br><span class="line">        <span class="comment">// 获取模拟器内存操作接口</span></span><br><span class="line">        <span class="keyword">final</span> Memory memory = androidEmulator.getMemory();</span><br><span class="line">        <span class="comment">// 设置系统类库解析</span></span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> AndroidResolver(<span class="number">23</span>));</span><br><span class="line">        <span class="comment">// 创建 Android 虚拟机, 传入 apk, Unidbg 可以替我们做部分签名校验</span></span><br><span class="line">        vm = androidEmulator.createDalvikVM(<span class="keyword">new</span> File(<span class="string">&quot;./LibAndApk/sinaInternational.apk&quot;</span>));</span><br><span class="line">        <span class="comment">// 加载目标 so</span></span><br><span class="line">        dm = vm.loadLibrary(<span class="keyword">new</span> File(<span class="string">&quot;./LibAndApk/libutility.so&quot;</span>), <span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 获取 so 模块的句柄, 后续需要使用</span></span><br><span class="line">        <span class="keyword">module</span> = dm.getModule();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置 JNI</span></span><br><span class="line">        vm.setJni(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// 设置日志</span></span><br><span class="line">        vm.setVerbose(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">calculateS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 构建参数 List</span></span><br><span class="line">        ArrayList&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">        list.add(vm.getJNIEnv()); <span class="comment">// 第一个参数 JNIEnv</span></span><br><span class="line">        list.add(<span class="number">0</span>); <span class="comment">// 第二个参数 jobject this 并未用到  传入 0</span></span><br><span class="line">        <span class="comment">// 第三个参数 context, 使用 vm.resolveClass 获取 java 层的类, className 使用类签名, newObject() 新建对象</span></span><br><span class="line">        DvmObject&lt;?&gt; context = vm.resolveClass(<span class="string">&quot;android/content/Context&quot;</span>).newObject(<span class="keyword">null</span>); <span class="comment">// context</span></span><br><span class="line">        <span class="comment">// 除了基本类型，比如 int，long 等，其他的对象类型一律要手动 addLocalObject。</span></span><br><span class="line">        list.add(vm.addLocalObject(context));</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> StringObject(vm,<span class="string">&quot;aa123&quot;</span>)));</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> StringObject(vm, <span class="string">&quot;CypCHG2kSlRkdvr2RG1QF8b2lCWXl7k7&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 主动调用 因为是 thumb 指令集, 需要地址+1</span></span><br><span class="line">        Number number = <span class="keyword">module</span>.callFunction(androidEmulator, <span class="number">0x1E7C</span> + <span class="number">1</span>, list.toArray())[<span class="number">0</span>];</span><br><span class="line">        String result = vm.getObject(number.intValue()).getValue().toString();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 手动打 patch</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">patch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 需要注意的是，这儿地址可别 + 1 了，Thumb 的 + 1 只在运行和 Hook 时需要考虑，打 Patch 可别想</span></span><br><span class="line">        <span class="keyword">int</span> patchCode = <span class="number">0x4FF00100</span>; <span class="comment">// mov r0, 1</span></span><br><span class="line">        <span class="comment">// 源代码: FF F7 EB FE  --&gt;  BL sub_1C60</span></span><br><span class="line">        androidEmulator.getMemory().pointer(<span class="keyword">module</span>.base + <span class="number">0x1E86</span>).setInt(<span class="number">0</span>, patchCode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态打 patch</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">patch1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        UnidbgPointer pointer = UnidbgPointer.pointer(androidEmulator, <span class="keyword">module</span>.base + <span class="number">0x1E86</span>);</span><br><span class="line">        <span class="keyword">assert</span> pointer != <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] code = pointer.getByteArray(<span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">if</span> (!Arrays.equals(code, <span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;(<span class="keyword">byte</span>) <span class="number">0xFF</span>, (<span class="keyword">byte</span>) <span class="number">0xF7</span>, (<span class="keyword">byte</span>) <span class="number">0xEB</span>, (<span class="keyword">byte</span>) <span class="number">0xFE</span>&#125;)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(Inspector.inspectString(code, <span class="string">&quot;patch32 code=&quot;</span> + Arrays.toString(code)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Keystone keystone = <span class="keyword">new</span> Keystone(KeystoneArchitecture.Arm, KeystoneMode.ArmThumb);</span><br><span class="line">            KeystoneEncoded assemble = keystone.assemble(<span class="string">&quot;mov r0, 1&quot;</span>);</span><br><span class="line">            <span class="keyword">byte</span>[] patch = assemble.getMachineCode();</span><br><span class="line">            <span class="keyword">if</span> (patch.length != code.length) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(Inspector.inspectString(patch, <span class="string">&quot;patch32 length=&quot;</span> + patch.length));</span><br><span class="line">            &#125;</span><br><span class="line">            pointer.write(<span class="number">0</span>, patch, <span class="number">0</span>, patch.length);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        sina test = <span class="keyword">new</span> sina();</span><br><span class="line">        test.patch();</span><br><span class="line">        test.patch1();</span><br><span class="line">        test.calculateS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> unidbg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> so </tag>
            
            <tag> unidbg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>程序是怎么跑起来的</title>
      <link href="computerhowtorun/"/>
      <url>computerhowtorun/</url>
      
        <content type="html"><![CDATA[<h1 id="cpu-是什么"><a href="#cpu-是什么" class="headerlink" title="cpu 是什么"></a>cpu 是什么</h1><ul><li>程序是什么<ul><li>  指示计算机每一步动作的一组指令</li><li>  可以理解成行事的先后顺序</li></ul></li><li>程序是由什么组成的<ul><li>  指令和数据组成</li><li>  程序是指令和数据的组合体, 例如, C 语言中<code>printf(&quot;你好&quot;);</code> 这个简单的程序中, <code>printf</code>是指令, <code>&quot;你好&quot;</code>是数据;</li></ul></li><li>什么是机器语言<ul><li>  cpu 可以识别和直接使用的语言</li><li>  cpu 能够直接识别和执行的只有机器语言, 使用 C, java等语言进行开发, 最后都会转化成机器语言;</li></ul></li><li>正在运行的程序存在什么位置<ul><li>  内存</li><li>  硬件和磁盘等媒介上保存的程序被复制到内存后才能运行;</li></ul></li><li>什么是内存地址<ul><li>  内存中, 用来表示命令和数据存储位置的数值就是地址</li><li>  内存中保存命令和数据的场所, 通过地址来标记和指定, 地址由整数值来表示;</li></ul></li><li>计算机的构成元件中, 负责程序的解释和运行的是哪个<ul><li>  cpu</li><li>  计算机的构成元件中, 根据程序的指令来进行数据运算, 并控制整个计算机的设备称作 cpu;</li></ul></li></ul><h2 id="cpu-结构和简单运行"><a href="#cpu-结构和简单运行" class="headerlink" title="cpu 结构和简单运行"></a>cpu 结构和简单运行</h2><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-28-050812.png"></p><p>cpu 内部由寄存器, 控制器, 运算器和时钟四个部分构成, 各个部分之间通过电流信号相互连通</p><ol><li> 寄存器: 可用来暂存指令, 数据等处理对象, 可以将其看做内存的一种; 根据种类的不同, 一个 cpu 内部会有 20-100 个寄存器;</li><li> 控制器: 负责把内存上的指令, 数据等读入寄存器, 并根据指令的执行结果来控制整个计算机; </li><li> 运算器: 运算器负责运算从内存读取到寄存器中的数据, </li><li> 时钟: 负责发出 cpu 开始计时的时钟信号; 不过有些 cpu 的时钟位于 cpu 外部;</li></ol><p>cpu 的简单运行:</p><ol><li> 程序启动后, 根据时钟信号, 控制器从内存中的读取指令和数据</li><li> 通过对这些指令和数据加以解释和运行, 运算器就会对数据进行运算</li><li> 控制器根据运算的结果来控制计算机; 这里的控制简单可以理解为数据运算之外的处理, 主要是数据的输入输出的时机控制, 比如内存和磁盘等媒介的输入输出, 键盘和鼠标的输入, 显示器和打印机的输出等, 这些都是控制的内容;</li></ol><h2 id="内存简介"><a href="#内存简介" class="headerlink" title="内存简介"></a>内存简介</h2><p>通常所说的内存指的是计算机的主存储器, 简称主存; 主存通过控制芯片等于 cpu 相连, 主要负责存储指令和数据; 主存由可读写的元素构成, 每个字节(1 字节=  8 位 )都带有一个地址编号; cpu 通过该地址读取主存中的指令和数据, 当然也可以写入数据;</p><h2 id="cpu-是寄存器的集合体"><a href="#cpu-是寄存器的集合体" class="headerlink" title="cpu 是寄存器的集合体"></a>cpu 是寄存器的集合体</h2><p>cpu 的四个构成部分中, 程序员只要了解寄存器即可, 其他三个不用太过于关注; 因为程序是把寄存器作为对象来描述的</p><p>内存的存储场所通过地址编号来区分, 而寄存器的种类则通过寄存器名称来区分;</p><p>寄存器中存储的内容可以是指令也可是是数据; 数据分为 <code>用于运算的数值</code> 和 <code>表示内存地址的数值</code> 两种;</p><p>寄存器的主要种类和功能:</p><table><thead><tr><th>种类</th><th>功能</th></tr></thead><tbody><tr><td>累加寄存器 (accumulator register)</td><td>存储执行运算的数据和运算后的数据</td></tr><tr><td>标志寄存器 (flag register)</td><td>存储运算处理后的 cpu 的状态</td></tr><tr><td>程序计数器 (program register)</td><td>存储下一条指令所在内存的地址</td></tr><tr><td>基址寄存器 (base register)</td><td>存储数据内存的起始地址</td></tr><tr><td>变址寄存器 (index register)</td><td>存储基址寄存器的相对地址</td></tr><tr><td>通用寄存器 (general purpose register)</td><td>存储任意数据</td></tr><tr><td>指令寄存器 (instruction register)</td><td>存储指令, cpu 内部使用, 程序员无法通过程序对该寄存器进行读写操作</td></tr><tr><td>栈寄存器 (stack register)</td><td>存储栈区域的起始地址</td></tr></tbody></table><h3 id="pc-程序计数器"><a href="#pc-程序计数器" class="headerlink" title="pc 程序计数器"></a>pc 程序计数器</h3><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-28-061038.png"></p><p>注: 为了方便演示, 把指令和数据分配到了一个地址中; 实际上, 一个命令和数据通常被存储在多个地址上;</p><ul><li>   地址 0100 是程序运行的开始位置, 操作系统将程序从硬盘复制到内存后, 会将程序计数器设定为 0100, 然后程序开始运行</li><li>  cpu 每执行一条指令, 程序计数器的值会自动增加一个指令的长度; 这里是+1, 当执行的指令占据多个内存地址时, 增加于指令长度相应的数值;</li><li>  cpu 的控制器会参照程序计数器的数值, 从内存中读取命令并执行, 也就是说, 程序计数器决定着程序的流程</li></ul><h3 id="条件分支和循环"><a href="#条件分支和循环" class="headerlink" title="条件分支和循环"></a>条件分支和循环</h3><p>程序的流程分为顺序执行, 条件分支和循环三种;</p><p>顺序执行是指按照地址内容的顺序执行指令</p><p>条件分支是指根据条件执行任意地址的指令</p><p>循环是指重复执行同一地址的指令</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-28-061755.png"></p><p>该案例是将存储在 0x0106地址的数值的绝对值显示打印到屏幕上的脚本;</p><ul><li>  程序运行的起始地址为0x0100</li><li>  当程序运行到 0x0102 时, 如果此时累加器的值是正数, 则执行跳转指令, jump 到 0x0140 地址; 如果不是, 则顺序执行 0x103 的指令;</li><li>  此时累加寄存器中的值为 123, 大于 0, 满足跳转的条件; ,跳转指令间接执行了将程序的 pc 计数器设定为 0x104 地址的操作</li></ul><h3 id="标志位寄存器"><a href="#标志位寄存器" class="headerlink" title="标志位寄存器"></a>标志位寄存器</h3><p>在上一个案例中, 我们提到了根据寄存器中的值是否大于 0 进行判断接下来的指令是否需要跳转; 无论当前累加寄存器的运算结构是负数, 零还是正数, 标志寄存器都会将其保存, 同时标志寄存器也负责存放溢出和奇偶校验的结果;</p><p>cpu 在进行运算时, 标志寄存器的数值会根据运算结果自动设定, 条件分支在跳转指令前会进行比较运算, 至于是否执行跳转指令, 则由 cpu 在参考标志寄存器的数值后进行判断; 运算结果的正负零三种状态由标志寄存器的三个位表示; 示例为 32 位 cpu (寄存器长度为 32 位)的标志寄存器; 标志寄存器的第一个字节位,第二个字节位,第三个字节位为 1 的时候, 表示运算结果分别为正数, 零和负数;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-28-063534.png"></p><h3 id="函数的调用机制"><a href="#函数的调用机制" class="headerlink" title="函数的调用机制"></a>函数的调用机制</h3><p>函数的调用是通过把程序的计数器的值设定为函数的存储地址来实现的; 函数的调用需要完成函数内部的处理后, 处理流程再返回到函数调用点的下一个地址, 所以如果只是修改 pc 指向函数起始的入口地址是不够的, 还需要考虑函数处理之后返回的问题;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-28-063823.png" alt="image-20210428143823237"></p><p>机器语言中使用 call 和 return 来解决函数调用的问题, 函数调用使用的是 call 指令, 而不是跳转指令, 在将函数的入口设定到程序计数器之前, call 指令会把调用函数后要执行的指令地址存储在栈中, 函数处理完毕后, 再通过函数的出口来执行 return 命令, return 命令的功能是把保存在栈中的地址设定到程序计数器中;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-28-064123.png"></p><h3 id="通过地址和索引实现数组"><a href="#通过地址和索引实现数组" class="headerlink" title="通过地址和索引实现数组"></a>通过地址和索引实现数组</h3><p>基址寄存器和变址寄存器, 通过这两个寄存器, 我们对内存上特定的区域进行划分, 从而实现类似于数组的操作;</p><p>如果用十六进制将计算机内存上 00000000-FFFFFFFF 的地址划分出来, 那么凡是该范围的内存区域, 只要有一个 32 位的寄存器, 就可以查看到全部的内存地址; 但如果想要像数组一样分割特定内存区域以达到连续查看的目的, 使用两个寄存器会更方便一些; 例如: 查看 10000000-1000FFFF 地址时, 可以将 10000000 作为基础地址存入基址寄存器, 并使变址寄存器在 00000000-0000FFFF 变化;</p><p>cpu 会将基址寄存器 + 变址寄存器的值解释为实际查看的内存地址;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-28-064727.png"></p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机基础 </tag>
            
            <tag> 程序是怎么跑起来的 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>携程机票</title>
      <link href="xiecheng/"/>
      <url>xiecheng/</url>
      
        <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inputStr = <span class="string">&quot;@BEIJING|北京(BJS)|1|BJS||@SHANGHAI|上海(SHA)|2|SHA||@TIANJIN|天津(TSN)|3|TSN||@CHONGQING|重庆(CKG)|4|CKG||@HAERBIN|哈尔滨(HRB)|5|HRB||@DALIAN|大连(DLC)|6|DLC||@QINGDAO|青岛(TAO)|7|TAO||@XIAN|西安(SIA)|10|SIA||@DUNHUANG|敦煌(DNH)|11|DNH||@NANJING|南京(NKG)|12|NKG||@WUXI|无锡(WUX)|13|WUX||@YANGZHOU|扬州(YTY)|15|YTY||@HANGZHOU|杭州(HGH)|17|HGH||@ZHOUSHAN|舟山(HSN)|19|HSN||@HUANGSHAN|黄山(TXN)|23|TXN||@JIUJIANG|九江(JIU)|24|JIU||@XIAMEN|厦门(XMN)|25|XMN||@WUYISHAN|武夷山(WUS)|26|WUS||@ZHANGJIAJIE|张家界(DYG)|27|DYG||@CHENGDU|成都(CTU)|28|CTU||@SHENZHEN|深圳(SZX)|30|SZX||@ZHUHAI|珠海(ZUH)|31|ZUH||@GUANGZHOU|广州(CAN)|32|CAN||@GUILIN|桂林(KWL)|33|KWL||@KUNMING|昆明(KMG)|34|KMG||@XISHUANGBANNA|西双版纳(JHG)|35|JHG||@DALI|大理市(DLU)|36|DLU||@LIJIANG|丽江(LJG)|37|LJG||@GUIYANG|贵阳(KWE)|38|KWE||@WULUMUQI|乌鲁木齐(URC)|39|URC||@LASA|拉萨(LXA)|41|LXA||@HAIKOU|海口(HAK)|42|HAK||@SANYA|三亚(SYX)|43|SYX||@NANTONG|南通(NTG)|82|NTG||@JIUZHAIGOU|九寨沟(JZH)|91|JZH||@RIKAZE|日喀则(RKZ)|92|RKZ||@DIQING|迪庆(DIG)|93|DIG||@ALI|阿里(NGQ)|97|NGQ||@YINCHUAN|银川(INC)|99|INC||@LANZHOU|兰州(LHW)|100|LHW||@HUHEHAOTE|呼和浩特(HET)|103|HET||@TAIYUAN|太原(TYN)|105|TYN||@LINZHI|林芝(LZY)|108|LZY||@KASHI|喀什市(KHG)|109|KHG||@YANAN|延安(ENY)|110|ENY||@XINING|西宁(XNN)|124|XNN||@HANZHONG|汉中(HZG)|129|HZG||@GEERMU|格尔木(GOQ)|132|GOQ||@DATONG|大同(DAT)|136|DAT||@CHANGZHI|长治(CIH)|137|CIH||@YUNCHENG|运城(YCU)|140|YCU||@BAOTOU|包头(BAV)|141|BAV||@HAILAER|海拉尔(HLD)|142|HLD||@JINAN|济南(TNA)|144|TNA||@QINHUANGDAO|秦皇岛(BPE)|147|BPE||@QIQIHAER|齐齐哈尔(NDG)|149|NDG||@MUDANJIANG|牡丹江(MDG)|150|MDG||@MOHE|漠河(OHE)|155|OHE||@JIXI|鸡西(JXA)|157|JXA||@CHANGCHUN|长春(CGQ)|158|CGQ||@JILIN|吉林(JIL)|159|JIL||@KELAMAYI|克拉玛依(KRY)|166|KRY||@ANKANG|安康(AKA)|171|AKA||@AKESU|阿克苏(AKU)|173|AKU||@ALETAI|阿勒泰(AAT)|175|AAT||@ANQING|安庆(AQG)|177|AQG||@ANSHAN|鞍山(AOG)|178|AOG||@ANSHUN|安顺(AVA)|179|AVA||@BEIHAI|北海(BHY)|189|BHY||@BAOSHAN|保山(BSD)|197|BSD||@CHANGBAISHAN|长白山(NBS)|199|NBS||@CHANGDE|常德(CGD)|201|CGD||@CHIFENG|赤峰(CIF)|202|CIF||@CHANGSHA|长沙(CSX)|206|CSX||@CHAOYANG|朝阳(CHG)|211|CHG||@CHANGZHOU|常州(CZX)|213|CZX||@DANDONG|丹东(DDG)|221|DDG||@DAQING|大庆(DQA)|231|DQA||@DAXIAN|达县(DAX)|234|DAX||@DONGYING|东营(DOY)|236|DOY||@ENSHI|恩施(ENH)|245|ENH||@FOSHAN|佛山(FUO)|251|FUO||@FUYANG|阜阳(FUG)|257|FUG||@FUZHOU|福州(FOC)|258|FOC||@GUANGYUAN|广元(GYS)|267|GYS||@GANZHOU|赣州(KOW)|268|KOW||@HANDAN|邯郸(HDG)|275|HDG||@HEFEI|合肥(HFE)|278|HFE||@HEIHE|黑河(HEK)|281|HEK||@HUAIHUA|怀化(HJJ)|282|HJJ||@HAMI|哈密市(HMI)|285|HMI||@HETIAN|和田市(HTN)|294|HTN||@HENGYANG|衡阳(HNY)|297|HNY||@HUIZHOU|惠州(HUZ)|299|HUZ||@JINGDEZHEN|景德镇(JDZ)|305|JDZ||@JINGGANGSHAN|井冈山(JGS)|307|JGS||@JIAMUSI|佳木斯(JMU)|317|JMU||@JINING|济宁(JNG)|318|JNG||@GUYUAN|固原(GYU)|321|GYU||@JIAYUGUAN|嘉峪关(JGN)|326|JGN||@JINZHOU|锦州(JNZ)|327|JNZ||@JINGZHOU|荆州(SHS)|328|SHS||@KUCHE|库车(KCA)|329|KCA||@KUERLE|库尔勒(KRL)|330|KRL||@LONGYAN|龙岩(LCX)|348|LCX||@LUOYANG|洛阳(LYA)|350|LYA||@LIANYUNGANG|连云港(LYG)|353|LYG||@LIUZHOU|柳州(LZH)|354|LZH||@LUZHOU|泸州(LZO)|355|LZO||@DEHONG|德宏(LUM)|365|LUM||@MIANYANG|绵阳(MIG)|370|MIG||@NINGBO|宁波(NGB)|375|NGB||@NANCHANG|南昌(KHN)|376|KHN||@NANCHONG|南充(NAO)|377|NAO||@NANNING|南宁(NNG)|380|NNG||@NANYANG|南阳(NNY)|385|NNY||@QIEMO|且末(IQM)|399|IQM||@QINGYANG|庆阳(IQN)|404|IQN||@QUZHOU|衢州(JUZ)|407|JUZ||@LIANGPING|梁平(LIA)|427|LIA||@SHIJIAZHUANG|石家庄(SJW)|428|SJW||@SHENYANG|沈阳(SHE)|451|SHE||@TACHENG|塔城(TCG)|455|TCG||@TONGLIAO|通辽(TGO)|458|TGO||@TIANSHUI|天水(THQ)|464|THQ||@TANGSHAN|唐山(TVS)|468|TVS||@WEIFANG|潍坊(WEF)|475|WEF||@WUHAN|武汉(WUH)|477|WUH||@WEIHAI|威海(WEH)|479|WEH||@WULANHAOTE|乌兰浩特(HLH)|484|HLH||@WANZHOU|万州(WXN)|487|WXN||@WENZHOU|温州(WNZ)|491|WNZ||@WUZHOU|梧州(WUZ)|492|WUZ||@XICHANG|西昌(XIC)|494|XIC||@XIANGYANG|襄阳(中国)(XFN)|496|XFN||@XILINHAOTE|锡林浩特(XIL)|500|XIL||@XUZHOU|徐州(XUZ)|512|XUZ||@YIBIN|宜宾(YBP)|514|YBP||@YICHANG|宜昌(YIH)|515|YIH||@YICHUN|伊春(LDS)|517|LDS||@YANJI|延吉(YNJ)|523|YNJ||@YULIN|榆林(UYN)|527|UYN||@YINING|伊宁市(YIN)|529|YIN||@YANTAI|烟台(YNT)|533|YNT||@YIWU|义乌(YIW)|536|YIW||@ZHANJIANG|湛江(ZHA)|547|ZHA||@ZHONGSHAN|中山(ZGN)|553|ZGN||@ZHAOTONG|昭通(ZAT)|555|ZAT||@ZHONGWEI|中卫(ZHY)|556|ZHY||@ZUNYI|遵义(ZYI)|558|ZYI||@ZHENGZHOU|郑州(CGO)|559|CGO||@LINYI|临沂(LYI)|569|LYI||@CHANGDU|昌都(BPX)|575|BPX||@HUAIAN|淮安(HIA)|577|HIA||@TAIZHOU|台州(HYN)|578|HYN||@LIUPANSHUI|六盘水(LPF)|605|LPF||@ZHANGYE|张掖(YZY)|663|YZY||@LINXI|林西(LXI)|744|LXI||@GUANGHUA|光化(LHK)|746|LHK||@GUANGHAN|广汉(GHN)|750|GHN||@JIEYANG|揭阳(SWA)|956|SWA||@JIEYANG|汕头(SWA)|956|SWA||@YONGZHOU|永州(LLF)|970|LLF||@MANZHOULI|满洲里(NZH)|1083|NZH||@PANZHIHUA|攀枝花(PZI)|1097|PZI||@WUHAI|乌海(WUA)|1133|WUA||@XINGYI|兴义(ACX)|1139|ACX||@BAISE|百色(AEB)|1140|AEB||@JIAGEDAQI|加格达奇(JGD)|1143|JGD||@JINCHANG|金昌(JIC)|1158|JIC||@YANCHENG|盐城(YNZ)|1200|YNZ||@TONGREN|铜仁市(TEN)|1227|TEN||@LINCANG|临沧(LNJ)|1236|LNJ||@WENSHAN|文山县(WNH)|1342|WNH||@AERSHAN|阿尔山(YIE)|1658|YIE||@LIBO|荔波(LLB)|1708|LLB||@JINJIANG|晋江(JJN)|1803|JJN||@JINJIANG|泉州(JJN)|1803|JJN||@JINJIANG|石狮(JJN)|1803|JJN||@TENGCHONG|腾冲(TCZ)|1819|TCZ||@BOLE|博乐(BPL)|2548|BPL||@MEIZHOU|梅州(MXZ)|3053|MXZ||@KANASI|喀纳斯(KJI)|3326|KJI||@NALATI|那拉提(NLT)|3360|NLT||@LIPING|黎平(HZH)|3852|HZH||@BAYANNAOER|巴彦淖尔(RLK)|3887|RLK||@EERDUOSI|鄂尔多斯(DSN)|3976|DSN||@PUER|普洱(SYM)|3996|SYM||@KANGDING|康定(KGT)|4130|KGT||@YUSHU|玉树县(YUS)|7582|YUS||@ELIANHAOTE|二连浩特(ERL)|7626|ERL||@QIANJIANG|黔江(JIQ)|7708|JIQ||@TULUFAN|吐鲁番(TLQ)|21811|TLQ||@MANGSHI|芒市(LUM)|3997|LUM||@&quot;</span></span><br><span class="line"></span><br><span class="line">cityList = re.findall(<span class="string">r&#x27;@.*?\|\|&#x27;</span>, inputStr)</span><br><span class="line">cityResult = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> cityList:</span><br><span class="line">    cityCode = each.split(<span class="string">&quot;|&quot;</span>)[-<span class="number">3</span>]</span><br><span class="line">    city = re.search(<span class="string">r&#x27;\|(.*?)\(&#x27;</span>,each).group(<span class="number">1</span>)</span><br><span class="line">    cityResult[cityCode] = city</span><br><span class="line"></span><br><span class="line">print(cityResult)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFlight</span>(<span class="params">transactionID</span>):</span></span><br><span class="line">    departureCityCode = <span class="string">&quot;NGB&quot;</span></span><br><span class="line">    arrivalCityCode = <span class="string">&quot;DLC&quot;</span></span><br><span class="line">    departureDate = <span class="string">&quot;2021-04-02&quot;</span></span><br><span class="line">    md = hashlib.md5()</span><br><span class="line">    md.update((transactionID + departureCityCode + arrivalCityCode + departureDate).encode())</span><br><span class="line">    sign = md.hexdigest()</span><br><span class="line">    print(<span class="string">&quot;sign&quot;</span>, sign)</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;authority&#x27;</span>: <span class="string">&#x27;flights.ctrip.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pragma&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;cache-control&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-ch-ua&#x27;</span>: <span class="string">&#x27;&quot;Google Chrome&quot;;v=&quot;89&quot;, &quot;Chromium&quot;;v=&quot;89&quot;, &quot;;Not A Brand&quot;;v=&quot;99&quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sign&#x27;</span>: sign,  <span class="comment"># md5（transactionID  +起始地三字码+降落的三字码+出发时间）</span></span><br><span class="line">        <span class="string">&#x27;sec-ch-ua-mobile&#x27;</span>: <span class="string">&#x27;?0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json;charset=UTF-8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;scope&#x27;</span>: <span class="string">&#x27;d&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;transactionid&#x27;</span>: transactionID,</span><br><span class="line">        <span class="string">&#x27;origin&#x27;</span>: <span class="string">&#x27;https://flights.ctrip.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-site&#x27;</span>: <span class="string">&#x27;same-origin&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-mode&#x27;</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-dest&#x27;</span>: <span class="string">&#x27;empty&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;referer&#x27;</span>: <span class="string">&#x27;https://flights.ctrip.com/international/search/oneway-ngb-dlc?depdate=2021-03-17&amp;cabin=Y_S_C_F&amp;containstax=1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;accept-language&#x27;</span>: <span class="string">&#x27;zh,zh-CN;q=0.9&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = (</span><br><span class="line">        (<span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;0.7611761915255784&#x27;</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;flightWayEnum&quot;</span>: <span class="string">&quot;OW&quot;</span>,</span><br><span class="line">        <span class="string">&quot;arrivalProvinceId&quot;</span>: <span class="number">7</span>,</span><br><span class="line">        <span class="string">&quot;extGlobalSwitches&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;useAllRecommendSwitch&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            <span class="string">&quot;unfoldPriceListSwitch&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;arrivalCountryName&quot;</span>: <span class="string">&quot;中国&quot;</span>,</span><br><span class="line">        <span class="string">&quot;infantCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;cabin&quot;</span>: <span class="string">&quot;Y_S_C_F&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cabinEnum&quot;</span>: <span class="string">&quot;Y_S_C_F&quot;</span>,</span><br><span class="line">        <span class="string">&quot;departCountryName&quot;</span>: <span class="string">&quot;中国&quot;</span>,</span><br><span class="line">        <span class="string">&quot;flightSegments&quot;</span>: [&#123;</span><br><span class="line">            <span class="string">&quot;departureDate&quot;</span>: departureDate,</span><br><span class="line">            <span class="string">&quot;arrivalProvinceId&quot;</span>: <span class="number">7</span>,</span><br><span class="line">            <span class="string">&quot;arrivalCountryName&quot;</span>: <span class="string">&quot;中国&quot;</span>,</span><br><span class="line">            <span class="string">&quot;arrivalCountryCode&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">            <span class="string">&quot;departureCityName&quot;</span>: <span class="string">&quot;宁波&quot;</span>,</span><br><span class="line">            <span class="string">&quot;departureCityCode&quot;</span>: departureCityCode,</span><br><span class="line">            <span class="string">&quot;departureCountryName&quot;</span>: <span class="string">&quot;中国&quot;</span>,</span><br><span class="line">            <span class="string">&quot;departureCountryCode&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">            <span class="string">&quot;arrivalCityName&quot;</span>: <span class="string">&quot;大连&quot;</span>,</span><br><span class="line">            <span class="string">&quot;arrivalCityCode&quot;</span>: arrivalCityCode,</span><br><span class="line">            <span class="string">&quot;departureCityTimeZone&quot;</span>: <span class="number">480</span>,</span><br><span class="line">            <span class="string">&quot;arrivalCountryId&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;timeZone&quot;</span>: <span class="number">480</span>,</span><br><span class="line">            <span class="string">&quot;departureCityId&quot;</span>: <span class="number">375</span>,</span><br><span class="line">            <span class="string">&quot;departureCountryId&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;arrivalCityTimeZone&quot;</span>: <span class="number">480</span>,</span><br><span class="line">            <span class="string">&quot;departureProvinceId&quot;</span>: <span class="number">16</span>,</span><br><span class="line">            <span class="string">&quot;arrivalCityId&quot;</span>: <span class="number">6</span></span><br><span class="line">        &#125;],</span><br><span class="line">        <span class="string">&quot;childCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;segmentNo&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;scope&quot;</span>: <span class="string">&quot;d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;adultCount&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;extensionAttributes&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;LoggingSampling&quot;</span>: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">            <span class="string">&quot;isFlightIntlNewUser&quot;</span>: <span class="string">&quot;false&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;transactionID&quot;</span>: transactionID,</span><br><span class="line">        <span class="string">&quot;directFlight&quot;</span>: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">        <span class="string">&quot;departureCityId&quot;</span>: <span class="number">375</span>,</span><br><span class="line">        <span class="string">&quot;isMultiplePassengerType&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;noRecommend&quot;</span>: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">        <span class="string">&quot;army&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;flightWay&quot;</span>: <span class="string">&quot;S&quot;</span>,</span><br><span class="line">        <span class="string">&quot;arrivalCityId&quot;</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="string">&quot;departProvinceId&quot;</span>: <span class="number">16</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = json.dumps(data)</span><br><span class="line"></span><br><span class="line">    response = requests.post(<span class="string">&#x27;https://flights.ctrip.com/international/search/api/search/batchSearch&#x27;</span>, headers=headers,</span><br><span class="line">                             params=params, data=data)</span><br><span class="line">    print(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getTransctionID</span>():</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;authority&#x27;</span>: <span class="string">&#x27;flights.ctrip.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pragma&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;cache-control&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;upgrade-insecure-requests&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-site&#x27;</span>: <span class="string">&#x27;same-origin&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-mode&#x27;</span>: <span class="string">&#x27;navigate&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-user&#x27;</span>: <span class="string">&#x27;?1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-dest&#x27;</span>: <span class="string">&#x27;document&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-ch-ua&#x27;</span>: <span class="string">&#x27;&quot;Google Chrome&quot;;v=&quot;89&quot;, &quot;Chromium&quot;;v=&quot;89&quot;, &quot;;Not A Brand&quot;;v=&quot;99&quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-ch-ua-mobile&#x27;</span>: <span class="string">&#x27;?0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;referer&#x27;</span>: <span class="string">&#x27;https://flights.ctrip.com/international/search/domestic?allianceid=4899&amp;sid=155997&amp;utm_medium=google&amp;utm_campaign=pp&amp;utm_source=googleppc&amp;gclid=Cj0KCQjw0caCBhCIARIsAGAfuMyq6upHCSOwQk_8QuJYNH03rdjpRFmASxulJApDlLImIriKQf3kO3IaArHCEALw_wcB&amp;gclsrc=aw.ds&amp;keywordid=2642337343-70570537617&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;accept-language&#x27;</span>: <span class="string">&#x27;zh,zh-CN;q=0.9&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = (</span><br><span class="line">        (<span class="string">&#x27;depdate&#x27;</span>, <span class="string">&#x27;2021-03-18&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;cabin&#x27;</span>, <span class="string">&#x27;Y_S_C_F&#x27;</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    response = requests.get(<span class="string">&#x27;https://flights.ctrip.com/international/search/oneway-ngb-bjs&#x27;</span>, headers=headers,</span><br><span class="line">                            params=params)</span><br><span class="line">    transactionID = re.search(<span class="string">r&#x27;&quot;transactionID&quot;:&quot;(.*?)&quot;&#x27;</span>,response.text).group(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> transactionID</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    transactionID = getTransctionID()</span><br><span class="line">    getFlight(transactionID)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> demo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> demo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微店</title>
      <link href="weidian/"/>
      <url>weidian/</url>
      
        <content type="html"><![CDATA[<ul><li>  微店搜索接口</li><li>  微店店铺所有商品</li><li>  微店商品详情页</li><li>  微店店铺信息</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> Padding</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params"><span class="built_in">input</span></span>):</span></span><br><span class="line">    key = <span class="string">&quot;6cec4a8b268b8749dfa0bd409effcd08&quot;</span></span><br><span class="line">    data = gzip.compress(<span class="built_in">input</span>.encode())</span><br><span class="line">    data = Padding.pad(data, AES.block_size, <span class="string">&#x27;pkcs7&#x27;</span>)</span><br><span class="line">    aes = AES.new(<span class="built_in">bytes</span>.fromhex(key), AES.MODE_ECB)</span><br><span class="line">    <span class="keyword">return</span> b64encode(aes.encrypt(data)).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">content</span>):</span></span><br><span class="line">    key = <span class="string">&quot;6cec4a8b268b8749dfa0bd409effcd08&quot;</span></span><br><span class="line">    aes = AES.new(<span class="built_in">bytes</span>.fromhex(key), AES.MODE_ECB)</span><br><span class="line">    data = Padding.unpad(aes.decrypt(content), AES.block_size, <span class="string">&#x27;pkcs7&#x27;</span>)</span><br><span class="line">    print(data.decode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">data</span>):</span></span><br><span class="line">    salt = <span class="string">&quot;2a7d5d1d3c0a4df08bfbacd58fb0748d&quot;</span></span><br><span class="line">    ori = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">sorted</span>(data):</span><br><span class="line">        ori += i + <span class="string">&quot;=&quot;</span> + data[i] + <span class="string">&quot;&amp;&quot;</span></span><br><span class="line">    ori += salt</span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(ori.encode())</span><br><span class="line">    sign_ = md5.hexdigest().upper()</span><br><span class="line"></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update((sign_ + salt).encode())</span><br><span class="line">    sign = md5.hexdigest().upper()</span><br><span class="line">    <span class="keyword">return</span> sign</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关键词搜索</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSkuList</span>(<span class="params">city, keyword, page</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param city: 地区筛选</span></span><br><span class="line"><span class="string">    :param keyword: 关键词</span></span><br><span class="line"><span class="string">    :param page: 翻页</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;thor.weidian.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;x-schema&#x27;</span>: <span class="string">&#x27;https&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;referrer&#x27;</span>: <span class="string">&#x27;https://android.weidian.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;origin&#x27;</span>: <span class="string">&#x27;android.weidian.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;x-origin&#x27;</span>: <span class="string">&#x27;thor&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;x-encrypt&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Android/8.1.0 WDAPP(WDBuyer/5.7.0) Thor/2.1.3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded; charset=utf-8&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    params = <span class="string">&quot;&#123;\&quot;area\&quot;:\&quot;\&quot;,\&quot;brands\&quot;:[],\&quot;chosePoints\&quot;:\&quot;\&quot;,\&quot;chosePrices\&quot;:\&quot;\&quot;,\&quot;city\&quot;:\&quot;&quot;</span> + city + <span class="string">&quot;\&quot;,\&quot;coreWord\&quot;:\&quot;\&quot;,\&quot;footprintId\&quot;:\&quot;5c30df6b68a1e62a097a6b793dd9cd27_1617017322405\&quot;,\&quot;id\&quot;:\&quot;&quot;</span> + keyword + <span class="string">&quot;\&quot;,\&quot;increServices\&quot;:[],\&quot;keyword\&quot;:\&quot;&quot;</span> + keyword + <span class="string">&quot;\&quot;,\&quot;limit\&quot;:16,\&quot;page\&quot;:&quot;</span> + page + <span class="string">&quot;,\&quot;source\&quot;:\&quot;1\&quot;,\&quot;tab\&quot;:\&quot;all\&quot;,\&quot;tags\&quot;:[],\&quot;wdServices\&quot;:[]&#125;&quot;</span></span><br><span class="line">    params_encode = encode(params)</span><br><span class="line">    context = <span class="string">&quot;&#123;\&quot;alt\&quot;:\&quot;0.0\&quot;,\&quot;android_id\&quot;:\&quot;2b2081ba28d67929\&quot;,\&quot;app_status\&quot;:\&quot;active\&quot;,\&quot;appid\&quot;:\&quot;com.koudai.weidian.buyer\&quot;,\&quot;appv\&quot;:\&quot;5.7.0\&quot;,\&quot;brand\&quot;:\&quot;google\&quot;,\&quot;build\&quot;:\&quot;20190821162153\&quot;,\&quot;channel\&quot;:\&quot;1013n\&quot;,\&quot;cuid\&quot;:\&quot;5c30df6b68a1e62a097a6b793dd9cd21\&quot;,\&quot;disk_capacity\&quot;:\&quot;19.40GB/25.01GB\&quot;,\&quot;feature\&quot;:\&quot;E|F,H|F,P|F,R|T\&quot;,\&quot;h\&quot;:\&quot;2392\&quot;,\&quot;iccid\&quot;:\&quot;89860320045744719592\&quot;,\&quot;imei\&quot;:\&quot;86798102045247\&quot;,\&quot;imsi\&quot;:\&quot;460115169646890\&quot;,\&quot;is_login\&quot;:\&quot;0\&quot;,\&quot;lat\&quot;:\&quot;29.887301\&quot;,\&quot;lon\&quot;:\&quot;121.63812\&quot;,\&quot;mac\&quot;:\&quot;AC:CF:85:B7:39:B9\&quot;,\&quot;machine_model\&quot;:\&quot;armv8l\&quot;,\&quot;memory\&quot;:\&quot;1095M/2799M\&quot;,\&quot;mid\&quot;:\&quot;Nexus_6P\&quot;,\&quot;mobile_station\&quot;:\&quot;0\&quot;,\&quot;net_subtype\&quot;:\&quot;0_\&quot;,\&quot;network\&quot;:\&quot;WIFI\&quot;,\&quot;os\&quot;:\&quot;27\&quot;,\&quot;platform\&quot;:\&quot;android\&quot;,\&quot;serial_num\&quot;:\&quot;ENU7N15A19011383\&quot;,\&quot;suid\&quot;:\&quot;5c30df6b68a1e62a097a6b793dd9cd29\&quot;,\&quot;w\&quot;:\&quot;1440\&quot;,\&quot;wmac\&quot;:\&quot;80:ea:07:96:22:e2\&quot;,\&quot;wssid\&quot;:\&quot;\\\&quot;阿里巴巴\\\&quot;\&quot;&#125;&quot;</span></span><br><span class="line">    context_encode = encode(context)</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;param&quot;</span>: params_encode,</span><br><span class="line">        <span class="string">&quot;v&quot;</span>: <span class="string">&quot;2.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;context&quot;</span>: context_encode,</span><br><span class="line">        <span class="string">&quot;appkey&quot;</span>: <span class="string">&quot;06475281&quot;</span>,</span><br><span class="line">        <span class="string">&quot;timestamp&quot;</span>: <span class="built_in">str</span>(<span class="built_in">int</span>(time.time() * <span class="number">1000</span>)),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sign = getSign(data)</span><br><span class="line">    data[<span class="string">&#x27;sign&#x27;</span>] = sign</span><br><span class="line"></span><br><span class="line">    response = requests.post(<span class="string">&#x27;https://thor.weidian.com/faith/search.item/1.7&#x27;</span>, headers=headers, data=data)</span><br><span class="line">    decode(response.content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 商品详情</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDetail</span>(<span class="params">itemid</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param itemid: 商品 id</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    url = <span class="string">&quot;https://thor.weidian.com/detailmjb/getItemInfo/1.1&quot;</span></span><br><span class="line">    params = &#123;<span class="string">&quot;adsk&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;itemId&quot;</span>: <span class="string">&quot;%s&quot;</span> % itemid&#125;</span><br><span class="line">    params = json.dumps(params, ensure_ascii=<span class="literal">False</span>).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    params_encode = encode(params)</span><br><span class="line">    context = &#123;<span class="string">&quot;alt&quot;</span>: <span class="string">&quot;0.0&quot;</span>, <span class="string">&quot;android_id&quot;</span>: <span class="string">&quot;2b2085ba28d67921&quot;</span>, <span class="string">&quot;app_status&quot;</span>: <span class="string">&quot;active&quot;</span>,</span><br><span class="line">               <span class="string">&quot;appid&quot;</span>: <span class="string">&quot;com.koudai.weidian.buyer&quot;</span>, <span class="string">&quot;appv&quot;</span>: <span class="string">&quot;5.7.0&quot;</span>, <span class="string">&quot;brand&quot;</span>: <span class="string">&quot;google&quot;</span>, <span class="string">&quot;build&quot;</span>: <span class="string">&quot;20190821162151&quot;</span>,</span><br><span class="line">               <span class="string">&quot;channel&quot;</span>: <span class="string">&quot;1013n&quot;</span>, <span class="string">&quot;cuid&quot;</span>: <span class="string">&quot;5c30df6b68a1e62a097a6b793dd9cd21&quot;</span>, <span class="string">&quot;disk_capacity&quot;</span>: <span class="string">&quot;19.35GB/25.01GB&quot;</span>,</span><br><span class="line">               <span class="string">&quot;feature&quot;</span>: <span class="string">&quot;E|F,H|F,P|F,R|T&quot;</span>, <span class="string">&quot;h&quot;</span>: <span class="string">&quot;2392&quot;</span>, <span class="string">&quot;iccid&quot;</span>: <span class="string">&quot;89860320045744719511&quot;</span>, <span class="string">&quot;imei&quot;</span>: <span class="string">&quot;86798102045241&quot;</span>,</span><br><span class="line">               <span class="string">&quot;imsi&quot;</span>: <span class="string">&quot;460115169646891&quot;</span>, <span class="string">&quot;is_login&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;lat&quot;</span>: <span class="string">&quot;29.887301&quot;</span>, <span class="string">&quot;lon&quot;</span>: <span class="string">&quot;121.63812&quot;</span>,</span><br><span class="line">               <span class="string">&quot;mac&quot;</span>: <span class="string">&quot;AC:CF:85:B7:39:B2&quot;</span>, <span class="string">&quot;machine_model&quot;</span>: <span class="string">&quot;armv8l&quot;</span>, <span class="string">&quot;memory&quot;</span>: <span class="string">&quot;940M/2799M&quot;</span>, <span class="string">&quot;mid&quot;</span>: <span class="string">&quot;Nexus_6P&quot;</span>,</span><br><span class="line">               <span class="string">&quot;mobile_station&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;net_subtype&quot;</span>: <span class="string">&quot;0_&quot;</span>, <span class="string">&quot;network&quot;</span>: <span class="string">&quot;WIFI&quot;</span>, <span class="string">&quot;os&quot;</span>: <span class="string">&quot;27&quot;</span>, <span class="string">&quot;platform&quot;</span>: <span class="string">&quot;android&quot;</span>,</span><br><span class="line">               <span class="string">&quot;serial_num&quot;</span>: <span class="string">&quot;ENU7N15A19011383&quot;</span>, <span class="string">&quot;suid&quot;</span>: <span class="string">&quot;5c30df6b68a1e62a097a6b793dd9cd21&quot;</span>, <span class="string">&quot;w&quot;</span>: <span class="string">&quot;1440&quot;</span>,</span><br><span class="line">               <span class="string">&quot;wmac&quot;</span>: <span class="string">&quot;80:ea:07:96:21:ea&quot;</span>, <span class="string">&quot;wssid&quot;</span>: <span class="string">&quot;\&quot;阿里巴巴\&quot;&quot;</span>&#125;</span><br><span class="line">    context = json.dumps(context, ensure_ascii=<span class="literal">False</span>).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    context_encode = encode(context)</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;param&quot;</span>: params_encode,</span><br><span class="line">        <span class="string">&quot;v&quot;</span>: <span class="string">&quot;2.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;context&quot;</span>: context_encode,</span><br><span class="line">        <span class="string">&quot;appkey&quot;</span>: <span class="string">&quot;06475281&quot;</span>,</span><br><span class="line">        <span class="string">&quot;timestamp&quot;</span>: <span class="built_in">str</span>(<span class="built_in">int</span>(time.time() * <span class="number">1000</span>)),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sign = getSign(data)</span><br><span class="line">    data[<span class="string">&#x27;sign&#x27;</span>] = sign</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="comment"># &quot;content-length&quot;: &quot;931&quot;,</span></span><br><span class="line">        <span class="string">&quot;x-schema&quot;</span>: <span class="string">&quot;https&quot;</span>,</span><br><span class="line">        <span class="string">&quot;referrer&quot;</span>: <span class="string">&quot;https://android.weidian.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;origin&quot;</span>: <span class="string">&quot;android.weidian.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;x-origin&quot;</span>: <span class="string">&quot;thor&quot;</span>,</span><br><span class="line">        <span class="string">&quot;x-encrypt&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="comment"># &quot;accept-encoding&quot;: &quot;GLZip&quot;,</span></span><br><span class="line">        <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Android/8.1.0 WDAPP(WDBuyer/5.7.0) Thor/2.1.3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=utf-8&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = requests.post(url=url,headers=headers,data=data)</span><br><span class="line">    decode(response.content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 店铺信息</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getShopInfo</span>(<span class="params">userid</span>):</span></span><br><span class="line">    cookies = &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;weidian.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pragma&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;cache-control&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;upgrade-insecure-requests&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Linux; Android 8.1.0; Nexus 6P Build/OPM7.181205.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/77.0.3865.120 TBS/045520 Mobile Safari/537.36 WDAPP(WDBuyer/5.7.0) appid/com.koudai.weidian.buyer KDJSBridge2/1.1.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-mode&#x27;</span>: <span class="string">&#x27;navigate&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-user&#x27;</span>: <span class="string">&#x27;?1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;x-referer&#x27;</span>: <span class="string">&#x27;https://android.weidian.com/&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;x-requested-with&#x27;</span>: <span class="string">&#x27;com.koudai.weidian.buyer&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-site&#x27;</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;accept-language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = (</span><br><span class="line">        (<span class="string">&#x27;userid&#x27;</span>, userid),</span><br><span class="line">        (<span class="string">&#x27;hidTop&#x27;</span>, <span class="string">&#x27;1&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;disableHeaderRefresh&#x27;</span>, <span class="string">&#x27;1&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;wfr&#x27;</span>, <span class="string">&#x27;item&#x27;</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    response = requests.get(<span class="string">&#x27;https://weidian.com/certDetails.html&#x27;</span>, headers=headers, params=params, cookies=cookies)</span><br><span class="line">    response.encoding = <span class="string">&quot;utf-8&quot;</span></span><br><span class="line">    print(response.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 店铺所有商品</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getShopSku</span>(<span class="params">shopId,page</span>):</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;authority&#x27;</span>: <span class="string">&#x27;thor.weidian.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pragma&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;cache-control&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-ch-ua&#x27;</span>: <span class="string">&#x27;&quot;Google Chrome&quot;;v=&quot;89&quot;, &quot;Chromium&quot;;v=&quot;89&quot;, &quot;;Not A Brand&quot;;v=&quot;99&quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;accept&#x27;</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-ch-ua-mobile&#x27;</span>: <span class="string">&#x27;?0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;origin&#x27;</span>: <span class="string">&#x27;https://shop843683.v.weidian.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-site&#x27;</span>: <span class="string">&#x27;same-site&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-mode&#x27;</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-fetch-dest&#x27;</span>: <span class="string">&#x27;empty&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;referer&#x27;</span>: <span class="string">&#x27;https://shop843683.v.weidian.com/&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;accept-language&#x27;</span>: <span class="string">&#x27;zh,zh-CN;q=0.9&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = (</span><br><span class="line">        (<span class="string">&#x27;param&#x27;</span>, <span class="string">&#x27;&#123;&quot;shopId&quot;:&quot;%s&quot;,&quot;page&quot;:%s,&quot;limit&quot;:20,&quot;tabId&quot;:0,&quot;sortOrder&quot;:&quot;desc&quot;,&quot;isFromH5&quot;:true&#125;&#x27;</span> % (shopId, page)),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    response = requests.get(<span class="string">&#x27;https://thor.weidian.com/ares/shop.getItemsInShop/1.0&#x27;</span>, headers=headers, params=params)</span><br><span class="line">    print(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    getSkuList(<span class="string">&quot;丽水&quot;</span>,<span class="string">&quot;杨梅&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    <span class="comment"># getDetail(3962774427)</span></span><br><span class="line">    <span class="comment"># getShopInfo(843683)</span></span><br><span class="line">    <span class="comment"># getShopSku(843683,5)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> demo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> demo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机基础</title>
      <link href="computer/"/>
      <url>computer/</url>
      
        <content type="html"><![CDATA[<h1 id="进制"><a href="#进制" class="headerlink" title="进制"></a>进制</h1><p>我们平时使用的数字都是由 0~9 共十个数字组成的，例如 1、9、10、297、952 等，一个数字最多能表示九，如果要表示十、十一、二十九、一百等，就需要多个数字组合起来。</p><p>例如表示 5+8 的结果，一个数字不够，只能”进位 “，用 13 来表示；这时” 进一位 “相当于十，” 进两位“相当于二十。</p><p>因为逢十进一（满十进一），也因为只有 0~9 共十个数字，所以叫做十进制（Decimalism）。十进制是在人类社会发展过程中自然形成的，它符合人们的思维习惯，例如人类有十根手指，也有十根脚趾。</p><p>进制也就是进位制。进行加法运算时逢 X 进一（满 X 进一），进行减法运算时借一当 X，这就是 X 进制，这种进制也就包含 X 个数字，基数为 X。十进制有 0~9 共 10 个数字，基数为 10，在加减法运算中，逢十进一，借一当十。</p><h2 id="二进制"><a href="#二进制" class="headerlink" title="二进制"></a>二进制</h2><p>我们不妨将思维拓展一下，既然可以用 0~9 共十个数字来表示数值，那么也可以用 0、1 两个数字来表示数值，这就是二进制（Binary）。例如，数字 0、1、10、111、100、1000001 都是有效的二进制。</p><p>在计算机内部，数据都是以二进制的形式存储的，二进制是学习编程必须掌握的基础。本节我们先讲解二进制的概念，下节讲解数据在内存中的存储，让大家学以致用。</p><p>二进制加减法和十进制加减法的思想是类似的：</p><ul><li>  对于十进制，进行加法运算时逢十进一，进行减法运算时借一当十；</li><li>  对于二进制，进行加法运算时逢二进一，进行减法运算时借一当二。</li></ul><p>下面两张示意图详细演示了二进制加减法的运算过程。</p><ol><li>二进制加法：1+0=1、1+1=10、11+10=101、111+111=1110</li></ol><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-015930.png">  </p><ol start="2"><li>二进制减法：1-0=1、10-1=1、101-11=10、1100-111=101</li></ol><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020024.png">  </p><h2 id="八进制"><a href="#八进制" class="headerlink" title="八进制"></a>八进制</h2><p>除了二进制，C 语言还会使用到八进制。</p><p>八进制有 0~7 共 8 个数字，基数为 8，加法运算时逢八进一，减法运算时借一当八。例如，数字 0、1、5、7、14、733、67001、25430 都是有效的八进制。</p><p>下面两张图详细演示了八进制加减法的运算过程。</p><ol><li>八进制加法：3+4=7、5+6=13、75+42=137、2427+567=3216</li></ol><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020031.png">  </p><ol start="2"><li>八进制减法：6-4=2、52-27=23、307-141=146、7430-1451=5757</li></ol><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020042.png">  </p><h2 id="十六进制"><a href="#十六进制" class="headerlink" title="十六进制"></a>十六进制</h2><p>除了二进制和八进制，十六进制也经常使用，甚至比八进制还要频繁。</p><p>十六进制中，用 A 来表示 10，B 表示 11，C 表示 12，D 表示 13，E 表示 14，F 表示 15，因此有 0~F 共 16 个数字，基数为 16，加法运算时逢 16 进 1，减法运算时借 1 当 16。例如，数字 0、1、6、9、A、D、F、419、EA32、80A3、BC00 都是有效的十六进制。</p><blockquote><p>注意，十六进制中的字母不区分大小写，ABCDEF 也可以写作 abcdef。</p></blockquote><p>下面两张图详细演示了十六进制加减法的运算过程。</p><ol><li>十六进制加法：6+7=D、18+BA=D2、595+792=D27、2F87+F8A=3F11</li></ol><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020047.png">  </p><ol start="2"><li>十六进制减法：D-3=A、52-2F=23、E07-141=CC6、7CA0-1CB1=5FEF</li></ol><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020054.png">  </p><h1 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h1><h2 id="将二进制、八进制、十六进制转换为十进制"><a href="#将二进制、八进制、十六进制转换为十进制" class="headerlink" title="将二进制、八进制、十六进制转换为十进制"></a>将二进制、八进制、十六进制转换为十进制</h2><p>二进制、八进制和十六进制向十进制转换都非常容易，就是 “按权相加”。所谓 “权”，也即 “位权”。</p><p>假设当前数字是 N 进制，那么：</p><ul><li>  对于整数部分，从右往左看，第 i 位的位权等于 Ni-1</li><li>  对于小数部分，恰好相反，要从左往右看，第 j 位的位权为 N-j。</li></ul><p>更加通俗的理解是，假设一个多位数（由多个数字组成的数）某位上的数字是 1，那么它所表示的数值大小就是该位的位权。</p><h4 id="1-整数部分"><a href="#1-整数部分" class="headerlink" title="1) 整数部分"></a>1) 整数部分</h4><p>例如，将八进制数字 53627 转换成十进制：</p><p>53627 = 5×84 + 3×83 + 6×82 + 2×81 + 7×80 = 22423（十进制）</p><p>从右往左看，第 1 位的位权为 80=1，第 2 位的位权为 81=8，第 3 位的位权为 82=64，第 4 位的位权为 83=512，第 5 位的位权为 84=4096 …… 第 n 位的位权就为 8n-1。将各个位的数字乘以位权，然后再相加，就得到了十进制形式。</p><blockquote><p>注意，这里我们需要以十进制形式来表示位权。</p></blockquote><p>再如，将十六进制数字 9FA8C 转换成十进制：</p><p>9FA8C = 9×164 + 15×163 + 10×162 + 8×161 + 12×160 = 653964（十进制）</p><p>从右往左看，第 1 位的位权为 160=1，第 2 位的位权为 161=16，第 3 位的位权为 162=256，第 4 位的位权为 163=4096，第 5 位的位权为 164=65536 …… 第 n 位的位权就为 16n-1。将各个位的数字乘以位权，然后再相加，就得到了十进制形式。</p><p>将二进制数字转换成十进制也是类似的道理：</p><p>11010 = 1×24 + 1×23 + 0×22 + 1×21 + 0×20 = 26（十进制）</p><p>从右往左看，第 1 位的位权为 20=1，第 2 位的位权为 21=2，第 3 位的位权为 22=4，第 4 位的位权为 23=8，第 5 位的位权为 24=16 …… 第 n 位的位权就为 2n-1。将各个位的数字乘以位权，然后再相加，就得到了十进制形式。</p><h4 id="2-小数部分"><a href="#2-小数部分" class="headerlink" title="2) 小数部分"></a>2) 小数部分</h4><p>例如，将八进制数字 423.5176 转换成十进制：</p><p>423.5176 = 4×82 + 2×81 + 3×80 + 5×8-1 + 1×8-2 + 7×8-3 + 6×8-4 = 275.65576171875（十进制）</p><p>小数部分和整数部分相反，要从左往右看，第 1 位的位权为 8-1=1/8，第 2 位的位权为 8-2=1/64，第 3 位的位权为 8-3=1/512，第 4 位的位权为 8-4=1/4096 …… 第 m 位的位权就为 8-m。</p><p>再如，将二进制数字 1010.1101 转换成十进制：</p><p>1010.1101 = 1×23 + 0×22 + 1×21 + 0×20 + 1×2-1 + 1×2-2 + 0×2-3 + 1×2-4 = 10.8125（十进制）</p><p>小数部分和整数部分相反，要从左往右看，第 1 位的位权为 2-1=1/2，第 2 位的位权为 2-2=1/4，第 3 位的位权为 2-3=1/8，第 4 位的位权为 2-4=1/16 …… 第 m 位的位权就为 2-m。</p><p>更多转换成十进制的例子：</p><ul><li>  二进制：1001 = 1×23 + 0×22 + 0×21 + 1×20 = 8 + 0 + 0 + 1 = 9（十进制）</li><li>  二进制：101.1001 = 1×22 + 0×21 + 1×20 + 1×2-1 + 0×2-2 + 0×2-3 + 1×2-4 = 4 + 0 + 1 + 0.5 + 0 + 0 + 0.0625 = 5.5625（十进制）</li><li>  八进制：302 = 3×82 + 0×81 + 2×80 = 192 + 0 + 2 = 194（十进制）</li><li>  八进制：302.46 = 3×82 + 0×81 + 2×80 + 4×8-1 + 6×8-2 = 192 + 0 + 2 + 0.5 + 0.09375= 194.59375（十进制）</li><li>  十六进制：EA7 = 14×162 + 10×161 + 7×160 = 3751（十进制）</li></ul><h2 id="将十进制转换为二进制、八进制、十六进制"><a href="#将十进制转换为二进制、八进制、十六进制" class="headerlink" title="将十进制转换为二进制、八进制、十六进制"></a>将十进制转换为二进制、八进制、十六进制</h2><p>将十进制转换为其它进制时比较复杂，整数部分和小数部分的算法不一样，下面我们分别讲解。</p><h4 id="1-整数部分-1"><a href="#1-整数部分-1" class="headerlink" title="1) 整数部分"></a>1) 整数部分</h4><p>十进制整数转换为 N 进制整数采用 “除 N 取余，逆序排列” 法。具体做法是：</p><ul><li>  将 N 作为除数，用十进制整数除以 N，可以得到一个商和余数；</li><li>  保留余数，用商继续除以 N，又得到一个新的商和余数；</li><li>  仍然保留余数，用商继续除以 N，还会得到一个新的商和余数；</li><li>  ……</li><li>  如此反复进行，每次都保留余数，用商接着除以 N，直到商为 0 时为止。</li></ul><p>把先得到的余数作为 N 进制数的低位数字，后得到的余数作为 N 进制数的高位数字，依次排列起来，就得到了 N 进制数字。</p><p>下图演示了将十进制数字 36926 转换成八进制的过程：</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020514.png"></p><p>从图中得知，十进制数字 36926 转换成八进制的结果为 110076。</p><p>下图演示了将十进制数字 42 转换成二进制的过程：</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020534.png"></p><p>从图中得知，十进制数字 42 转换成二进制的结果为 101010。</p><h4 id="2-小数部分-1"><a href="#2-小数部分-1" class="headerlink" title="2) 小数部分"></a>2) 小数部分</h4><p>十进制小数转换成 N 进制小数采用 “乘 N 取整，顺序排列” 法。具体做法是：</p><ul><li>  用 N 乘以十进制小数，可以得到一个积，这个积包含了整数部分和小数部分；</li><li>  将积的整数部分取出，再用 N 乘以余下的小数部分，又得到一个新的积；</li><li>  再将积的整数部分取出，继续用 N 乘以余下的小数部分；</li><li>  ……</li><li>  如此反复进行，每次都取出整数部分，用 N 接着乘以小数部分，直到积中的小数部分为 0，或者达到所要求的精度为止。</li></ul><p>把取出的整数部分按顺序排列起来，先取出的整数作为 N 进制小数的高位数字，后取出的整数作为低位数字，这样就得到了 N 进制小数。</p><p>下图演示了将十进制小数 0.930908203125 转换成八进制小数的过程：</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020658.png"></p><p>从图中得知，十进制小数 0.930908203125 转换成八进制小数的结果为 0.7345。</p><p>下图演示了将十进制小数 0.6875 转换成二进制小数的过程：</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020713.png"></p><p>从图中得知，十进制小数 0.6875 转换成二进制小数的结果为 0.1011。</p><p>如果一个数字既包含了整数部分又包含了小数部分，那么将整数部分和小数部分开，分别按照上面的方法完成转换，然后再合并在一起即可。例如：</p><ul><li>  十进制数字 36926.930908203125 转换成八进制的结果为 110076.7345；</li><li>  十进制数字 42.6875 转换成二进制的结果为 101010.1011。</li></ul><p>下表列出了前 17 个十进制整数与二进制、八进制、十六进制的对应关系：</p><table><tbody><tr><th>十进制</th><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td><td>13</td><td>14</td><td>15</td><td>16</td></tr><tr><th>二进制</th><td>0</td><td>1</td><td>10</td><td>11</td><td>100</td><td>101</td><td>110</td><td>111</td><td>1000</td><td>1001</td><td>1010</td><td>1011</td><td>1100</td><td>1101</td><td>1110</td><td>1111</td><td>10000</td></tr><tr><th>八进制</th><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>10</td><td>11</td><td>12</td><td>13</td><td>14</td><td>15</td><td>16</td><td>17</td><td>20</td></tr><tr><th>十六进制</th><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>A</td><td>B</td><td>C</td><td>D</td><td>E</td><td>F</td><td>10</td></tr></tbody></table><p>注意，十进制小数转换成其他进制小数时，结果有可能是一个无限位的小数。请看下面的例子：</p><ul><li>  十进制 0.51 对应的二进制为 0.100000101000111101011100001010001111010111…，是一个循环小数；</li><li>  十进制 0.72 对应的二进制为 0.1011100001010001111010111000010100011110…，是一个循环小数；</li><li>  十进制 0.625 对应的二进制为 0.101，是一个有限小数。</li></ul><h2 id="二进制和八进制、十六进制的转换"><a href="#二进制和八进制、十六进制的转换" class="headerlink" title="二进制和八进制、十六进制的转换"></a>二进制和八进制、十六进制的转换</h2><p>其实，任何进制之间的转换都可以使用上面讲到的方法，只不过有时比较麻烦，所以一般针对不同的进制采取不同的方法。将二进制转换为八进制和十六进制时就有非常简洁的方法，反之亦然。</p><h4 id="1-二进制整数和八进制整数之间的转换"><a href="#1-二进制整数和八进制整数之间的转换" class="headerlink" title="1) 二进制整数和八进制整数之间的转换"></a>1) 二进制整数和八进制整数之间的转换</h4><p>二进制整数转换为八进制整数时，每三位二进制数字转换为一位八进制数字，运算的顺序是从低位向高位依次进行，高位不足三位用零补齐。下图演示了如何将二进制整数 1110111100 转换为八进制：</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020757.png"></p><p>从图中可以看出，二进制整数 1110111100 转换为八进制的结果为 1674。</p><p>八进制整数转换为二进制整数时，思路是相反的，每一位八进制数字转换为三位二进制数字，运算的顺序也是从低位向高位依次进行。下图演示了如何将八进制整数 2743 转换为二进制：</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020801.png"></p><p>从图中可以看出，八进制整数 2743 转换为二进制的结果为 10111100011。</p><h4 id="2-二进制整数和十六进制整数之间的转换"><a href="#2-二进制整数和十六进制整数之间的转换" class="headerlink" title="2) 二进制整数和十六进制整数之间的转换"></a>2) 二进制整数和十六进制整数之间的转换</h4><p>二进制整数转换为十六进制整数时，每四位二进制数字转换为一位十六进制数字，运算的顺序是从低位向高位依次进行，高位不足四位用零补齐。下图演示了如何将二进制整数 10 1101 0101 1100 转换为十六进制：</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020845.jpg"></p><p>从图中可以看出，二进制整数 10 1101 0101 1100 转换为十六进制的结果为 2D5C。</p><p>十六进制整数转换为二进制整数时，思路是相反的，每一位十六进制数字转换为四位二进制数字，运算的顺序也是从低位向高位依次进行。下图演示了如何将十六进制整数 A5D6 转换为二进制：</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-08-020907.png"></p><p>从图中可以看出，十六进制整数 A5D6 转换为二进制的结果为 1010 0101 1101 0110。</p><p>在 C 语言编程中，二进制、八进制、十六进制之间几乎不会涉及小数的转换，所以这里我们只讲整数的转换，大家学以致用足以。另外，八进制和十六进制之间也极少直接转换，这里我们也不再讲解了。</p><h1 id="二进制数据存储"><a href="#二进制数据存储" class="headerlink" title="二进制数据存储"></a>二进制数据存储</h1><p>计算机要处理的信息是多种多样的，如数字、文字、符号、图形、音频、视频等，这些信息在人们的眼里是不同的。但对于计算机来说，它们在内存中都是一样的，都是以二进制的形式来表示。</p><p>要想学习编程，就必须了解二进制，它是计算机处理数据的基础。</p><p>内存条是一个非常精密的部件，包含了上亿个电子元器件，它们很小，达到了纳米级别。这些元器件，实际上就是电路；电路的电压会变化，要么是 0V，要么是 5V，只有这两种电压。5V 是通电，用 1 来表示，0V 是断电，用 0 来表示。所以，一个元器件有 2 种状态，0 或者 1。</p><p>我们通过电路来控制这些元器件的通断电，会得到很多 0、1 的组合。例如，8 个元器件有 28=256 种不同的组合，16 个元器件有 216=65536 种不同的组合。虽然一个元器件只能表示 2 个数值，但是多个结合起来就可以表示很多数值了。</p><p>我们可以给每一种组合赋予特定的含义，例如，可以分别用 1101000、00011100、11111111、00000000、01010101、10101010 来表示 C、语、言、中、文、网 这几个字，那么结合起来 1101000 00011100 11111111 00000000 01010101 10101010 就表示”C 语言中文网 “。</p><p>一般情况下我们不一个一个的使用元器件，而是将 <strong>8 个元器件看做一个单位</strong>，即使表示很小的数，例如 1，也需要 8 个，也就是 00000001。</p><p>1 个元器件称为 1 比特（Bit）或 1 位，8 个元器件称为 1 字节（Byte），那么 16 个元器件就是 2Byte，32 个就是 4Byte，以此类推：</p><ul><li>  8×1024 个元器件就是 1024Byte，简写为 1KB；</li><li>  8×1024×1024 个元器件就是 1024KB，简写为 1MB；</li><li>  8×1024×1024×1024 个元器件就是 1024MB，简写为 1GB。</li></ul><p>现在，你知道 1GB 的内存有多少个元器件了吧。我们通常所说的文件大小是多少 KB、多少 MB，就是这个意思。</p><p>单位换算：</p><ul><li>  1Byte = 8 Bit</li><li>  1KB = 1024Byte = 210Byte</li><li>  1MB = 1024KB = 220Byte</li><li>  1GB = 1024MB = 230Byte</li><li>  1TB = 1024GB = 240Byte</li><li>  1PB = 1024TB = 250Byte</li><li>  1EB = 1024PB = 260Byte</li></ul><p>我们平时使用计算机时，通常只会设计到 KB、MB、GB、TB 这几个单位，PB 和 EB 这两个高级单位一般在<a href="http://c.biancheng.net/big_data/">大数据</a>处理过程中才会用到。</p><p>你看，在内存中没有 abc 这样的字符，也没有 gif、jpg 这样的图片，只有 0 和 1 两个数字，计算机也只认识 0 和 1。所以，计算机使用二进制，而不是我们熟悉的十进制，写入内存中的数据，都会被转换成 0 和 1 的组合。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kali 环境搭建</title>
      <link href="kali/"/>
      <url>kali/</url>
      
        <content type="html"><![CDATA[<h1 id="kali-环境搭建"><a href="#kali-环境搭建" class="headerlink" title="kali 环境搭建"></a>kali 环境搭建</h1><h2 id="kali-root"><a href="#kali-root" class="headerlink" title="kali root"></a>kali root</h2><p>开机后用kali/kali进去入系统，运行sudo passwd root，给root设个密码toor，重复retype一次。然后重启以root/toor进入系统即可。</p><h2 id="kali-设置时区"><a href="#kali-设置时区" class="headerlink" title="kali 设置时区"></a>kali 设置时区</h2><p>kali里面时间老是不对，其实只是时区不对而已，一个命令就搞定：<br><code>dpkg-reconfigure tzdata</code><br>然后选择Asia→Shanghai，然后重启即可。</p><h2 id="kali-常用软件"><a href="#kali-常用软件" class="headerlink" title="kali 常用软件"></a>kali 常用软件</h2><h3 id="安装-jnetop-htop-tree"><a href="#安装-jnetop-htop-tree" class="headerlink" title="安装 jnetop htop tree"></a>安装 jnetop htop tree</h3><p>apt update<br>apt install jnettop htp tree</p><h2 id="kali-换源"><a href="#kali-换源" class="headerlink" title="kali 换源"></a>kali 换源</h2><p>1.更新软件源<br><code>sudo vim /etc/apt/sources.list</code><br>2.选择比较合适的源(选择一个即可）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#中科大</span></span><br><span class="line">deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br><span class="line"><span class="comment">#阿里云</span></span><br><span class="line">deb http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line"><span class="comment">#清华大学</span></span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line"></span><br><span class="line"><span class="comment">#163</span></span><br><span class="line">deb http://mirrors.163.com/debian wheezy main non-free contrib</span><br><span class="line">deb-src http://mirrors.163.com/debian wheezy main non-free contrib</span><br><span class="line">deb http://mirrors.163.com/debian wheezy-proposed-updates main non-free contrib</span><br><span class="line">deb-src http://mirrors.163.com/debian wheezy-proposed-updates main non-free contrib</span><br><span class="line">deb-src http://mirrors.163.com/debian-security wheezy/updates main non-free contrib</span><br><span class="line"></span><br><span class="line"><span class="comment">#东软大学</span></span><br><span class="line">deb http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contrib</span><br><span class="line">deb-src http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contrib</span><br><span class="line"></span><br><span class="line"><span class="comment">#官方源</span></span><br><span class="line">deb http://http.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://http.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line"><span class="comment">#jessie 需要手动调整 复制过来有问题</span></span><br><span class="line">deb http://ftp.de.debian.org/debian jessie main</span><br></pre></td></tr></table></figure><h2 id="kali-非-root-用户使用-adb"><a href="#kali-非-root-用户使用-adb" class="headerlink" title="kali 非 root 用户使用 adb"></a>kali 非 root 用户使用 adb</h2><p>非 root 用户使用 adb 命令时可能会出现以下错误<br><code>adb: insufficient permissions for device: missing udev rules?</code></p><p>解决方式:<br><code>vim /etc/udev/rules.d/51-android.rules</code></p><p>然后添加:<br><code>SUBSYSTEM==&quot;usb&quot;, ENV&#123;DEVTYPE&#125;==&quot;usb_device&quot;, MODE=&quot;0666&quot;</code><br>再次拔插设备即可</p><h2 id="kali-安装-android-studio"><a href="#kali-安装-android-studio" class="headerlink" title="kali 安装 android studio"></a>kali 安装 android studio</h2><p>浏览器设置代理</p><p>搜索proxy socks5 本机 ip: 代理端口</p><p>打开网址: <a href="https://developer.android.com/studio">https://developer.android.com/studio</a></p><p>复制 download 地址, 使用 wget 命令下载</p><p>下载完成后解压缩并添加权限 <code>chmod -R 755 Android-Studio</code> </p><p>进入 bin 目录启动 <code>./studio.sh</code> </p><p>安装完成后新建一个 native 项目等待同步即可</p><h2 id="kali-使用-adb"><a href="#kali-使用-adb" class="headerlink" title="kali 使用 adb"></a>kali 使用 adb</h2><p>安装好 android-studio 之后</p><p>进入 <code>/root/Android/Sdk/platform-tools</code>可以看到 adb 工具</p><p>将路径加入到 zshrc 中 <code>vim ~/.zshrc</code> 加入: <code>export PATH=&quot;/root/Android/Sdk/platform-tools:$PATH&quot;</code> </p><h2 id="kali-安装-pyenv"><a href="#kali-安装-pyenv" class="headerlink" title="kali 安装 pyenv"></a>kali 安装 pyenv</h2><ol><li><p><a href="https://github.com/pyenv/pyenv/wiki#suggested-build-environment">安装需要的依赖 </a> <code>sudo apt-get update; sudo apt-get install --no-install-recommends make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev</code></p></li><li><p><code>git clone https://github.com/pyenv/pyenv.git ~/.pyenv</code> </p></li><li><p>kali 2020 使用的是 zsh , 需要将 pyenv 添加到路径中 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PYENV_ROOT=&quot;$HOME/.pyenv&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PATH=&quot;$PYENV_ROOT/bin:$PATH&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure></li><li><p><code>echo -e &#39;if command -v pyenv 1&gt;/dev/null 2&gt;&amp;1; then\n  eval &quot;$(pyenv init -)&quot;\nfi&#39; &gt;&gt; ~/.zshrc</code></p></li><li><p><code>exec &quot;$SHELL&quot;</code></p></li><li><p>安装指定版本 python <code>pyenv install 3.8.0</code> </p></li><li><p>切换指定版本 python <code>pyenv local 3.8.0</code> </p></li></ol><h2 id="kali-安装-nodejs-和-gum"><a href="#kali-安装-nodejs-和-gum" class="headerlink" title="kali 安装 nodejs 和 gum"></a>kali 安装 nodejs 和 gum</h2><p><a href="https://github.com/nodesource/distributions/blob/master/README.md">https://github.com/nodesource/distributions/blob/master/README.md</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Using Debian, as root</span></span><br><span class="line">curl -fsSL https://deb.nodesource.com/setup_15.x | bash -</span><br><span class="line">apt-get install -y nodejs</span><br></pre></td></tr></table></figure><p>安装 gum 进行代码提示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save @types/frida-gum</span><br></pre></td></tr></table></figure><h2 id="kali-安装-vscode"><a href="#kali-安装-vscode" class="headerlink" title="kali 安装 vscode"></a>kali 安装 vscode</h2><p>下载地址: <a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></p><p><code>dpkg -i 文件名</code></p><h2 id="kali-设置固定-ip"><a href="#kali-设置固定-ip" class="headerlink" title="kali 设置固定 ip"></a>kali 设置固定 ip</h2><ol><li><p> <code>vim /etc/network/interface</code></p></li><li><p>在 interface 文件中追加以下内容:</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auto eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">address 192.168.1.53</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">gateway 192.168.1.1</span><br></pre></td></tr></table></figure></li><li><p> 配置 dns <code>vim /etc/resolv.conf</code>  –&gt;  <code>nameserver 8.8.8.8</code>  –&gt;  <code>nameserver 114.114.114.114</code></p></li><li><p> <code>systemctl restart networking</code> </p></li></ol><h2 id="kali-配置-sshd-服务"><a href="#kali-配置-sshd-服务" class="headerlink" title="kali 配置 sshd 服务"></a>kali 配置 sshd 服务</h2><ol><li> 修改 sshd 配置文件, 允许 root 登录</li><li> <code>vim /etc/ssh/sshd_config</code>  –&gt;  <code>: set nu</code></li><li> 修改 PermitRootLogin 32 行附近, 打开注释, 设置为 <code>PermitRootLogin yes</code></li><li> <code>/etc/init.d/ssh resatrt</code> 重启 ssh 服务</li><li> <code>update-rc.d ssh enable</code> 设置为开机启动</li></ol><h1 id="kali-信息收集-DNS"><a href="#kali-信息收集-DNS" class="headerlink" title="kali 信息收集 - DNS"></a>kali 信息收集 - DNS</h1><h2 id="dns-域名解析原理"><a href="#dns-域名解析原理" class="headerlink" title="dns 域名解析原理"></a>dns 域名解析原理</h2><h3 id="dns-服务器概述"><a href="#dns-服务器概述" class="headerlink" title="dns 服务器概述"></a>dns 服务器概述</h3><p>运行 dns 服务器程序的计算机, 存储 dns 数据库信息; dns 服务器分为根域 dns 服务器, 顶级域名 dns 服务器; 根域 dns 服务器有 13 个, 都存储了全部的顶级域名服务器的所在地址, 顶级域名服务器存储了每位客户所注册的主机地址, 对应到例如 163.com 这个级别;</p><h3 id="域名记录"><a href="#域名记录" class="headerlink" title="域名记录"></a>域名记录</h3><ol><li> A 记录 正向解析, 将域名和 ip 地址关联起来;</li><li> Cname 别名记录, 允许客户将多个名字映射到到同一台计算机;</li><li> NS 域名服务器记录, 用于指定该域名由哪个 dns 服务器来解析;</li><li> MX 邮箱记录, 邮件交换记录, 它指向一个邮件服务器;</li><li> PTR 反向解析; ip 对应的域名, 这些记录保存在 <code>in-addr.arpa</code>域中</li></ol><h3 id="ping-获取域名对应的-ip"><a href="#ping-获取域名对应的-ip" class="headerlink" title="ping 获取域名对应的 ip"></a>ping 获取域名对应的 ip</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># ping xuegod.cn</span></span><br><span class="line">PING xuegod.cn (47.243.25.180) 56(84) bytes of data.</span><br><span class="line">64 bytes from 47.243.25.180 (47.243.25.180): icmp_seq=1 ttl=44 time=78.4 ms</span><br><span class="line">64 bytes from 47.243.25.180 (47.243.25.180): icmp_seq=2 ttl=44 time=75.5 ms</span><br><span class="line">64 bytes from 47.243.25.180 (47.243.25.180): icmp_seq=3 ttl=44 time=75.4 ms</span><br><span class="line">^C</span><br><span class="line">--- xuegod.cn ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2003ms</span><br><span class="line">rtt min/avg/max/mdev = 75.396/76.406/78.355/1.378 ms</span><br></pre></td></tr></table></figure><p>47.243.25.180 为域名对应的 ip 地址</p><h3 id="nslookup-查看域名信息"><a href="#nslookup-查看域名信息" class="headerlink" title="nslookup 查看域名信息"></a>nslookup 查看域名信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># nslookup xuegod.cn</span></span><br><span class="line">Server:8.8.8.8  <span class="comment"># dns 服务器</span></span><br><span class="line">Address:8.8.8.8<span class="comment">#53# dns 服务器地址</span></span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:xuegod.cn<span class="comment"># 我们要解析的域名</span></span><br><span class="line">Address: 47.243.25.180<span class="comment"># 解析得到的 ip 地址</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># nslookup www.baidu.com</span></span><br><span class="line">Server:8.8.8.8</span><br><span class="line">Address:8.8.8.8<span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">www.baidu.comcanonical name = www.a.shifen.com.    </span><br><span class="line">www.a.shifen.comcanonical name = www.wshifen.com. <span class="comment"># www.baidu.com 和 www.wshifen.com 是彼此的域名别名</span></span><br><span class="line">Name:www.wshifen.com</span><br><span class="line">Address: 103.235.46.39</span><br></pre></td></tr></table></figure><h3 id="dig-查看域名信息"><a href="#dig-查看域名信息" class="headerlink" title="dig 查看域名信息"></a>dig 查看域名信息</h3><p>语法: dig (选项) 需要查询的域名</p><ol><li> dig @&lt;dns 服务器地址&gt; 域名  –&gt;  指定进行解析的域名服务器</li><li> dig (选项) 域名 any  –&gt;  显示所有类型的域名记录, 如果不加 any 则默认只显示 A 记录</li><li> dig -x ip地址  –&gt;  使用 ip 反查域名</li><li> dig txt chaos VERSION.BIND @域名服务器  –&gt;  查看域名服务器 bind 的软件版本信息, 可以通过版本信息来查找相关版本漏洞的利用方式 </li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># dig xuegod.cn</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.16.11-Debian &lt;&lt;&gt;&gt; xuegod.cn</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 29684</span></span><br><span class="line"><span class="string">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; OPT PSEUDOSECTION:</span></span><br><span class="line"><span class="string">; EDNS: version: 0, flags:; udp: 512</span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;xuegod.cn.INA</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ANSWER SECTION:</span></span><br><span class="line"><span class="string">xuegod.cn.599INA47.243.25.180  # 域名对应的 A 记录</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 79 msec</span></span><br><span class="line"><span class="string">;; SERVER: 8.8.8.8#53(8.8.8.8)</span></span><br><span class="line"><span class="string">;; WHEN: 三 6月 16 22:54:32 EDT 2021</span></span><br><span class="line"><span class="string">;; MSG SIZE  rcvd: 54</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># dig @114.114.114.114 xuegod.cn</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.16.11-Debian &lt;&lt;&gt;&gt; @114.114.114.114 xuegod.cn</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 29481</span></span><br><span class="line"><span class="string">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;xuegod.cn.INA</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ANSWER SECTION:</span></span><br><span class="line"><span class="string">xuegod.cn.600INA47.243.25.180</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 55 msec</span></span><br><span class="line"><span class="string">;; SERVER: 114.114.114.114#53(114.114.114.114)</span></span><br><span class="line"><span class="string">;; WHEN: 三 6月 16 23:34:22 EDT 2021</span></span><br><span class="line"><span class="string">;; MSG SIZE  rcvd: 43</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># dig @114.114.114.114 xuegod.cn any</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.16.11-Debian &lt;&lt;&gt;&gt; @114.114.114.114 xuegod.cn any</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 21625</span></span><br><span class="line"><span class="string">;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; OPT PSEUDOSECTION:</span></span><br><span class="line"><span class="string">; EDNS: version: 0, flags:; udp: 512</span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;xuegod.cn.INANY</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ANSWER SECTION:</span></span><br><span class="line"><span class="string">xuegod.cn.600INMX10 mxbiz2.qq.com.</span></span><br><span class="line"><span class="string">xuegod.cn.600INMX5 mxbiz1.qq.com.</span></span><br><span class="line"><span class="string">xuegod.cn.487INA47.243.25.180</span></span><br><span class="line"><span class="string">xuegod.cn.2034INNSdns7.hichina.com.</span></span><br><span class="line"><span class="string">xuegod.cn.2034INNSdns8.hichina.com.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 271 msec</span></span><br><span class="line"><span class="string">;; SERVER: 114.114.114.114#53(114.114.114.114)</span></span><br><span class="line"><span class="string">;; WHEN: 三 6月 16 23:36:16 EDT 2021</span></span><br><span class="line"><span class="string">;; MSG SIZE  rcvd: 152</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># dig -x 114.114.114.114</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.16.11-Debian &lt;&lt;&gt;&gt; -x 114.114.114.114</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 48624</span></span><br><span class="line"><span class="string">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; OPT PSEUDOSECTION:</span></span><br><span class="line"><span class="string">; EDNS: version: 0, flags:; udp: 512</span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;114.114.114.114.in-addr.arpa.INPTR</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ANSWER SECTION:</span></span><br><span class="line"><span class="string">114.114.114.114.in-addr.arpa. 335 INPTRpublic1.114dns.com.   # PTR ip 对应的域名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 279 msec</span></span><br><span class="line"><span class="string">;; SERVER: 8.8.8.8#53(8.8.8.8)</span></span><br><span class="line"><span class="string">;; WHEN: 三 6月 16 23:37:35 EDT 2021</span></span><br><span class="line"><span class="string">;; MSG SIZE  rcvd: 89</span></span><br></pre></td></tr></table></figure><h3 id="whois-查询域名信息"><a href="#whois-查询域名信息" class="headerlink" title="whois 查询域名信息"></a>whois 查询域名信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─<span class="comment"># whois xuegod.cn</span></span><br><span class="line">Domain Name: xuegod.cn</span><br><span class="line">ROID: 20140908s10001s72166376-cn</span><br><span class="line">Domain Status: ok</span><br><span class="line">Registrant: 北京学神科技有限公司</span><br><span class="line">Registrant Contact Email: jianmingbasic@163.com</span><br><span class="line">Sponsoring Registrar: 阿里云计算有限公司（万网）</span><br><span class="line">Name Server: dns7.hichina.com</span><br><span class="line">Name Server: dns8.hichina.com</span><br><span class="line">Registration Time: 2014-09-08 10:52:31</span><br><span class="line">Expiration Time: 2021-09-08 10:52:31</span><br><span class="line">DNSSEC: unsigned</span><br></pre></td></tr></table></figure><h3 id="Maltego-收集子域名"><a href="#Maltego-收集子域名" class="headerlink" title="Maltego 收集子域名"></a>Maltego 收集子域名</h3><p>子域名是某个主域的二级域名或者多级域名, 在防御措施严密情况下无法直接拿下主域, 那么就可以采用迂回战术拿下子域名, 然后无限靠近主域;</p>]]></content>
      
      
      <categories>
          
          <category> env </category>
          
      </categories>
      
      
        <tags>
            
            <tag> env </tag>
            
            <tag> kali </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>adb 常用命令</title>
      <link href="adb/"/>
      <url>adb/</url>
      
        <content type="html"><![CDATA[<ul><li><p>adb 启动和停止</p><ul><li><code>adb start-server</code></li><li><code>adb kill-server</code></li></ul></li><li><p>adb 查看最顶端应用的包名和 activity 名</p><ul><li><code>adb shell dumpsys window | grep mCurrentFocus</code> </li></ul></li><li><p>adb 输入字符串</p><ul><li><code>adb shell input text &quot;&lt;String&gt;&quot;</code> </li></ul></li><li><p>adb 模拟按键</p><ul><li><code>adb shell input keyevent &lt;Int&gt;</code> <a href="https://www.huaweicloud.com/articles/aaab7697baca07f9d37854a69631a11d.html">按键参考</a></li></ul></li><li><p>adb 安装 apk 指定 32 位和 64 位</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb install --abi armeabi-v7a &lt;apk path&gt;  <span class="comment"># 32位下运行</span></span><br><span class="line">adb install --abi arm64-v8a &lt;apk path&gt;    <span class="comment"># 64位下运行</span></span><br></pre></td></tr></table></figure></li><li><p>adb 查看连接设备</p><ul><li><code>adb devices</code></li></ul></li><li><p>adb 指定连接设备</p><ul><li><code>adb -s cf12345f shell</code></li></ul></li><li><p>adb 安装应用</p><ul><li><code>adb install -r demo.apk</code></li></ul></li><li><p>adb 卸载应用</p><ul><li><code>adb uninstall &lt;包名&gt;</code></li></ul></li><li><p>adb 列出手机安装的所有 app 的包名</p><ul><li><code>adb shell pm list packages</code></li></ul></li><li><p>adb 列出除了系统应用之外的第三方应用</p><ul><li><code>adb shell pm list package -3</code> </li></ul></li><li><p>adb 清除应用数据和缓存</p><ul><li><code>adb shell pm clear &lt;包名&gt;</code></li></ul></li><li><p>adb 强制停止应用</p><ul><li><code>adb shell am force-stop com.tencent.mm</code></li></ul></li><li><p>adb 启动 activity</p><ul><li><code>adb shell am start com.tencent.mm/com.tencent.mm.ui.LauncherUI</code> 配合adb 查看最顶端应用的包名和 activity 名使用</li></ul></li><li><p>adb 取出安装的 apk</p><ol><li><code>adb shell pm list package</code></li><li><code>adb shell pm path com.tence01.mm</code> 获取apk的位置</li><li><code>adb pull /data/app/com.tence01.mm-1.apk ~/apks</code> 拉取到本地</li></ol></li></ul>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> others </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>arm</title>
      <link href="arm/"/>
      <url>arm/</url>
      
        <content type="html"><![CDATA[<h1 id="arm-可执行程序生成过程"><a href="#arm-可执行程序生成过程" class="headerlink" title="arm 可执行程序生成过程"></a>arm 可执行程序生成过程</h1><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>编写hello.c 文件</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello arm!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mac 自带的 clang 编译, 如果使用默认的 clang 进行编译<br><code>clang _01helloworld.c -o hello_mac</code></p><p>使用 <code>file</code> 查看, 编译的结果为<br><code>Mach-O 64-bit executable x86_6</code></p><p>需要使用 <code>ndk</code> 中的 <code>clang</code> 进行编译; 可以直接使用 <code>android studio</code> 自带的 <code>ndk</code> 中的 <code>clang</code> 命令进行编译;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-12-03-065237.png" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-12-03-065237.png"></p><p>将 <code>clang</code> 添加到环境变量, 方便使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alias arm&#x3D;&#39;export PATH&#x3D;&quot;&#x2F;Users&#x2F;zhangyang&#x2F;Library&#x2F;Android&#x2F;sdk&#x2F;ndk&#x2F;21.0.6113669&#x2F;toolchains&#x2F;llvm&#x2F;prebuilt&#x2F;darwin-x86_64&#x2F;bin:$PATH&quot;&#39;</span><br><span class="line">arm # 切换环境变量</span><br><span class="line">clang -target aarch64-linux-android21 _01helloworld.c -o hello # 编译 64 位</span><br><span class="line">clang -target armv7-linux-android21 _01helloworld.c -o hello     # 编译 32 位</span><br></pre></td></tr></table></figure><p>使用 <code>file</code> 查看, 结果为: <code>hello: ELF 64-bit LSB shared object, ARM aarch64, version 1 (SYSV), dynamically linked, interpreter /system/bin/linker64, not stripped</code></p><h2 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h2><p>获取预编译的文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -target arm-linux-android21 -E _01helloworld.c *-o arm*hello.i</span><br></pre></td></tr></table></figure><p>使用 <code>clang</code> 命令, 增加 <code>-E</code> 参数, 生成一个 <code>.i</code> 尾缀的文件</p><ul><li>hello.i</li></ul><p>预处理过程将源文件中导入的头文件和宏展开; 预处理输出结果还是一个源程序文件, 以 <code>.i</code> 为扩展名</p><h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -target arm-linux-android21 -S arm_hello.i -o arm_hello.s</span><br></pre></td></tr></table></figure><p>使用 <code>clang</code> 命令, 增加 <code>-S</code> 参数, 将 <code>.i</code> 文件生成为一个尾缀 <code>.s</code> 文件</p><ul><li>arm_hello.s</li></ul><h2 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -target arm-linux-android21 -c arm_hello.s -o arm_hello.o</span><br></pre></td></tr></table></figure><p>此时生成的 <code>arm_hello.o</code> , 生成一个可重定位目标文件, 以 <code>.o</code> 为扩展名;</p><p>它是一个二进制文件, 其中的代码已经是机器指令了;</p><p>数据以及其他信息也都用二进制表示, 所以它不可读, 打开显示为乱码;</p><h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><p>将多个 <code>.o</code> 文件通过命令链接成一个可执行文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -taregt arm-linux-adnroid21 arm_hello.o -o arm_hello</span><br></pre></td></tr></table></figure><p>在 <code>android</code> 中运行</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-12-03-073133.png" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-12-03-073133.png"></p>]]></content>
      
      
      <categories>
          
          <category> so </category>
          
      </categories>
      
      
        <tags>
            
            <tag> arm </tag>
            
            <tag> so </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>101辅导</title>
      <link href="101fudao/"/>
      <url>101fudao/</url>
      
        <content type="html"><![CDATA[<h1 id="INFO"><a href="#INFO" class="headerlink" title="INFO"></a>INFO</h1><p>app: 101辅导<br>包名: com.chinaedu.blessonstu<br>版本: 1.8.5</p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>直接搜索 “signature” 定位到关键代码<code>com.chinaedu.http.interceptor.SHA1EncryptInterceptor</code>;<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-15-083222.png" alt="img"></p><p>该类是一个<code>interceptor</code> , 通过 <code>addInterceptor</code>方法添加到 <code>OkHttpClient</code> 中;<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-15-083132.png" alt="img"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///&lt;reference path=&#x27;./index.d.ts&#x27;/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;执行 -&gt; &quot;</span>,<span class="string">&quot;hook&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> Sha1Clazz = Java.use(<span class="string">&quot;com.chinaedu.blessonstu.utils.SHA1Utils&quot;</span>);</span><br><span class="line">        Java.openClassFile(<span class="string">&quot;/data/local/tmp/r0gson.dex&quot;</span>).load();</span><br><span class="line">        <span class="keyword">var</span> gson = Java.use(<span class="string">&quot;com.r0ysue.gson.Gson&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Sha1Clazz.makeSignature.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">map, str</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;makeSignature map:&quot;</span>,gson.$new().toJson(map));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;makeSignature str:&quot;</span>, str);</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">this</span>.makeSignature(map, str);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;makeSignature result:&quot;</span>, result);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Sha1Clazz.SHA1.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;SHA1 str&quot;</span>, str);</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">this</span>.SHA1(str);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;SHA1 result&quot;</span>, result);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    hook();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-15-084738.png" alt="img"></p><ol><li>对请求参数进行排序</li><li>排序之后拼接字符串 key=value</li><li>添加&amp;符进行分割</li><li>末位添加 salt: 00302c79-3a50-47ae-89f3-242f51b3e817</li><li>对字符串进行标准的 sha1 摘要</li></ol><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-15-085117.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> demo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> demo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>铁甲</title>
      <link href="tiejia/"/>
      <url>tiejia/</url>
      
        <content type="html"><![CDATA[<h1 id="INFO"><a href="#INFO" class="headerlink" title="INFO"></a>INFO</h1><p>app: 铁甲<br>包名: com.cehome.cehomebbs<br>版本: 3.9.9.0</p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>使用关键词搜索 “token” 可以直接定位到关键代码 <code>cehome.sdk.utils.AesUtil.getSystemHeader</code><br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-15-080348.png" alt="img"><br>定位到关键代码, 使用了 Aes 进行加密; 进入该方法可以看到使用的标准的加密:<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-15-080428.png" alt="img"></p><ol><li>加密内容: “cehomeapp@” + uuid</li><li>key: j33$E@GctUXJtVfO</li><li>ECB/PKCS5Padding</li></ol><h1 id="python-实现"><a href="#python-实现" class="headerlink" title="python 实现"></a>python 实现</h1><p><a href="https://github.com/kevinspider/snip/blob/main/AesEcb.py">AesEcb</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Mapping</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> Padding</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aes_ecb_pkcs7_b64_encrypt</span>(<span class="params">data, key</span>):</span></span><br><span class="line">    data = Padding.pad(data.encode(<span class="string">&#x27;utf-8&#x27;</span>), AES.block_size, <span class="string">&#x27;pkcs7&#x27;</span>)</span><br><span class="line">    aes = AES.new(key.encode(<span class="string">&#x27;utf-8&#x27;</span>), AES.MODE_ECB)</span><br><span class="line">    <span class="keyword">return</span> b64encode(aes.encrypt(data)).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aes_ecb_pkcs7_b64_decrypt</span>(<span class="params">data, key</span>):</span></span><br><span class="line">    data = b64decode(data.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    aes = AES.new(key.encode(<span class="string">&#x27;utf-8&#x27;</span>), AES.MODE_ECB)</span><br><span class="line">    <span class="keyword">return</span> Padding.unpad(aes.decrypt(data), AES.block_size, <span class="string">&#x27;pkcs7&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    result = aes_ecb_pkcs7_b64_encrypt(<span class="string">&quot;cehomeapp@f6b72cfb-e94d-4eba-9aa3-6c41f33118e8&quot;</span>,<span class="string">&quot;j33$E@GctUXJtVfO&quot;</span>)</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> demo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> demo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>宝宝树孕育</title>
      <link href="baobaoshu/"/>
      <url>baobaoshu/</url>
      
        <content type="html"><![CDATA[<h1 id="INFO"><a href="#INFO" class="headerlink" title="INFO"></a>INFO</h1><p>app: com.babytree.apps.pregnancy<br>name: 宝宝树孕育<br>version: 8.31.0</p><h1 id="脱壳"><a href="#脱壳" class="headerlink" title="脱壳"></a>脱壳</h1><p>测试过程中发现, 使用 objection 进行 dexdump 比使用 python 中 dexdump 更加稳定;<br><code>objection -g com.babytree.apps.pregnancy explore</code><br><code>plugin load /Users/zhangyang/.objection/plugins/dexdump</code><br><code>plugin dexdump dump</code></p><h1 id="合并-dex"><a href="#合并-dex" class="headerlink" title="合并 dex"></a>合并 dex</h1><p>脱壳 dump 下来的 dex 文件存放在 ~/packageName 下, <a href="https://kevinspider.github.io/post/dex2apk/">dex2apk</a>进行合并 dex 文件;<br><code>mkdir source</code><br><code>mv *.dex ./source</code><br><code>python dex2apk.py -a ./baobaoshu.apk -i source</code><br><code>jadx-gui repacked.apk</code></p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>直接搜索 “signature” 可以快速定位到加密位置:<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-15-052527.png" alt="img"><br>或者通过观察加密字段的特征, 使用 md5 反向定位 <a href="https://github.com/kevinspider/snip/blob/main/hookMD5.js">hookmd5</a><br>定位到关键加密位置: com.meitun.mama.util.bt<br>查看该类的 a 方法, 加密逻辑为:</p><ol><li>对请求的 url 进行首字母排序</li><li>遍历排序结果, 进行 key=value 的拼接</li><li>末位添加 salt : iambabytreekey!@#$%^&amp;*()</li><li>对结果进行 md5</li></ol>]]></content>
      
      
      <categories>
          
          <category> demo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> demo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git</title>
      <link href="git/"/>
      <url>git/</url>
      
        <content type="html"><![CDATA[<p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-15-032156.jpg" alt="img"></p><ul><li>workspace: 工作区</li><li>index/stage: 暂存区</li><li>repository: 仓库区(本地仓库)</li><li>remote: 远程仓库</li></ul><h1 id="新建代码库"><a href="#新建代码库" class="headerlink" title="新建代码库"></a>新建代码库</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在当前目录新建一个Git代码库</span></span><br><span class="line">$ git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个目录，将其初始化为Git代码库</span></span><br><span class="line">$ git init [project-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载一个项目和它的整个代码历史</span></span><br><span class="line">$ git <span class="built_in">clone</span> [url]</span><br></pre></td></tr></table></figure><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>Git 的配置文件为 .gitconfig, 可以在用户主目录下(全局配置), 也可以在项目目录下(项目配置);</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示当前的Git配置</span></span><br><span class="line">$ git config --list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑Git配置文件</span></span><br><span class="line">$ git config -e [--global]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置提交代码时的用户信息</span></span><br><span class="line">$ git config [--global] user.name <span class="string">&quot;[name]&quot;</span></span><br><span class="line">$ git config [--global] user.email <span class="string">&quot;[email address]&quot;</span></span><br></pre></td></tr></table></figure><h1 id="增加-删除文件"><a href="#增加-删除文件" class="headerlink" title="增加/删除文件"></a>增加/删除文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加指定文件到暂存区</span></span><br><span class="line">$ git add [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加指定目录到暂存区，包括子目录</span></span><br><span class="line">$ git add [dir]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加当前目录的所有文件到暂存区</span></span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加每个变化前，都会要求确认</span></span><br><span class="line"><span class="comment"># 对于同一个文件的多处变化，可以实现分次提交</span></span><br><span class="line">$ git add -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除工作区文件，并且将这次删除放入暂存区</span></span><br><span class="line">$ git rm [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止追踪指定文件，但该文件会保留在工作区</span></span><br><span class="line">$ git rm --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改名文件，并且将这个改名放入暂存区</span></span><br><span class="line">$ git mv [file-original] [file-renamed]</span><br></pre></td></tr></table></figure><h1 id="代码提交"><a href="#代码提交" class="headerlink" title="代码提交"></a>代码提交</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提交暂存区到仓库区</span></span><br><span class="line">$ git commit -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交暂存区的指定文件到仓库区</span></span><br><span class="line">$ git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交工作区自上次commit之后的变化，直接到仓库区</span></span><br><span class="line">$ git commit -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交时显示所有diff信息</span></span><br><span class="line">$ git commit -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用一次新的commit，替代上一次提交</span></span><br><span class="line"><span class="comment"># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span></span><br><span class="line">$ git commit --amend -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重做上一次commit，并包括指定文件的新变化</span></span><br><span class="line">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure><h1 id="远程同步"><a href="#远程同步" class="headerlink" title="远程同步"></a>远程同步</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载远程仓库的所有变动</span></span><br><span class="line">$ git fetch [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有远程仓库</span></span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个远程仓库的信息</span></span><br><span class="line">$ git remote show [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加一个新的远程仓库，并命名</span></span><br><span class="line">$ git remote add [shortname] [url]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取回远程仓库的变化，并与本地分支合并</span></span><br><span class="line">$ git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传本地指定分支到远程仓库</span></span><br><span class="line">$ git push [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强行推送当前分支到远程仓库，即使有冲突</span></span><br><span class="line">$ git push [remote] --force</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送所有分支到远程仓库</span></span><br><span class="line">$ git push [remote] --all</span><br></pre></td></tr></table></figure><h1 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有本地分支</span></span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有远程分支</span></span><br><span class="line">$ git branch -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有本地分支和远程分支</span></span><br><span class="line">$ git branch -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，但依然停留在当前分支</span></span><br><span class="line">$ git branch [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，并切换到该分支</span></span><br><span class="line">$ git checkout -b [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，指向指定commit</span></span><br><span class="line">$ git branch [branch] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，与指定的远程分支建立追踪关系</span></span><br><span class="line">$ git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到指定分支，并更新工作区</span></span><br><span class="line">$ git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到上一个分支</span></span><br><span class="line">$ git checkout -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立追踪关系，在现有分支与指定的远程分支之间</span></span><br><span class="line">$ git branch --set-upstream [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并指定分支到当前分支</span></span><br><span class="line">$ git merge [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择一个commit，合并进当前分支</span></span><br><span class="line">$ git cherry-pick [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line">$ git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程分支</span></span><br><span class="line">$ git push origin --delete [branch-name]</span><br><span class="line">$ git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure><h1 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有tag</span></span><br><span class="line">$ git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个tag在当前commit</span></span><br><span class="line">$ git tag [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个tag在指定commit</span></span><br><span class="line">$ git tag [tag] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除本地tag</span></span><br><span class="line">$ git tag -d [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程tag</span></span><br><span class="line">$ git push origin :refs/tags/[tagName]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看tag信息</span></span><br><span class="line">$ git show [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交指定tag</span></span><br><span class="line">$ git push [remote] [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交所有tag</span></span><br><span class="line">$ git push [remote] --tags</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，指向某个tag</span></span><br><span class="line">$ git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure><h1 id="查看信息"><a href="#查看信息" class="headerlink" title="查看信息"></a>查看信息</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示有变更的文件</span></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的版本历史</span></span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示commit历史，以及每次commit发生变更的文件</span></span><br><span class="line">$ git <span class="built_in">log</span> --<span class="built_in">stat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索提交历史，根据关键词</span></span><br><span class="line">$ git <span class="built_in">log</span> -S [keyword]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个commit之后的所有变动，每个commit占据一行</span></span><br><span class="line">$ git <span class="built_in">log</span> [tag] HEAD --pretty=format:%s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个commit之后的所有变动，其&quot;提交说明&quot;必须符合搜索条件</span></span><br><span class="line">$ git <span class="built_in">log</span> [tag] HEAD --grep feature</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个文件的版本历史，包括文件改名</span></span><br><span class="line">$ git <span class="built_in">log</span> --follow [file]</span><br><span class="line">$ git whatchanged [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定文件相关的每一次diff</span></span><br><span class="line">$ git <span class="built_in">log</span> -p [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示过去5次提交</span></span><br><span class="line">$ git <span class="built_in">log</span> -5 --pretty --oneline</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有提交过的用户，按提交次数排序</span></span><br><span class="line">$ git shortlog -sn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定文件是什么人在什么时间修改过</span></span><br><span class="line">$ git blame [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示暂存区和工作区的差异</span></span><br><span class="line">$ git diff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示暂存区和上一个commit的差异</span></span><br><span class="line">$ git diff --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示工作区与当前分支最新commit之间的差异</span></span><br><span class="line">$ git diff HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示两次提交之间的差异</span></span><br><span class="line">$ git diff [first-branch]...[second-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示今天你写了多少行代码</span></span><br><span class="line">$ git diff --shortstat <span class="string">&quot;@&#123;0 day ago&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交的元数据和内容变化</span></span><br><span class="line">$ git show [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交发生变化的文件</span></span><br><span class="line">$ git show --name-only [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交时，某个文件的内容</span></span><br><span class="line">$ git show [commit]:[filename]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的最近几次提交</span></span><br><span class="line">$ git reflog</span><br></pre></td></tr></table></figure><h1 id="撤销"><a href="#撤销" class="headerlink" title="撤销"></a>撤销</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 恢复暂存区的指定文件到工作区</span></span><br><span class="line">$ git checkout [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复某个commit的指定文件到暂存区和工作区</span></span><br><span class="line">$ git checkout [commit] [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复暂存区的所有文件到工作区</span></span><br><span class="line">$ git checkout .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</span></span><br><span class="line">$ git reset [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置暂存区与工作区，与上一次commit保持一致</span></span><br><span class="line">$ git reset --hard</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</span></span><br><span class="line">$ git reset [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</span></span><br><span class="line">$ git reset --hard [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前HEAD为指定commit，但保持暂存区和工作区不变</span></span><br><span class="line">$ git reset --keep [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个commit，用来撤销指定commit</span></span><br><span class="line"><span class="comment"># 后者的所有变化都将被前者抵消，并且应用到当前分支</span></span><br><span class="line">$ git revert [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暂时将未提交的变化移除，稍后再移入</span></span><br><span class="line">$ git stash</span><br><span class="line">$ git stash pop</span><br></pre></td></tr></table></figure><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成一个可供发布的压缩包</span></span><br><span class="line">$ git archive</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置换行符为LF</span></span><br><span class="line">git config --global core.autocrlf <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#拒绝提交包含混合换行符的文件</span></span><br><span class="line">git config --global core.safecrlf <span class="literal">true</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> others </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dex2apk</title>
      <link href="dex2apk/"/>
      <url>dex2apk/</url>
      
        <content type="html"><![CDATA[<p>使用脱壳工具脱下来的 dex 合并成 apk; 直接拖入 jadx-gui 中查看<br>针对之前出现的某些 dex 格式错误, 导致重新打包之后会出现 jadx-gui 无法打开的问题;</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rename_class</span>(<span class="params">path</span>):</span></span><br><span class="line">   files = os.listdir(path)</span><br><span class="line">   dex_index = <span class="number">0</span></span><br><span class="line">   <span class="keyword">if</span> path.endswith(<span class="string">&#x27;/&#x27;</span>):</span><br><span class="line">       path = path[:-<span class="number">1</span>]</span><br><span class="line">       print(path)</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(files)):</span><br><span class="line">       <span class="keyword">if</span> files[i].endswith(<span class="string">&#x27;.dex&#x27;</span>):</span><br><span class="line">           old_name = path + <span class="string">&#x27;/&#x27;</span> + files[i]</span><br><span class="line">           <span class="keyword">if</span> dex_index == <span class="number">0</span>:</span><br><span class="line">               new_name = path + <span class="string">&#x27;/&#x27;</span> + <span class="string">&#x27;classes.dex&#x27;</span></span><br><span class="line">           <span class="keyword">else</span>:</span><br><span class="line">               new_name = path + <span class="string">&#x27;/&#x27;</span> + <span class="string">&#x27;classes%d.dex&#x27;</span> % dex_index</span><br><span class="line">           dex_index += <span class="number">1</span></span><br><span class="line">           <span class="keyword">if</span> os.path.exists(new_name):</span><br><span class="line">               <span class="keyword">continue</span></span><br><span class="line">           os.rename(old_name, new_name)</span><br><span class="line">   print(<span class="string">&#x27;[*] 重命名完毕&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_dex</span>(<span class="params">path</span>):</span></span><br><span class="line">   files = os.listdir(path)</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(files)):</span><br><span class="line">       <span class="keyword">if</span> files[i].endswith(<span class="string">&quot;.dex&quot;</span>):</span><br><span class="line">           flag = os.popen(<span class="string">&quot;jadx -s &quot;</span> + path + <span class="string">&quot;/&quot;</span> + files[i]).read()</span><br><span class="line">           print(<span class="string">&quot;flag&quot;</span>, flag)</span><br><span class="line">           <span class="keyword">if</span> <span class="string">&quot;INFO  - done&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">               print(<span class="string">&quot;校验成功&quot;</span>)</span><br><span class="line">           <span class="keyword">else</span>:</span><br><span class="line">               print(<span class="string">&quot;校验失败, 删除文件&quot;</span> + path + <span class="string">&quot;/&quot;</span> + files[i])</span><br><span class="line">               os.remove(path + <span class="string">&quot;/&quot;</span> + files[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extract_META_INF_from_apk</span>(<span class="params">apk_path, target_path</span>):</span></span><br><span class="line">   r = zipfile.is_zipfile(apk_path)</span><br><span class="line">   <span class="keyword">if</span> r:</span><br><span class="line">       fz = zipfile.ZipFile(apk_path, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">       <span class="keyword">for</span> file <span class="keyword">in</span> fz.namelist():</span><br><span class="line">           <span class="keyword">if</span> file.startswith(<span class="string">&#x27;META-INF&#x27;</span>):</span><br><span class="line">               fz.extract(file, target_path)</span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">       print(<span class="string">&#x27;[-] %s 不是一个APK文件&#x27;</span> % apk_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zip_dir</span>(<span class="params">dirname, zipfilename</span>):</span></span><br><span class="line">   filelist = []</span><br><span class="line">   <span class="keyword">if</span> os.path.isfile(dirname):</span><br><span class="line">       <span class="keyword">if</span> dirname.endswith(<span class="string">&#x27;.dex&#x27;</span>):</span><br><span class="line">           filelist.append(dirname)</span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">       <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(dirname):</span><br><span class="line">           <span class="keyword">for</span> <span class="built_in">dir</span> <span class="keyword">in</span> dirs:</span><br><span class="line">               <span class="comment"># if dir == &#x27;META-INF&#x27;:</span></span><br><span class="line">               <span class="comment"># print(&#x27;dir:&#x27;, os.path.join(root, dir))</span></span><br><span class="line">               filelist.append(os.path.join(root, <span class="built_in">dir</span>))</span><br><span class="line">           <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">               <span class="comment"># print(&#x27;file:&#x27;, os.path.join(root, name))</span></span><br><span class="line"></span><br><span class="line">               filelist.append(os.path.join(root, name))</span><br><span class="line"></span><br><span class="line">   z = zipfile.ZipFile(zipfilename, <span class="string">&#x27;w&#x27;</span>, zipfile.ZIP_DEFLATED)</span><br><span class="line">   <span class="keyword">for</span> tar <span class="keyword">in</span> filelist:</span><br><span class="line">       arcname = tar[<span class="built_in">len</span>(dirname):]</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (<span class="string">&#x27;META-INF&#x27;</span> <span class="keyword">in</span> arcname <span class="keyword">or</span> arcname.endswith(<span class="string">&#x27;.dex&#x27;</span>)) <span class="keyword">and</span> <span class="string">&#x27;.DS_Store&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> arcname:</span><br><span class="line">           z.write(tar, arcname)</span><br><span class="line">   print(<span class="string">&#x27;[*] APK打包成功，你可以拖入APK进行分析啦！&#x27;</span>  )</span><br><span class="line">   z.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_args</span>():</span></span><br><span class="line">   parser = argparse.ArgumentParser(description=<span class="string">&#x27;repackage dumped dex to apk for jeb/jadx analysis.&#x27;</span>)</span><br><span class="line">   parser.add_argument(<span class="string">&#x27;-a&#x27;</span>, <span class="string">&#x27;--apk_path&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">type</span>=<span class="built_in">str</span>,</span><br><span class="line">                       <span class="built_in">help</span>=<span class="string">&#x27;apk for extracting META-INF&#x27;</span>)</span><br><span class="line">   parser.add_argument(<span class="string">&#x27;-i&#x27;</span>, <span class="string">&#x27;--dex_path&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">type</span>=<span class="built_in">str</span>,</span><br><span class="line">                       <span class="built_in">help</span>=<span class="string">&#x27;path of dumped dex&#x27;</span>)</span><br><span class="line">   parser.add_argument(<span class="string">&#x27;-o&#x27;</span>, <span class="string">&#x27;--output&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&quot;repacked.apk&quot;</span>,</span><br><span class="line">                       <span class="built_in">help</span>=<span class="string">&#x27;apk path after zip&#x27;</span>)</span><br><span class="line">   args = parser.parse_args()</span><br><span class="line">   <span class="comment">#print(args.apk_path)</span></span><br><span class="line">   <span class="keyword">return</span> args</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">   args = parse_args()</span><br><span class="line">   rename_class(args.dex_path)</span><br><span class="line">   check_dex(args.dex_path)</span><br><span class="line">   extract_META_INF_from_apk(args.apk_path, args.dex_path)</span><br><span class="line">   <span class="comment"># zip_file(args.dex_path)</span></span><br><span class="line">   zip_dir(args.dex_path, args.output)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment"># usage</span></span><br><span class="line">   <span class="comment"># jadx 需要加入环境变量</span></span><br><span class="line">   <span class="comment"># python dex2apk.py -a ./baobaoshu.apk -i com.babytree.apps.pregnancy</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> others </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>本来生活</title>
      <link href="benlaishenghuo/"/>
      <url>benlaishenghuo/</url>
      
        <content type="html"><![CDATA[<h1 id="INFO"><a href="#INFO" class="headerlink" title="INFO"></a>INFO</h1><p>app: com.android.benlailife.activity<br>name: 本来生活<br>version: 5.7.1</p><h1 id="脱壳"><a href="#脱壳" class="headerlink" title="脱壳"></a>脱壳</h1><p><code>frida-dexdump dump</code><br><code>grep -grep -rnli &quot;mainactivity&quot; ./</code><br>找到目标 <code>dex</code> 文件, 使用 <code>jadx-gui</code> 打开</p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><h2 id="sign-参数"><a href="#sign-参数" class="headerlink" title="sign 参数"></a>sign 参数</h2><p>直接全局搜索 “sign” 很容易定位到 <code>com.android.benlai.request.basic.c</code> 中的 <code>createSign</code>方法;<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-11-120100.png" alt="img"></p><ol><li>对输入的 map 根据键进行排序</li><li>遍历排序结果拼接成字符串</li><li>字符串末位添加 salt : <code>benlai</code></li><li>调用 <code>u.a</code>方法, 进入之后看到就是一个标准的 md5, 然后将 md5 的结果转成大写</li></ol><h2 id="Authorization"><a href="#Authorization" class="headerlink" title="Authorization"></a>Authorization</h2><p>清空 app 的缓存, 抓包发现在启动的较早时机会发出一个 <code>https://api.benlai.com/v5/token</code> 的请求; 此时的 <code>Authorization</code> 是一个定值; 写死或者通过 hook 获取都可以</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CredentialsClazz = Java.use(<span class="string">&quot;okhttp3.Credentials&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> result = CredentialsClazz.basic(<span class="string">&quot;ffa50d1669fe48e3a512fe68d7f5d10e&quot;</span>,<span class="string">&quot;3e4b5ac89c5746ab8a1d72df8242b126&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;request_token_au&quot;</span>, result);</span><br></pre></td></tr></table></figure><p>通过 hook 的方式也可以手动获取和清空该值, 每次清空该值之后再请求都会触发 <code>https://api.benlai.com/v5/token</code> 请求;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 authorization</span></span><br><span class="line"><span class="keyword">var</span> mmkvClazz = Java.use(<span class="string">&quot;com.tencent.mmkv.MMKV&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> mmkv_token = mmkvClazz.mmkvWithID(<span class="string">&quot;MMKV_TOKEN&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;mmkv_token&quot;</span>, mmkv_token);</span><br><span class="line"><span class="keyword">var</span> result = mmkv_token.decodeString(<span class="string">&quot;GLOBAL_TOKEN&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;result&quot;</span>, result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清空</span></span><br><span class="line">mmkv_token.encode(<span class="string">&quot;GLOBAL_TOKEN&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;重制 global_token&quot;</span>);</span><br></pre></td></tr></table></figure><p>拿到的响应内容为:<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-11-120622.png" alt="img"><br>access_token 就是之后请求数据要使用的 <code>Authorization</code>;</p><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">__author__ = <span class="string">&quot;Kevin&quot;</span></span><br><span class="line">__time__ = <span class="string">&quot;2021/3/11&quot;</span></span><br><span class="line">__blog__ = <span class="string">&quot;https://kevinspider.github.io/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">deviceId = <span class="string">&#x27;010214c4-9b56-4130-a4d9-3124c82462f0&#x27;</span></span><br><span class="line">android_id = <span class="string">&#x27;37cea1958c8c5c1e&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encodeMethod</span>(<span class="params">params</span>):</span></span><br><span class="line">    dict_2 = <span class="built_in">dict</span>(<span class="built_in">sorted</span>(params.items(), key=<span class="keyword">lambda</span> i: i[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">input</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> dict_2:</span><br><span class="line">        <span class="built_in">input</span> += key + dict_2[key]</span><br><span class="line"></span><br><span class="line">    print(<span class="built_in">input</span>)</span><br><span class="line">    <span class="built_in">input</span> += <span class="string">&quot;benlai&quot;</span></span><br><span class="line"></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(<span class="built_in">input</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    md5_result = md5.hexdigest().upper()</span><br><span class="line">    <span class="keyword">return</span> md5_result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAccessToken</span>():</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;Basic ZmZhNTBkMTY2OWZlNDhlM2E1MTJmZTY4ZDdmNWQxMGU6M2U0YjVhYzg5YzU3NDZhYjhhMWQ3MmRmODI0MmIxMjY=&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Dalvik/2.1.0(Linux;U;Android8.1.0;Nexus6PBuild/OPM7.181205.001)&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;api.benlai.com&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;systemVersion&quot;</span>: <span class="string">&quot;8.1.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;phoneModel&quot;</span>: <span class="string">&quot;Nexus_6P&quot;</span>,</span><br><span class="line">        <span class="string">&quot;localcity&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pageid&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;source&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;nativeVersion&quot;</span>: <span class="string">&quot;5.7.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;t&quot;</span>: <span class="built_in">str</span>(<span class="built_in">int</span>(time.time() * <span class="number">1000</span>)),</span><br><span class="line">        <span class="string">&quot;imei&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="comment"># &quot;sign&quot;: &quot;48B07E12DB11CECBE2A00B86AFD851A8&quot;,</span></span><br><span class="line">        <span class="string">&quot;webId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;version&quot;</span>: <span class="string">&quot;5.7.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;android_id&quot;</span>: android_id,</span><br><span class="line">        <span class="string">&quot;channel&quot;</span>: <span class="string">&quot;yyb&quot;</span>,</span><br><span class="line">        <span class="string">&quot;deviceId&quot;</span>: deviceId,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">      <span class="string">&#x27;grant_Type&#x27;</span>: <span class="string">&#x27;Client_Credentials&#x27;</span>,</span><br><span class="line">      <span class="comment"># &#x27;sign&#x27;: &#x27;48B07E12DB11CECBE2A00B86AFD851A8&#x27;,</span></span><br><span class="line">      <span class="string">&#x27;channel&#x27;</span>: <span class="string">&#x27;yyb&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;pageid&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;systemVersion&#x27;</span>: <span class="string">&#x27;8.1.0&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;deviceId&#x27;</span>: deviceId,</span><br><span class="line">      <span class="string">&#x27;phoneModel&#x27;</span>: <span class="string">&#x27;Nexus_6P&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;localcity&#x27;</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;nativeVersion&#x27;</span>: <span class="string">&#x27;5.7.1&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;5.7.1&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;webId&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;t&#x27;</span>: <span class="built_in">str</span>(<span class="built_in">int</span>(time.time() * <span class="number">1000</span>)),</span><br><span class="line">      <span class="string">&#x27;imei&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;android_id&#x27;</span>: android_id</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    md5_result = encodeMethod(params)</span><br><span class="line"></span><br><span class="line">    data[<span class="string">&#x27;sign&#x27;</span>] = md5_result</span><br><span class="line">    params[<span class="string">&#x27;sign&#x27;</span>] = md5_result</span><br><span class="line"></span><br><span class="line">    response = requests.post(<span class="string">&#x27;https://api.benlai.com/v5/token&#x27;</span>, headers=headers, params=params, data=data)</span><br><span class="line">    data = response.json()</span><br><span class="line"></span><br><span class="line">    access_token = data[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;access_token&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> access_token</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getList</span>(<span class="params">accessToken</span>):</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&quot;Bearer &quot;</span> + accessToken,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Dalvik/2.1.0(Linux;U;Android8.1.0;Nexus6PBuild/OPM7.181205.001)&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;api.benlai.com&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;channel&#x27;</span>: <span class="string">&#x27;yyb&#x27;</span>,</span><br><span class="line">        <span class="comment"># &#x27;sign&#x27;: &#x27;615AECBF4D611D71934E999D0164A693&#x27;,</span></span><br><span class="line">        <span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pageid&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;systemVersion&#x27;</span>: <span class="string">&#x27;8.1.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;deviceId&#x27;</span>: deviceId,</span><br><span class="line">        <span class="string">&#x27;phoneModel&#x27;</span>: <span class="string">&#x27;Nexus_6P&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;limit&#x27;</span>: <span class="string">&#x27;10&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;categorySysNo&#x27;</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;offset&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;localcity&#x27;</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;5.7.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;nativeVersion&#x27;</span>: <span class="string">&#x27;5.7.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;webId&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;t&#x27;</span>: <span class="built_in">str</span>(<span class="built_in">int</span>(time.time() * <span class="number">1000</span>)),</span><br><span class="line">        <span class="string">&#x27;imei&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;android_id&#x27;</span>: android_id,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    md5_result = encodeMethod(params)</span><br><span class="line">    params[<span class="string">&#x27;sign&#x27;</span>] = md5_result</span><br><span class="line"></span><br><span class="line">    response = requests.get(<span class="string">&#x27;https://api.benlai.com/v5/IHome/GetHomePageTagInfo&#x27;</span>, headers=headers, params=params)</span><br><span class="line">    print(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    accessToken = getAccessToken()</span><br><span class="line">    print(accessToken)</span><br><span class="line">    getList(accessToken)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> demo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> demo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>frida 抓包</title>
      <link href="zhuabao/"/>
      <url>zhuabao/</url>
      
        <content type="html"><![CDATA[<h1 id="Http-和-Https"><a href="#Http-和-Https" class="headerlink" title="Http 和 Https"></a>Http 和 Https</h1><h2 id="Http-的弊端"><a href="#Http-的弊端" class="headerlink" title="Http 的弊端"></a>Http 的弊端</h2><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-09-031554.jpg"></p><p>Http 在传输数据的过程中, 所有的数据都是明文传输的, 没有安全性可言; 想要让 Http 更加安全, 只能使用加密算法对信息进行加密之后再传输, 只要确保密钥不被第三方获取, 那么就能确保数据传输的安全性;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-09-031841.jpg"></p><p>在 Http 的基础上, 对原有的 Http 进行 TLS 或 SSL 的加密, 提高安全性; Https = Http + SSL/TLS</p><h2 id="Https-工作原理"><a href="#Https-工作原理" class="headerlink" title="Https 工作原理"></a>Https 工作原理</h2><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-09-032601.jpg" alt="未命名图片"></p><ul><li><p>证书验证</p><ul><li>  ① 客户端发起请求, 连接到服务端的443端口(Https 默认端口)</li><li>  ②采用 Http 协议的服务器必须要有一套数字 CA 证书, 颁发证书的同时会产生一个私钥和一个公钥, 私钥由服务端自己保存, 公钥则是附带在证书信息中, 可以公开; 证书本身也附带一个证书电子签名, 这个签名用来验证证书的完整性和真实性, 防止证书被篡改;</li><li>  ③服务器响应客户端请求, 将证书传递给客户端, 证书包含公钥和其他信息, 如: 证书颁发机构, 公司信息, 和证书有效期等;</li><li>④客户端解析证书并对其进行验证<ul><li>  如果证书不是可信机构颁布的, 或者证书中的域名和实际域名不一致, 或者证书已经过期, 就会向访问者显示一个警告, 告知风险; </li><li>  如果证书可信任, 进入接下来的数据传输中的非对称加密流程</li></ul></li></ul></li><li><p>数据传输</p><ul><li><p>非对称加密</p><p>  <img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-09-034704.png" alt="img"></p><ul><li>  客户端判断证书可信任, 客户端会从服务器证书中取出服务器的公钥, 并生成一个随机码 Key, 再使用服务器的公钥对 Key 进行加密;</li><li>  ⑤客户端将使用服务器公钥加密之后的 Key 的结果发送给服务器</li><li>  ⑥服务器使用自己的私钥对客户端发送过来的加密之后的 Key 进行解密, 获取到之后对称加密服务器和客户端通信的密钥 Key;</li></ul></li><li><p>对称加密</p><p>  <img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-09-034800.png" alt="img"></p><ul><li>  ⑦使用从客户端获取到的 Key 对信息进行加密, 发送给客户端</li><li>  ⑧之后客户端和服务器都通过这个 Key 对数据进行加解密, 传输所有的内容</li></ul></li></ul></li></ul><h1 id="Http-TCP-Socket"><a href="#Http-TCP-Socket" class="headerlink" title="Http/TCP/Socket"></a>Http/TCP/Socket</h1><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-05-07-030157.jpg"></p><p>HTTP是应用层的协议，也是开发中最常用的一个网络协议；TCP是传输层的协议，大学学过计算机网络的都知道，该层还有一个UDP协议; Socket 本质是(API)，对TCP/IP的封装，可供程序员做网络通讯开发是所调用, Socket 本质是从传输层抽象出来的, 采用 IP 地址和端口号的形式进行标识, 并不是传统意义上的网络协议;</p><h2 id="TCP-和-Http"><a href="#TCP-和-Http" class="headerlink" title="TCP 和 Http"></a>TCP 和 Http</h2><p>在网络分层中, Http 协议是基于 TCP 协议的, 客户端向服务器发送一个 Http 请求时, 需要先和服务端建立 TCP 连接, 也就是经典的三次握手, 握手成功后才会进行数据交互; 总结: Http 基于 TCP</p><h2 id="TCP-和-Socket"><a href="#TCP-和-Socket" class="headerlink" title="TCP 和 Socket"></a>TCP 和 Socket</h2><p>Socket是应用层与传输层之间的同一个抽象层，它是一套接口，所以Socket连接可以基于TCP连接，也有可能基于UDP。我们知道，TCP协议是可靠的，UDP协议是不可靠的，那么基于TCP协议的Socket连接同样是可靠的；基于UDP协议的Socket连接是不可靠的，大多数的即时通讯工具都是基于后者实现的。</p><h2 id="Http-和-Socket"><a href="#Http-和-Socket" class="headerlink" title="Http 和 Socket"></a>Http 和 Socket</h2><p>HTTP连接中，只有客户端发起请求后服务端才会响应，服务端是无法主动向客户端发消息的。而Socket连接中，通信双方发送消息并没有先后的限制，通信双方中的任何一方可以随时向另一方发送消息。</p><h1 id="SSl-和-TLS"><a href="#SSl-和-TLS" class="headerlink" title="SSl 和 TLS"></a>SSl 和 TLS</h1><h2 id="SSL-和-TLS-概念"><a href="#SSL-和-TLS-概念" class="headerlink" title="SSL 和 TLS 概念"></a>SSL 和 TLS 概念</h2><p>SSL 和 TLS 协议可以为通信双方提供识别和认证通道，从而保证通信的机密性和数据完整性。TLS 协议是从 Netscape SSL 3.0 协议演变而来的，不过这两种协议并不兼容，SSL 已经逐渐被 TLS 取代，所以下文就以 TLS 指代安全层;</p><h2 id="SSL-TLS-握手"><a href="#SSL-TLS-握手" class="headerlink" title="SSL/TLS 握手"></a>SSL/TLS 握手</h2><p>TLS 握手是启动 HTTPS 通信的过程，类似于 TCP 建立连接时的三次握手。 在 TLS 握手的过程中，通信双方交换消息以相互验证，相互确认，并确立它们所要使用的加密算法以及会话密钥 (用于对称加密的密钥)。可以说，TLS 握手是 HTTPS 通信的基础部分。</p><p>TLS 握手过程, 总共做了四件事:</p><ol><li> 商定双方通信所使用的 TLS 版本, 例如: TLS1.0, 1.2, 1.3等</li><li> 确定双方所要使用的密码组合;</li><li> 客户端通过服务器的公钥和数字证书上的数字签名验证服务端的身份;</li><li> 生成会话密钥, 并将密钥用于握手结束后的对称加密;</li></ol><p>详细过程:</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-04-09-051254.jpg" alt="未命名图片 (1)"></p><ol><li>“client hello” 消息: 客户端通过发送 “client hello” 消息向服务器发起握手请求, 该消息包含了:<ol><li> 客户端所支持的 TLS 版本和密码组合, 以供服务器进行选择</li><li> client random 随机字符串</li></ol></li><li>“server hello” 消息: 服务器发送 “server hello” 消息对客户端进行回应, 该消息包含了:<ol><li> 数字证书, 服务器选择的密码组合 </li><li> server random 随机字符串</li></ol></li><li>验证: 客户端对服务器发来的证书进行验证, 确保对方身份的合法性; 验证步骤为:<ol><li> 检查数字签名</li><li> 验证证书链</li><li> 检查证书的有效期</li><li> 检查证书撤回状态</li></ol></li><li> “premaster secret” 字符串: 客户端向服务器发送另一个随机字符串 “premaster secret” (预主密码), 这个字符串是经过服务器的公钥加密过的, 只有对应的私钥才能解密</li><li> 服务器使用私钥解密客户端发过来的加密的 “premaster secret”</li><li> 生成共享密钥: 经过上述步骤之后, 客户端和服务器都拥有了相同的 <strong>client random</strong>, <strong>server random</strong> 和 <strong>premaster secret</strong>, 并通过相同的算法生成相同的共享密钥 Key;</li><li> 客户端就绪: 客户端发送经过共享密钥 Key 加密后的 Finished 信号</li><li> 服务器就绪: 服务器发送经过共享密钥 Key 加密后的 Finished 信号</li><li> 达成安全通信: 握手完成, 双方使用对称加密进行安全通信</li></ol><h1 id="Https-中间人抓包"><a href="#Https-中间人抓包" class="headerlink" title="Https 中间人抓包"></a>Https 中间人抓包</h1><h2 id="高版本安卓系统如何导入证书"><a href="#高版本安卓系统如何导入证书" class="headerlink" title="高版本安卓系统如何导入证书"></a>高版本安卓系统如何导入证书</h2><ol><li><p><a href="https://github.com/Magisk-Modules-Repo/movecert">magisk - Move Certificates 模块</a></p></li><li><p>Aosp 直接将证书编译到系统中 <a href="https://www.52pojie.cn/thread-1382688-1-1.html">参考链接</a></p></li><li><p><a href="http://zhaoxincheng.com/index.php/2020/07/16/%E5%AE%89%E5%8D%937-0%E5%8F%8A%E4%BB%A5%E4%B8%8A%E6%8A%93%E5%8C%85%E8%AF%81%E4%B9%A6%E5%B0%8F%E6%8A%80%E5%B7%A7/">re 管理器</a></p></li><li><p>命令行</p><p>charles导出.cer证书，选择.cer类型 保存在pc上</p><ol><li>修改证书名称<br>系统证书目录：/system/etc/security/cacerts/<br>其中的每个证书的命名规则如下：<br><Certificate_Hash>.<br>文件名是一个Hash值，而后缀是一个数字。<br>文件名可以用下面的命令计算出来：<br>openssl x509 -subject_hash_old -in <Certificate_File><br>后缀名的数字是为了防止文件名冲突的，比如如果两个证书算出的Hash值是一样的话，那么一个证书的后缀名数字可以设置成0，而另一个证书的后缀名数字可以设置成1</li><li>复制证书到设备上<br>adb push xxxxxxx.0 /sdcard/</li><li>复制到系统目录并修改权限（安卓8.1.0 Magisk Root）<br>mount -o rw,remount /system 【不修改 没法写入】<br>mount -o rw,remount /<br>mv /sdcard/xxxxxxx.0 /etc/security/cacerts/ 移动文件到系统<br>chown root:root /etc/security/cacerts/fc365f9d.0 修改用户组<br>chmod 644 /system/etc/security/cacerts/xxxxxxx.0 修改权限</li></ol></li></ol><h2 id="抓包失败常见问题"><a href="#抓包失败常见问题" class="headerlink" title="抓包失败常见问题"></a>抓包失败常见问题</h2><ol><li>单向证书校验中 (C 校验 S), 没有将抓包工具证书放在手机中 <code>400 Bad Request</code></li><li>双向证书检验中 (S 校验 C), 没有向抓包工具配置 App 证书 <code>No required SSL certificate was sent</code></li><li>SSL PINNING 配置好了证书依然无法抓包</li></ol><h2 id="证书验证"><a href="#证书验证" class="headerlink" title="证书验证"></a>证书验证</h2><h3 id="什么是单向证书验证"><a href="#什么是单向证书验证" class="headerlink" title="什么是单向证书验证"></a>什么是单向证书验证</h3><p>单向认证流程中, 服务器端保存着公钥证书和私钥两个文件, 流程如下:<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-03-050703.jpg" alt="img"></p><ol><li>客户端发起建立 Https 连接请求, 将 SSL 协议版本的信息发送给服务器端;</li><li>服务器端将本机的公钥证书发送给客户端;</li><li>客户端读取公钥证书, 取出服务端公钥;</li><li>客户端生成一个随机数(秘钥 R), 用刚才得到的服务器公钥去加密这个随机数形成密文, 发送给服务端;</li><li>服务端用自己的私钥去解密密文, 得到秘钥 R;</li><li>服务端和客户端在之后的通讯中就使用秘钥 R 进行通信;</li></ol><h3 id="什么是双向证书验证"><a href="#什么是双向证书验证" class="headerlink" title="什么是双向证书验证"></a>什么是双向证书验证</h3><p>双向认证, 客户端和服务器端都需要验证对方的身份, 在建立 Https 连接的过程中, 握手的流程比单向认证多了几步; 单向认证过程, 客户端从服务器端下载服务器端公钥证书进行验证, 然后建立安全通信通道; 双向验证中, 客服端除了需要从服务器端下载服务器的公钥证书进行验证之外, 还需要把客户端的公钥证书上传到服务器端给服务器端进行验证, 等双方都认证通过了, 才开始建立安全通信通道进行数据传输;</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-03-051308.jpg" alt="img"></p><ol><li>客户端发起建立 Https 连接请求, 将 SSL 协议版本的信息发送到服务器端;</li><li>服务器端将本机的公钥证书发送给客户端;</li><li>客户端读取公钥证书, 取出服务器公钥;</li><li>客户端将客户端的公钥证书发送给服务器端;</li><li>服务器端使用根证书解密客户端公钥证书, 拿到客户端公钥;</li><li>客户端发送自己支持的加密方案给服务器端;</li><li>服务器端根据自己和客户端支持的方法, 选择一个双方都能接收的加密方案, 使用客户端的公钥加密后发送给客户端;</li><li>客户端使用自己的私钥去解密密文, 得到秘钥 R;</li><li>服务器和客户端在后续通讯中使用秘钥 R 进行通信;</li></ol><h3 id="双向证书获取客户端证书和密码"><a href="#双向证书获取客户端证书和密码" class="headerlink" title="双向证书获取客户端证书和密码"></a>双向证书获取客户端证书和密码</h3><p>关键点:</p><ol><li>证书密码</li><li>cer 或者 p12 证书</li></ol><p>通杀方案:<br>通过 <code>r0ysue</code> 的 <a href="https://github.com/r0ysue/r0capture">r0capture</a> 进行 hook , 获取到证书;<br><code>python r0capture.py -U -f cn.soulapp.android -v &gt;&gt; soul3.txt</code><br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-03-062429.jpg" alt="img"><br>导出后的证书位于/sdcard/Download/包名xxx.p12路径，导出多次，每一份均可用，密码默认为：r0ysue，推荐使用keystore-explorer打开查看证书</p><p>手动方案:<br>例如 <code>soul</code> apk, 采用了双向证书验证;<br>对 apk 进行解包, tree 找到 client.cer 和 client.p12;<br>在 jadx 中进行反编译, 直接搜索 <code>client.p12</code> 定位到对应的 <code>load</code> 方法<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-03-065415.jpg" alt="img"><br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-03-065455.jpg" alt="img"><br>直接 hook 该方法就可以获取到证书的秘钥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///&lt;reference path=&#x27;./index.d.ts&#x27;/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_password</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> KeyStore =  Java.use(<span class="string">&quot;java.security.KeyStore&quot;</span>);</span><br><span class="line">        KeyStore.load.overload(<span class="string">&#x27;java.io.InputStream&#x27;</span>, <span class="string">&#x27;[C&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">inputStream, password</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;password is&quot;</span>, <span class="built_in">JSON</span>.stringify(password));</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.load(inputStream, password);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(hook_password)</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#125;%2R+\OSsjpP!w%X</span></span><br></pre></td></tr></table></figure><h3 id="如何将客户端证书配置到抓包工具"><a href="#如何将客户端证书配置到抓包工具" class="headerlink" title="如何将客户端证书配置到抓包工具"></a>如何将客户端证书配置到抓包工具</h3><p>charles -&gt; Proxy -&gt; SSL Proxying Settings -&gt; Server Certificates -&gt; Import P12 or PEM -&gt; 输入密码<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-03-065807.jpg" alt="img"></p><h3 id="requests-指定证书请求"><a href="#requests-指定证书请求" class="headerlink" title="requests 指定证书请求"></a>requests 指定证书请求</h3><p>安装 : <code>pip install requests_pkcs12</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests_pkcs12 <span class="keyword">import</span> get</span><br><span class="line"></span><br><span class="line">r = get(<span class="string">&#x27;https://example.com/test&#x27;</span>, pkcs12_filename=<span class="string">&#x27;clientcert.p12&#x27;</span>, pkcs12_password=<span class="string">&#x27;correcthorsebatterystaple&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="代理检测"><a href="#代理检测" class="headerlink" title="代理检测"></a>代理检测</h2><h3 id="代理检测原理"><a href="#代理检测原理" class="headerlink" title="代理检测原理"></a>代理检测原理</h3><p>检测用户是否使用了代理进行请求, 如果使用了代理, 那么很可能是中间人攻击, 强制中断请求;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 判断设备 是否使用代理上网</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isWifiProxy</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> IS_ICS_OR_LATER = Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.ICE_CREAM_SANDWICH;</span><br><span class="line">        String proxyAddress; </span><br><span class="line">        <span class="keyword">int</span> proxyPort; </span><br><span class="line">        <span class="keyword">if</span> (IS_ICS_OR_LATER) &#123; </span><br><span class="line">            proxyAddress = System.getProperty(<span class="string">&quot;http.proxyHost&quot;</span>); </span><br><span class="line">            String portStr = System.getProperty(<span class="string">&quot;http.proxyPort&quot;</span>); </span><br><span class="line">            proxyPort = Integer.parseInt((portStr != <span class="keyword">null</span> ? portStr : <span class="string">&quot;-1&quot;</span>)); </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            proxyAddress = android.net.Proxy.getHost(context); </span><br><span class="line">            proxyPort = android.net.Proxy.getPort(context); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> (!TextUtils.isEmpty(proxyAddress)) &amp;&amp; (proxyPort != -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="VPN-抓包"><a href="#VPN-抓包" class="headerlink" title="VPN 抓包"></a>VPN 抓包</h2><p>常用的抓包软件都是通过 <code>wifi</code> 设置 <code>http</code> 代理的方式进行抓包, 只是在应用层进行抓包, 很容易被检测和绕过;</p><p>使用以下 <code>api</code> 可以快速检测是否使用了 <code>http</code> 代理, 导致抓包失效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.getProperty(&quot;http.proxyHost&quot;)&#96;</span><br><span class="line">&#96;System.getProperty(&quot;http.proxyPort&quot;)</span><br></pre></td></tr></table></figure><p><code>VPN</code> 抓包属于网络层, 开启 <code>VPN</code> 之后会在手机上新增一个虚拟网卡, 所有的流量都会从这个网卡上经过, 而且可以逃过上述两个 <code>api</code> 的检测;</p><h3 id="VPN-检测和绕过"><a href="#VPN-检测和绕过" class="headerlink" title="VPN 检测和绕过"></a>VPN 检测和绕过</h3><ol><li><code>java.net.NetworkInterface.getName()</code><br>该方法通过检测返回结果是否为 <code>tun0</code> 或 <code>ppp0</code> 来判断是否使用了 <code>vpn</code> ; <code>bypass</code> 的方法也比较简单, <code>hook</code> 这个方法, 然后返回 <code>&quot;rmnet_data1&quot;</code> 即可;</li><li><code>android.net.ConnectivityManager.getNetworkCapabilities()</code><br>该方法的返回值为 <code>null</code> 即可不被检测</li></ol><h2 id="SSL-Pinning"><a href="#SSL-Pinning" class="headerlink" title="SSL Pinning"></a>SSL Pinning</h2><h3 id="什么是-SSL-Pinning"><a href="#什么是-SSL-Pinning" class="headerlink" title="什么是 SSL Pinning"></a>什么是 SSL Pinning</h3><ul><li>SSL Pinning 是一种防止中间人攻击的技术, 主要机制是: 客户端发起请求 -&gt; 收到服务器发来的证书进行校验 -&gt; 如果收到的证书不被客户端信任, 那么就直接断开请求;</li><li>客户端预置了一份服务端的证书, 防止中间人攻击时被中间人伪造的服务端证书欺骗;</li><li>使用了 SSL pinning 技术的 App, 只信任指定的证书, 就算将自签名证书按照到系统目录中, App 也不会信任; 以此来对抗中间人攻击;</li></ul><ol><li>证书固定: 开发者将 SSL 证书的某些字节码硬编码在应用程序中; 当应用程序与服务器通信时, 它将检查证书中是否存在相同的字节码; 如果存在, 则应用程序将请求发送到服务器; 如果字节码不匹配, 它将抛出 SSL 证书错误; 这样可以防止攻击者使用自己的自签名证书;</li><li>公钥固定: 在客户端访问网站进行公钥固定中, 服务器将其公钥固定在客户端中, 当客户端重新访问同一个网站时, 服务器将标识其公共秘钥以检测连接的完整性;</li></ol><h3 id="双向验证和-SSL-Pinning-的区别"><a href="#双向验证和-SSL-Pinning-的区别" class="headerlink" title="双向验证和 SSL Pinning 的区别"></a>双向验证和 SSL Pinning 的区别</h3><ul><li>SSL Pinning 是客户端锁定服务器的证书, 在要与服务器进行交互的时候, 服务器端会将证书发送给客户端, 客户端调用函数对服务器端发来的证书进行校验, 与本地存放的的证书(一般存放在/asset 或/res/raw)进行对比;</li><li>双向证书认证是添加了客户端向服务器发送证书, 服务器对客户端的证书进行校验的部分;</li></ul><h3 id="如何定位-绕过已知通信框架的证书绑定"><a href="#如何定位-绕过已知通信框架的证书绑定" class="headerlink" title="如何定位/绕过已知通信框架的证书绑定"></a>如何定位/绕过已知通信框架的证书绑定</h3><ol><li>常见的 http 框架, 可以使用 <a href="https://github.com/sensepost/objection/blob/90044d7323ba6a302030cb9e02d90468036ae4b4/agent/src/android/pinning.ts">objection</a> 进行 hook : <code>android sslpinning disable</code><ul><li>Traditional HttpsURLConnection</li><li>OkHTTP</li><li>Retrofit (Wraps OkHTTP)</li><li>Volley (Uses a TrustManager)</li><li>Picasso (Uses a TrustManager)</li></ul></li><li><code>objection</code> 未覆盖的可以使用 <a href="https://github.com/WooyunDota/DroidSSLUnpinning/blob/master/ObjectionUnpinningPlus/hooks.js">ObjectionUnpinningPlus</a> 进行<ul><li>SSLcontext(ART only)</li><li>okhttp</li><li>webview</li><li>XUtils(ART only)</li><li>httpclientandroidlib</li><li>JSSE</li><li>network_security_config (android 7.0+)</li><li>Apache Http client (support partly)</li><li>OpenSSLSocketImpl</li><li>TrustKit</li><li>Cronet</li></ul></li><li><a href="https://github.com/r0ysue/r0capture">r0capture</a> 应用层抓包通杀<ul><li>spawn 模式: <code>python3 r0capture.py -U -f com.qiyi.video -v</code></li><li>attach 模式: <code>python3 r0capture.py -U com.qiyi.video -v</code></li><li><code>-p fileName.pcap</code> : 抓包并保存为 pcap 文件, 后续使用 Wireshark 进行分析</li><li><code>&gt;&gt; fileName.txt</code>: 将抓包内容重定向到指定文本中, 方便过滤</li><li>客户端证书导出功能, 默认开启, 需要用 spawn 模式运行, 需要手动给 app 添加存储卡读取权限;导出后的证书位于/sdcard/Download/包名xxx.p12路径, 密码默认<code>r0ysue</code>;</li><li><code>-H</code>，用于Frida-server监听在非标准端口时的连接</li></ul></li></ol><h3 id="如何定位-绕过未知框架的证书绑定"><a href="#如何定位-绕过未知框架的证书绑定" class="headerlink" title="如何定位/绕过未知框架的证书绑定"></a>如何定位/绕过未知框架的证书绑定</h3><ol><li>Hook Java 的 File 类构造函数, 证书肯定要被读取到内存中, 找到证书路径;</li><li>检测客户端证书的读取</li><li>打印调用栈, 定位到证书绑定代码</li></ol><h1 id="大众点评通用抓包"><a href="#大众点评通用抓包" class="headerlink" title="大众点评通用抓包"></a>大众点评通用抓包</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cls = Java.use(<span class="string">&quot;com.dianping.nvnetwork.tunnel2.a&quot;</span>);</span><br><span class="line">    cls.isSocketConnected.overload().implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="淘系抓包"><a href="#淘系抓包" class="headerlink" title="淘系抓包"></a>淘系抓包</h1><p>使用Charles、Fiddle等抓包工具对淘系App进行抓包时，你会发现总是抓不到包，出现请求不走Charles代理的情况。这是因为淘系app底层网络通信的协议并不是普通的http协议，而是自己实现的一套私有协议Spdy。</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-12-22-062221.jpg" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-12-22-062221.jpg"></p><p>所以我们只要通过hook将是否使用spdy返回false既可;</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> SwitchConfig = Java.use(<span class="string">&#x27;mtopsdk.mtop.global.SwitchConfig&#x27;</span>);</span><br><span class="line">    SwitchConfig.nQ.overload().implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="美团外卖抓包"><a href="#美团外卖抓包" class="headerlink" title="美团外卖抓包"></a>美团外卖抓包</h1><p><a href="https://zckun.github.io/2019/09/13/python-mtwm-capture/">https://zckun.github.io/2019/09/13/python-mtwm-capture/</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptable -A INPUT -s ***.**.***.181 -j DROP #屏蔽&#96;</span><br><span class="line">&#96;iptable -D INPUT -s ***.**.***.181 -j DROP #解除屏蔽&#96;</span><br><span class="line">&#96;service iptables save</span><br></pre></td></tr></table></figure><h1 id="r0capture-抓包分析"><a href="#r0capture-抓包分析" class="headerlink" title="r0capture 抓包分析"></a>r0capture 抓包分析</h1><h2 id="Hook-抓取-Http-包"><a href="#Hook-抓取-Http-包" class="headerlink" title="Hook 抓取 Http 包"></a>Hook 抓取 Http 包</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><h3 id="hook-点"><a href="#hook-点" class="headerlink" title="hook 点"></a>hook 点</h3><h3 id="frida-参考-r0capture"><a href="#frida-参考-r0capture" class="headerlink" title="frida (参考 r0capture)"></a>frida (参考 r0capture)</h3><h2 id="Hook-抓取-Https-包"><a href="#Hook-抓取-Https-包" class="headerlink" title="Hook 抓取 Https 包"></a>Hook 抓取 Https 包</h2><h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><h3 id="Hook-点-如何确定-SSL-库的关键-API"><a href="#Hook-点-如何确定-SSL-库的关键-API" class="headerlink" title="Hook 点 (如何确定 SSL 库的关键 API)"></a>Hook 点 (如何确定 SSL 库的关键 API)</h3><h3 id="协议使用了系统中的-SSL-类库"><a href="#协议使用了系统中的-SSL-类库" class="headerlink" title="协议使用了系统中的 SSL 类库"></a>协议使用了系统中的 SSL 类库</h3><h4 id="java"><a href="#java" class="headerlink" title="java"></a>java</h4><h4 id="native"><a href="#native" class="headerlink" title="native"></a>native</h4><h3 id="协议使用了自我集成的-SSL-类库"><a href="#协议使用了自我集成的-SSL-类库" class="headerlink" title="协议使用了自我集成的 SSL 类库"></a>协议使用了自我集成的 SSL 类库</h3><h4 id="java-1"><a href="#java-1" class="headerlink" title="java"></a>java</h4>]]></content>
      
      
      <categories>
          
          <category> frida </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 抓包 </tag>
            
            <tag> frida </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>frida hook so</title>
      <link href="fridahookso/"/>
      <url>fridahookso/</url>
      
        <content type="html"><![CDATA[<h1 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h1><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-08-09-054336.png" alt="image-20210809134336251"></p><h1 id="frida-env"><a href="#frida-env" class="headerlink" title="frida env"></a>frida env</h1><p><a href="https://github.com/frida/frida-java-bridge/blob/master/lib/env.js">https://github.com/frida/frida-java-bridge/blob/master/lib/env.js</a></p><h1 id="IDA-判断-Thumb-指令集和-Arm-指令集"><a href="#IDA-判断-Thumb-指令集和-Arm-指令集" class="headerlink" title="IDA 判断 Thumb 指令集和 Arm 指令集"></a>IDA 判断 Thumb 指令集和 Arm 指令集</h1><ul><li>IDA - Options - General - number of opcode bytes - 设置为 4</li><li>此时查看 IDA VIew 中 opcode 的长度, 如果出现 2 个字节和 4 个字节的, 说明为 thumb 指令集</li><li>如果都是 4 个字节的, 说明是 arm 指令集;</li><li>在 Thumb 指令集下, inline hook 的偏移地址需要进行 +1 操作;</li></ul><h1 id="枚举内存中的-so-文件"><a href="#枚举内存中的-so-文件" class="headerlink" title="枚举内存中的 so 文件"></a>枚举内存中的 so 文件</h1><p>用于查看目标 module 是否被正常加载, 使用 <code>Process.enumerateModules()</code> 将当前加载的所有 so 文件打印出来</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_native</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> modules = Process.enumerateModules();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> modules)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="built_in">module</span> = modules[i];</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">module</span>.name);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">module</span>.name.indexOf(<span class="string">&quot;target.so&quot;</span>) &gt; -<span class="number">1</span> )&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">module</span>.base);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="获取指定-so-文件的基地址"><a href="#获取指定-so-文件的基地址" class="headerlink" title="获取指定 so 文件的基地址"></a>获取指定 so 文件的基地址</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_module</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> baseAddr = Module.findBaseAddress(<span class="string">&quot;libnative-lib.so&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;baseAddr&quot;</span>, baseAddr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="获取指定-so-文件的函数"><a href="#获取指定-so-文件的函数" class="headerlink" title="获取指定 so 文件的函数"></a>获取指定 so 文件的函数</h1><h2 id="通过导出函数名定位-native-方法"><a href="#通过导出函数名定位-native-方法" class="headerlink" title="通过导出函数名定位 native 方法"></a>通过导出函数名定位 native 方法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_func_from_exports</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> add_c_addr = Module.findExportByName(<span class="string">&quot;libnative-lib.so&quot;</span>, <span class="string">&quot;add_c&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;add_c_addr is :&quot;</span>,add_c_addr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="通过-symbols-符号定位-native-方法"><a href="#通过-symbols-符号定位-native-方法" class="headerlink" title="通过 symbols 符号定位 native 方法"></a>通过 symbols 符号定位 native 方法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find_func_from_symbols</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> NewStringUTF_addr = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> symbols = Process.findModuleByName(<span class="string">&quot;libart.so&quot;</span>).enumerateSymbols();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> symbols) &#123;</span><br><span class="line">        <span class="keyword">var</span> symbol = symbols[i];</span><br><span class="line">        <span class="keyword">if</span> (symbol.name.indexOf(<span class="string">&quot;art&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">            symbol.name.indexOf(<span class="string">&quot;JNI&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">            symbol.name.indexOf(<span class="string">&quot;CheckJNI&quot;</span>) &lt; <span class="number">0</span></span><br><span class="line">        )&#123;</span><br><span class="line">            <span class="keyword">if</span> (symbol.name.indexOf(<span class="string">&quot;NewStringUTF&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;find target symbols&quot;</span>, symbol.name, <span class="string">&quot;address is &quot;</span>, symbol.address);</span><br><span class="line">                NewStringUTF_addr = symbol.address;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;NewStringUTF_addr is &quot;</span>, NewStringUTF_addr);</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(NewStringUTF_addr, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;args0&quot;</span>,args[<span class="number">0</span>])</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;args0&quot;</span>, args[<span class="number">0</span>], hexdump(args[<span class="number">0</span>]));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;args1&quot;</span>, args[<span class="number">1</span>], hexdump(args[<span class="number">1</span>]));</span><br><span class="line">            <span class="keyword">var</span> env = Java.vm.tryGetEnv();</span><br><span class="line">            <span class="keyword">if</span> (env != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 直接读取 c 里面的 char</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;Memory readCstring is :&quot;</span>, Memory.readCString(args[<span class="number">1</span>]));</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;get env error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">returnResult</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;result: &quot;</span>, Java.cast(returnResult, Java.use(<span class="string">&quot;java.lang.String&quot;</span>)));</span><br><span class="line">            <span class="keyword">var</span> env = Java.vm.tryGetEnv();</span><br><span class="line">            <span class="keyword">if</span> (env != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> jstring = env.newStringUtf(<span class="string">&quot;修改返回值&quot;</span>);</span><br><span class="line">                returnResult.replace(ptr(jstring));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="通过地址偏移-inline-hook-任意函数"><a href="#通过地址偏移-inline-hook-任意函数" class="headerlink" title="通过地址偏移 inline-hook 任意函数"></a>通过地址偏移 inline-hook 任意函数</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// get base address of target so;</span></span><br><span class="line">    <span class="keyword">var</span> libnative_lib_addr = Module.findBaseAddress(<span class="string">&quot;libnative-lib.so&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;base module addr -&gt;&quot;</span>, libnative_lib_addr);</span><br><span class="line">    <span class="keyword">if</span> (libnative_lib_addr)&#123;</span><br><span class="line">        <span class="keyword">var</span> add_addr1 = Module.findExportByName(<span class="string">&quot;libnative-lib.so&quot;</span>, <span class="string">&quot;_Z5r0addii&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> add_addr2 = libnative_lib_addr.add(<span class="number">0x94B2</span> + <span class="number">1</span>); <span class="comment">// 32位需要加1</span></span><br><span class="line">        <span class="built_in">console</span>.log(add_addr1);</span><br><span class="line">        <span class="built_in">console</span>.log(add_addr2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主动调用</span></span><br><span class="line">    <span class="keyword">var</span> add1 = <span class="keyword">new</span> NativeFunction(add_addr1, <span class="string">&quot;int&quot;</span>, [<span class="string">&quot;int&quot;</span>, <span class="string">&quot;int&quot;</span>]);</span><br><span class="line">    <span class="keyword">var</span> add2 = <span class="keyword">new</span> NativeFunction(add_addr2, <span class="string">&quot;int&quot;</span>, [<span class="string">&quot;int&quot;</span>, <span class="string">&quot;int&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;add1 result is -&gt;&quot;</span> + add1(<span class="number">10</span>, <span class="number">20</span>));</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;add2 result is -&gt;&quot;</span> + add2(<span class="number">10</span>, <span class="number">20</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">base module addr -&gt; 0xd430b000</span></span><br><span class="line"><span class="comment">0xd43144b3</span></span><br><span class="line"><span class="comment">0xd43144b3</span></span><br><span class="line"><span class="comment">add1 result is -&gt;30</span></span><br><span class="line"><span class="comment">add2 result is -&gt;30</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h1 id="通过-Intercept-拦截器打印-native-方法参数和返回值-并修改返回值"><a href="#通过-Intercept-拦截器打印-native-方法参数和返回值-并修改返回值" class="headerlink" title="通过 Intercept 拦截器打印 native 方法参数和返回值, 并修改返回值"></a>通过 Intercept 拦截器打印 native 方法参数和返回值, 并修改返回值</h1><ul><li><code>onEnter</code>: 函数(args) : 回调函数, 给定一个参数 args, 用于读取或者写入参数作为 <code>NativePointer</code> 对象的指针;</li><li><code>onLeave</code>: 函数(retval) : 回调函数给定一个参数 retval, 该参数是包含原始返回值的 NativePointer 派生对象; 可以调用 <code>retval.replace(1234)</code> 以整数 1234 替换返回值, 或者调用<code>retval.replace(ptr(&quot;0x1234&quot;))</code> 以替换为指针;</li><li>注意: <code>retval</code> 对象会在 <code>onLeave</code> 调用中回收, 因此不要将其存储在回调之外使用, 如果需要存储包含的值, 需要制作深拷贝, 如 <code>ptr(retval.toString())</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find_func_from_exports</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> add_c_addr = Module.findExportByName(<span class="string">&quot;libnative-lib.so&quot;</span>, <span class="string">&quot;add_c&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;add_c_addr is :&quot;</span>,add_c_addr);</span><br><span class="line">    <span class="comment">// 添加拦截器</span></span><br><span class="line">    Interceptor.attach(add_c_addr,&#123;</span><br><span class="line">        <span class="comment">// 打印入参</span></span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;add_c called&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;arg1:&quot;</span>,args[<span class="number">0</span>].toInt32());</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;arg2&quot;</span>, args[<span class="number">1</span>].toInt32());</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 打印返回值</span></span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">returnValue</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;add_c result is :&quot;</span>, returnValue.toInt32());</span><br><span class="line">            <span class="comment">// 修改返回值</span></span><br><span class="line">            returnValue.replace(<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="通过-Intercept-拦截器替换原方法"><a href="#通过-Intercept-拦截器替换原方法" class="headerlink" title="通过 Intercept 拦截器替换原方法"></a>通过 Intercept 拦截器替换原方法</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">frida_Interceptor</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="comment">//这个c_getSum方法有两个int参数、返回结果为两个参数相加</span></span><br><span class="line">       <span class="comment">//这里用NativeFunction函数自己定义了一个c_getSum函数</span></span><br><span class="line">       <span class="keyword">var</span> add_method = <span class="keyword">new</span> NativeFunction(Module.findExportByName(<span class="string">&#x27;libhello.so&#x27;</span>, <span class="string">&#x27;c_getSum&#x27;</span>), </span><br><span class="line">       <span class="string">&#x27;int&#x27;</span>,[<span class="string">&#x27;int&#x27;</span>,<span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line">       <span class="comment">//输出结果 那结果肯定就是 3</span></span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">&quot;result:&quot;</span>,add_method(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">       <span class="comment">//这里对原函数的功能进行替换实现</span></span><br><span class="line">       Interceptor.replace(add_method, <span class="keyword">new</span> NativeCallback(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">           <span class="comment">//h不论是什么参数都返回123</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">       &#125;, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]));</span><br><span class="line">       <span class="comment">//再次调用 则返回123</span></span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">&quot;result:&quot;</span>,add_method(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="so-层方法注册到-js-中-主动调用"><a href="#so-层方法注册到-js-中-主动调用" class="headerlink" title="so 层方法注册到 js 中, 主动调用"></a>so 层方法注册到 js 中, 主动调用</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new NativeFunction(address, returnType, argTypes[, options])</span><br></pre></td></tr></table></figure><ul><li><code>address</code> : 函数地址</li><li><code>returnType</code> : 指定返回类型</li><li><code>argTypes</code> : 数组指定参数类型</li><li>类型可选: void, pointer, int, uint, long, ulong, char, uchar, float, double, int8, uint8, int16, int32, uint32, int64, uint64; 参照函数所需的 type 来定义即可;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invoke_native_func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> baseAddr = Module.findBaseAddress(<span class="string">&quot;libnative-lib.so&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;baseAddr&quot;</span>, baseAddr);</span><br><span class="line">    <span class="keyword">var</span> offset = <span class="number">0x0000A28C</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> add_c_addr = baseAddr.add(offset);</span><br><span class="line">    <span class="keyword">var</span> add_c_func = <span class="keyword">new</span> NativeFunction(add_c_addr, <span class="string">&quot;int&quot;</span>, [<span class="string">&quot;int&quot;</span>,<span class="string">&quot;int&quot;</span>]);</span><br><span class="line">    <span class="keyword">var</span> result = add_c_func(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取 so 文件基地址</span></span><br><span class="line">    <span class="keyword">var</span> base = Module.findBaseAddress(<span class="string">&quot;libnative-lib.so&quot;</span>);</span><br><span class="line">    <span class="comment">// 获取目标函数偏移</span></span><br><span class="line">    <span class="keyword">var</span> sub_834_addr = base.add(<span class="number">0x835</span>) <span class="comment">// thumb 需要 +1</span></span><br><span class="line">    <span class="comment">// 使用 new NativeFunction 将函数注册到 js</span></span><br><span class="line">    <span class="keyword">var</span> sub_834 = <span class="keyword">new</span> NativeFunction(sub_834_addr, <span class="string">&#x27;pointer&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line">    <span class="comment">// 开辟内存, 创建入参</span></span><br><span class="line">    <span class="keyword">var</span> arg0 = Memory.alloc(<span class="number">10</span>);</span><br><span class="line">    ptr(arg0).writeUtf8String(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> result = sub_834(arg0);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;result is :&quot;</span>, hexdump(result));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="hook-libart-中的-jni-方法"><a href="#hook-libart-中的-jni-方法" class="headerlink" title="hook libart 中的 jni 方法"></a>hook libart 中的 jni 方法</h1><p><code>jni</code> 全部定在在 <code>/system/lib(64)/libart.so</code> 文件中, 通过枚举 <code>symbols</code> 筛选出指定的方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_libart</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> GetStringUTFChars_addr = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// jni 系统函数都在 libart.so 中</span></span><br><span class="line">    <span class="keyword">var</span> module_libart = Process.findModuleByName(<span class="string">&quot;libart.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> symbols = module_libart.enumerateSymbols();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; symbols.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> name = symbols[i].name;</span><br><span class="line">        <span class="keyword">if</span> ((name.indexOf(<span class="string">&quot;JNI&quot;</span>) &gt;= <span class="number">0</span>) </span><br><span class="line">&amp;&amp; (name.indexOf(<span class="string">&quot;CheckJNI&quot;</span>) == -<span class="number">1</span>) </span><br><span class="line">&amp;&amp; (name.indexOf(<span class="string">&quot;art&quot;</span>) &gt;= <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (name.indexOf(<span class="string">&quot;GetStringUTFChars&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(name);</span><br><span class="line">                <span class="comment">// 获取到指定 jni 方法地址</span></span><br><span class="line">                GetStringUTFChars_addr = symbols[i].address;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Interceptor.attach(GetStringUTFChars_addr, &#123;</span><br><span class="line">            onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">                <span class="comment">// console.log(&quot;args[0] is : &quot;, args[0]);</span></span><br><span class="line">                <span class="comment">// console.log(&quot;args[1] is : &quot;, args[1]);</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;native args[1] is :&quot;</span>,Java.vm.getEnv().getStringUtfChars(args[<span class="number">1</span>],<span class="literal">null</span>).readCString());</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;GetStringUTFChars onEnter called from:\n&#x27;</span> +</span><br><span class="line">                    Thread.backtrace(<span class="built_in">this</span>.context, Backtracer.FUZZY)</span><br><span class="line">                    .map(DebugSymbol.fromAddress).join(<span class="string">&#x27;\n&#x27;</span>) + <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">                <span class="comment">// console.log(&quot;native args[1] is :&quot;, Java.cast(args[1], Java.use(&quot;java.lang.String&quot;)));</span></span><br><span class="line">                <span class="comment">// console.log(&quot;native args[1] is :&quot;, Memory.readCString(Java.vm.getEnv().getStringUtfChars(args[1],null)));</span></span><br><span class="line">            &#125;, <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">                <span class="comment">// retval const char*</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;GetStringUTFChars onLeave : &quot;</span>, ptr(retval).readCString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="hook-libc-中的系统方法"><a href="#hook-libc-中的系统方法" class="headerlink" title="hook libc 中的系统方法"></a>hook libc 中的系统方法</h1><p><code>/system/lib(64)/libc.so</code> 导出的符号没有进行 <code>namemanline</code> , 直接过滤筛选即可</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hook libc.so</span></span><br><span class="line"><span class="keyword">var</span> pthread_create_addr = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(JSON.stringify(Process.enumerateModules())); </span></span><br><span class="line"><span class="comment">// Process.enumerateModules() 枚举加载的so文件</span></span><br><span class="line"><span class="keyword">var</span> symbols = Process.findModuleByName(<span class="string">&quot;libc.so&quot;</span>).enumerateSymbols();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; symbols.length; i++)&#123;</span><br><span class="line">    <span class="keyword">if</span> (symbols[i].name === <span class="string">&quot;pthread_create&quot;</span>)&#123;</span><br><span class="line">        <span class="comment">// console.log(&quot;symbols name is -&gt; &quot; + symbols[i].name);</span></span><br><span class="line">        <span class="comment">// console.log(&quot;symbols address is -&gt; &quot; + symbols[i].address);</span></span><br><span class="line">        pthread_create_addr = symbols[i].address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Interceptor.attach(pthread_create_addr,&#123;</span><br><span class="line">    onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;args is -&gt;&quot;</span> + args[<span class="number">0</span>], args[<span class="number">1</span>], args[<span class="number">2</span>],args[<span class="number">3</span>]);</span><br><span class="line">    &#125;,</span><br><span class="line">    onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(retval);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>libc.so</code> 中方法替换</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hook 检测frida 的方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// var exports = Process.findModuleByName(&quot;libnative-lib.so&quot;).enumerateExports(); 导出</span></span><br><span class="line">    <span class="comment">// var imports = Process.findModuleByName(&quot;libnative-lib.so&quot;).enumerateImports(); 导入</span></span><br><span class="line">    <span class="comment">// var symbols = Process.findModuleByName(&quot;libnative-lib.so&quot;).enumerateSymbols(); 符号</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> pthread_create_addr = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> symbols = Process.getModuleByName(<span class="string">&quot;libc.so&quot;</span>).enumerateSymbols();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; symbols.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> symbol = symbols[i];</span><br><span class="line">        <span class="keyword">if</span> (symbol.name === <span class="string">&quot;pthread_create&quot;</span>) &#123;</span><br><span class="line">            pthread_create_addr = symbol.address;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;pthread_create name is -&gt;&quot;</span>, symbol.name);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;pthread_create address is -&gt;&quot;</span>, pthread_create_addr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 定义方法 之后主动调用的时候使用</span></span><br><span class="line">        <span class="keyword">var</span> pthread_create = <span class="keyword">new</span> NativeFunction(pthread_create_addr, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>])</span><br><span class="line">        Interceptor.replace(pthread_create_addr,<span class="keyword">new</span> NativeCallback(<span class="function"><span class="keyword">function</span> (<span class="params">a0, a1, a2, a3</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">var</span> detect_frida_loop = Module.findExportByName(<span class="string">&quot;libnative-lib.so&quot;</span>, <span class="string">&quot;_Z17detect_frida_loopPv&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;a0,a1,a2,a3 -&gt;&quot;</span>,a0,a1,a2,a3);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">String</span>(a2) === <span class="built_in">String</span>(detect_frida_loop)) &#123;</span><br><span class="line">                result = <span class="number">0</span>;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;阻止frida反调试启动&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result = pthread_create(a0,a1,a2,a3);</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;正常启动&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>]));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="hook-native-调用栈"><a href="#hook-native-调用栈" class="headerlink" title="hook native 调用栈"></a>hook native 调用栈</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(f, &#123;</span><br><span class="line">  onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;RegisterNatives called from:\n&#x27;</span> +</span><br><span class="line">        Thread.backtrace(<span class="built_in">this</span>.context, Backtracer.ACCURATE)</span><br><span class="line">        .map(DebugSymbol.fromAddress).join(<span class="string">&#x27;\n&#x27;</span>) + <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="jnitrace"><a href="#jnitrace" class="headerlink" title="jnitrace"></a>jnitrace</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><code>jnitrace</code>: <a href="https://github.com/chame1eon/jnitrace">https://github.com/chame1eon/jnitrace</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python&#96; : &#96;pip install jnitrace</span><br></pre></td></tr></table></figure><h2 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h2><p><code>ndk</code> 开发是没有办法脱离 <code>[libc.so](http://libc.so)</code> 和 <code>[libart.so](http://libart.so)</code> 进行开发, 所以只要降维打击, 通过 <code>trace</code> 的方式就可以监控到 <code>so</code> 层</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-09-07-032605.jpg" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-09-07-032605.jpg"></p><h3 id="启动命令"><a href="#启动命令" class="headerlink" title="启动命令"></a>启动命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jnitrace [options] -l libname packagename</span><br></pre></td></tr></table></figure><p>例如: <code>jnitrace -l [libnative-lib.so](http://libnative-lib.so) com.example.myapplication</code></p><h3 id="必要参数"><a href="#必要参数" class="headerlink" title="必要参数"></a><strong>必要参数</strong></h3><ul><li><code>-l libname</code> : 指定要<code>trace</code>的<code>.so</code>文件, 可以同时<code>trace</code>多个<code>.so</code>文件, 直接使用 <code>*</code>来<code>trace</code>所有的<code>.so</code>文件; 如: <code>-l libnative-lib.so -l libanother-lib.so</code> or <code>-l *</code></li><li><code>packagename</code> : 指定要<code>trace</code>的<code>package name</code></li></ul><h3 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a><strong>可选参数</strong></h3><ul><li><code>-m</code>: 指定是<code>spawn</code>还是<code>attach</code></li><li><code>-b</code>: 指定是<code>fuzzy</code>还是<code>accurate</code></li><li><code>-i &lt;regex&gt;</code>: 指定一个正则表达式来过滤出方法名, 例如: <code>-i Get -i RegisterNatives</code> 就只会打印出名字里包含<code>Get</code>或者<code>RegisterNatives</code>的<code>JNI methods</code></li><li><code>-e &lt;regex&gt;</code>和<code>i</code>相反，同样通过正则表达式来过滤，但这次会将指定的内容忽略掉</li><li><code>-I &lt;string&gt;</code>trace导出的方法，jnitrace认为导出的函数应该是从Java端能够直接调用的函数，所以可以包括使用RegisterNatives来注册的函数，例如<code>I stringFromJNI -I nativeMethod([B)V</code>，就包括导出名里有stringFromJNI，以及使用RegisterNames来注册，并带有nativeMethod([B)V签名的函数。</li><li><code>-o path/output.json</code>，导出输出到文件里。</li><li><code>-p path/to/script.js</code>，用于在加载jnitrace脚本之前将指定路径的Frida脚本加载到目标进程中，这可以用于在jnitrace启动之前对抗反调试。</li><li><code>-a path/to/script.js</code>，用于在加载jnitrace脚本之后将指定路径的Frida脚本加载到目标进程中</li><li><code>-ignore-env</code>，不打印所有的JNIEnv函数</li><li><code>-ignore-vm</code>，不打印所有的JavaVM函数</li></ul><h3 id="启动方式"><a href="#启动方式" class="headerlink" title="启动方式"></a>启动方式</h3><p>默认使用 <code>spawn</code> 启动, 可以通过 <code>-m attach</code> 设置通过 <code>attach</code> 启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jnitrace -m attach -l[libnative-lib.so](http:&#x2F;&#x2F;libnative-lib.so) com.kevin.demoso1</span><br></pre></td></tr></table></figure><h3 id="设置回溯器"><a href="#设置回溯器" class="headerlink" title="设置回溯器"></a>设置回溯器</h3><p>默认情况下使用 <code>accurate</code>的精确模式来进行回溯, 可以通过 <code>-b fuzzy</code> 修改为模糊模式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jnitrace -l [libnative-lib.so](http:&#x2F;&#x2F;libnative-lib.so) -b fuzzy com.kevin.demoso1</span><br></pre></td></tr></table></figure><h3 id="监控指定规则的方法"><a href="#监控指定规则的方法" class="headerlink" title="监控指定规则的方法"></a>监控指定规则的方法</h3><p>用于指定应该跟踪的方法名, 该选项可以多次提供;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jnitrace -l libnative-lib.so -i RegisterNatives com.kevin.demoso1</span><br></pre></td></tr></table></figure><p>只过滤出<code>RegisterNatives</code>相关的内容</p><h3 id="忽略指定规则的方法"><a href="#忽略指定规则的方法" class="headerlink" title="忽略指定规则的方法"></a><strong>忽略指定规则的方法</strong></h3><p>用于指定在跟踪中应被忽略的方法名, 这个选项可以被多次提供;</p><p>忽略以<code>Find</code>开头的所有方法;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jnitrace -l libnative-lib.so -e ^Find com.kevin.demoso</span><br></pre></td></tr></table></figure><h2 id="jnitace-计算偏移地址"><a href="#jnitace-计算偏移地址" class="headerlink" title="jnitace 计算偏移地址"></a>jnitace 计算偏移地址</h2><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-09-07-062032.png" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-09-07-062032.png"></p><p><code>0x8e4f3b1</code> 是方法 <code>initSN</code> 方法的绝对地址</p><p><code>0xd8e4e000</code> 是 <code>[libmyjni.so](http://libmyjni.so)</code> 基地址</p><p>使用使用 <code>initSN()V</code>的绝对地址 <code>0xd8e4f3b1</code> 减去 <code>[libmyjni.so](http://libmyjni.so)</code> 的基地址 <code>0xd8e4e000</code> , 得到偏移 <code>0x13B1</code></p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-09-07-070337.png" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-09-07-070337.png"></p><p><code>g</code> 进行跳转到 <code>0x13B1</code> 即可进入方法</p><h1 id="frida-trace"><a href="#frida-trace" class="headerlink" title="frida trace"></a>frida trace</h1><p>文档地址: <a href="https://frida.re/docs/frida-trace/">https://frida.re/docs/frida-trace/</a></p><h2 id="options"><a href="#options" class="headerlink" title="options"></a>options</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Usage: frida-trace [options] target</span><br><span class="line"></span><br><span class="line"> Options:</span><br><span class="line">   --version             show program<span class="string">&#x27;s version number and exit</span></span><br><span class="line"><span class="string">   -h, --help            show this help message and exit</span></span><br><span class="line"><span class="string">   -D ID, --device=ID    connect to device with the given ID</span></span><br><span class="line"><span class="string">   -U, --usb             connect to USB device</span></span><br><span class="line"><span class="string">   -R, --remote          connect to remote frida-server</span></span><br><span class="line"><span class="string">   -H HOST, --host=HOST  connect to remote frida-server on HOST</span></span><br><span class="line"><span class="string">   -f FILE, --file=FILE  spawn FILE</span></span><br><span class="line"><span class="string">   -F, --attach-frontmost     attach to frontmost application</span></span><br><span class="line"><span class="string">   -n NAME, --attach-name=NAME     attach to NAME</span></span><br><span class="line"><span class="string">   -p PID, --attach-pid=PID     attach to PID</span></span><br><span class="line"><span class="string">   --stdio=inherit|pipe      stdio behavior when spawning (defaults to “inherit”)</span></span><br><span class="line"><span class="string">   --runtime=duk|v8          script runtime to use (defaults to “duk”)</span></span><br><span class="line"><span class="string">   --debug                   enable the Node.js compatible script debugger</span></span><br><span class="line"><span class="string">   -I MODULE, --include-module=MODULE       include MODULE</span></span><br><span class="line"><span class="string">   -X MODULE, --exclude-module=MODULE       exclude MODULE</span></span><br><span class="line"><span class="string">   -i FUNCTION, --include=FUNCTION    include FUNCTION</span></span><br><span class="line"><span class="string">   -x FUNCTION, --exclude=FUNCTION   exclude FUNCTION</span></span><br><span class="line"><span class="string">   -a MODULE!OFFSET, --add=MODULE!OFFSET    add MODULE!OFFSET</span></span><br><span class="line"><span class="string">   -T, --include-imports    include program&#x27;</span>s imports</span><br><span class="line">   -t MODULE, --include-<span class="built_in">module</span>-imports=MODULE      include MODULE imports</span><br><span class="line">   -m OBJC_METHOD, --include-objc-method=OBJC_METHOD    include OBJC_METHOD</span><br><span class="line">   -M OBJC_METHOD, --exclude-objc-method=OBJC_METHOD    exclude OBJC_METHOD</span><br><span class="line">   -s DEBUG_SYMBOL, --include-debug-symbol=DEBUG_SYMBOL    include DEBUG_SYMBOL</span><br><span class="line">   -q, --quiet           <span class="keyword">do</span> not format output messages</span><br><span class="line">   -d, --decorate        Add <span class="built_in">module</span> name to generated onEnter log statement</span><br><span class="line">   -o OUTPUT, --output=OUTPUT    dump messages to file</span><br></pre></td></tr></table></figure><h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida-trace [options] packagename</span><br></pre></td></tr></table></figure><h3 id="启动模式"><a href="#启动模式" class="headerlink" title="启动模式"></a>启动模式</h3><p>默认使用 <code>attach</code> 模式, 可以指定 <code>-f packageName</code> 使用 <code>spawn</code> 模式启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida-trace -U -i strcmp -f com.gdufs.xman</span><br></pre></td></tr></table></figure><h3 id="文件输出"><a href="#文件输出" class="headerlink" title="文件输出"></a>文件输出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida-trace -U -i &quot;strcmp&quot; -f com.gdufs.xman -o xman.json</span><br></pre></td></tr></table></figure><p><code>-o filepath</code> 指定输出的文件路径, 方便内容过多时进行查看</p><h3 id="trace-任意-function"><a href="#trace-任意-function" class="headerlink" title="trace 任意 function"></a>trace 任意 function</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida-trace -U -i &quot;strcmp&quot; com.example.demoso1</span><br></pre></td></tr></table></figure><h3 id="trace-任意-module"><a href="#trace-任意-module" class="headerlink" title="trace 任意 module"></a>trace 任意 module</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida-trace -U -I &quot;libnative-lib.so&quot; com.example.demoso1</span><br></pre></td></tr></table></figure><h3 id="根据地址进行-trace"><a href="#根据地址进行-trace" class="headerlink" title="根据地址进行 trace"></a>根据地址进行 trace</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida-trace -U -a &quot;libnative-lib.so!0x9281&quot; com.example.demoso1</span><br></pre></td></tr></table></figure><h2 id="批量-trace"><a href="#批量-trace" class="headerlink" title="批量 trace"></a>批量 trace</h2><p>源码地址: <a href="https://github.com/Pr0214/trace_natives">https://github.com/Pr0214/trace_natives</a></p><p>ps: 需要切换到 frida14 版本</p><p>1.将traceNatives.py丢进IDA plugins目录中</p><ul><li>  在ida 的python console中运行如下命令即可找到plugins目录：<code>os.path.join(idaapi.get_user_idadir(), &quot;plugins&quot;)</code></li></ul><p>2.IDA中，Edit-Plugins-traceNatives –&gt;  IDA输出窗口就会显示如下字眼：<strong>使用方法如下： frida-trace -UF -O C:\Users\Lenovo\Desktop\2021\mt\libmtguard.txt</strong></p><h1 id="frida-hook-libart"><a href="#frida-hook-libart" class="headerlink" title="frida-hook-libart"></a>frida-hook-libart</h1><p>下载地址: <a href="https://github.com/lasting-yang/frida_hook_libart">https://github.com/lasting-yang/frida_hook_libart</a></p><h2 id="hook-art"><a href="#hook-art" class="headerlink" title="hook art"></a>hook art</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U --no-pause -f package_name -l hook_art.js</span><br></pre></td></tr></table></figure><h2 id="hook-RegisterNatives"><a href="#hook-RegisterNatives" class="headerlink" title="hook_RegisterNatives"></a>hook_RegisterNatives</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U --no-pause -f package_name -l hook_RegisterNatives.js</span><br></pre></td></tr></table></figure><h2 id="hook-artmethod"><a href="#hook-artmethod" class="headerlink" title="hook_artmethod"></a>hook_artmethod</h2><h3 id="init-libext-first-time"><a href="#init-libext-first-time" class="headerlink" title="init libext first time"></a>init libext first time</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">adb push lib/libext64.so /data/<span class="built_in">local</span>/tmp/libext64.so</span><br><span class="line">adb push lib/libext.so /data/<span class="built_in">local</span>/tmp/libext.so</span><br><span class="line">adb shell su -c <span class="string">&quot;cp /data/local/tmp/libext64.so /data/app/libext64.so&quot;</span></span><br><span class="line">adb shell su -c <span class="string">&quot;cp /data/local/tmp/libext.so /data/app/libext.so&quot;</span></span><br><span class="line">adb shell su -c <span class="string">&quot;chown 1000.1000 /data/app/libext*.so&quot;</span></span><br><span class="line">adb shell su -c <span class="string">&quot;chmod 777 /data/app/libext*.so&quot;</span></span><br><span class="line">adb shell su -c <span class="string">&quot;ls -al /data/app/libext*&quot;</span></span><br></pre></td></tr></table></figure><h3 id="use-hook-artmethod-js"><a href="#use-hook-artmethod-js" class="headerlink" title="use hook_artmethod.js"></a>use hook_artmethod.js</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">frida -U --no-pause -f package_name -l hook_artmethod.js</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">frida -U --no-pause -f package_name -l hook_artmethod.js &gt; hook_artmethod.log</span><br></pre></td></tr></table></figure><h2 id="frida-fart-hook"><a href="#frida-fart-hook" class="headerlink" title="frida-fart-hook"></a>frida-fart-hook</h2><p>首先拷贝fart.so和fart64.so到/data/app目录下，并使用chmod 777 设置好权限,然后就可以使用了。</p><p>如果目标 app 没有 sdcard 权限则需要手动添加; 或者可以修改 frida_fart_hook.js 中的源码, 将 savepath 改为 <code>/data/data/应用包名/</code>;</p><p>该frida版fart是使用hook的方式实现的函数粒度的脱壳，仅仅是对类中的所有函数进行了加载，但依然可以解决绝大多数的抽取保护</p><p>需要以spawn方式启动app，等待app进入Activity界面后，执行fart()函数即可。如app包名为com.example.test,则</p><p><code>frida -U -f com.example.test -l frida_fart_hook.js --no-pause</code> ，然后等待app进入主界面,执行fart()</p><p>高级用法：如果发现某个类中的函数的CodeItem没有dump下来，可以调用dump(classname),传入要处理的类名，完成对该类下的所有函数体的dump,dump下来的函数体会追加到bin文件当中。</p><h1 id="frida-文件写入-frida-hook-libc"><a href="#frida-文件写入-frida-hook-libc" class="headerlink" title="frida 文件写入(frida/hook libc)"></a>frida 文件写入(frida/hook libc)</h1><p><code>frida api</code> 写入文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">writeFile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> file = <span class="keyword">new</span> File(<span class="string">&quot;/sdcard/reg.dat&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">file.write(<span class="string">&quot;content from frida&quot;</span>);</span><br><span class="line">file.flush();</span><br><span class="line">file.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>frida 定义 NativeFunction</code> 写入文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">writeFileNative</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> addr_fopen = Module.findExportByName(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;fopen&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> addr_fputs = Module.findExportByName(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;fputs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> addr_fclose = Module.findExportByName(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;fclose&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 libc 的系统方法注册到 js 层</span></span><br><span class="line"><span class="keyword">var</span> fopen = <span class="keyword">new</span> NativeFunction(addr_fopen, <span class="string">&quot;pointer&quot;</span>, [<span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;pointer&quot;</span>]);</span><br><span class="line"><span class="keyword">var</span> fputs = <span class="keyword">new</span> NativeFunction(addr_fputs, <span class="string">&quot;int&quot;</span>, [<span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;pointer&quot;</span>]);</span><br><span class="line"><span class="keyword">var</span> fclose = <span class="keyword">new</span> NativeFunction(addr_fclose, <span class="string">&quot;int&quot;</span>, [<span class="string">&quot;pointer&quot;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 js 层主动调用 libc 的方法</span></span><br><span class="line"><span class="comment">// 不能直接将 js 的字符串传给 libc中的方法, 需要进行转换</span></span><br><span class="line"><span class="keyword">var</span> filename = Memory.allocUtf8String(<span class="string">&quot;/sdcard/reg.dat&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> open_mode = Memory.allocUtf8String(<span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> file = fopen(filename, open_mode);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> buffer = Memory.allocUtf8String(<span class="string">&quot;content from frida&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> result = fputs(buffer, file);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;fputs ret: &quot;</span>, result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭文件</span></span><br><span class="line">fclose(file);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="hook-读写-std-string"><a href="#hook-读写-std-string" class="headerlink" title="hook 读写 std::string"></a>hook 读写 std::string</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readStdString</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> isTiny = (str.readU8 &amp; <span class="number">1</span>) === <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (isTiny)&#123;</span><br><span class="line">    <span class="keyword">return</span> str.add(<span class="number">1</span>).readUtf8String();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str.add(<span class="number">2</span> * Process.pointerSize).readPointer().readUtf8String();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">writeStdString</span>(<span class="params">str, content</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> isTiny = (str.readU8() &amp; <span class="number">1</span>) === <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (isTiny)&#123;</span><br><span class="line">    str.add(<span class="number">1</span>).writeUtf8String(content);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    str.add(<span class="number">2</span> * Process.pointerSize).readPointer().writeUtf8String(content);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="hook-so-文件加载后马上-hook"><a href="#hook-so-文件加载后马上-hook" class="headerlink" title="hook so 文件加载后马上 hook"></a>hook so 文件加载后马上 hook</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种方式（针对较老的系统版本）</span></span><br><span class="line"><span class="keyword">var</span> dlopen = Module.findExportByName(<span class="literal">null</span>, <span class="string">&quot;dlopen&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(dlopen);</span><br><span class="line"><span class="keyword">if</span>(dlopen != <span class="literal">null</span>)&#123;</span><br><span class="line">    Interceptor.attach(dlopen,&#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> soName = args[<span class="number">0</span>].readCString();</span><br><span class="line">            <span class="built_in">console</span>.log(soName);</span><br><span class="line">            <span class="keyword">if</span>(soName.indexOf(<span class="string">&quot;libc.so&quot;</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="built_in">this</span>.hook = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">this</span>.hook) &#123; </span><br><span class="line">                dlopentodo();</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种方式（针对新系统版本） android 8.1 使用该方法</span></span><br><span class="line"><span class="keyword">var</span> android_dlopen_ext = Module.findExportByName(<span class="literal">null</span>, <span class="string">&quot;android_dlopen_ext&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(android_dlopen_ext);</span><br><span class="line"><span class="keyword">if</span>(android_dlopen_ext != <span class="literal">null</span>)&#123;</span><br><span class="line">    Interceptor.attach(android_dlopen_ext,&#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> soName = args[<span class="number">0</span>].readCString();</span><br><span class="line">            <span class="built_in">console</span>.log(soName);</span><br><span class="line">            <span class="keyword">if</span>(soName.indexOf(<span class="string">&quot;libc.so&quot;</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="built_in">this</span>.hook = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">this</span>.hook) &#123;</span><br><span class="line">                dlopentodo();</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dlopentodo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//todo ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="hook-libc-kill"><a href="#hook-libc-kill" class="headerlink" title="hook libc kill"></a>hook libc kill</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceKILL</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> kill_addr = Module.findExportByName(<span class="string">&quot;libc.so&quot;</span>,<span class="string">&quot;kill&quot;</span>);</span><br><span class="line">Interceptor.replace(kill_addr, <span class="keyword">new</span> NativeCallback(<span class="function"><span class="keyword">function</span>(<span class="params">arg0, arg1</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;arg0=&gt; &quot;</span>, arg0);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;arg1=&gt; &quot;</span>, arg1);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;libc.so!kill called from:\n&#x27;</span> +</span><br><span class="line">        Thread.backtrace(<span class="built_in">this</span>.context, Backtracer.ACCURATE)</span><br><span class="line">        .map(DebugSymbol.fromAddress).join(<span class="string">&#x27;\n&#x27;</span>) + <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">&#125;,<span class="string">&quot;int&quot;</span>,[<span class="string">&quot;int&quot;</span>,<span class="string">&quot;int&quot;</span>]))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="hook-init-array"><a href="#hook-init-array" class="headerlink" title="hook init_array"></a>hook init_array</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//应用以32位在64位终端环境下运行</span></span><br><span class="line"><span class="comment">//adb install --abi armeabi-v7a &lt;path to apk&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_call_function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> call_function_addr = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> symbols = Process.getModuleByName(<span class="string">&quot;linker&quot;</span>).enumerateSymbols();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> m = <span class="number">0</span>; m &lt; symbols.length; m++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (symbols[m].name == <span class="string">&quot;__dl__ZL13call_functionPKcPFviPPcS2_ES0_&quot;</span>) &#123;</span><br><span class="line">            call_function_addr = symbols[m].address;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;found call_function_addr =&gt; &quot;</span>, call_function_addr)</span><br><span class="line">            hook_call_function(call_function_addr)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_call_function</span>(<span class="params">_call_function_addr</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;hook call function begin!hooking address :=&gt;&quot;</span>,_call_function_addr)</span><br><span class="line">    Interceptor.attach(_call_function_addr,&#123;</span><br><span class="line">        onEnter:<span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(args[<span class="number">2</span>].readCString().indexOf(<span class="string">&quot;base.odex&quot;</span>)&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;============================&quot;</span>)</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;function_name =&gt;&quot;</span>,args[<span class="number">0</span>].readCString())</span><br><span class="line">                <span class="keyword">var</span> soPath = args[<span class="number">2</span>].readCString()</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;so path : =&gt;&quot;</span>,soPath)</span><br><span class="line">                <span class="keyword">var</span> soName = soPath.split(<span class="string">&quot;/&quot;</span>).pop();</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;function offset =&gt;&quot;</span>,<span class="string">&quot;0x&quot;</span>+(args[<span class="number">1</span>]-Module.findBaseAddress(soName)).toString(<span class="number">16</span>))</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;============================&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="attr">onLeave</span>:<span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(get_call_function)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_constructor</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Process.pointerSize == <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> linker = Process.findModuleByName(<span class="string">&quot;linker&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> linker = Process.findModuleByName(<span class="string">&quot;linker64&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> addr_call_function =<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> addr_g_ld_debug_verbosity = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> addr_async_safe_format_log = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (linker) &#123;</span><br><span class="line">        <span class="keyword">var</span> symbols = linker.enumerateSymbols();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; symbols.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> name = symbols[i].name;</span><br><span class="line">            <span class="keyword">if</span> (name.indexOf(<span class="string">&quot;call_function&quot;</span>) &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">                addr_call_function = symbols[i].address;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(name.indexOf(<span class="string">&quot;g_ld_debug_verbosity&quot;</span>) &gt;=<span class="number">0</span>)&#123;</span><br><span class="line">                addr_g_ld_debug_verbosity = symbols[i].address;</span><br><span class="line">              </span><br><span class="line">                ptr(addr_g_ld_debug_verbosity).writeInt(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(name.indexOf(<span class="string">&quot;async_safe_format_log&quot;</span>) &gt;=<span class="number">0</span> &amp;&amp; name.indexOf(<span class="string">&#x27;va_list&#x27;</span>) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            </span><br><span class="line">                addr_async_safe_format_log = symbols[i].address;</span><br><span class="line"></span><br><span class="line">            &#125; </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(addr_async_safe_format_log)&#123;</span><br><span class="line">        Interceptor.attach(addr_async_safe_format_log,&#123;</span><br><span class="line">            onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">this</span>.log_level  = args[<span class="number">0</span>];</span><br><span class="line">                <span class="built_in">this</span>.tag = ptr(args[<span class="number">1</span>]).readCString()</span><br><span class="line">                <span class="built_in">this</span>.fmt = ptr(args[<span class="number">2</span>]).readCString()</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">this</span>.fmt.indexOf(<span class="string">&quot;c-tor&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp; <span class="built_in">this</span>.fmt.indexOf(<span class="string">&#x27;Done&#x27;</span>) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="built_in">this</span>.function_type = ptr(args[<span class="number">3</span>]).readCString(), <span class="comment">// func_type</span></span><br><span class="line">                    <span class="built_in">this</span>.so_path = ptr(args[<span class="number">5</span>]).readCString();</span><br><span class="line">                    <span class="keyword">var</span> strs = <span class="keyword">new</span> <span class="built_in">Array</span>(); <span class="comment">//定义一数组 </span></span><br><span class="line">                    strs = <span class="built_in">this</span>.so_path.split(<span class="string">&quot;/&quot;</span>); <span class="comment">//字符分割</span></span><br><span class="line">                    <span class="built_in">this</span>.so_name = strs.pop();</span><br><span class="line">                    <span class="built_in">this</span>.func_offset  = ptr(args[<span class="number">4</span>]).sub(Module.findBaseAddress(<span class="built_in">this</span>.so_name)) </span><br><span class="line">                     <span class="built_in">console</span>.log(<span class="string">&quot;func_type:&quot;</span>, <span class="built_in">this</span>.function_type,</span><br><span class="line">                        <span class="string">&#x27;\nso_name:&#x27;</span>,<span class="built_in">this</span>.so_name,</span><br><span class="line">                        <span class="string">&#x27;\nso_path:&#x27;</span>,<span class="built_in">this</span>.so_path,</span><br><span class="line">                        <span class="string">&#x27;\nfunc_offset:&#x27;</span>,<span class="built_in">this</span>.func_offset </span><br><span class="line">                     );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    hook_constructor();</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><h1 id="frida-dump"><a href="#frida-dump" class="headerlink" title="frida dump"></a>frida dump</h1><p>document: <a href="https://github.com/lasting-yang/frida_dump">https://github.com/lasting-yang/frida_dump</a></p><h2 id="frida-dump-so"><a href="#frida-dump-so" class="headerlink" title="frida dump so"></a>frida dump so</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dump_so</span>(<span class="params">so_name</span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> currentApplication = Java.use(<span class="string">&quot;android.app.ActivityThread&quot;</span>).currentApplication();</span><br><span class="line">        <span class="keyword">var</span> dir = currentApplication.getApplicationContext().getFilesDir().getPath();</span><br><span class="line">        <span class="keyword">var</span> libso = Process.getModuleByName(so_name);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[name]:&quot;</span>, libso.name);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[base]:&quot;</span>, libso.base);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[size]:&quot;</span>, ptr(libso.size));</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[path]:&quot;</span>, libso.path);</span><br><span class="line">        <span class="keyword">var</span> file_path = dir + <span class="string">&quot;/&quot;</span> + libso.name + <span class="string">&quot;_&quot;</span> + libso.base + <span class="string">&quot;_&quot;</span> + ptr(libso.size) + <span class="string">&quot;.so&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> file_handle = <span class="keyword">new</span> File(file_path, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (file_handle &amp;&amp; file_handle != <span class="literal">null</span>) &#123;</span><br><span class="line">            Memory.protect(ptr(libso.base), libso.size, <span class="string">&#x27;rwx&#x27;</span>);</span><br><span class="line">            <span class="keyword">var</span> libso_buffer = ptr(libso.base).readByteArray(libso.size);</span><br><span class="line">            file_handle.write(libso_buffer);</span><br><span class="line">            file_handle.flush();</span><br><span class="line">            file_handle.close();</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;[dump]:&quot;</span>, file_path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="frida-dump-dex"><a href="#frida-dump-dex" class="headerlink" title="frida dump dex"></a>frida dump dex</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_self_process_name</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> openPtr = Module.getExportByName(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;open&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> open = <span class="keyword">new</span> NativeFunction(openPtr, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> readPtr = Module.getExportByName(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;read&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> read = <span class="keyword">new</span> NativeFunction(readPtr, <span class="string">&quot;int&quot;</span>, [<span class="string">&quot;int&quot;</span>, <span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;int&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> closePtr = Module.getExportByName(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;close&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> close = <span class="keyword">new</span> NativeFunction(closePtr, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> path = Memory.allocUtf8String(<span class="string">&quot;/proc/self/cmdline&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> fd = open(path, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> buffer = Memory.alloc(<span class="number">0x1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> result = read(fd, buffer, <span class="number">0x1000</span>);</span><br><span class="line">        close(fd);</span><br><span class="line">        result = ptr(buffer).readCString();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;-1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mkdir</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> mkdirPtr = Module.getExportByName(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;mkdir&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> mkdir = <span class="keyword">new</span> NativeFunction(mkdirPtr, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> opendirPtr = Module.getExportByName(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;opendir&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> opendir = <span class="keyword">new</span> NativeFunction(opendirPtr, <span class="string">&#x27;pointer&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> closedirPtr = Module.getExportByName(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;closedir&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> closedir = <span class="keyword">new</span> NativeFunction(closedirPtr, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> cPath = Memory.allocUtf8String(path);</span><br><span class="line">    <span class="keyword">var</span> dir = opendir(cPath);</span><br><span class="line">    <span class="keyword">if</span> (dir != <span class="number">0</span>) &#123;</span><br><span class="line">        closedir(dir);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mkdir(cPath, <span class="number">755</span>);</span><br><span class="line">    chmod(path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chmod</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> chmodPtr = Module.getExportByName(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;chmod&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> chmod = <span class="keyword">new</span> NativeFunction(chmodPtr, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line">    <span class="keyword">var</span> cPath = Memory.allocUtf8String(path);</span><br><span class="line">    chmod(cPath, <span class="number">755</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dump_dex</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> libart = Process.findModuleByName(<span class="string">&quot;libart.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> addr_DefineClass = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> symbols = libart.enumerateSymbols();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">0</span>; index &lt; symbols.length; index++) &#123;</span><br><span class="line">        <span class="keyword">var</span> symbol = symbols[index];</span><br><span class="line">        <span class="keyword">var</span> symbol_name = symbol.name;</span><br><span class="line">        <span class="comment">//这个DefineClass的函数签名是Android9的</span></span><br><span class="line">        <span class="comment">//_ZN3art11ClassLinker11DefineClassEPNS_6ThreadEPKcmNS_6HandleINS_6mirror11ClassLoaderEEERKNS_7DexFileERKNS9_8ClassDefE</span></span><br><span class="line">        <span class="keyword">if</span> (symbol_name.indexOf(<span class="string">&quot;ClassLinker&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">            symbol_name.indexOf(<span class="string">&quot;DefineClass&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">            symbol_name.indexOf(<span class="string">&quot;Thread&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">            symbol_name.indexOf(<span class="string">&quot;DexFile&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(symbol_name, symbol.address);</span><br><span class="line">            addr_DefineClass = symbol.address;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> dex_maps = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> dex_count = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;[DefineClass:]&quot;</span>, addr_DefineClass);</span><br><span class="line">    <span class="keyword">if</span> (addr_DefineClass) &#123;</span><br><span class="line">        Interceptor.attach(addr_DefineClass, &#123;</span><br><span class="line">            onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> dex_file = args[<span class="number">5</span>];</span><br><span class="line">                <span class="comment">//ptr(dex_file).add(Process.pointerSize) is &quot;const uint8_t* const begin_;&quot;</span></span><br><span class="line">                <span class="comment">//ptr(dex_file).add(Process.pointerSize + Process.pointerSize) is &quot;const size_t size_;&quot;</span></span><br><span class="line">                <span class="keyword">var</span> base = ptr(dex_file).add(Process.pointerSize).readPointer();</span><br><span class="line">                <span class="keyword">var</span> size = ptr(dex_file).add(Process.pointerSize + Process.pointerSize).readUInt();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (dex_maps[base] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">                    dex_maps[base] = size;</span><br><span class="line">                    <span class="keyword">var</span> magic = ptr(base).readCString();</span><br><span class="line">                    <span class="keyword">if</span> (magic.indexOf(<span class="string">&quot;dex&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">var</span> process_name = get_self_process_name();</span><br><span class="line">                        <span class="keyword">if</span> (process_name != <span class="string">&quot;-1&quot;</span>) &#123;</span><br><span class="line">                            <span class="keyword">var</span> dex_dir_path = <span class="string">&quot;/data/data/&quot;</span> + process_name + <span class="string">&quot;/files/dump_dex_&quot;</span> + process_name;</span><br><span class="line">                            mkdir(dex_dir_path);</span><br><span class="line">                            <span class="keyword">var</span> dex_path = dex_dir_path + <span class="string">&quot;/class&quot;</span> + (dex_count == <span class="number">1</span> ? <span class="string">&quot;&quot;</span> : dex_count) + <span class="string">&quot;.dex&quot;</span>;</span><br><span class="line">                            <span class="built_in">console</span>.log(<span class="string">&quot;[find dex]:&quot;</span>, dex_path);</span><br><span class="line">                            <span class="keyword">var</span> fd = <span class="keyword">new</span> File(dex_path, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">                            <span class="keyword">if</span> (fd &amp;&amp; fd != <span class="literal">null</span>) &#123;</span><br><span class="line">                                dex_count++;</span><br><span class="line">                                <span class="keyword">var</span> dex_buffer = ptr(base).readByteArray(size);</span><br><span class="line">                                fd.write(dex_buffer);</span><br><span class="line">                                fd.flush();</span><br><span class="line">                                fd.close();</span><br><span class="line">                                <span class="built_in">console</span>.log(<span class="string">&quot;[dump dex]:&quot;</span>, dex_path);</span><br><span class="line"></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;&#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> is_hook_libart = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_dlopen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Interceptor.attach(Module.findExportByName(<span class="literal">null</span>, <span class="string">&quot;dlopen&quot;</span>), &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> pathptr = args[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (pathptr !== <span class="literal">undefined</span> &amp;&amp; pathptr != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> path = ptr(pathptr).readCString();</span><br><span class="line">                <span class="comment">//console.log(&quot;dlopen:&quot;, path);</span></span><br><span class="line">                <span class="keyword">if</span> (path.indexOf(<span class="string">&quot;libart.so&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.can_hook_libart = <span class="literal">true</span>;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;[dlopen:]&quot;</span>, path);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.can_hook_libart &amp;&amp; !is_hook_libart) &#123;</span><br><span class="line">                dump_dex();</span><br><span class="line">                is_hook_libart = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(Module.findExportByName(<span class="literal">null</span>, <span class="string">&quot;android_dlopen_ext&quot;</span>), &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> pathptr = args[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (pathptr !== <span class="literal">undefined</span> &amp;&amp; pathptr != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> path = ptr(pathptr).readCString();</span><br><span class="line">                <span class="comment">//console.log(&quot;android_dlopen_ext:&quot;, path);</span></span><br><span class="line">                <span class="keyword">if</span> (path.indexOf(<span class="string">&quot;libart.so&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.can_hook_libart = <span class="literal">true</span>;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;[android_dlopen_ext:]&quot;</span>, path);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.can_hook_libart &amp;&amp; !is_hook_libart) &#123;</span><br><span class="line">                dump_dex();</span><br><span class="line">                is_hook_libart = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setImmediate(dump_dex);</span><br></pre></td></tr></table></figure><h2 id="frida-dump-dex-class"><a href="#frida-dump-dex-class" class="headerlink" title="frida dump dex class"></a>frida dump dex class</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_self_process_name</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> openPtr = Module.getExportByName(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;open&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> open = <span class="keyword">new</span> NativeFunction(openPtr, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> readPtr = Module.getExportByName(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;read&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> read = <span class="keyword">new</span> NativeFunction(readPtr, <span class="string">&quot;int&quot;</span>, [<span class="string">&quot;int&quot;</span>, <span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;int&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> closePtr = Module.getExportByName(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;close&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> close = <span class="keyword">new</span> NativeFunction(closePtr, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> path = Memory.allocUtf8String(<span class="string">&quot;/proc/self/cmdline&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> fd = open(path, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> buffer = Memory.alloc(<span class="number">0x1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> result = read(fd, buffer, <span class="number">0x1000</span>);</span><br><span class="line">        close(fd);</span><br><span class="line">        result = ptr(buffer).readCString();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;-1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">load_all_class</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Java.available) &#123;</span><br><span class="line">        Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> DexFileclass = Java.use(<span class="string">&quot;dalvik.system.DexFile&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> BaseDexClassLoaderclass = Java.use(<span class="string">&quot;dalvik.system.BaseDexClassLoader&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> DexPathListclass = Java.use(<span class="string">&quot;dalvik.system.DexPathList&quot;</span>);</span><br><span class="line"></span><br><span class="line">            Java.enumerateClassLoaders(&#123;</span><br><span class="line">                onMatch: <span class="function"><span class="keyword">function</span> (<span class="params">loader</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">var</span> basedexclassloaderobj = Java.cast(loader, BaseDexClassLoaderclass);</span><br><span class="line">                        <span class="keyword">var</span> pathList = basedexclassloaderobj.pathList.value;</span><br><span class="line">                        <span class="keyword">var</span> pathListobj = Java.cast(pathList, DexPathListclass)</span><br><span class="line">                        <span class="keyword">var</span> dexElements = pathListobj.dexElements.value;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">var</span> index <span class="keyword">in</span> dexElements) &#123;</span><br><span class="line">                            <span class="keyword">var</span> element = dexElements[index];</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="keyword">var</span> dexfile = element.dexFile.value;</span><br><span class="line">                                <span class="keyword">var</span> dexfileobj = Java.cast(dexfile, DexFileclass);</span><br><span class="line">                                <span class="built_in">console</span>.log(<span class="string">&quot;dexFile:&quot;</span>, dexfileobj);</span><br><span class="line">                                <span class="keyword">const</span> classNames = [];</span><br><span class="line">                                <span class="keyword">const</span> enumeratorClassNames = dexfileobj.entries();</span><br><span class="line">                                <span class="keyword">while</span> (enumeratorClassNames.hasMoreElements()) &#123;</span><br><span class="line">                                    <span class="keyword">var</span> className = enumeratorClassNames.nextElement().toString();</span><br><span class="line">                                    classNames.push(className);</span><br><span class="line">                                    <span class="keyword">try</span> &#123;</span><br><span class="line">                                        loader.loadClass(className);</span><br><span class="line">                                    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                                        <span class="built_in">console</span>.log(<span class="string">&quot;loadClass error:&quot;</span>, error);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                                <span class="built_in">console</span>.log(<span class="string">&quot;dexfile error:&quot;</span>, error);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">&quot;loader error:&quot;</span>, error);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                onComplete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;load_all_class end.&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> dex_maps = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print_dex_maps</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> dex <span class="keyword">in</span> dex_maps) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(dex, dex_maps[dex]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dump_dex</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    load_all_class();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> base <span class="keyword">in</span> dex_maps) &#123;</span><br><span class="line">        <span class="keyword">var</span> size = dex_maps[base];</span><br><span class="line">        <span class="built_in">console</span>.log(base);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> magic = ptr(base).readCString();</span><br><span class="line">        <span class="keyword">if</span> (magic.indexOf(<span class="string">&quot;dex&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> process_name = get_self_process_name();</span><br><span class="line">            <span class="keyword">if</span> (process_name != <span class="string">&quot;-1&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> dex_path = <span class="string">&quot;/data/data/&quot;</span> + process_name + <span class="string">&quot;/files/&quot;</span> + base.toString(<span class="number">16</span>) + <span class="string">&quot;_&quot;</span> + size.toString(<span class="number">16</span>) + <span class="string">&quot;.dex&quot;</span>;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;[find dex]:&quot;</span>, dex_path);</span><br><span class="line">                <span class="keyword">var</span> fd = <span class="keyword">new</span> File(dex_path, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (fd &amp;&amp; fd != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> dex_buffer = ptr(base).readByteArray(size);</span><br><span class="line">                    fd.write(dex_buffer);</span><br><span class="line">                    fd.flush();</span><br><span class="line">                    fd.close();</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;[dump dex]:&quot;</span>, dex_path);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_dex</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> libart = Process.findModuleByName(<span class="string">&quot;libart.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> addr_DefineClass = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> symbols = libart.enumerateSymbols();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">0</span>; index &lt; symbols.length; index++) &#123;</span><br><span class="line">        <span class="keyword">var</span> symbol = symbols[index];</span><br><span class="line">        <span class="keyword">var</span> symbol_name = symbol.name;</span><br><span class="line">        <span class="comment">//这个DefineClass的函数签名是Android9的</span></span><br><span class="line">        <span class="comment">//_ZN3art11ClassLinker11DefineClassEPNS_6ThreadEPKcmNS_6HandleINS_6mirror11ClassLoaderEEERKNS_7DexFileERKNS9_8ClassDefE</span></span><br><span class="line">        <span class="keyword">if</span> (symbol_name.indexOf(<span class="string">&quot;ClassLinker&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">            symbol_name.indexOf(<span class="string">&quot;DefineClass&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">            symbol_name.indexOf(<span class="string">&quot;Thread&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">            symbol_name.indexOf(<span class="string">&quot;DexFile&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(symbol_name, symbol.address);</span><br><span class="line">            addr_DefineClass = symbol.address;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;[DefineClass:]&quot;</span>, addr_DefineClass);</span><br><span class="line">    <span class="keyword">if</span> (addr_DefineClass) &#123;</span><br><span class="line">        Interceptor.attach(addr_DefineClass, &#123;</span><br><span class="line">            onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> dex_file = args[<span class="number">5</span>];</span><br><span class="line">                <span class="comment">//ptr(dex_file).add(Process.pointerSize) is &quot;const uint8_t* const begin_;&quot;</span></span><br><span class="line">                <span class="comment">//ptr(dex_file).add(Process.pointerSize + Process.pointerSize) is &quot;const size_t size_;&quot;</span></span><br><span class="line">                <span class="keyword">var</span> base = ptr(dex_file).add(Process.pointerSize).readPointer();</span><br><span class="line">                <span class="keyword">var</span> size = ptr(dex_file).add(Process.pointerSize + Process.pointerSize).readUInt();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (dex_maps[base] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">                    dex_maps[base] = size;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;hook_dex:&quot;</span>, base, size);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>) </span>&#123;&#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> is_hook_libart = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_dlopen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Interceptor.attach(Module.findExportByName(<span class="literal">null</span>, <span class="string">&quot;dlopen&quot;</span>), &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> pathptr = args[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (pathptr !== <span class="literal">undefined</span> &amp;&amp; pathptr != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> path = ptr(pathptr).readCString();</span><br><span class="line">                <span class="comment">//console.log(&quot;dlopen:&quot;, path);</span></span><br><span class="line">                <span class="keyword">if</span> (path.indexOf(<span class="string">&quot;libart.so&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.can_hook_libart = <span class="literal">true</span>;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;[dlopen:]&quot;</span>, path);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.can_hook_libart &amp;&amp; !is_hook_libart) &#123;</span><br><span class="line">                hook_dex();</span><br><span class="line">                is_hook_libart = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(Module.findExportByName(<span class="literal">null</span>, <span class="string">&quot;android_dlopen_ext&quot;</span>), &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> pathptr = args[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (pathptr !== <span class="literal">undefined</span> &amp;&amp; pathptr != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> path = ptr(pathptr).readCString();</span><br><span class="line">                <span class="comment">//console.log(&quot;android_dlopen_ext:&quot;, path);</span></span><br><span class="line">                <span class="keyword">if</span> (path.indexOf(<span class="string">&quot;libart.so&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.can_hook_libart = <span class="literal">true</span>;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;[android_dlopen_ext:]&quot;</span>, path);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.can_hook_libart &amp;&amp; !is_hook_libart) &#123;</span><br><span class="line">                hook_dex();</span><br><span class="line">                is_hook_libart = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setImmediate(hook_dex);</span><br></pre></td></tr></table></figure><h1 id="指针运算符和读写-API"><a href="#指针运算符和读写-API" class="headerlink" title="指针运算符和读写 API"></a>指针运算符和读写 API</h1><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-01-052956.jpg" alt="img"><br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-01-053441.jpg" alt="img"></p><h2 id="hook-so-readPointer"><a href="#hook-so-readPointer" class="headerlink" title="hook so readPointer()"></a>hook so readPointer()</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> libc_addr = Process.findModuleByName(<span class="string">&quot;libc.so&quot;</span>).base;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;libc address is &quot;</span> + libc_addr);</span><br><span class="line">        <span class="comment">// 0x10 转为十进制为 16, 读取</span></span><br><span class="line">        <span class="built_in">console</span>.log(libc_addr.readByteArray(<span class="number">0x10</span>));</span><br><span class="line">        <span class="comment">// readPointer(), 从此内存位置读取 NativePointer</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;pointer size&quot;</span>, Process.pointerSize);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;readPointer() is &quot;</span> + libc_addr.readPointer());</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Memory.readPointer()&quot;</span> + Memory.readPointer(libc_addr.add(Process.pointerSize)));</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h2 id="hook-so-writePointer"><a href="#hook-so-writePointer" class="headerlink" title="hook so writePointer()"></a>hook so writePointer()</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> libc_addr = Process.findModuleByName(<span class="string">&quot;libc.so&quot;</span>).base;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;libc_addr : &quot;</span> + libc_addr);</span><br><span class="line">        <span class="comment">// 分配四个字节的空间地址</span></span><br><span class="line">        <span class="keyword">const</span> r = Memory.alloc(<span class="number">4</span>);</span><br><span class="line">        <span class="comment">// 将 libc_addr 指针写入刚申请的 r 中</span></span><br><span class="line">        r.writePointer(libc_addr);</span><br><span class="line">        <span class="comment">// 读取 r 指针的数据</span></span><br><span class="line">        <span class="keyword">var</span> buffer = Memory.readByteArray(r, <span class="number">4</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(buffer);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//libc_addr : 0x7da7fdf000</span></span><br><span class="line">        <span class="comment">//    0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span></span><br><span class="line"><span class="comment">// 00000000  00 f0 fd a7                                      ....</span></span><br></pre></td></tr></table></figure><h2 id="hook-so-readS32-readU32"><a href="#hook-so-readS32-readU32" class="headerlink" title="hook so readS32(), readU32()"></a>hook so readS32(), readU32()</h2><p>从指定内存地址读取有符号或者无符号 8/16/21/etc 或浮点数/双精度值, 并将其作为数字返回;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> libc_addr = Process.findModuleByName(<span class="string">&quot;libc.so&quot;</span>).base;</span><br><span class="line">        <span class="built_in">console</span>.log(hexdump(libc_addr));</span><br><span class="line">        <span class="built_in">console</span>.log(libc_addr.readS32(), (libc_addr.readS32()).toString(<span class="number">16</span>));</span><br><span class="line">        <span class="built_in">console</span>.log(libc_addr.readU32(), (libc_addr.readU32()).toString(<span class="number">16</span>));</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-03-01-062734.png" alt="img"></p><h2 id="hook-so-writeS32-writeU32"><a href="#hook-so-writeS32-writeU32" class="headerlink" title="hook so writeS32(), writeU32()"></a>hook so writeS32(), writeU32()</h2><p>将有符号或无符号8/16/32/等或浮点数/双精度值写入此内存位置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 开辟四个字节的内存空间</span></span><br><span class="line">        <span class="keyword">const</span> r = Memory.alloc(<span class="number">4</span>);</span><br><span class="line">        r.writeS32(<span class="number">0x12345678</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(r.readByteArray(<span class="number">0x10</span>));</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&lt;!--  <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span>  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line"><span class="number">00000000</span>  <span class="number">78</span> <span class="number">56</span> <span class="number">34</span> <span class="number">12</span> 7d <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">98</span> c0 bb a8 7d <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  xV4.&#125;.......&#125;...</span><br><span class="line"> --&gt;</span><br></pre></td></tr></table></figure><h2 id="hook-so-readByteArray-writeByteArray"><a href="#hook-so-readByteArray-writeByteArray" class="headerlink" title="hook so readByteArray(), writeByteArray()"></a>hook so readByteArray(), writeByteArray()</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 定义一个需要写入的字节数组</span></span><br><span class="line">        <span class="keyword">var</span> arr = [ <span class="number">0x72</span>, <span class="number">0x6F</span>, <span class="number">0x79</span>, <span class="number">0x73</span>, <span class="number">0x75</span>, <span class="number">0x65</span>];</span><br><span class="line">       <span class="comment">//这里申请以arr大小的内存空间</span></span><br><span class="line">        <span class="keyword">var</span> r = Memory.alloc(arr.length);</span><br><span class="line">        <span class="comment">// 将 arr 写入 r 中</span></span><br><span class="line">        r.writeByteArray(arr);</span><br><span class="line">        <span class="comment">// Memory.writeByteArray(r, arr); 同样可以写入</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;memory readbyteArray: &quot;</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(r.readByteArray(arr.length));</span><br><span class="line">        <span class="built_in">console</span>.log(Memory.readByteArray(r, arr.length));</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h2 id="hook-so-readCString-writeUtf8String"><a href="#hook-so-readCString-writeUtf8String" class="headerlink" title="hook so readCString(), writeUtf8String()"></a>hook so readCString(), writeUtf8String()</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 开辟内存空间 存有字符串</span></span><br><span class="line">        <span class="keyword">var</span> r = Memory.allocUtf8String(<span class="string">&quot;你好,世界&quot;</span>);</span><br><span class="line">        <span class="comment">// 读取内存中的字符串</span></span><br><span class="line">        <span class="built_in">console</span>.log(hexdump(r));</span><br><span class="line">        <span class="built_in">console</span>.log(r.readCString());</span><br><span class="line">        <span class="comment">// 往内存中写入新的字符串</span></span><br><span class="line">        r.writeUtf8String(<span class="string">&quot;Hello,World&quot;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(hexdump(r));</span><br><span class="line">        <span class="built_in">console</span>.log(r.readCString())</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h1 id="hook-获取-jni-array"><a href="#hook-获取-jni-array" class="headerlink" title="hook 获取 jni array"></a>hook 获取 jni array</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 jbytesArray 的指针</span></span><br><span class="line"><span class="keyword">var</span> arg1Ptr = Java.vm.getEnv().getByteArrayElements(<span class="built_in">this</span>.arg1, <span class="literal">null</span>) </span><br><span class="line"><span class="comment">// 获取到指针后可以直接 hexdump 打印</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;arg1Ptr&quot;</span>,hexdump(arg1Ptr));</span><br><span class="line"><span class="comment">// 如果是字符串可以直接转</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;arg1Ptr&quot;</span>,arg1Ptr.readCString());</span><br></pre></td></tr></table></figure><h1 id="ida-动态调试"><a href="#ida-动态调试" class="headerlink" title="ida 动态调试"></a>ida 动态调试</h1><ol><li><p>将 ida 中的 android-server 推入到手机中</p><p> <code>adb push /Applications/IDA\ Pro\ 7.0/ida.app/Contents/MacOS/dbgsrv/android_server /data/local/tmp/as</code></p><p> android_server 负责调试 32 位的app, android_server64 负责调试 64 位的app, 改名为 as 可以防止部分 android_server 名称检测</p></li><li><p>给 android_server 增加权限</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">chmod +x /data/<span class="built_in">local</span>/tmp/as</span><br></pre></td></tr></table></figure></li><li><p> 进行端口转发 <code>adb forward tcp:11678 tcp:11678</code></p></li><li><p>启动 android_server 并指定端口为 11678</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">/data/<span class="built_in">local</span>/tmp/as -p11678</span><br></pre></td></tr></table></figure></li><li><p> 调试之前先注入 frida</p></li><li><p> 新建一个 ida 界面</p></li><li><p> Debugger - Remote ARMLinux/Android debugger</p></li><li><p> hostname: localhost; Port: 11678; 勾选 Save network settings as default</p></li><li><p> frida 打印出目标 function 最终的地址, ida 中 g 到目标 function 地址, 查看是否是 thumb 指令集, 如果是 thumb 则 option + g, 将 T 修改为1, 再按 c;</p></li><li><p> File - Script file - 读取 ida trace 脚本, 需要更改目标 so 文件和 function 的起始地址和结束地址; 读取之后会出现断点; 快捷键: <code>option F7</code>; </p></li><li><p> frida 主动调用脚本, 检测断点是否触发</p></li><li><p> 断点检测正常后, ida 中执行 starthook()命令, 进行 hook 操作; 执行<code>suspend_other_thread()</code>挂起其他线程(可选择)</p></li><li><p> ida 中 Debugger - tracing - tracing options - 设置 Trace file 路径 和 取消 Trace over debugger segments 的勾选</p></li><li><p> ida 中 Debugger - tracing - 勾选 instruction tracing</p></li><li><p> frida 主动调用触发断点</p></li><li><p> ida 点击运行按钮进行执行, 此时 ida 中黄色部分为已经执行完的指令, 点击 Debugger -tracing - tracing window 可以看到当前执行进度;</p></li></ol><h1 id="ida-添加自有-python-路径"><a href="#ida-添加自有-python-路径" class="headerlink" title="ida 添加自有 python 路径"></a>ida 添加自有 python 路径</h1><p>修改路径下的文件 : /Applications/IDA Pro 7.0/ida.app/Contents/MacOS/python/init.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Prepare sys.path so loading of the shared objects works</span></span><br><span class="line">lib_dynload = os.path.join(</span><br><span class="line">    sys.executable,</span><br><span class="line">    IDAPYTHON_DYNLOAD_BASE,</span><br><span class="line">    <span class="string">&quot;python&quot;</span>, <span class="string">&quot;lib&quot;</span>, <span class="string">&quot;python2.7&quot;</span>, <span class="string">&quot;lib-dynload&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># added by kevin</span></span><br><span class="line">sys.path.insert(<span class="number">0</span>, <span class="string">&quot;/Users/zhangyang/anaconda3/envs/py2/lib/python2.7/site-packages&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="idapython-脚本调试"><a href="#idapython-脚本调试" class="headerlink" title="idapython 脚本调试"></a>idapython 脚本调试</h1><p>在 pycharm 中开启调试</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-06-03-040306.png"></p><p>在需要调试的脚本中添加断点</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pydevd_pycharm</span><br><span class="line"></span><br><span class="line">pydevd_pycharm.settrace(<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">12345</span>, stdoutToServer=<span class="literal">True</span>, stderrToServer=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>在 idapython 的<code>__init__.py</code>文件中添加自有的 python 路径;</p><p>先在 pycharm 中打开调试监听, 在 ida 中运行要调试的脚本即可;</p><h1 id="jni-helper"><a href="#jni-helper" class="headerlink" title="jni_helper"></a>jni_helper</h1><ol><li> 进入目录 <code>~/androidFxxk/idaTools/jni_helper</code></li><li> <code>java -jar JadxFindJNI/JadxFindJNI.jar &lt;apk.path&gt; &lt;output.json&gt;</code></li><li> ida 中<code>Script File</code>运行 <code>jni_help</code>脚本, 路径 <code>~/androidFxxk/idaTools/jni_helper/ida/jni_helper.py</code></li><li> 导入刚才生成的 <code>output.json</code> 文件即可自动识别</li></ol>]]></content>
      
      
      <categories>
          
          <category> frida </category>
          
      </categories>
      
      
        <tags>
            
            <tag> frida </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>逆向环境搭建</title>
      <link href="androidenv/"/>
      <url>androidenv/</url>
      
        <content type="html"><![CDATA[<h1 id="google-系统镜像"><a href="#google-系统镜像" class="headerlink" title="google 系统镜像"></a>google 系统镜像</h1><ul><li>推荐<code>8.1.0 OPM7.181205.001</code></li><li>下载地址: <a href="https://developers.google.com/android/images">https://developers.google.com/android/images</a></li><li>国内镜像: <a href="http://aosp.opersys.com/">http://aosp.opersys.com/</a></li></ul><h1 id="sdk-工具包"><a href="#sdk-工具包" class="headerlink" title="sdk 工具包"></a>sdk 工具包</h1><ul><li>包含 adb, fastboot, systrace 等</li><li>下载地址: <a href="https://developer.android.com/studio/releases/platform-tools">https://developer.android.com/studio/releases/platform-tools</a></li></ul><h1 id="twrp-管理工具"><a href="#twrp-管理工具" class="headerlink" title="twrp 管理工具"></a>twrp 管理工具</h1><ul><li>下载地址: <a href="https://twrp.me/Devices/">https://twrp.me/Devices/</a></li></ul><h1 id="SuperSU"><a href="#SuperSU" class="headerlink" title="SuperSU"></a>SuperSU</h1><ul><li>下载地址: <a href="https://supersuroot.org/download/">https://supersuroot.org/download/</a></li></ul><h1 id="Magisk"><a href="#Magisk" class="headerlink" title="Magisk"></a>Magisk</h1><ul><li>下载地址: <a href="https://github.com/topjohnwu/Magisk/releases">https://github.com/topjohnwu/Magisk/releases</a></li></ul><h1 id="apktool"><a href="#apktool" class="headerlink" title="apktool"></a>apktool</h1><ul><li>下载地址: <a href="https://bitbucket.org/iBotPeaches/apktool/downloads/">https://bitbucket.org/iBotPeaches/apktool/downloads/</a></li></ul><h1 id="wifiADB"><a href="#wifiADB" class="headerlink" title="wifiADB"></a>wifiADB</h1><ul><li>下载地址: <a href="https://play.google.com/store/apps/details?id=com.ttxapps.wifiadb&amp;hl=en_US">https://play.google.com/store/apps/details?id=com.ttxapps.wifiadb&amp;hl=en_US</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># connect</span></span><br><span class="line">adb connect ip:port</span><br><span class="line">adb shell</span><br><span class="line"></span><br><span class="line"><span class="comment"># disconnect</span></span><br><span class="line">adb disconnect</span><br></pre></td></tr></table></figure><h1 id="安卓系统设置"><a href="#安卓系统设置" class="headerlink" title="安卓系统设置"></a>安卓系统设置</h1><h2 id="wifi-显示错误"><a href="#wifi-显示错误" class="headerlink" title="wifi 显示错误"></a>wifi 显示错误</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">settings put global captive_portal_http_url https://www.google.cn/generate_204</span><br><span class="line">settings put global captive_portal_https_url https://www.google.cn/generate_204</span><br><span class="line">settings put global ntp_server 1.hk.pool.ntp.org</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h1 id="frida-frida-tools-objection-版本"><a href="#frida-frida-tools-objection-版本" class="headerlink" title="frida frida-tools objection 版本"></a>frida frida-tools objection 版本</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保证安装的顺序 否则可能会导致安装的版本不对</span></span><br><span class="line">pip install frida==12.8.0</span><br><span class="line">pip install frida-tools==5.3.0</span><br><span class="line">pip install objection==1.8.4</span><br></pre></td></tr></table></figure><h1 id="BurpSuite-破解版"><a href="#BurpSuite-破解版" class="headerlink" title="BurpSuite 破解版"></a>BurpSuite 破解版</h1><p><a href="https://blog.csdn.net/u014549283/article/details/81248886">https://blog.csdn.net/u014549283/article/details/81248886</a></p><h1 id="brook"><a href="#brook" class="headerlink" title="brook"></a>brook</h1><p><a href="https://github.com/txthinking/brook">https://github.com/txthinking/brook</a></p><h1 id="010editor-过期处理"><a href="#010editor-过期处理" class="headerlink" title="010editor 过期处理"></a>010editor 过期处理</h1><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-11-27-082817.jpg" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-11-27-082817.jpg"></p><h1 id="miniconda"><a href="#miniconda" class="headerlink" title="miniconda"></a>miniconda</h1><p>pyenv依赖问题一直很麻烦，可以切到miniconda</p><ol><li>下载安装脚本（建议科学）：<br>proxychains wget</li></ol><p><a href="https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh">https://repo.anaconda.com/miniconda/Miniconda3-lat…</a></p><ol><li>给安装脚本可执行权限<br>chmod +x Miniconda3-latest-Linux-x86_64.sh</li><li>运行安装脚本：<br>sh Miniconda3-latest-Linux-x86_64.sh</li><li>安装python3.8.0环境（建议科学）<br>proxychains conda create -n py380 python=3.8.0</li><li>切换到python3.8.0<br>conda activate py380</li><li>安装frida 12.8.0全家桶（建议科学）<br>proxychains pip install frida12.8.0<br>proxychains pip install frida-tools5.3.0<br>proxychains pip install objection==1.8.4</li><li>为了新建的终端默认的env在py380，可以将下面这句话放在/root/.bashrc的末尾，然后source一下。</li></ol><p>conda activate py380</p><ol><li>也可以把这句话放在/root/.bashrc的末尾，source之后只要运行mfrida命令即可切换到py380环境。</li></ol><p>alias mfrida=”conda activate py380”</p><ol><li>第七条和第八条二选一即可。开始享受12.8.0全家桶吧~</li></ol><h1 id="charles-破解版"><a href="#charles-破解版" class="headerlink" title="charles 破解版"></a>charles 破解版</h1><p><a href="https://www.zzzmode.com/mytools/charles/">https://www.zzzmode.com/mytools/charles/</a></p><h1 id="fastboot"><a href="#fastboot" class="headerlink" title="fastboot"></a>fastboot</h1><p><code>r0ysue</code> 星球直接搜索 <code>fastboot</code> 即可</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-11-28-085946.png" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-11-28-085946.png"></p><h1 id="android-系统刷机"><a href="#android-系统刷机" class="headerlink" title="android 系统刷机"></a>android 系统刷机</h1><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ul><li>  手机: Nexus 6P</li><li>  系统: <a href="https://developers.google.com/android/images">google 官方工厂镜像</a></li></ul><p>使用 <code>wget</code> 命令下载目标系统镜像, 下载完成后使用 <code>shasum -a 256 /tmp/hello.txt</code> 进行文件校验;</p><h2 id="刷机"><a href="#刷机" class="headerlink" title="刷机"></a>刷机</h2><h3 id="fastboot-1"><a href="#fastboot-1" class="headerlink" title="fastboot"></a>fastboot</h3><p>第一步, 将手机进入 <code>fastboot</code>状态, 操作如下:</p><ol><li>  将 USB 断开, 确保手机有 80% 以上的电量;</li><li>  将手机完全关机</li><li>  同时按住音量向下键和开机键</li><li>  手机进入 <code>fastboot</code>状态</li></ol><blockquote><p>  如果手机没有解锁, 那么 Device State 显示 Locked; 需要先解锁, 只有 Unlocked 才可以继续刷入;</p></blockquote><h3 id="刷入系统"><a href="#刷入系统" class="headerlink" title="刷入系统"></a>刷入系统</h3><p>第二步, 手机用 USB 连接电脑, 运行脚本, 将系统刷入手机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unzip 解压下载好的系统文件</span><br><span class="line"><span class="built_in">cd</span> 解压好的目录</span><br><span class="line">./flash-all.sh</span><br></pre></td></tr></table></figure><p>刷机完成后手机可以正常开机;</p><h3 id="刷入-twrp"><a href="#刷入-twrp" class="headerlink" title="刷入 twrp"></a>刷入 twrp</h3><p>第三步, 下载<code>twrp</code>针对对应机型的镜像, 手机再次进入到 fastboot 模式, 使用 fastboot 命令将镜像刷入;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot flash recovery 下载好的 twrp 镜像.img</span><br></pre></td></tr></table></figure><p>刷完之后, 手机按两次音量向下键, 选择 Recovery mode, 按电源键进入, 稍等片刻即可进入 twrp 界面; </p><p>进入 twrp 界面后, 直接滑开即可, 意味着允许修改系统;</p><h3 id="刷入-Magisk"><a href="#刷入-Magisk" class="headerlink" title="刷入 Magisk"></a>刷入 Magisk</h3><p>从 Magisk 的 github 中下载最新的卡刷包 <a href="https://github.com/topjohnwu/Magisk/releases/tag/v23.0">magisk.zip</a></p><p>然后使用 adb 命令将卡刷包上传到手机中 <code>adb push magisk.zip /sdcard/</code></p><p>然后使用 twrp 将这个卡刷包安装到手机里, 打开 twrp, 点选 <code>Install</code>, 选择刚刚传入进去的 magisk.zip 文件, 滑动确认安装;</p><p>安装完成后, 直接重启即可; <code>Reboot System</code>;</p><h2 id="root"><a href="#root" class="headerlink" title="root"></a>root</h2><ol><li>  <code>设置 --&gt;  系统 --&gt;  关于手机 --&gt;  版本号</code>, 点击版本号五下, 打开开发者选项, 然后进入 <code>设置 --&gt;  系统 --&gt;  开发者选项</code>;</li><li>  打开 USB 调试选项;</li><li>  USB 连接电脑, 使用 adb 命令连接;</li><li>  手机授权点击同意</li><li>  <code>su</code></li><li>  手机出现 Magisk 的超级用户请求, 点击允许;</li></ol><h1 id="charles-抓包"><a href="#charles-抓包" class="headerlink" title="charles 抓包"></a>charles 抓包</h1><ul><li><a href="http://zhaoxincheng.com/index.php/2020/07/16/%E5%AE%89%E5%8D%937-0%E5%8F%8A%E4%BB%A5%E4%B8%8A%E6%8A%93%E5%8C%85%E8%AF%81%E4%B9%A6%E5%B0%8F%E6%8A%80%E5%B7%A7/">http://zhaoxincheng.com/index.php/2020/07/16/安卓7-0及以上抓包证书小技巧/</a></li></ul><ol><li>将证书安装到 user 下</li><li>用re管理器把<code>/data/misc/user/0/cacerts-added/</code>这个路径下面的文件复制到<code>/system/etc/security/cacerts</code></li></ol>]]></content>
      
      
      <categories>
          
          <category> env </category>
          
      </categories>
      
      
        <tags>
            
            <tag> env </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一行命令内网穿透</title>
      <link href="neiwangchuangtou/"/>
      <url>neiwangchuangtou/</url>
      
        <content type="html"><![CDATA[<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>本地搭建 web 服务</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__author__ = <span class="string">&quot;Kevin&quot;</span></span><br><span class="line">__time__ = <span class="string">&quot;2021/2/24&quot;</span></span><br><span class="line">__blog__ = <span class="string">&quot;https://kevinspider.github.io/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span>():</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">   app.run()</span><br></pre></td></tr></table></figure><p>运行起来之后, 可以通过本地端口 <code>http://127.0.0.1:5000/</code> 进行正常访问</p><h1 id="穿透"><a href="#穿透" class="headerlink" title="穿透"></a>穿透</h1><p>开启了本地服务之后, 接下来可以通过 <code>localhost</code> 命令将本地网站提供给所有人访问<br><code>ssh -R 80:localhost:5000 localhost.run</code><br>返回的外网地址为:<br><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-02-24-021047.png" alt="img"><br>直接访问即可: <a href="http://zhangyang-9d453a8b.localhost.run/">http://zhangyang-9d453a8b.localhost.run</a></p>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> others </tag>
            
            <tag> 内网穿透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xposed</title>
      <link href="xposed/"/>
      <url>xposed/</url>
      
        <content type="html"><![CDATA[<h1 id="Xposed-简介"><a href="#Xposed-简介" class="headerlink" title="Xposed 简介"></a>Xposed 简介</h1><p>Xposed 是可以在不修改 apk 的情况下影响程序运行, 修改系统的框架<br>基于它可以制作出很多功能强大的模块, 且在功能不冲突的情况下同时运行;<br>在这个框架下, 我们可以加载自己编写的插件 app, 实现对目标 apk 的注入, 拦截等;</p><h1 id="xposed-原理"><a href="#xposed-原理" class="headerlink" title="xposed 原理"></a>xposed 原理</h1><p>控制 <code>zygote</code> 进程, 通过替换<code>/system/bin/app_precess</code> 程序控制 <code>zygote</code> 进程, 使得它在系统启动的过程中加载 <code>Xposed framework</code> 的一个 <code>jar</code> 文件 (<code>XposedBridge.jar</code>), 从而完成对 <code>zygote</code> 进程机器创建的虚拟机的劫持, 并且能够允许开发者独立替代任何<code>class</code>, 例如 <code>framework</code>本身, 系统 UI 又或者任意一个 app;</p><h1 id="Xposed-开发范式"><a href="#Xposed-开发范式" class="headerlink" title="Xposed 开发范式"></a>Xposed 开发范式</h1><p>新建 android 项目, 在 AndroidManifest.xml 文件中, Application中 activity 标签上面添加以下代码:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;xposedmodule&quot;</span><br><span class="line">    android:value=&quot;true&quot; /&gt;   <span class="comment">&lt;!--定义 xposed 这是一个 xposed 模块--&gt;</span></span><br><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;xposeddescription&quot;</span><br><span class="line">    android:value=&quot;这是一个Xposed例程&quot; /&gt;  <span class="comment">&lt;!-- 关于模块的描述 --&gt;</span></span><br><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;xposedminversion&quot;</span><br><span class="line">    android:value=&quot;53&quot; /&gt;   <span class="comment">&lt;!-- 该模块支持的最低版本 本例为 53 --&gt;</span></span><br></pre></td></tr></table></figure><p>在 AndroidStudio3.1 中, 自动配置 XposedBridgeApi.jar;</p><p>在 项目/app/src/main/ 目录下找到 build.gradle, 添加以下代码:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">jcenter()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">compileOnly &#x27;de.robv.android.xposed:api:82&#x27;</span><br><span class="line">compileOnly &#x27;de.robv.android.xposed:api:82:sources&#x27;</span><br></pre></td></tr></table></figure><p>结果如下:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compileOnly &#x27;de.robv.android.xposed:api:82&#x27;</span><br><span class="line">    compileOnly &#x27;de.robv.android.xposed:api:82:sources&#x27;</span><br><span class="line">    implementation fileTree(dir: &quot;libs&quot;, include: [&quot;*.jar&quot;])</span><br><span class="line">    implementation &#x27;androidx.appcompat:appcompat:1.2.0&#x27;</span><br><span class="line">    implementation &#x27;androidx.constraintlayout:constraintlayout:2.0.4&#x27;</span><br><span class="line">    testImplementation &#x27;junit:junit:4.12&#x27;</span><br><span class="line">    androidTestImplementation &#x27;androidx.test.ext:junit:1.1.2&#x27;</span><br><span class="line">    androidTestImplementation &#x27;androidx.test.espresso:espresso-core:3.3.0&#x27;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 Project 模式下, 找到 /app/src/main/java/包名/ , 即在 MainActivity 同级目录下, 创建 java 类;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kevin.xposed03;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hook</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam lpparam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!lpparam.packageName.equals(<span class="string">&quot;包名&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>告诉 xposed 框架入口类的位置, 在 /app/src/main 目录下创建 assets 文件夹, 在该 assets 文件中创建 xposed_init.txt 文件, 在里面定义入口类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.kevin.xposed03.Hook</span><br></pre></td></tr></table></figure><h1 id="Hook-获取类和设置类的静态属性"><a href="#Hook-获取类和设置类的静态属性" class="headerlink" title="Hook 获取类和设置类的静态属性"></a>Hook 获取类和设置类的静态属性</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kevin.xposed03;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hook</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;Hook&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam lpparam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;handleLoadPackage: Hook starting&quot;</span>);</span><br><span class="line"><span class="comment">//        xposed 是全局 hook, 必须实现 IXposedHookLoadPackage 的接口</span></span><br><span class="line"><span class="comment">//        handleLoadPackage 是 hook 之后的回调, 其中传入的参数 lpparam 携带了包名信息, 需要进行过滤</span></span><br><span class="line">        <span class="keyword">if</span> (!lpparam.packageName.equals(<span class="string">&quot;com.xiaojianbang.xposeddemo&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;handleLoadPackage: find target package&quot;</span>);</span><br><span class="line"><span class="comment">//        hook 修改类的静态属性</span></span><br><span class="line"><span class="comment">//        1. 找到要 hook 的类 p1:要 hook 的类名 p2:classLoader</span></span><br><span class="line">        Class&lt;?&gt; targetClazz = XposedHelpers.findClass(<span class="string">&quot;com.xiaojianbang.xposeddemo.Demo&quot;</span>, lpparam.classLoader);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        2. setStaticIntField p1: findClass 的目标类 p2: 字段名称 p3: 要设置的值</span></span><br><span class="line">        XposedHelpers.setStaticIntField(targetClazz, <span class="string">&quot;staticInt&quot;</span>, <span class="number">1024</span>);</span><br><span class="line">        <span class="keyword">int</span> staticInt = XposedHelpers.getStaticIntField(targetClazz, <span class="string">&quot;staticInt&quot;</span>);</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;handleLoadPackage: xposed staticInt is &quot;</span> + staticInt);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        设置 String 类型的静态变量的值</span></span><br><span class="line">        XposedHelpers.setStaticObjectField(targetClazz,<span class="string">&quot;Tag&quot;</span>, <span class="string">&quot;kevin&quot;</span>);</span><br><span class="line">        String hookTag = (String) XposedHelpers.getStaticObjectField(targetClazz, <span class="string">&quot;Tag&quot;</span>);</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;handleLoadPackage: xposed hookTag is &quot;</span> + hookTag);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>hadnleLoadPackage() 是 hook 之后的回调函数, 传入的参数 lpparam 携带了大量的信息;</li><li>lpparam.packageName 可以获取到加载的包名, xposed 是全局 hook, 需要使用包名进行过滤</li><li>lpparam.classLoader 可以获取到当前的 classLoader</li><li>XposedHelpers.findClass(类名字符串, 当前的 classLoader 对象) 获取到要 hook 的类</li><li>XposedHelpers.setStaticIntField(要 hook 的类, 静态字段名字符串, 要设置的值) 给类的静态属性赋值</li><li>XposedHelpers.getStaticIntFiled(要 hook 的类, 静态字段名字符串) 获取 int 类型的类的静态属性</li><li>XposedHelpers.setStaticObjectField(要 hook 的类, 静态字段名字符串, 要设置的值) 给非基础数据类型的类的静态属性赋值</li><li>XposedHelpers.getStaticObjectField(要 hook 的类, 静态字段名字符串) 获取非基础数据类型的类的静态属性的值</li></ul><h1 id="Hook-构造函数"><a href="#Hook-构造函数" class="headerlink" title="Hook 构造函数"></a>Hook 构造函数</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        hook 构造函数</span></span><br><span class="line">Class&lt;?&gt; targetClazz = XposedHelpers.findClass(<span class="string">&quot;com.xiaojianbang.xposeddemo.Demo&quot;</span>, lpparam.classLoader);</span><br><span class="line">        XposedHelpers.findAndHookConstructor(targetClazz, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line"><span class="comment">//            hook 方法需要实现 XC_MethodHook 抽象类, 实现 beforeHookedMethod 方法和 afterHookedMethod 方法</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;beforeHookedMethod: 这是无参构造函数前&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;beforeHookedMethod: 这是无参构造函数后&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        hook 有参构造函数</span></span><br><span class="line"><span class="comment">//        参数要 hook 的 class 和传入的参数类型 都是字节码 </span></span><br><span class="line">        XposedHelpers.findAndHookConstructor(targetClazz, String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                param.args[<span class="number">0</span>] = <span class="string">&quot;Xposed 专题&quot;</span>;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;beforeHookedMethod: 这是有参构造函数前&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;beforeHookedMethod: 这是有参构造函数后&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-普通方法"><a href="#Hook-普通方法" class="headerlink" title="Hook 普通方法"></a>Hook 普通方法</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    hook 普通方法</span></span><br><span class="line"><span class="comment">//    xposed 中 hook 普通方法 无论是 static / not static / private / public 都是调用 findAndHookMethod</span></span><br><span class="line">Class&lt;?&gt; targetClazz = XposedHelpers.findClass(<span class="string">&quot;com.xiaojianbang.xposeddemo.Demo&quot;</span>, lpparam.classLoader);</span><br><span class="line">        XposedHelpers.findAndHookMethod(targetClazz, <span class="string">&quot;publicFunc&quot;</span>, String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;beforeHookedMethod: publicFunc hooked before input param is: &quot;</span> + param.args[<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;beforeHookedMethod: publicFunc hooked after&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><h1 id="Hook-复杂参数"><a href="#Hook-复杂参数" class="headerlink" title="Hook 复杂参数"></a>Hook 复杂参数</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        hook 复杂参数</span></span><br><span class="line"><span class="comment">//        参数 1: String</span></span><br><span class="line"><span class="comment">//        参数 2: String[][]</span></span><br><span class="line"><span class="comment">//        参数 3: Map</span></span><br><span class="line"><span class="comment">//        参数 4: ArrayList</span></span><br><span class="line">Class&lt;?&gt; targetClazz = XposedHelpers.findClass(<span class="string">&quot;com.xiaojianbang.xposeddemo.Demo&quot;</span>, lpparam.classLoader);</span><br><span class="line">        XposedHelpers.findAndHookMethod(</span><br><span class="line">                targetClazz,</span><br><span class="line">                <span class="string">&quot;complexParameterFunc&quot;</span>,</span><br><span class="line">                String.class, <span class="comment">// &quot;java.lang.String&quot;</span></span><br><span class="line">                String[][].class, <span class="comment">// &quot;[[Ljava.lang.String;&quot;</span></span><br><span class="line">                Map.class, <span class="comment">// &quot;java.util.Map&quot;</span></span><br><span class="line">                ArrayList.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        Log.i(TAG, <span class="string">&quot;beforeHookedMethod: complexParameterFunc hooked before&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        Log.i(TAG, <span class="string">&quot;beforeHookedMethod: complexParameterFunc hooked after&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br></pre></td></tr></table></figure><h1 id="Hook-自定义类"><a href="#Hook-自定义类" class="headerlink" title="Hook 自定义类"></a>Hook 自定义类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        hook 自定义类</span></span><br><span class="line"><span class="comment">//        获取自定义的类</span></span><br><span class="line"><span class="comment">//        获取 class 字节码的方法</span></span><br><span class="line"><span class="comment">//          1. 类名.class</span></span><br><span class="line"><span class="comment">//          2. 对象.getClass()</span></span><br><span class="line"><span class="comment">//          3. Class.forName()</span></span><br><span class="line"><span class="comment">//          4. &quot;java.lang.String&quot; 传入类的路径字符串</span></span><br><span class="line"><span class="comment">//          5. new DexClassLoader().loadClass 动态加载</span></span><br><span class="line"><span class="comment">//          6. XposedHelpers.findClass()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        Class&lt;?&gt; Animal =  XposedHelpers.findClass(&quot;com.xiaojianbang.xposeddemo.Animal&quot;,lpparam.classLoader);</span></span><br><span class="line"><span class="comment">//        Class&lt;?&gt; Animal = lpparam.classLoader.loadClass(&quot;com.xiaojianbang.xposeddemo.Animal&quot;);</span></span><br><span class="line">        Class&lt;?&gt; Animal = Class.forName(<span class="string">&quot;com.xiaojianbang.xposeddemo.Animal&quot;</span>, <span class="keyword">false</span>, lpparam.classLoader);</span><br><span class="line"></span><br><span class="line">        XposedHelpers.findAndHookMethod(</span><br><span class="line">                targetClazz,</span><br><span class="line">                <span class="string">&quot;Inner&quot;</span>,</span><br><span class="line">                Animal,</span><br><span class="line">                String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        Log.i(TAG, <span class="string">&quot;beforeHookedMethod: Inner&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        Log.i(TAG, <span class="string">&quot;afterHookedMethod: Inner&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br></pre></td></tr></table></figure><h1 id="Hook-替换函数"><a href="#Hook-替换函数" class="headerlink" title="Hook 替换函数"></a>Hook 替换函数</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        hook 替换函数</span></span><br><span class="line"><span class="comment">//        不是在方法执行前或后增加内容, 而是直接覆盖该方法, 可以调用原有方法</span></span><br><span class="line">Class&lt;?&gt; targetClazz = XposedHelpers.findClass(<span class="string">&quot;com.xiaojianbang.xposeddemo.Demo&quot;</span>, lpparam.classLoader);</span><br><span class="line">        XposedHelpers.findAndHookMethod(targetClazz, <span class="string">&quot;repleaceFunc&quot;</span>, <span class="keyword">new</span> XC_MethodReplacement() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> Object <span class="title">replaceHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                Log.d(TAG, <span class="string">&quot;replaceHookedMethod: 替换原有的方法 repleaceFunc&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><h1 id="Hook-内部类并获取对象的属性"><a href="#Hook-内部类并获取对象的属性" class="headerlink" title="Hook 内部类并获取对象的属性"></a>Hook 内部类并获取对象的属性</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; InnerClass = XposedHelpers.findClass(<span class="string">&quot;com.xiaojianbang.xposeddemo.Demo$InnerClass&quot;</span>, lpparam.classLoader);</span><br><span class="line">XposedHelpers.findAndHookMethod(InnerClass, <span class="string">&quot;innerFunc&quot;</span>, String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">        <span class="keyword">int</span> aa = XposedHelpers.getIntField(param.thisObject, <span class="string">&quot;innerPublicInt&quot;</span>);</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;beforeHookedMethod: innerPublicInt is &quot;</span> + aa);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>内部类为 类名$内部类名</li><li>获取当前对象 param.thisObject 获取当前的对象</li></ul><h1 id="Hook-主动调用"><a href="#Hook-主动调用" class="headerlink" title="Hook 主动调用"></a>Hook 主动调用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Class targetClass = XposedHelpers.findClass(<span class="string">&quot;com.xiaojianbang.xposeddemo.Demo&quot;</span>, lpparam.classLoader);</span><br><span class="line">Log.d(TAG, <span class="string">&quot;beforeHookedMethod: 调用前&quot;</span>);</span><br><span class="line">XposedHelpers.callMethod(targetClass.newInstance(), <span class="string">&quot;refl&quot;</span>);</span><br><span class="line">Log.d(TAG, <span class="string">&quot;beforeHookedMethod: 调用后&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="Hook-打印调用栈"><a href="#Hook-打印调用栈" class="headerlink" title="Hook 打印调用栈"></a>Hook 打印调用栈</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Log.e(<span class="string">&quot;调用栈 tag&quot;</span>, <span class="string">&quot;Stack&quot;</span>, <span class="keyword">new</span> Throwable(<span class="string">&quot;手动抛出异常&quot;</span>));</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> xposed </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xposed </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>objection 指南</title>
      <link href="objection/"/>
      <url>objection/</url>
      
        <content type="html"><![CDATA[<h1 id="objectiong"><a href="#objectiong" class="headerlink" title="objectiong"></a>objectiong</h1><h2 id="objection-启动"><a href="#objection-启动" class="headerlink" title="objection 启动"></a>objection 启动</h2><h3 id="attach-启动"><a href="#attach-启动" class="headerlink" title="attach 启动"></a>attach 启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objection -g -d packagename explore</span><br></pre></td></tr></table></figure><h3 id="spawn-启动"><a href="#spawn-启动" class="headerlink" title="spawn 启动"></a>spawn 启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--startup-command</span><br><span class="line">objection -g packagename explore --startup-command &#39;android hooking watch class_method android.app.AlertDialog.onCreate --dump-args --dump-backtrace --dump-return&#39;</span><br></pre></td></tr></table></figure><h3 id="连接远程自定义端口"><a href="#连接远程自定义端口" class="headerlink" title="连接远程自定义端口"></a>连接远程自定义端口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objection -N -h 192.168.0.1 -p 6666 -g com.kevin.demo1 explore</span><br></pre></td></tr></table></figure><h2 id="objection-memory"><a href="#objection-memory" class="headerlink" title="objection memory"></a>objection memory</h2><h3 id="memory-list-modules"><a href="#memory-list-modules" class="headerlink" title="memory list modules"></a>memory list modules</h3><p>查看内存中加载的 <code>module</code> , 可以方便获取 <code>.so</code> 的基地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memory list modules [--json module.json]</span><br></pre></td></tr></table></figure><ul><li>result</li></ul><h3 id="memory-list-exports"><a href="#memory-list-exports" class="headerlink" title="memory list exports"></a>memory list exports</h3><p>查看指定 <code>module</code> 的导出函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memory list exports [libssl.so](http:&#x2F;&#x2F;libssl.so) [--json exports.json]</span><br></pre></td></tr></table></figure><ul><li>result</li></ul><h2 id="objection-android"><a href="#objection-android" class="headerlink" title="objection android"></a>objection android</h2><h3 id="解除-ssl-pinning"><a href="#解除-ssl-pinning" class="headerlink" title="解除 ssl pinning"></a>解除 ssl pinning</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android sslpinning disable</span><br></pre></td></tr></table></figure><h3 id="获取当前的-activity"><a href="#获取当前的-activity" class="headerlink" title="获取当前的 activity"></a>获取当前的 <code>activity</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking get current_activity</span><br></pre></td></tr></table></figure><h3 id="获取当前的所有-activities"><a href="#获取当前的所有-activities" class="headerlink" title="获取当前的所有 activities"></a>获取当前的所有 <code>activities</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking list activities</span><br></pre></td></tr></table></figure><ul><li>result</li></ul><h3 id="获取当前的所有-services"><a href="#获取当前的所有-services" class="headerlink" title="获取当前的所有 services"></a>获取当前的所有 <code>services</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking list services</span><br></pre></td></tr></table></figure><h3 id="获取当前所有的-receivers"><a href="#获取当前所有的-receivers" class="headerlink" title="获取当前所有的 receivers"></a>获取当前所有的 <code>receivers</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking list receivers</span><br></pre></td></tr></table></figure><h3 id="获取当前加载的所有-classes"><a href="#获取当前加载的所有-classes" class="headerlink" title="获取当前加载的所有 classes"></a>获取当前加载的所有 <code>classes</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking list classes</span><br></pre></td></tr></table></figure><h3 id="获取指定-class-下的所有-methods"><a href="#获取指定-class-下的所有-methods" class="headerlink" title="获取指定 class 下的所有 methods"></a>获取指定 <code>class</code> 下的所有 <code>methods</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking list class_methods com.kevin.demoso1.MainActivity</span><br></pre></td></tr></table></figure><ul><li>result</li></ul><h3 id="模糊查询-class"><a href="#模糊查询-class" class="headerlink" title="模糊查询 class"></a>模糊查询 <code>class</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking search classes Main</span><br></pre></td></tr></table></figure><ul><li>result</li></ul><h3 id="模糊查询-method"><a href="#模糊查询-method" class="headerlink" title="模糊查询 method"></a>模糊查询 <code>method</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking search methods jni</span><br></pre></td></tr></table></figure><h3 id="查找指定-class-的对象实例"><a href="#查找指定-class-的对象实例" class="headerlink" title="查找指定 class 的对象实例"></a>查找指定 <code>class</code> 的对象实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android heap search instances com.kevin.demoso1.MainActivity</span><br></pre></td></tr></table></figure><ul><li>result</li></ul><h3 id="调用实例对象的方法"><a href="#调用实例对象的方法" class="headerlink" title="调用实例对象的方法"></a>调用实例对象的方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android heap execute 0x1eea myfirstjni --return-string</span><br></pre></td></tr></table></figure><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-09-02-084704.png" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-09-02-084704.png"></p><h3 id="启动指定-activity"><a href="#启动指定-activity" class="headerlink" title="启动指定 activity"></a>启动指定 <code>activity</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android intent launch_activity com.kevin.demoso1.MainActivity</span><br></pre></td></tr></table></figure><h3 id="启动指定-service"><a href="#启动指定-service" class="headerlink" title="启动指定 service"></a>启动指定 <code>service</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android intent launch_service com.kevin.demoso1.MainService</span><br></pre></td></tr></table></figure><h3 id="监控指定的-class"><a href="#监控指定的-class" class="headerlink" title="监控指定的 class"></a>监控指定的 <code>class</code></h3><p>定位到了关键 <code>class</code> , 可以通过 <code>watch class</code> 来监控该类下的所有方法, 帮助定位</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking watch class com.kevin.demoso1.MainActivity --dump-args --dump-backtrace --dump-return</span><br></pre></td></tr></table></figure><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-09-02-091131.png" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-09-02-091131.png"></p><h3 id="监控指定的-method"><a href="#监控指定的-method" class="headerlink" title="监控指定的 method"></a>监控指定的 <code>method</code></h3><p>通过 <code>watch class_method</code> 监控可疑的方法, 对方法的参数, 返回值和调用栈进行打印;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking watch class_method com.kevin.demoso1.MainActivity.myfirstjniJNI --dump-args --dump-backtrace --dump-return</span><br></pre></td></tr></table></figure><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-09-02-091541.png" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2020-09-02-091541.png"></p><h3 id="过滤-objection-结果"><a href="#过滤-objection-结果" class="headerlink" title="过滤 objection 结果"></a>过滤 objection 结果</h3><p><code>objection log</code> 默认是不能用 <code>grep</code> 进行过滤的, 但是可以通过</p><p><code>objection -g packagename run commandline | grep keyword</code> 进行过滤</p><p>例如: <code>objection -g com.android.settings run memory list modules | grep libc</code></p><p>还可以通过查看 <code>~/.objection/objection.log</code> 来查看日志信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ~&#x2F;.objection&#x2F;objection.log | grep -i display</span><br></pre></td></tr></table></figure><h2 id="一次-hook-多个类"><a href="#一次-hook-多个类" class="headerlink" title="一次 hook 多个类"></a>一次 hook 多个类</h2><ol><li><p>获取到指定的包下面的所有的类</p><p><code>android hooking search class okhttp</code></p></li><li><p>复制 <code>class</code> , 创建 txt 进行替换, 在类名前面加上 <code>android hooking watch class</code></p></li><li><p>使用 <code>objection -g packagename explore -c file.txt</code> 进行批量 <code>hook</code></p><p><code>objection -g com.kevin.Test explore -c hooklist.txt</code></p></li></ol><h2 id="objection指定参数进行-hook"><a href="#objection指定参数进行-hook" class="headerlink" title="objection指定参数进行 hook"></a><code>objection</code>指定参数进行 <code>hook</code></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking watch class_method 指定类和方法 参数类型, 参数类型</span><br></pre></td></tr></table></figure><p>例如: <code>android hooking watch class_method javax.crypto.Mac.getInstance java.lang.String</code></p><h1 id="wallbreaker"><a href="#wallbreaker" class="headerlink" title="wallbreaker"></a>wallbreaker</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone [https:&#x2F;&#x2F;github.com&#x2F;hluwa&#x2F;Wallbreaker](https:&#x2F;&#x2F;github.com&#x2F;hluwa&#x2F;Wallbreaker) ~&#x2F;.objection&#x2F;plugins&#x2F;Wallbreaker</span><br></pre></td></tr></table></figure><h2 id="objection-加载插件"><a href="#objection-加载插件" class="headerlink" title="objection 加载插件"></a>objection 加载插件</h2><h3 id="加载-wallbreaker"><a href="#加载-wallbreaker" class="headerlink" title="加载 wallbreaker"></a>加载 <code>wallbreaker</code></h3><p>启动时加载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objection -g [com.app.name](http:&#x2F;&#x2F;com.app.name) explore -P ~&#x2F;.objection&#x2F;plugins</span><br></pre></td></tr></table></figure><p>启动后加载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugin load &#x2F;Users&#x2F;zhangyang&#x2F;.objection&#x2F;plugins&#x2F;Wallbreaker</span><br></pre></td></tr></table></figure><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><ol><li><code>plugin wallbreaker classsearch &lt;pattern&gt;</code> 查找指定的类</li><li><code>plugin wallbreaker classdump &lt;classname&gt; [--fullname]</code> <code>dump</code> 指定的类</li><li><code>plugin wallbreaker objectsearch &lt;classname&gt;</code> 查找指定的类的实例</li><li><code>plugin wallbreaker objectdump &lt;handle&gt; [--fullname]</code> <code>dump</code> 指定的类的实例</li></ol><h1 id="dexdump"><a href="#dexdump" class="headerlink" title="dexdump"></a>dexdump</h1><h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;hluwa&#x2F;FRIDA-DEXDump ~&#x2F;.objection&#x2F;plugins&#x2F;dexdump</span><br></pre></td></tr></table></figure><h2 id="加载-dexdump插件"><a href="#加载-dexdump插件" class="headerlink" title="加载 dexdump插件"></a>加载 <code>dexdump</code>插件</h2><p>启动 <code>objection</code> , 读取插件, 这里要注意路径, <code>Wallbreaker</code> 直接读取 <code>plugins</code> 即可, 但是 <code>fridadexdump</code> 需要读取到 <code>dexdump</code> 目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.hello.qqc explore -P ~/.objection/plugins/dexdump/</span><br><span class="line"></span><br><span class="line"><span class="comment"># to dump all found dex.</span></span><br><span class="line">plugin dexdump dump </span><br><span class="line"></span><br><span class="line"><span class="comment"># to search and print all dex</span></span><br><span class="line">plugin dexdump search</span><br></pre></td></tr></table></figure><h2 id="python-中使用-dexdump"><a href="#python-中使用-dexdump" class="headerlink" title="python 中使用 dexdump"></a>python 中使用 dexdump</h2><p><code>pip3 install frida-dexdump</code><br><code>frida-dexdump -h</code><br><code>frida-dexdump dump</code> 直接脱当前应用</p><p>arguments:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-n: [Optional] Specify target process name, when spawn mode, it requires an application package name. If not specified, use frontmost application.</span><br><span class="line">-p: [Optional] Specify pid when multiprocess. If not specified, dump all.</span><br><span class="line">-f: [Optional] Use spawn mode, default is <span class="built_in">disable</span>.</span><br><span class="line">-s: [Optional] When spawn mode, start dump work after sleep few seconds. default is 10s.</span><br><span class="line">-d: [Optional] Enable deep search maybe detected more dex, but speed will be slower.</span><br><span class="line">-h: show <span class="built_in">help</span>.</span><br></pre></td></tr></table></figure><h2 id="查找脱下的-dex"><a href="#查找脱下的-dex" class="headerlink" title="查找脱下的 dex"></a>查找脱下的 <code>dex</code></h2><p>进入存放脱下来的 <code>dex</code> 文件目录, 一般是在 <code>~/.objection/plugins/包名</code> 路径下</p><p>定位主文件</p><ul><li>通过文件大小判断 <code>ls -lht</code></li><li>通过 <code>grep -rnli &quot;mainactivity&quot; *</code> 获取当前目录下含有 <code>MainActivity</code> 的目标文件</li></ul><h2 id="重打包"><a href="#重打包" class="headerlink" title="重打包"></a>重打包</h2><ol><li><code>apktool d -s xxx.apk</code> 保留壳的 <code>dex</code> 文件</li><li>删除原 <code>dex</code> 文件, 将脱壳后的文件全部复制进来, 将文件名修改为 <code>classes.dex</code> <code>classes2.dex</code> <code>classes3.dex</code></li><li>修改 <code>AndroidManifest.xml</code> 文件中的 <code>application</code> 节点下面的 <code>android:name</code> 属性, 原来的是 <code>android:name=&quot;com.SecShell.SecShell.ApplicationWrapper&quot;</code> ，这是梆梆壳启动的地方，现在我们需要修改为脱壳后的 <code>dex</code> 中继承了 <code>Application</code> 的类，我们搜索 <code>extends Appliaction</code> ，可以找到是 <code>cn.net.tokyo.ccg.base.App</code></li><li><code>apktool b 包名</code> 进行重打包</li></ol>]]></content>
      
      
      <categories>
          
          <category> objection </category>
          
      </categories>
      
      
        <tags>
            
            <tag> objection </tag>
            
            <tag> wallbreaker </tag>
            
            <tag> dexdump </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>frida hook java</title>
      <link href="fridahookjava/"/>
      <url>fridahookjava/</url>
      
        <content type="html"><![CDATA[<h1 id="Frida-启动"><a href="#Frida-启动" class="headerlink" title="Frida 启动"></a>Frida 启动</h1><h2 id="attach-启动"><a href="#attach-启动" class="headerlink" title="attach 启动"></a>attach 启动</h2><p>直接附加到指定包名的应用中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U com.kevin.android -l hook.js --no-pause</span><br></pre></td></tr></table></figure><p>直接附加到当前应用中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">frida -UF -l hook.js --no-pause</span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">import frida</span><br><span class="line"></span><br><span class="line">def on_message(message,data):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;message&quot;</span>,message)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data&quot;</span>,data)</span><br><span class="line"></span><br><span class="line">device = frida.get_usb_device()</span><br><span class="line">session = device.attach(<span class="string">&quot;com.kevin.demo1&quot;</span>)</span><br><span class="line"></span><br><span class="line">with open(<span class="string">&quot;./demo1.js&quot;</span>,<span class="string">&quot;r&quot;</span>) as f:</span><br><span class="line">    script = session.create_script(f.read())</span><br><span class="line"></span><br><span class="line">script.on(<span class="string">&quot;message&quot;</span>,on_message)</span><br><span class="line">script.load()</span><br><span class="line">sys.stdin.read()</span><br></pre></td></tr></table></figure><h2 id="spawn-启动"><a href="#spawn-启动" class="headerlink" title="spawn 启动"></a>spawn 启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">frida -U -f com.kevin.android -l demo1.js --no-pause</span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">import frida</span><br><span class="line"></span><br><span class="line">def on_message(message,data):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;message&quot;</span>,message)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data&quot;</span>,data)</span><br><span class="line"></span><br><span class="line">device = frida.get_usb_device()</span><br><span class="line">pid = device.spawn([<span class="string">&quot;com.kevin.demo1&quot;</span>])</span><br><span class="line">device.resume(pid)</span><br><span class="line">session = device.attach(pid)</span><br><span class="line"></span><br><span class="line">with open(<span class="string">&quot;./rpc_demo.js&quot;</span>,<span class="string">&#x27;r&#x27;</span>) as f:</span><br><span class="line">    script = session.create_script(f.read())</span><br><span class="line"></span><br><span class="line">script.on(<span class="string">&quot;message&quot;</span>,on_message)</span><br><span class="line">script.load()</span><br><span class="line"></span><br><span class="line">sys.stdin.read()</span><br></pre></td></tr></table></figure><h1 id="frida-server-自定义端口"><a href="#frida-server-自定义端口" class="headerlink" title="frida-server 自定义端口"></a>frida-server 自定义端口</h1><h2 id="frida-server"><a href="#frida-server" class="headerlink" title="frida server"></a>frida server</h2><p>更改 frida server 默认端口: 27042 并开启远程连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">su -</span><br><span class="line"><span class="built_in">cd</span> /data/<span class="built_in">local</span>/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入 wifiadb 对应的 ip 和自定义端口</span></span><br><span class="line">./frida-server -l 192.168.0.1:6666</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以使用默认端口启动</span></span><br><span class="line">./frida-server -l 192.168.0.1</span><br></pre></td></tr></table></figure><h2 id="frida"><a href="#frida" class="headerlink" title="frida"></a>frida</h2><p>frida 远程连接自定义端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 连接指定 6666 端口</span></span><br><span class="line">frida -H 192.168.0.1:6666 com.demo1.app -l demo1.js</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认使用端口 27042</span></span><br><span class="line">frida -H 192.168.0.1 -l demo1.js</span><br></pre></td></tr></table></figure><h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> frida, sys</span><br><span class="line"></span><br><span class="line">jsCode = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">console.log(&quot;test&quot;);</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">message</span>(<span class="params">message, data</span>):</span></span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">        print(<span class="string">f&quot;[*] <span class="subst">&#123;message[<span class="string">&#x27;payload&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(message)</span><br><span class="line"><span class="comment"># ./fs120800 -l &quot;0.0.0.0:6666&quot;</span></span><br><span class="line"><span class="comment"># adb wifi 10.0.0.23</span></span><br><span class="line">process = frida.get_device_manager().add_remote_device(<span class="string">&#x27;127.0.0.1:6666&#x27;</span>).attach(<span class="string">&#x27;com.kevin.app&#x27;</span>)</span><br><span class="line">script = process.create_script(jsCode)</span><br><span class="line">script.on(<span class="string">&quot;message&quot;</span>,message)</span><br><span class="line">script.load()</span><br><span class="line"><span class="built_in">input</span>()</span><br></pre></td></tr></table></figure><h1 id="Frida-rpc-远程调用"><a href="#Frida-rpc-远程调用" class="headerlink" title="Frida rpc 远程调用"></a>Frida rpc 远程调用</h1><h2 id="python-1"><a href="#python-1" class="headerlink" title="python"></a>python</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, request</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">message</span>(<span class="params">message, data</span>):</span></span><br><span class="line"><span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">print(<span class="string">f&quot;[*] <span class="subst">&#123;message[<span class="string">&#x27;payload&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(message)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ./fs120800 -l &quot;0.0.0.0:6666&quot;</span></span><br><span class="line"><span class="comment"># adb wifi 10.0.0.123</span></span><br><span class="line"><span class="comment"># 远程 frida-server 路径 adb wifi 的 ip : frida-server 启动的端口</span></span><br><span class="line">session = frida.get_device_manager().add_remote_device(<span class="string">&#x27;10.0.0.123:6666&#x27;</span>).attach(<span class="string">&#x27;com.example.demoso1&#x27;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/Users/zhangyang/codes/fridaProject/rpcDemo/hook.js&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    jsCode = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(&quot;加载代码&quot;, jsCode)</span></span><br><span class="line">script = session.create_script(jsCode)</span><br><span class="line">script.on(<span class="string">&quot;message&quot;</span>,message)</span><br><span class="line">script.load()</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(&quot;加密&quot;,&quot;1213&quot;)</span></span><br><span class="line"><span class="comment"># encodeResult = script.exports.invokemethod01(&quot;123&quot;)</span></span><br><span class="line"><span class="comment"># decodeResult = script.exports.invokemethod02(encodeResult)</span></span><br><span class="line"><span class="comment"># print(decodeResult)</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/encrypt&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span><span class="comment">#data解密</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt_class</span>():</span></span><br><span class="line">    data = request.get_data()</span><br><span class="line">    json_data = json.loads(data.decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    postdata = json_data.get(<span class="string">&quot;data&quot;</span>)</span><br><span class="line">    res = script.exports.invokemethod01(postdata)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/decrypt&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span><span class="comment">#url加密</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_class</span>():</span></span><br><span class="line">    data = request.get_data()</span><br><span class="line">    json_data = json.loads(data.decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    postdata = json_data.get(<span class="string">&quot;data&quot;</span>)</span><br><span class="line">    print(postdata)</span><br><span class="line">    res = script.exports.invokemethod02(postdata)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure><h2 id="js"><a href="#js" class="headerlink" title="js"></a>js</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///&lt;reference path=&#x27;/Users/zhangyang/node_modules/@types/frida-gum/index.d.ts&#x27;/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 先 hook 方法 method01</span></span><br><span class="line"><span class="comment">// function hookmethod1()&#123;</span></span><br><span class="line"><span class="comment">//     Java.perform(function()&#123;</span></span><br><span class="line"><span class="comment">//         var targetClass = Java.use(&quot;com.example.demoso1.MainActivity&quot;);</span></span><br><span class="line"><span class="comment">//         targetClass.method01.implementation = function(str)&#123;</span></span><br><span class="line"><span class="comment">//             console.log(&quot;str is &quot;, str);</span></span><br><span class="line"><span class="comment">//             var result = this.method01(str);</span></span><br><span class="line"><span class="comment">//             console.log(&quot;result is &quot;, result);</span></span><br><span class="line"><span class="comment">//             return result;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;)</span></span><br><span class="line"><span class="comment">// &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 主动调用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fridamethod01</span>(<span class="params">inputStr</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">null</span>;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> targetClass = Java.use(<span class="string">&quot;com.example.demoso1.MainActivity&quot;</span>);</span><br><span class="line">        result = targetClass.method01(inputStr);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fridamethod02</span>(<span class="params">inputStr</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// public native String method02(String str);</span></span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.choose(<span class="string">&quot;com.example.demoso1.MainActivity&quot;</span>,&#123;</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span>(<span class="params">ins</span>)</span>&#123;</span><br><span class="line">                result = ins.method02(inputStr);</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 优先测试 js 中的主动调用</span></span><br><span class="line"><span class="comment">// function main()&#123;</span></span><br><span class="line"><span class="comment">//     console.log(&quot;你好 -&gt; 结果为:&quot;, fridamethod01(&quot;你好&quot;));</span></span><br><span class="line"><span class="comment">//     console.log(&quot;27cae29a0913f6791705ca10be31a3e0 -&gt; 结果为&quot;, fridamethod02(&quot;27cae29a0913f6791705ca10be31a3e0&quot;))</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// setImmediate(main);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于主动调用设置 rpc</span></span><br><span class="line">rpc.exports = &#123;</span><br><span class="line">    invokemethod01: fridamethod01,</span><br><span class="line">    invokemethod02: fridamethod02,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="压力测试"><a href="#压力测试" class="headerlink" title="压力测试"></a>压力测试</h2><p>tmp.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;data&quot;</span>: <span class="string">&quot;62feb9a98a01945ab06c0dd7823adc57&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">siege -c30 -r1 <span class="string">&quot;&lt;http://127.0.0.1:5000/encrypt&gt; POST &lt; tmp.json&quot;</span></span><br></pre></td></tr></table></figure><h2 id="nps-进行内网穿透"><a href="#nps-进行内网穿透" class="headerlink" title="nps 进行内网穿透"></a>nps 进行内网穿透</h2><ol><li><p>nps server 启动</p><p>mac: <code>sudo nps start</code></p></li><li><p>新建客户端</p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-01-14-032324.png" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-01-14-032324.png"></p><p>安卓手机连接客户端 <code>./npc -server=10.0.0.124:8024 -vkey=hm40rtjpf2j3c1up -type=tcp</code></p></li><li><p>给客户端添加和 frida server 的端口映射</p><p>安卓手机启动 frida-server: <code>./fs12800 -l 0.0.0.0:6666</code></p><p><img src="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-01-14-032703.png" alt="https://kevinspider-1258012111.cos.ap-shanghai.myqcloud.com/2021-01-14-032703.png"></p><p>将目标 frida-server 的端口映射到 56666 端口上</p></li><li><p>python 脚本更改和 frida-server 的连接</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session = frida.get_device_manager().add_remote_device(<span class="string">&#x27;10.0.0.124:56666&#x27;</span>).attach(<span class="string">&#x27;com.example.demoso1&#x27;</span>)</span><br></pre></td></tr></table></figure><p>此时就可以将 frida-server 开放到公网了;</p></li></ol><h1 id="Hook-普通方法"><a href="#Hook-普通方法" class="headerlink" title="Hook 普通方法"></a>Hook 普通方法</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> UtilsClass = Java.use(<span class="string">&quot;com.kevin.app.Utils&quot;</span>);</span><br><span class="line">        UtilsClass.getCalc.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 打印信息</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;a:&#x27;</span> + a + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;b:&#x27;</span> + b);</span><br><span class="line">        <span class="comment">// 调用原方法获取结果</span></span><br><span class="line">        <span class="keyword">var</span> value = <span class="built_in">this</span>.getCalc(a, b);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;result:&#x27;</span>,value);</span><br><span class="line">            <span class="comment">// 修改返回值</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">123456</span>;    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><h1 id="Hook-重载方法"><a href="#Hook-重载方法" class="headerlink" title="Hook 重载方法"></a>Hook 重载方法</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> UtilsClass = Java.use(<span class="string">&quot;com.kevin.app.Utils&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重载无参方法</span></span><br><span class="line">        UtilsClass.test.overload().implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;hook overload no args&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.test();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 重载有参方法 - 基础数据类型</span></span><br><span class="line">UtilsClass.test.overload(<span class="string">&#x27;int&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;hook overload int args&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> myNum = <span class="number">9999</span>;</span><br><span class="line">            <span class="keyword">var</span> oriResult = <span class="built_in">this</span>.test(num);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;oriResult is :&quot;</span> + oriResult);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.test(myNum);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 重载有参方法 - 引用数据类型</span></span><br><span class="line">        UtilsClass.test.overload(<span class="string">&#x27;com.kevin.app.Money&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">money</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;hook Money args&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.test(money);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// hook 指定方法的所有重载</span></span><br><span class="line">        <span class="keyword">var</span> ClassName = Java.use(<span class="string">&quot;com.xiaojianbang.app.Utils&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> overloadsLength = ClassName.test.overloads.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; overloadsLength; i++)&#123;</span><br><span class="line">            ClassName.test.overloads[i].implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="comment">// 遍历打印 arguments </span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> a = <span class="number">0</span>; a &lt; <span class="built_in">arguments</span>.length; a++)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(a + <span class="string">&quot; : &quot;</span> + <span class="built_in">arguments</span>[a]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 调用原方法</span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.test.apply(<span class="built_in">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><h1 id="Hook-构造方法"><a href="#Hook-构造方法" class="headerlink" title="Hook 构造方法"></a>Hook 构造方法</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// hook 构造方法 $init</span></span><br><span class="line">        <span class="keyword">var</span> MoneyClass = Java.use(<span class="string">&quot;com.kevin.app.Money&quot;</span>);</span><br><span class="line">        MoneyClass.$init.overload().implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;hook Money $init&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.$init();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><h1 id="Hook-对象"><a href="#Hook-对象" class="headerlink" title="Hook 对象"></a>Hook 对象</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// hook instance</span></span><br><span class="line">        Java.choose(<span class="string">&quot;com.xiaojianbang.app.Money&quot;</span>,&#123;</span><br><span class="line">            onMatch : <span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;find it!!&quot;</span>, instance.getInfo());</span><br><span class="line">                <span class="comment">// something to do...</span></span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;compelete!!!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><h1 id="Hook-动静态成员属性"><a href="#Hook-动静态成员属性" class="headerlink" title="Hook 动静态成员属性"></a>Hook 动静态成员属性</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> MoneyClass = Java.use(<span class="string">&quot;com.xiaojianbang.app.Money&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// get static properties</span></span><br><span class="line">        <span class="comment">// need to use .value</span></span><br><span class="line">        <span class="keyword">var</span> ori_property = MoneyClass.flag.value;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;ori_property: &quot;</span>, ori_property);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// change static properties </span></span><br><span class="line">        MoneyClass.flag.value = <span class="string">&quot;change the value&quot;</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;change to : &quot;</span>, MoneyClass.flag.value);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// get dynamic properties </span></span><br><span class="line">        Java.choose(<span class="string">&quot;com.xiaojianbang.app.Money&quot;</span>,&#123;</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                instance.num.value = <span class="number">50000</span>;</span><br><span class="line">                <span class="comment">// 当对象的成员属性和成员方法名重复时,成员属性前加`_`,进行区分</span></span><br><span class="line">                instance._name.value = <span class="string">&quot;ouyuan&quot;</span>; </span><br><span class="line">                <span class="built_in">console</span>.log(instance._name.value, instance.num.value, instance.flag.value);</span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;complete!!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><h1 id="Hook-内部类"><a href="#Hook-内部类" class="headerlink" title="Hook 内部类"></a>Hook 内部类</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perfor(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// hook 内部类</span></span><br><span class="line">        <span class="comment">// 内部类使用$进行分隔 不使用.</span></span><br><span class="line">        <span class="keyword">var</span> InnerClass = Java.use(<span class="string">&quot;com.xiaojianbang.app.Money$innerClass&quot;</span>);</span><br><span class="line">        <span class="comment">// 重写内部类的 $init 方法</span></span><br><span class="line">        InnerClass.$init.overload(<span class="string">&quot;java.lang.String&quot;</span>,<span class="string">&quot;int&quot;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;x: &quot;</span>,x);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;y: &quot;</span>,y);</span><br><span class="line">            <span class="built_in">this</span>.$init(x,y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><h1 id="Hook-匿名类"><a href="#Hook-匿名类" class="headerlink" title="Hook 匿名类"></a>Hook 匿名类</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口, 抽象类, 不可以被new</span></span><br><span class="line"><span class="comment">// 接口, 抽象类 要使用必须要实例化, 实例化不是通过new, 而是通过实现接口方法, 继承抽象类等方式</span></span><br><span class="line"><span class="comment">// new __接口__&#123;&#125; 可以理解成 new 了一个实现接口的匿名类, 在匿名类的内部(花括号内),实现了这个接口</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// hook 匿名类</span></span><br><span class="line">        <span class="comment">// 匿名类在 smail中以 $1, $2 等方式存在, 需要通过 java 行号去 smail 找到准确的匿名类名称 </span></span><br><span class="line">        <span class="keyword">var</span> NiMingClass = Java.use(<span class="string">&quot;com.xiaojianbang.app.MainActivity$1&quot;</span>);</span><br><span class="line">        NiMingClass.getInfo.implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;kevin change 匿名类&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><h1 id="Hook-类的所有方法"><a href="#Hook-类的所有方法" class="headerlink" title="Hook 类的所有方法"></a>Hook 类的所有方法</h1><ul><li><code>Java.enumerateLoadedClasses()</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.enumerateLoadedClasses(&#123;</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span>(<span class="params">name,handle</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (name.indexOf(<span class="string">&quot;com.xiaojianbang.app.Money&quot;</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(name,handle);</span><br><span class="line">                    <span class="comment">// 利用反射 获取类中的所有方法</span></span><br><span class="line">                    <span class="keyword">var</span> TargetClass = Java.use(name);</span><br><span class="line">                    <span class="comment">// return Method Object List</span></span><br><span class="line">                    <span class="keyword">var</span> methodsList = TargetClass.class.getDeclaredMethods(); </span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; methodsList.length; i++)&#123;</span><br><span class="line">                        <span class="comment">// Method Objection getName()</span></span><br><span class="line">                        <span class="built_in">console</span>.log(methodsList[i].getName());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;complete!!!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>Java.enumerateLoadedClassesSync()</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// return String[] class name</span></span><br><span class="line">        <span class="keyword">var</span> classList = Java.enumerateLoadedClassesSync();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; classList.length; i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> targetClass = classList[i];</span><br><span class="line">            <span class="keyword">if</span> (targetClass.indexOf(<span class="string">&quot;com.xiaojianbang.app.Money&quot;</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;hook the class: &quot;</span>, targetClass);</span><br><span class="line">            <span class="keyword">var</span> TargetClass = Java.use(targetClass);</span><br><span class="line">                <span class="comment">// 利用反射获取类中的所有方法</span></span><br><span class="line">            <span class="keyword">var</span> methodsList = TargetClass.class.getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> k=<span class="number">0</span>; k &lt; methodsList.length; k++)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(methodsList[k].getName());</span><br><span class="line">            &#125;               </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><h1 id="Hook-类的所有方法及重载"><a href="#Hook-类的所有方法及重载" class="headerlink" title="Hook 类的所有方法及重载"></a>Hook 类的所有方法及重载</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// hook md5 class in app</span></span><br><span class="line">        <span class="comment">// 1. iterate classes</span></span><br><span class="line">        <span class="keyword">var</span> classList = Java.enumerateLoadedClassesSync();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; classList.length; i++)&#123;</span><br><span class="line">            <span class="comment">// 筛选过滤 只遍历 MD5 下面的方法</span></span><br><span class="line">            <span class="keyword">if</span> (classList[i].indexOf(<span class="string">&quot;com.xiaojianbang.app.MD5&quot;</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> className = classList[i];</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;class name is :&quot;</span>, className);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 2. get methods of the class</span></span><br><span class="line">                <span class="comment">// 返回一个 Methods对象的数组</span></span><br><span class="line">                <span class="keyword">var</span> methodsList = Java.use(className).class.getDeclaredMethods();</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> k=<span class="number">0</span>; k&lt;methodsList.length; k++)&#123;                    </span><br><span class="line">                    <span class="comment">// console.log(&quot;method is :&quot;,methodsList[k],typeof(methodsList[k]));</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// 3. Method object.getName() --&gt; methodName and class[methodName] to hook method</span></span><br><span class="line">                    <span class="keyword">var</span> methodName = methodsList[k].getName(); <span class="comment">// </span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// console.log(&#x27;methodName&#x27;,methodName);</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 4. use apply and arguments to implementation</span></span><br><span class="line">                    <span class="keyword">var</span> hookClass = Java.use(className);</span><br><span class="line">                    <span class="comment">// 5. overloads</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> o = <span class="number">0</span>; o&lt; hookClass[methodName].overloads.length; o++)&#123;</span><br><span class="line">                        hookClass[methodName].overloads[o].implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                            <span class="keyword">for</span> (<span class="keyword">var</span> a=<span class="number">0</span>; a&lt;<span class="built_in">arguments</span>.length; a++)&#123;</span><br><span class="line">                                <span class="built_in">console</span>.log(<span class="string">&#x27;argument &#x27;</span>,a,<span class="built_in">arguments</span>[a]);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">// return this[methodName].apply(this,arguments);</span></span><br><span class="line">                            <span class="keyword">return</span> <span class="string">&quot;fucking the md5&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-动态加载的-dex"><a href="#Hook-动态加载的-dex" class="headerlink" title="Hook 动态加载的 dex"></a>Hook 动态加载的 dex</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            onMatch : <span class="function"><span class="keyword">function</span>(<span class="params">loader</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// loadClass or findClass</span></span><br><span class="line">                    <span class="keyword">if</span> (loader.loadClass(<span class="string">&quot;com.xiaojianbang.app.Dynamic&quot;</span>))&#123;</span><br><span class="line">                        Java.classFactory.loader = loader;</span><br><span class="line">                        <span class="keyword">var</span> hookClass = Java.use(<span class="string">&quot;com.xiaojianbang.app.Dynamic&quot;</span>);</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">&quot;success hook it :&quot;</span>, hookClass);</span><br><span class="line">                        <span class="comment">// something to do;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    <span class="comment">// pass</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;complete !!! &quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><p>经常在加壳的 app 中, 没办法正确找到正常加载 app 类的 classloader, 可以使用以下代码:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        Java.enumerateClassLoadersSync().forEach(<span class="function"><span class="keyword">function</span> (<span class="params">classloader</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;classloader&quot;</span>, classloader);</span><br><span class="line">                classloader.loadClass(<span class="string">&quot;com.kanxue.encrypt01.MainActivity&quot;</span>);</span><br><span class="line">                Java.classFactory.loader = classloader;</span><br><span class="line">                <span class="keyword">var</span> mainActivityClass = Java.use(<span class="string">&quot;com.kanxue.encrypt01.MainActivity&quot;</span>);</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;mainActivityClass&quot;</span>, mainActivityClass);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;error&quot;</span>, error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-主动构造数组"><a href="#Hook-主动构造数组" class="headerlink" title="Hook 主动构造数组"></a>Hook 主动构造数组</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mainArray</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> myCharList = Java.array(<span class="string">&quot;char&quot;</span>,[<span class="string">&#x27;一&#x27;</span>,<span class="string">&#x27;去&#x27;</span>,<span class="string">&#x27;二&#x27;</span>,<span class="string">&#x27;三&#x27;</span>,<span class="string">&#x27;里&#x27;</span>]);</span><br><span class="line">        <span class="keyword">var</span> myStringList = Java.array(<span class="string">&quot;java.lang.String&quot;</span>,[<span class="string">&quot;一&quot;</span>,<span class="string">&quot;二&quot;</span>,<span class="string">&quot;三&quot;</span>]);</span><br><span class="line">        <span class="keyword">var</span> ArrayClass = Java.use(<span class="string">&quot;java.util.Arrays&quot;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(ArrayClass.toString(myCharList));</span><br><span class="line">        <span class="built_in">console</span>.log(ArrayClass.toString(myStringList));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-cast-强制类型转换"><a href="#Hook-cast-强制类型转换" class="headerlink" title="Hook cast 强制类型转换"></a>Hook cast 强制类型转换</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java.cast() 子类可以强转成父类, 父类不能转成子类</span></span><br><span class="line"><span class="comment">// 可以使用Java.cast()将子类强转成父类, 再调用父类的动态方法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">castDemo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> JuiceHandle = <span class="literal">null</span>; <span class="comment">// 用来存储内存中找到的Juice对象</span></span><br><span class="line">        <span class="keyword">var</span> WaterClass = Java.use(<span class="string">&quot;com.r0ysue.a0526printout.Water&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        Java.choose(<span class="string">&quot;com.r0ysue.a0526printout.Juice&quot;</span>,&#123;</span><br><span class="line">onComplete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                JuiceHandle = instance;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;instance:&quot;</span>, instance);</span><br><span class="line">                <span class="comment">// 调用Juice对象的方法</span></span><br><span class="line">                <span class="built_in">console</span>.log(JuiceHandle.fillEnergy());</span><br><span class="line">                <span class="comment">// 子类Juice转父类Water 并调用父类的动态方法</span></span><br><span class="line">                <span class="keyword">var</span> WaterInstance = Java.cast(JuiceHandle,WaterClass);</span><br><span class="line">                <span class="built_in">console</span>.log(WaterInstance.still(WaterInstance));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-打印类实现的接口"><a href="#Hook-打印类实现的接口" class="headerlink" title="Hook 打印类实现的接口"></a>Hook 打印类实现的接口</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">searchInterface</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.enumerateLoadedClasses(&#123;</span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span>(<span class="params">name,handle</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (name.indexOf(<span class="string">&quot;com.r0ysue.a0526printout&quot;</span>) &gt; -<span class="number">1</span>) &#123; <span class="comment">// 使用包名进行过滤</span></span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;find class&quot;</span>);</span><br><span class="line">                    <span class="keyword">var</span> targetClass = Java.use(name);</span><br><span class="line">                    <span class="keyword">var</span> interfaceList = targetClass.class.getInterfaces(); <span class="comment">// 使用反射获取类实现的接口数组</span></span><br><span class="line">                    <span class="keyword">if</span> (interfaceList.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(name) <span class="comment">// 打印类名</span></span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> interfaceList) &#123;</span><br><span class="line">                            <span class="built_in">console</span>.log(<span class="string">&quot;\t&quot;</span>, interfaceList[i].toString()); <span class="comment">// 直接打印接口名称</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-enum-枚举"><a href="#Hook-enum-枚举" class="headerlink" title="Hook enum 枚举"></a>Hook enum 枚举</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enumPrint</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.choose(<span class="string">&quot;com.r0ysue.a0526printout.Signal&quot;</span>,&#123;</span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;find it ,&#x27;</span>,instance);</span><br><span class="line">                <span class="built_in">console</span>.log(instance.class.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-获取-context"><a href="#Hook-获取-context" class="headerlink" title="Hook 获取 context"></a>Hook 获取 context</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getContext</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> currentApplication = Java.use(<span class="string">&quot;android.app.ActivityThread&quot;</span>).currentApplication();</span><br><span class="line">        <span class="built_in">console</span>.log(currentApplication);</span><br><span class="line">        <span class="keyword">var</span> context = currentApplication.getApplicationContext();</span><br><span class="line">        <span class="built_in">console</span>.log(context);</span><br><span class="line">        <span class="keyword">var</span> packageName = context.getPackageName();</span><br><span class="line">        <span class="built_in">console</span>.log(packageName);</span><br><span class="line">        <span class="built_in">console</span>.log(currentApplication.getPackageName());</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-主动调用构造方法"><a href="#Hook-主动调用构造方法" class="headerlink" title="Hook 主动调用构造方法"></a>Hook 主动调用构造方法</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> StringClass = Java.use(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> MoneyClass = Java.use(<span class="string">&quot;com.xiaojianbang.app.Money&quot;</span>);</span><br><span class="line">        MoneyClass.$init.overload(<span class="string">&#x27;java.lang.String&#x27;</span>,<span class="string">&#x27;int&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;hook Money init&#x27;</span>);</span><br><span class="line">            <span class="keyword">var</span> myX = StringClass.new(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> myY = <span class="number">9999</span>;</span><br><span class="line">            <span class="built_in">this</span>.$init(myX,myY);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><h1 id="Hook-主动调用静态方法"><a href="#Hook-主动调用静态方法" class="headerlink" title="Hook 主动调用静态方法"></a>Hook 主动调用静态方法</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main_rsa</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> RSA = Java.use(<span class="string">&quot;com.xiaojianbang.app.RSA&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> StringClass = Java.use(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> base64Class = Java.use(<span class="string">&quot;android.util.Base64&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> myBytes = StringClass.$new(<span class="string">&quot;Hello World&quot;</span>).getBytes();</span><br><span class="line">        <span class="keyword">var</span> result = RSA.encrypt(myBytes);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;result is :&quot;</span>, result);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;json result is: &quot;</span>,<span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;base64 result is :&quot;</span>, base64Class.encodeToString(result,<span class="number">0</span>));</span><br><span class="line">        <span class="comment">// console.log(&quot;new String is : &quot;, StringClass.$new(result)); // 加密之后的内容有很多不可见字符, 不能直接 new String()</span></span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main_rsa);</span><br></pre></td></tr></table></figure><h1 id="Hook-主动调用动态方法"><a href="#Hook-主动调用动态方法" class="headerlink" title="Hook 主动调用动态方法"></a>Hook 主动调用动态方法</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非静态方法的主动调用 自定义instance 并调用 非静态方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main_getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> instance = Java.use(<span class="string">&quot;com.xiaojianbang.app.Money&quot;</span>).$new(<span class="string">&quot;日元&quot;</span>,<span class="number">300000</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(instance.getInfo());</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历所有的对象并调用 需要进行过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main_instance_getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.choose(<span class="string">&quot;com.xiaojianbang.app.Money&quot;</span>,&#123;</span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(instance.getInfo());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-frida-和-python-交互"><a href="#Hook-frida-和-python-交互" class="headerlink" title="Hook frida 和 python 交互"></a>Hook frida 和 python 交互</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">frida 传递参数</span><br><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        console.log(&quot;enter perform&quot;);</span><br><span class="line">        &#x2F;&#x2F; 获取要hook的类</span><br><span class="line">        var TextViewClass &#x3D; Java.use(&quot;android.widget.TextView&quot;);</span><br><span class="line">        &#x2F;&#x2F; 要hook的方法</span><br><span class="line">        TextViewClass.setText.overload(&#39;java.lang.CharSequence&#39;).implementation &#x3D; function (ori_input) &#123;</span><br><span class="line">            console.log(&#39;enter&#39;, &#39;java.lang.CharSequence&#39;);</span><br><span class="line">            console.log(&#39;ori_input&#39;,ori_input.toString());</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 定义用于接受python传参的data</span><br><span class="line">            var receive_data;</span><br><span class="line">            &#x2F;&#x2F; 将原参数传递给python 在python中进行处理</span><br><span class="line">            send(ori_input.toString());</span><br><span class="line">            &#x2F;&#x2F; recv 从python接收传递的内容 默认传过来的是个json对象</span><br><span class="line">            recv(function (json_data) &#123;</span><br><span class="line">                console.log(&#39;data from python &#39; + json_data.data);</span><br><span class="line">                receive_data &#x3D; json_data.data;</span><br><span class="line">                console.log(typeof (receive_data));</span><br><span class="line">            &#125;).wait(); &#x2F;&#x2F;wait() 等待python处理 阻塞</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 转java字符串</span><br><span class="line">            receive_data &#x3D; Java.use(&quot;java.lang.String&quot;).$new(receive_data);</span><br><span class="line">            this.setText(receive_data);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br><span class="line">python 处理收到的参数</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">__author__ &#x3D; &quot;K&quot;</span><br><span class="line">__time__ &#x3D; &quot;2020-08-06 09:48&quot;</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">import base64</span><br><span class="line">import frida</span><br><span class="line">from loguru import logger</span><br><span class="line"></span><br><span class="line">def on_message(message,data):</span><br><span class="line">    logger.info(str(message)) # dict</span><br><span class="line">    logger.info(str(data) if data else &quot;None&quot;)</span><br><span class="line"></span><br><span class="line">    if message[&#39;type&#39;] &#x3D;&#x3D; &#39;error&#39;:</span><br><span class="line">        logger.error(&#39;error:&#39; + str(message[&#39;description&#39;]))</span><br><span class="line">        logger.error(&#39;stack: &#39; + str(message[&#39;stack&#39;]))</span><br><span class="line"></span><br><span class="line">    if message[&#39;type&#39;] &#x3D;&#x3D; &#39;send&#39;:</span><br><span class="line">        logger.info(&#39;get message [*] --&gt; &#39; + message[&#39;payload&#39;])</span><br><span class="line"></span><br><span class="line">        payload &#x3D; message[&#39;payload&#39;]</span><br><span class="line">        # 处理逻辑 sending to the server: YWFhOmJiYg&#x3D;&#x3D;</span><br><span class="line">        tmp &#x3D; payload.split(&#39;:&#39;)</span><br><span class="line">        sts &#x3D; tmp[0]</span><br><span class="line">        need_to_db64 &#x3D; tmp[1]</span><br><span class="line">        user_pass &#x3D; base64.b64decode(need_to_db64.encode()).decode()</span><br><span class="line"></span><br><span class="line">        mine_str &#x3D; &#39;admin&#39; + &#39;:&#39; + user_pass.split(&#39;:&#39;)[-1]</span><br><span class="line">        mine_b64_str &#x3D; base64.b64encode(mine_str.encode()).decode()</span><br><span class="line">        mine_b64_str &#x3D; sts + mine_b64_str</span><br><span class="line">        logger.info(mine_b64_str)</span><br><span class="line"></span><br><span class="line">        # python返回数据给js script.post</span><br><span class="line">        script.post(&#123;&#39;data&#39;:mine_b64_str&#125;)</span><br><span class="line">        logger.info(&#39;python complete&#39;)</span><br><span class="line"></span><br><span class="line">device &#x3D; frida.get_usb_device()</span><br><span class="line"># pid &#x3D; device.spawn([&#39;com.kevin.demo04&#39;])</span><br><span class="line"># time.sleep(1)</span><br><span class="line">session &#x3D; device.attach(&#39;com.kevin.demo02&#39;)</span><br><span class="line">with open(&#39;.&#x2F;hulianhutong.js&#39;,&#39;r&#39;) as f:</span><br><span class="line">    script &#x3D; session.create_script(f.read())</span><br><span class="line"></span><br><span class="line">script.on(&quot;message&quot;,on_message)</span><br><span class="line">script.load()</span><br><span class="line">input()</span><br></pre></td></tr></table></figure><h1 id="Hook-打印-char"><a href="#Hook-打印-char" class="headerlink" title="Hook 打印 char"></a>Hook 打印 char</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 打印char字符, 直接调用java.lang.Character toString()即可</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> CharClass = Java.use(<span class="string">&quot;java.lang.Character&quot;</span>);</span><br><span class="line">        CharClass.toString.overload(<span class="string">&quot;char&quot;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">inputChar</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">this</span>.toString(inputChar);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;inputChar, result: &quot;</span>, inputChar, result);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-打印-char-数组"><a href="#Hook-打印-char-数组" class="headerlink" title="Hook 打印 char 数组"></a>Hook 打印 char 数组</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 使用 java.util.Arrays 的 toString 方法 打印 [C </span></span><br><span class="line"><span class="comment">// 2. 使用 js 的 JSON.stringify 打印 [C</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printCharArray</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> ArrayClass = Java.use(<span class="string">&quot;java.util.Arrays&quot;</span>);</span><br><span class="line">        ArrayClass.toString.overload(<span class="string">&#x27;[C&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">charArray</span>)</span>&#123;</span><br><span class="line">            <span class="comment">// 1. java.util.Arrays.toString()</span></span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">this</span>.toString(charArray);</span><br><span class="line">            <span class="comment">// 2. javascript JSON.stringify()</span></span><br><span class="line">            <span class="keyword">var</span> result1 = <span class="built_in">JSON</span>.stringify(charArray);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;charArray, result : &#x27;</span>, charArray, result);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;charArray, result :&#x27;</span>, charArray, result1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-打印和修改-HashMap"><a href="#Hook-打印和修改-HashMap" class="headerlink" title="Hook 打印和修改 HashMap"></a>Hook 打印和修改 HashMap</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">遍历打印</span><br><span class="line">function main()&#123;</span><br><span class="line">Java.perform(function()&#123;</span><br><span class="line">        var targetClass &#x3D; Java.use(&quot;com.xiaojianbang.app.ShufferMap&quot;);</span><br><span class="line">        targetClass.show.implementation &#x3D; function(map)&#123;</span><br><span class="line">            &#x2F;&#x2F; 遍历 map</span><br><span class="line">        var result &#x3D; &quot;&quot;;</span><br><span class="line">        var it &#x3D; map.keySet().iterator();</span><br><span class="line">        while (it.hasNext())&#123;</span><br><span class="line">            var keyStr &#x3D; it.next();</span><br><span class="line">            var valueStr &#x3D; map.get(keyStr);</span><br><span class="line">                result +&#x3D; valueStr;</span><br><span class="line">        &#125;</span><br><span class="line">            console.log(&quot;result :&quot;, result);</span><br><span class="line">            </span><br><span class="line">            &#x2F;&#x2F; 修改 map</span><br><span class="line">            map.put(&quot;pass&quot;,&quot;fxxk&quot;);</span><br><span class="line">            map.put(&quot;code&quot;,&quot;Hello World&quot;);</span><br><span class="line">            console.log(JSON.stringify(map));</span><br><span class="line">            this.show(map);</span><br><span class="line">            </span><br><span class="line">            return this.show(map);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br><span class="line">cast打印 HashMap</span><br><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var HashMapNode &#x3D; Java.use(&quot;java.util.HashMap$Node&quot;);</span><br><span class="line">        var targetClass &#x3D; Java.use(&quot;com.xiaojianbang.app.ShufferMap&quot;);</span><br><span class="line">        </span><br><span class="line">        var targetClass.show.implementation &#x3D; function(map)&#123;</span><br><span class="line">            var result &#x3D; &quot;&quot;;</span><br><span class="line">            var iterator &#x3D; map.entrySet().iterator();</span><br><span class="line">            while (iterator.hasNext()) &#123;</span><br><span class="line">                console.log(&quot;entry&quot;, iterator.next());</span><br><span class="line">                var entry &#x3D; Java.cast(iterator.next(), HashMapNode);</span><br><span class="line">                console.log(entry.getKey());</span><br><span class="line">                console.log(entry.getValue());</span><br><span class="line">                return +&#x3D; entry.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            console.log(&quot;result is :&quot;, result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><p><code>toString()</code>打印</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> targetClass = Java.use(<span class="string">&quot;com.xiaojianbang.app.ShufferMap&quot;</span>);</span><br><span class="line">        targetClass.show.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">map</span>)</span>&#123;</span><br><span class="line">            <span class="comment">// 直接调用 toString()</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;打印hashmap: -&gt; &quot;</span> + map.toString());</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.show.apply(<span class="built_in">this</span>,<span class="built_in">arguments</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printHashMap</span>(<span class="params">flag, param_hm</span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> HashMap = Java.use(<span class="string">&#x27;java.util.HashMap&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> args_map = Java.cast(param_hm, HashMap);</span><br><span class="line">        send(flag +<span class="string">&quot;:&quot;</span> + args_map.toString());</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-打印-byte-数组"><a href="#Hook-打印-byte-数组" class="headerlink" title="Hook 打印 byte 数组"></a>Hook 打印 byte 数组</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">方法 1</span><br><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">            var StringClass &#x3D; Java.use(&quot;java.lang.String&quot;);</span><br><span class="line">            var byteArray &#x3D; StringClass.$new(&quot;Hello World&quot;).getBytes();</span><br><span class="line">            </span><br><span class="line">            &#x2F;&#x2F; load r0gson</span><br><span class="line">        &#x2F;&#x2F; openClassFile 返回 dex对象, dex对象.load()加载dex文件内容</span><br><span class="line">            Java.openClassFile(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;r0gson.dex&quot;).load();</span><br><span class="line">            var gson &#x3D; Java.use(&quot;com.r0ysue.gson.Gson&quot;);</span><br><span class="line">            console.log(gson.$new().toJson(byteArray));</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; &#x2F;&#x2F; console byte[]</span><br><span class="line">            &#x2F;&#x2F; var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">            &#x2F;&#x2F; console.log(ByteString.of(byteArray).hex()); &#x2F;&#x2F; byte转16进制字符串</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; &#x2F;&#x2F; 创建自定义Java数组 并打印</span><br><span class="line">            &#x2F;&#x2F; var MyArray &#x3D; Java.array(&quot;byte&quot;,[13,4,4,2]);</span><br><span class="line">            &#x2F;&#x2F; console.log(gson.$new().toJson(MyArray));</span><br><span class="line"></span><br><span class="line">            var TargetClass &#x3D; Java.use(&quot;com.xiaojianbang.app.ShufferMap&quot;);</span><br><span class="line">            TargetClass.show.implementation &#x3D;  function(map)&#123;</span><br><span class="line">                console.log(gson.$new().toJson(map));</span><br><span class="line">                return this.show(map);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br><span class="line">方法 2</span><br><span class="line">&#x2F;&#x2F; 1. 使用 java.util.Arrays.toString() 打印 [B</span><br><span class="line">&#x2F;&#x2F; 2. 使用 javascript JSON.stringify() 打印 [B</span><br><span class="line"></span><br><span class="line">function printByteArray()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var ArrayClass &#x3D; Java.use(&quot;java.util.Arrays&quot;);</span><br><span class="line">        ArrayClass.toString.overload(&#39;[B&#39;).implementation &#x3D; function(byteArray)&#123;</span><br><span class="line">&#x2F;&#x2F; 1. 使用 java.util.Arrays.toString() 打印 [B</span><br><span class="line">            var result &#x3D; this.toString(byteArray);</span><br><span class="line">&#x2F;&#x2F; 2. 使用 javascript JSON.stringify() 打印 [B</span><br><span class="line">            var result1 &#x3D; JSON.stringify(byteArray);</span><br><span class="line">            </span><br><span class="line">            console.log(&#39;byteArray,result: &#39;, byteArray, result);</span><br><span class="line">            console.log(&#39;byteArray,result1 :&#39;, byteArray, result1);</span><br><span class="line"></span><br><span class="line">            return result</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">方法 3</span><br><span class="line">function printByteArray(byteArray)&#123;</span><br><span class="line">Java.perform(function()&#123;</span><br><span class="line">var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">console.log(ByteString.of(byteArray).hex())</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-打印调用栈"><a href="#Hook-打印调用栈" class="headerlink" title="Hook 打印调用栈"></a>Hook 打印调用栈</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printStacks</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;====== printStacks start ====== &quot;</span> + name + <span class="string">&quot;==============================&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// sample 1</span></span><br><span class="line">    <span class="keyword">var</span> throwable = Java.use(<span class="string">&quot;android.util.Log&quot;</span>).getStackTraceString(Java.use(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new());</span><br><span class="line">    <span class="built_in">console</span>.log(throwable);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sample 2</span></span><br><span class="line">    <span class="keyword">var</span> exception = Java.use(<span class="string">&quot;android.util.Log&quot;</span>).getStackTraceString(Java.use(<span class="string">&quot;java.lang.Exception&quot;</span>).$new());</span><br><span class="line">    <span class="built_in">console</span>.log(exception);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;====== printStacks end ======== &quot;</span> + name + <span class="string">&quot;==============================&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-gson-打印"><a href="#Hook-gson-打印" class="headerlink" title="Hook gson 打印"></a>Hook gson 打印</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> StringClass = Java.use(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> byteArray = StringClass.$new(<span class="string">&quot;Hello World&quot;</span>).getBytes();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// load r0gson</span></span><br><span class="line">        <span class="comment">// openClassFile 返回 dex对象, dex对象.load()加载dex文件内容</span></span><br><span class="line">            Java.openClassFile(<span class="string">&quot;/data/local/tmp/r0gson.dex&quot;</span>).load();</span><br><span class="line">            <span class="keyword">var</span> gson = Java.use(<span class="string">&quot;com.r0ysue.gson.Gson&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(gson.$new().toJson(byteArray));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// // console byte[]</span></span><br><span class="line">            <span class="comment">// var ByteString = Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span></span><br><span class="line">            <span class="comment">// console.log(ByteString.of(byteArray).hex()); // byte转16进制字符串</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// // 创建自定义Java数组 并打印</span></span><br><span class="line">            <span class="comment">// var MyArray = Java.array(&quot;byte&quot;,[13,4,4,2]);</span></span><br><span class="line">            <span class="comment">// console.log(gson.$new().toJson(MyArray));</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> TargetClass = Java.use(<span class="string">&quot;com.xiaojianbang.app.ShufferMap&quot;</span>);</span><br><span class="line">            TargetClass.show.implementation =  <span class="function"><span class="keyword">function</span>(<span class="params">map</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(gson.$new().toJson(map));</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.show(map);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><h1 id="Hook-打印-non-ascii-和特殊字符"><a href="#Hook-打印-non-ascii-和特殊字符" class="headerlink" title="Hook 打印 non-ascii 和特殊字符"></a>Hook 打印 non-ascii 和特殊字符</h1><p>一些特殊字符和不可见字符, 可以先通过编码再解码的方式进行 <code>hook</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ֏(<span class="keyword">int</span> x) &#123;</span><br><span class="line">        <span class="keyword">return</span> x + <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>针对上面的<code>֏</code>, 直接用<code>js</code>编码, 在通过<code>类名[js解码的方法名]</code>进行<code>implementation</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> targetClass = <span class="string">&quot;com.example.hooktest.MainActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> hookCls = Java.use(targetClass);</span><br><span class="line">            <span class="keyword">var</span> methods = hookCls.class.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> methods) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(methods[i].toString());</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="built_in">encodeURIComponent</span>(methods[i].toString().replace(<span class="regexp">/^.*?\.([^\s\.\(\)]+)\(.*?$/</span>, <span class="string">&quot;$1&quot;</span>)));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            hookCls[<span class="built_in">decodeURIComponent</span>(<span class="string">&quot;%D6%8F&quot;</span>)]</span><br><span class="line">                .implementation = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;original call: fun(&quot;</span> + x + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">                    <span class="keyword">var</span> result = <span class="built_in">this</span>[<span class="built_in">decodeURIComponent</span>(<span class="string">&quot;%D6%8F&quot;</span>)](<span class="number">900</span>);</span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><h1 id="简易-wallbreaker-内存打印"><a href="#简易-wallbreaker-内存打印" class="headerlink" title="简易 wallbreaker 内存打印"></a>简易 wallbreaker 内存打印</h1><p>内存漫游, 打印实例的字段和方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> Class = Java.use(<span class="string">&quot;java.lang.Class&quot;</span>);</span><br><span class="line">        </span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">inspectObject</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> obj_class = Java.cast(obj.getClass(), Class);</span><br><span class="line">            <span class="keyword">var</span> fields = obj_class.getDeclaredFields();</span><br><span class="line">            <span class="keyword">var</span> methods = obj_class.getMethods();</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;Inspectiong &quot;</span> + obj.getClass().toString());</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;\t Fields:&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> fields)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;\t\t&quot;</span> + fields[i].toString());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;\t Methods:&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> methods)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;\t\t&quot;</span> + methods[i].toString())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Java.choose(<span class="string">&quot;com.baidu.lbs.waimai.WaimaiActivity&quot;</span>,&#123;</span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;complete!&quot;</span>);</span><br><span class="line">                </span><br><span class="line">            &#125;,</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;find instance&quot;</span>, instance);</span><br><span class="line">                inspectObject(instance);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><h1 id="hook-frida-实现-runnable"><a href="#hook-frida-实现-runnable" class="headerlink" title="hook frida 实现 runnable"></a>hook frida 实现 runnable</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">// https://developer.android.com/reference/android/view/WindowManager.LayoutParams.html#FLAG_SECURE</span></span><br><span class="line">   <span class="keyword">var</span> FLAG_SECURE = <span class="number">0x2000</span>;</span><br><span class="line">   <span class="keyword">var</span> Runnable = Java.use(<span class="string">&quot;java.lang.Runnable&quot;</span>);</span><br><span class="line">   <span class="keyword">var</span> DisableSecureRunnable = Java.registerClass(&#123;</span><br><span class="line">      name: <span class="string">&quot;me.bhamza.DisableSecureRunnable&quot;</span>,</span><br><span class="line">      implements: [Runnable],</span><br><span class="line">      fields: &#123;</span><br><span class="line">          activity: <span class="string">&quot;android.app.Activity&quot;</span>,</span><br><span class="line">       &#125;,</span><br><span class="line">       methods: &#123;</span><br><span class="line">          $init: [&#123;</span><br><span class="line">             returnType: <span class="string">&quot;void&quot;</span>,</span><br><span class="line">             argumentTypes: [<span class="string">&quot;android.app.Activity&quot;</span>],</span><br><span class="line">             implementation: <span class="function"><span class="keyword">function</span> (<span class="params">activity</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">this</span>.activity.value = activity;</span><br><span class="line">             &#125;</span><br><span class="line">          &#125;],</span><br><span class="line">          run: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">             <span class="keyword">var</span> flags = <span class="built_in">this</span>.activity.value.getWindow().getAttributes().flags.value; <span class="comment">// get current value</span></span><br><span class="line">             flags &amp;= ~FLAG_SECURE; <span class="comment">// toggle it</span></span><br><span class="line">             <span class="built_in">this</span>.activity.value.getWindow().setFlags(flags, FLAG_SECURE); <span class="comment">// disable it!</span></span><br><span class="line">             <span class="built_in">console</span>.log(<span class="string">&quot;Done disabling SECURE flag...&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Java.choose(<span class="string">&quot;com.example.app.FlagSecureTestActivity&quot;</span>, &#123;</span><br><span class="line">       <span class="string">&quot;onMatch&quot;</span>: <span class="function"><span class="keyword">function</span> (<span class="params">instance</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> runnable = DisableSecureRunnable.$new(instance);</span><br><span class="line">          instance.runOnUiThread(runnable);</span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">&quot;onComplete&quot;</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><h1 id="Hook-监控控件-onClick"><a href="#Hook-监控控件-onClick" class="headerlink" title="Hook 监控控件 onClick"></a>Hook 监控控件 onClick</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jclazz = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> jobj = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getObjClassName</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!jclazz) &#123;</span><br><span class="line">        <span class="keyword">var</span> jclazz = Java.use(<span class="string">&quot;java.lang.Class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!jobj) &#123;</span><br><span class="line">        <span class="keyword">var</span> jobj = Java.use(<span class="string">&quot;java.lang.Object&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jclazz.getName.call(jobj.getClass.call(obj));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">watch</span>(<span class="params">obj, mtdName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> listener_name = getObjClassName(obj);</span><br><span class="line">    <span class="keyword">var</span> target = Java.use(listener_name);</span><br><span class="line">    <span class="keyword">if</span> (!target || !mtdName <span class="keyword">in</span> target) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// send(&quot;[WatchEvent] hooking &quot; + mtdName + &quot;: &quot; + listener_name);</span></span><br><span class="line">    target[mtdName].overloads.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">overload</span>) </span>&#123;</span><br><span class="line">        overload.implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">//send(&quot;[WatchEvent] &quot; + mtdName + &quot;: &quot; + getObjClassName(this));</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;[WatchEvent] &quot;</span> + mtdName + <span class="string">&quot;: &quot;</span> + getObjClassName(<span class="built_in">this</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>[mtdName].apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">OnClickListener</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//以spawn启动进程的模式来attach的话</span></span><br><span class="line">        Java.use(<span class="string">&quot;android.view.View&quot;</span>).setOnClickListener.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">listener</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (listener != <span class="literal">null</span>) &#123;</span><br><span class="line">                watch(listener, <span class="string">&#x27;onClick&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.setOnClickListener(listener);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果frida以attach的模式进行attch的话</span></span><br><span class="line">        Java.choose(<span class="string">&quot;android.view.View$ListenerInfo&quot;</span>, &#123;</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span> (<span class="params">instance</span>) </span>&#123;</span><br><span class="line">                instance = instance.mOnClickListener.value;</span><br><span class="line">                <span class="keyword">if</span> (instance) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;mOnClickListener name is :&quot;</span> + getObjClassName(instance));</span><br><span class="line">                    watch(instance, <span class="string">&#x27;onClick&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(OnClickListener);</span><br></pre></td></tr></table></figure><h1 id="Hook-startActivity"><a href="#Hook-startActivity" class="headerlink" title="Hook startActivity"></a>Hook startActivity</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Activity = Java.use(<span class="string">&quot;android.app.Activity&quot;</span>);</span><br><span class="line">    <span class="comment">//console.log(Object.getOwnPropertyNames(Activity));</span></span><br><span class="line">    Activity.startActivity.overload(<span class="string">&#x27;android.content.Intent&#x27;</span>).implementation=<span class="function"><span class="keyword">function</span>(<span class="params">p1</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Hooking android.app.Activity.startActivity(p1) successfully,p1=&quot;</span>+p1);</span><br><span class="line">        <span class="built_in">console</span>.log(Java.use(<span class="string">&quot;android.util.Log&quot;</span>).getStackTraceString(Java.use(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new()));</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">decodeURIComponent</span>(p1.toUri(<span class="number">256</span>)));</span><br><span class="line">        <span class="built_in">this</span>.startActivity(p1);</span><br><span class="line">    &#125;</span><br><span class="line">    Activity.startActivity.overload(<span class="string">&#x27;android.content.Intent&#x27;</span>, <span class="string">&#x27;android.os.Bundle&#x27;</span>).implementation=<span class="function"><span class="keyword">function</span>(<span class="params">p1,p2</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Hooking android.app.Activity.startActivity(p1,p2) successfully,p1=&quot;</span>+p1+<span class="string">&quot;,p2=&quot;</span>+p2);</span><br><span class="line">        <span class="built_in">console</span>.log(Java.use(<span class="string">&quot;android.util.Log&quot;</span>).getStackTraceString(Java.use(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new()));</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">decodeURIComponent</span>(p1.toUri(<span class="number">256</span>)));</span><br><span class="line">        <span class="built_in">this</span>.startActivity(p1,p2);</span><br><span class="line">    &#125;</span><br><span class="line">    Activity.startService.overload(<span class="string">&#x27;android.content.Intent&#x27;</span>).implementation=<span class="function"><span class="keyword">function</span>(<span class="params">p1</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Hooking android.app.Activity.startService(p1) successfully,p1=&quot;</span>+p1);</span><br><span class="line">        <span class="built_in">console</span>.log(Java.use(<span class="string">&quot;android.util.Log&quot;</span>).getStackTraceString(Java.use(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new()));</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">decodeURIComponent</span>(p1.toUri(<span class="number">256</span>)));</span><br><span class="line">        <span class="built_in">this</span>.startService(p1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Hook-frida-绕过-root-检测"><a href="#Hook-frida-绕过-root-检测" class="headerlink" title="Hook frida 绕过 root 检测"></a>Hook frida 绕过 root 检测</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $ frida -l antiroot.js -U -f com.example.app --no-pause</span></span><br><span class="line"><span class="comment">// CHANGELOG by Pichaya Morimoto (p.morimoto@sth.sh): </span></span><br><span class="line"><span class="comment">//  - I added extra whitelisted items to deal with the latest versions </span></span><br><span class="line"><span class="comment">// of RootBeer/Cordova iRoot as of August 6, 2019</span></span><br><span class="line"><span class="comment">//  - The original one just fucked up (kill itself) if Magisk is installed lol</span></span><br><span class="line"><span class="comment">// Credit &amp; Originally written by: https://codeshare.frida.re/@dzonerzy/fridantiroot/</span></span><br><span class="line"><span class="comment">// If this isn&#x27;t working in the future, check console logs, rootbeer src, or libtool-checker.so</span></span><br><span class="line"></span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> RootPackages = [<span class="string">&quot;com.noshufou.android.su&quot;</span>, <span class="string">&quot;com.noshufou.android.su.elite&quot;</span>, <span class="string">&quot;eu.chainfire.supersu&quot;</span>,</span><br><span class="line">        <span class="string">&quot;com.koushikdutta.superuser&quot;</span>, <span class="string">&quot;com.thirdparty.superuser&quot;</span>, <span class="string">&quot;com.yellowes.su&quot;</span>, <span class="string">&quot;com.koushikdutta.rommanager&quot;</span>,</span><br><span class="line">        <span class="string">&quot;com.koushikdutta.rommanager.license&quot;</span>, <span class="string">&quot;com.dimonvideo.luckypatcher&quot;</span>, <span class="string">&quot;com.chelpus.lackypatch&quot;</span>,</span><br><span class="line">        <span class="string">&quot;com.ramdroid.appquarantine&quot;</span>, <span class="string">&quot;com.ramdroid.appquarantinepro&quot;</span>, <span class="string">&quot;com.devadvance.rootcloak&quot;</span>, <span class="string">&quot;com.devadvance.rootcloakplus&quot;</span>,</span><br><span class="line">        <span class="string">&quot;de.robv.android.xposed.installer&quot;</span>, <span class="string">&quot;com.saurik.substrate&quot;</span>, <span class="string">&quot;com.zachspong.temprootremovejb&quot;</span>, <span class="string">&quot;com.amphoras.hidemyroot&quot;</span>,</span><br><span class="line">        <span class="string">&quot;com.amphoras.hidemyrootadfree&quot;</span>, <span class="string">&quot;com.formyhm.hiderootPremium&quot;</span>, <span class="string">&quot;com.formyhm.hideroot&quot;</span>, <span class="string">&quot;me.phh.superuser&quot;</span>,</span><br><span class="line">        <span class="string">&quot;eu.chainfire.supersu.pro&quot;</span>, <span class="string">&quot;com.kingouser.com&quot;</span>, <span class="string">&quot;com.android.vending.billing.InAppBillingService.COIN&quot;</span>,<span class="string">&quot;com.topjohnwu.magisk&quot;</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> RootBinaries = [<span class="string">&quot;su&quot;</span>, <span class="string">&quot;busybox&quot;</span>, <span class="string">&quot;supersu&quot;</span>, <span class="string">&quot;Superuser.apk&quot;</span>, <span class="string">&quot;KingoUser.apk&quot;</span>, <span class="string">&quot;SuperSu.apk&quot;</span>,<span class="string">&quot;magisk&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> RootProperties = &#123;</span><br><span class="line">        <span class="string">&quot;ro.build.selinux&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ro.debuggable&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;service.adb.root&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ro.secure&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> RootPropertiesKeys = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> RootProperties) RootPropertiesKeys.push(k);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> PackageManager = Java.use(<span class="string">&quot;android.app.ApplicationPackageManager&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> Runtime = Java.use(<span class="string">&#x27;java.lang.Runtime&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> NativeFile = Java.use(<span class="string">&#x27;java.io.File&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">String</span> = Java.use(<span class="string">&#x27;java.lang.String&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> SystemProperties = Java.use(<span class="string">&#x27;android.os.SystemProperties&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> BufferedReader = Java.use(<span class="string">&#x27;java.io.BufferedReader&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ProcessBuilder = Java.use(<span class="string">&#x27;java.lang.ProcessBuilder&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> StringBuffer = Java.use(<span class="string">&#x27;java.lang.StringBuffer&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> loaded_classes = Java.enumerateLoadedClassesSync();</span><br><span class="line"></span><br><span class="line">    send(<span class="string">&quot;Loaded &quot;</span> + loaded_classes.length + <span class="string">&quot; classes!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> useKeyInfo = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> useProcessManager = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    send(<span class="string">&quot;loaded: &quot;</span> + loaded_classes.indexOf(<span class="string">&#x27;java.lang.ProcessManager&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (loaded_classes.indexOf(<span class="string">&#x27;java.lang.ProcessManager&#x27;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//useProcessManager = true;</span></span><br><span class="line">            <span class="comment">//var ProcessManager = Java.use(&#x27;java.lang.ProcessManager&#x27;);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            send(<span class="string">&quot;ProcessManager Hook failed: &quot;</span> + err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        send(<span class="string">&quot;ProcessManager hook not loaded&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> KeyInfo = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (loaded_classes.indexOf(<span class="string">&#x27;android.security.keystore.KeyInfo&#x27;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//useKeyInfo = true;</span></span><br><span class="line">            <span class="comment">//var KeyInfo = Java.use(&#x27;android.security.keystore.KeyInfo&#x27;);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            send(<span class="string">&quot;KeyInfo Hook failed: &quot;</span> + err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        send(<span class="string">&quot;KeyInfo hook not loaded&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PackageManager.getPackageInfo.overload(<span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">pname, flags</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> shouldFakePackage = (RootPackages.indexOf(pname) &gt; -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (shouldFakePackage) &#123;</span><br><span class="line">            send(<span class="string">&quot;Bypass root check for package: &quot;</span> + pname);</span><br><span class="line">            pname = <span class="string">&quot;set.package.name.to.a.fake.one.so.we.can.bypass.it&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getPackageInfo.call(<span class="built_in">this</span>, pname, flags);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    NativeFile.exists.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> name = NativeFile.getName.call(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">var</span> shouldFakeReturn = (RootBinaries.indexOf(name) &gt; -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (shouldFakeReturn) &#123;</span><br><span class="line">            send(<span class="string">&quot;Bypass return value for binary: &quot;</span> + name);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.exists.call(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> exec = Runtime.exec.overload(<span class="string">&#x27;[Ljava.lang.String;&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> exec1 = Runtime.exec.overload(<span class="string">&#x27;java.lang.String&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> exec2 = Runtime.exec.overload(<span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;[Ljava.lang.String;&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> exec3 = Runtime.exec.overload(<span class="string">&#x27;[Ljava.lang.String;&#x27;</span>, <span class="string">&#x27;[Ljava.lang.String;&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> exec4 = Runtime.exec.overload(<span class="string">&#x27;[Ljava.lang.String;&#x27;</span>, <span class="string">&#x27;[Ljava.lang.String;&#x27;</span>, <span class="string">&#x27;java.io.File&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> exec5 = Runtime.exec.overload(<span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;[Ljava.lang.String;&#x27;</span>, <span class="string">&#x27;java.io.File&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    exec5.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">cmd, env, dir</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (cmd.indexOf(<span class="string">&quot;getprop&quot;</span>) != -<span class="number">1</span> || cmd == <span class="string">&quot;mount&quot;</span> || cmd.indexOf(<span class="string">&quot;build.prop&quot;</span>) != -<span class="number">1</span> || cmd == <span class="string">&quot;id&quot;</span> || cmd == <span class="string">&quot;sh&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> fakeCmd = <span class="string">&quot;grep&quot;</span>;</span><br><span class="line">            send(<span class="string">&quot;Bypass &quot;</span> + cmd + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cmd == <span class="string">&quot;su&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> fakeCmd = <span class="string">&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;</span>;</span><br><span class="line">            send(<span class="string">&quot;Bypass &quot;</span> + cmd + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cmd == <span class="string">&quot;which&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> fakeCmd = <span class="string">&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;</span>;</span><br><span class="line">            send(<span class="string">&quot;Bypass which command&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> exec5.call(<span class="built_in">this</span>, cmd, env, dir);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    exec4.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">cmdarr, env, file</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cmdarr.length; i = i + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> tmp_cmd = cmdarr[i];</span><br><span class="line">            <span class="keyword">if</span> (tmp_cmd.indexOf(<span class="string">&quot;getprop&quot;</span>) != -<span class="number">1</span> || tmp_cmd == <span class="string">&quot;mount&quot;</span> || tmp_cmd.indexOf(<span class="string">&quot;build.prop&quot;</span>) != -<span class="number">1</span> || tmp_cmd == <span class="string">&quot;id&quot;</span> || tmp_cmd == <span class="string">&quot;sh&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> fakeCmd = <span class="string">&quot;grep&quot;</span>;</span><br><span class="line">                send(<span class="string">&quot;Bypass &quot;</span> + cmdarr + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (tmp_cmd == <span class="string">&quot;su&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> fakeCmd = <span class="string">&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;</span>;</span><br><span class="line">                send(<span class="string">&quot;Bypass &quot;</span> + cmdarr + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> exec4.call(<span class="built_in">this</span>, cmdarr, env, file);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    exec3.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">cmdarr, envp</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cmdarr.length; i = i + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> tmp_cmd = cmdarr[i];</span><br><span class="line">            <span class="keyword">if</span> (tmp_cmd.indexOf(<span class="string">&quot;getprop&quot;</span>) != -<span class="number">1</span> || tmp_cmd == <span class="string">&quot;mount&quot;</span> || tmp_cmd.indexOf(<span class="string">&quot;build.prop&quot;</span>) != -<span class="number">1</span> || tmp_cmd == <span class="string">&quot;id&quot;</span> || tmp_cmd == <span class="string">&quot;sh&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> fakeCmd = <span class="string">&quot;grep&quot;</span>;</span><br><span class="line">                send(<span class="string">&quot;Bypass &quot;</span> + cmdarr + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (tmp_cmd == <span class="string">&quot;su&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> fakeCmd = <span class="string">&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;</span>;</span><br><span class="line">                send(<span class="string">&quot;Bypass &quot;</span> + cmdarr + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> exec3.call(<span class="built_in">this</span>, cmdarr, envp);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    exec2.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">cmd, env</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (cmd.indexOf(<span class="string">&quot;getprop&quot;</span>) != -<span class="number">1</span> || cmd == <span class="string">&quot;mount&quot;</span> || cmd.indexOf(<span class="string">&quot;build.prop&quot;</span>) != -<span class="number">1</span> || cmd == <span class="string">&quot;id&quot;</span> || cmd == <span class="string">&quot;sh&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> fakeCmd = <span class="string">&quot;grep&quot;</span>;</span><br><span class="line">            send(<span class="string">&quot;Bypass &quot;</span> + cmd + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cmd == <span class="string">&quot;su&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> fakeCmd = <span class="string">&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;</span>;</span><br><span class="line">            send(<span class="string">&quot;Bypass &quot;</span> + cmd + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> exec2.call(<span class="built_in">this</span>, cmd, env);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    exec.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">cmd</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cmd.length; i = i + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> tmp_cmd = cmd[i];</span><br><span class="line">            <span class="keyword">if</span> (tmp_cmd.indexOf(<span class="string">&quot;getprop&quot;</span>) != -<span class="number">1</span> || tmp_cmd == <span class="string">&quot;mount&quot;</span> || tmp_cmd.indexOf(<span class="string">&quot;build.prop&quot;</span>) != -<span class="number">1</span> || tmp_cmd == <span class="string">&quot;id&quot;</span> || tmp_cmd == <span class="string">&quot;sh&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> fakeCmd = <span class="string">&quot;grep&quot;</span>;</span><br><span class="line">                send(<span class="string">&quot;Bypass &quot;</span> + cmd + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (tmp_cmd == <span class="string">&quot;su&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> fakeCmd = <span class="string">&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;</span>;</span><br><span class="line">                send(<span class="string">&quot;Bypass &quot;</span> + cmd + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> exec.call(<span class="built_in">this</span>, cmd);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    exec1.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">cmd</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (cmd.indexOf(<span class="string">&quot;getprop&quot;</span>) != -<span class="number">1</span> || cmd == <span class="string">&quot;mount&quot;</span> || cmd.indexOf(<span class="string">&quot;build.prop&quot;</span>) != -<span class="number">1</span> || cmd == <span class="string">&quot;id&quot;</span> || cmd == <span class="string">&quot;sh&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> fakeCmd = <span class="string">&quot;grep&quot;</span>;</span><br><span class="line">            send(<span class="string">&quot;Bypass &quot;</span> + cmd + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cmd == <span class="string">&quot;su&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> fakeCmd = <span class="string">&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;</span>;</span><br><span class="line">            send(<span class="string">&quot;Bypass &quot;</span> + cmd + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> exec1.call(<span class="built_in">this</span>, cmd);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">String</span>.contains.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (name == <span class="string">&quot;test-keys&quot;</span>) &#123;</span><br><span class="line">            send(<span class="string">&quot;Bypass test-keys check&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.contains.call(<span class="built_in">this</span>, name);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> get = SystemProperties.get.overload(<span class="string">&#x27;java.lang.String&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    get.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (RootPropertiesKeys.indexOf(name) != -<span class="number">1</span>) &#123;</span><br><span class="line">            send(<span class="string">&quot;Bypass &quot;</span> + name);</span><br><span class="line">            <span class="keyword">return</span> RootProperties[name];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.get.call(<span class="built_in">this</span>, name);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(Module.findExportByName(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;fopen&quot;</span>), &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> path1 = Memory.readCString(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">var</span> path = path1.split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> executable = path[path.length - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">var</span> shouldFakeReturn = (RootBinaries.indexOf(executable) &gt; -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> (shouldFakeReturn) &#123;</span><br><span class="line">                Memory.writeUtf8String(args[<span class="number">0</span>], <span class="string">&quot;/ggezxxx&quot;</span>);</span><br><span class="line">                send(<span class="string">&quot;Bypass native fopen &gt;&gt; &quot;</span>+path1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(Module.findExportByName(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;fopen&quot;</span>), &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> path1 = Memory.readCString(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">var</span> path = path1.split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> executable = path[path.length - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">var</span> shouldFakeReturn = (RootBinaries.indexOf(executable) &gt; -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> (shouldFakeReturn) &#123;</span><br><span class="line">                Memory.writeUtf8String(args[<span class="number">0</span>], <span class="string">&quot;/ggezxxx&quot;</span>);</span><br><span class="line">                send(<span class="string">&quot;Bypass native fopen &gt;&gt; &quot;</span>+path1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(Module.findExportByName(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;system&quot;</span>), &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> cmd = Memory.readCString(args[<span class="number">0</span>]);</span><br><span class="line">            send(<span class="string">&quot;SYSTEM CMD: &quot;</span> + cmd);</span><br><span class="line">            <span class="keyword">if</span> (cmd.indexOf(<span class="string">&quot;getprop&quot;</span>) != -<span class="number">1</span> || cmd == <span class="string">&quot;mount&quot;</span> || cmd.indexOf(<span class="string">&quot;build.prop&quot;</span>) != -<span class="number">1</span> || cmd == <span class="string">&quot;id&quot;</span>) &#123;</span><br><span class="line">                send(<span class="string">&quot;Bypass native system: &quot;</span> + cmd);</span><br><span class="line">                Memory.writeUtf8String(args[<span class="number">0</span>], <span class="string">&quot;grep&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (cmd == <span class="string">&quot;su&quot;</span>) &#123;</span><br><span class="line">                send(<span class="string">&quot;Bypass native system: &quot;</span> + cmd);</span><br><span class="line">                Memory.writeUtf8String(args[<span class="number">0</span>], <span class="string">&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    TO IMPLEMENT:</span></span><br><span class="line"><span class="comment">    Exec Family</span></span><br><span class="line"><span class="comment">    int execl(const char *path, const char *arg0, ..., const char *argn, (char *)0);</span></span><br><span class="line"><span class="comment">    int execle(const char *path, const char *arg0, ..., const char *argn, (char *)0, char *const envp[]);</span></span><br><span class="line"><span class="comment">    int execlp(const char *file, const char *arg0, ..., const char *argn, (char *)0);</span></span><br><span class="line"><span class="comment">    int execlpe(const char *file, const char *arg0, ..., const char *argn, (char *)0, char *const envp[]);</span></span><br><span class="line"><span class="comment">    int execv(const char *path, char *const argv[]);</span></span><br><span class="line"><span class="comment">    int execve(const char *path, char *const argv[], char *const envp[]);</span></span><br><span class="line"><span class="comment">    int execvp(const char *file, char *const argv[]);</span></span><br><span class="line"><span class="comment">    int execvpe(const char *file, char *const argv[], char *const envp[]);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    BufferedReader.readLine.overload().implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> text = <span class="built_in">this</span>.readLine.call(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (text === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// just pass , i know it&#x27;s ugly as hell but test != null won&#x27;t work :(</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> shouldFakeRead = (text.indexOf(<span class="string">&quot;ro.build.tags=test-keys&quot;</span>) &gt; -<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (shouldFakeRead) &#123;</span><br><span class="line">                send(<span class="string">&quot;Bypass build.prop file read&quot;</span>);</span><br><span class="line">                text = text.replace(<span class="string">&quot;ro.build.tags=test-keys&quot;</span>, <span class="string">&quot;ro.build.tags=release-keys&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> executeCommand = ProcessBuilder.command.overload(<span class="string">&#x27;java.util.List&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    ProcessBuilder.start.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> cmd = <span class="built_in">this</span>.command.call(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">var</span> shouldModifyCommand = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cmd.size(); i = i + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> tmp_cmd = cmd.get(i).toString();</span><br><span class="line">            <span class="keyword">if</span> (tmp_cmd.indexOf(<span class="string">&quot;getprop&quot;</span>) != -<span class="number">1</span> || tmp_cmd.indexOf(<span class="string">&quot;mount&quot;</span>) != -<span class="number">1</span> || tmp_cmd.indexOf(<span class="string">&quot;build.prop&quot;</span>) != -<span class="number">1</span> || tmp_cmd.indexOf(<span class="string">&quot;id&quot;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">                shouldModifyCommand = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (shouldModifyCommand) &#123;</span><br><span class="line">            send(<span class="string">&quot;Bypass ProcessBuilder &quot;</span> + cmd);</span><br><span class="line">            <span class="built_in">this</span>.command.call(<span class="built_in">this</span>, [<span class="string">&quot;grep&quot;</span>]);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.start.call(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cmd.indexOf(<span class="string">&quot;su&quot;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">            send(<span class="string">&quot;Bypass ProcessBuilder &quot;</span> + cmd);</span><br><span class="line">            <span class="built_in">this</span>.command.call(<span class="built_in">this</span>, [<span class="string">&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;</span>]);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.start.call(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.start.call(<span class="built_in">this</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (useProcessManager) &#123;</span><br><span class="line">        <span class="keyword">var</span> ProcManExec = ProcessManager.exec.overload(<span class="string">&#x27;[Ljava.lang.String;&#x27;</span>, <span class="string">&#x27;[Ljava.lang.String;&#x27;</span>, <span class="string">&#x27;java.io.File&#x27;</span>, <span class="string">&#x27;boolean&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> ProcManExecVariant = ProcessManager.exec.overload(<span class="string">&#x27;[Ljava.lang.String;&#x27;</span>, <span class="string">&#x27;[Ljava.lang.String;&#x27;</span>, <span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;java.io.FileDescriptor&#x27;</span>, <span class="string">&#x27;java.io.FileDescriptor&#x27;</span>, <span class="string">&#x27;java.io.FileDescriptor&#x27;</span>, <span class="string">&#x27;boolean&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        ProcManExec.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">cmd, env, workdir, redirectstderr</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> fake_cmd = cmd;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cmd.length; i = i + <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> tmp_cmd = cmd[i];</span><br><span class="line">                <span class="keyword">if</span> (tmp_cmd.indexOf(<span class="string">&quot;getprop&quot;</span>) != -<span class="number">1</span> || tmp_cmd == <span class="string">&quot;mount&quot;</span> || tmp_cmd.indexOf(<span class="string">&quot;build.prop&quot;</span>) != -<span class="number">1</span> || tmp_cmd == <span class="string">&quot;id&quot;</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> fake_cmd = [<span class="string">&quot;grep&quot;</span>];</span><br><span class="line">                    send(<span class="string">&quot;Bypass &quot;</span> + cmdarr + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (tmp_cmd == <span class="string">&quot;su&quot;</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> fake_cmd = [<span class="string">&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;</span>];</span><br><span class="line">                    send(<span class="string">&quot;Bypass &quot;</span> + cmdarr + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ProcManExec.call(<span class="built_in">this</span>, fake_cmd, env, workdir, redirectstderr);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ProcManExecVariant.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">cmd, env, directory, stdin, stdout, stderr, redirect</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> fake_cmd = cmd;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cmd.length; i = i + <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> tmp_cmd = cmd[i];</span><br><span class="line">                <span class="keyword">if</span> (tmp_cmd.indexOf(<span class="string">&quot;getprop&quot;</span>) != -<span class="number">1</span> || tmp_cmd == <span class="string">&quot;mount&quot;</span> || tmp_cmd.indexOf(<span class="string">&quot;build.prop&quot;</span>) != -<span class="number">1</span> || tmp_cmd == <span class="string">&quot;id&quot;</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> fake_cmd = [<span class="string">&quot;grep&quot;</span>];</span><br><span class="line">                    send(<span class="string">&quot;Bypass &quot;</span> + cmdarr + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (tmp_cmd == <span class="string">&quot;su&quot;</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> fake_cmd = [<span class="string">&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;</span>];</span><br><span class="line">                    send(<span class="string">&quot;Bypass &quot;</span> + cmdarr + <span class="string">&quot; command&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ProcManExecVariant.call(<span class="built_in">this</span>, fake_cmd, env, directory, stdin, stdout, stderr, redirect);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (useKeyInfo) &#123;</span><br><span class="line">        KeyInfo.isInsideSecureHardware.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            send(<span class="string">&quot;Bypass isInsideSecureHardware&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="Hook-frida-强制在主线程运行"><a href="#Hook-frida-强制在主线程运行" class="headerlink" title="Hook frida 强制在主线程运行"></a>Hook frida 强制在主线程运行</h1><p>针对使用一些方法的时候出现报错 <code>on a thread that has not called Looper.prepare()</code></p><p>强制让代码运行在主线程中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> Toast = Java.use(<span class="string">&#x27;android.widget.Toast&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> currentApplication = Java.use(<span class="string">&#x27;android.app.ActivityThread&#x27;</span>).currentApplication(); </span><br><span class="line">  <span class="keyword">var</span> context = currentApplication.getApplicationContext();</span><br><span class="line"></span><br><span class="line">  Java.scheduleOnMainThread(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Toast.makeText(context, <span class="string">&quot;Hello World&quot;</span>, Toast.LENGTH_LONG.value).show();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Hook-frida-指定方法中过滤打印"><a href="#Hook-frida-指定方法中过滤打印" class="headerlink" title="Hook frida 指定方法中过滤打印"></a>Hook frida 指定方法中过滤打印</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_lnf</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> activate = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> hashmapClass = Java.use(<span class="string">&quot;java.util.HashMap&quot;</span>);</span><br><span class="line">        hashmapClass.put.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">key,value</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (activate)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;key:&quot;</span>, key, <span class="string">&quot;value:&quot;</span>, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.put(key,value);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> lnfClazz = Java.use(<span class="string">&quot;tb.lnf&quot;</span>);</span><br><span class="line">        lnfClazz.a.overload(<span class="string">&#x27;java.util.HashMap&#x27;</span>, <span class="string">&#x27;java.util.HashMap&#x27;</span>, <span class="string">&#x27;java.lang.String&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;boolean&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">hashmap, hashmap2, str, str2, z</span>) </span>&#123;</span><br><span class="line">                printHashMap(<span class="string">&quot;hashmap&quot;</span>, hashmap);</span><br><span class="line">                printHashMap(<span class="string">&quot;hashmap2&quot;</span>, hashmap2);</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;str&quot;</span>, str);</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;str2&quot;</span>, str2);</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;boolean&quot;</span>, z);</span><br><span class="line">                activate = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">var</span> result = <span class="built_in">this</span>.a(hashmap, hashmap2, str, str2, z);</span><br><span class="line">                activate = <span class="literal">false</span></span><br><span class="line">                printHashMap(<span class="string">&quot;result&quot;</span>, result);</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-禁止-app-退出"><a href="#Hook-禁止-app-退出" class="headerlink" title="Hook 禁止 app 退出"></a>Hook 禁止 app 退出</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hookExit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[*] Starting hook exit&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> exitClass = Java.use(<span class="string">&quot;java.lang.System&quot;</span>);</span><br><span class="line">        exitClass.exit.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;[*] System.exit.called&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[*] hooking calls to System.exit&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(hookExit);</span><br></pre></td></tr></table></figure><h1 id="Hook-修改设备参数"><a href="#Hook-修改设备参数" class="headerlink" title="Hook 修改设备参数"></a>Hook 修改设备参数</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// frida hook 修改设备参数</span></span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> TelephonyManager = Java.use(<span class="string">&quot;android.telephony.TelephonyManager&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//IMEI hook</span></span><br><span class="line">    TelephonyManager.getDeviceId.overload().implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">               <span class="built_in">console</span>.log(<span class="string">&quot;[*]Called - getDeviceId()&quot;</span>);</span><br><span class="line">               <span class="keyword">var</span> temp = <span class="built_in">this</span>.getDeviceId();</span><br><span class="line">               <span class="built_in">console</span>.log(<span class="string">&quot;real IMEI: &quot;</span>+temp);</span><br><span class="line">               <span class="keyword">return</span> <span class="string">&quot;867979021642856&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// muti IMEI</span></span><br><span class="line">    TelephonyManager.getDeviceId.overload(<span class="string">&#x27;int&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">p</span>) </span>&#123;</span><br><span class="line">               <span class="built_in">console</span>.log(<span class="string">&quot;[*]Called - getDeviceId(int) param is&quot;</span>+p);</span><br><span class="line">               <span class="keyword">var</span> temp = <span class="built_in">this</span>.getDeviceId(p);</span><br><span class="line">               <span class="built_in">console</span>.log(<span class="string">&quot;real IMEI &quot;</span>+p+<span class="string">&quot;: &quot;</span>+temp);</span><br><span class="line">               <span class="keyword">return</span> <span class="string">&quot;867979021642856&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//IMSI hook</span></span><br><span class="line">TelephonyManager.getSimSerialNumber.overload().implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">               <span class="built_in">console</span>.log(<span class="string">&quot;[*]Called - getSimSerialNumber(String)&quot;</span>);</span><br><span class="line">               <span class="keyword">var</span> temp = <span class="built_in">this</span>.getSimSerialNumber();</span><br><span class="line">               <span class="built_in">console</span>.log(<span class="string">&quot;real IMSI: &quot;</span>+temp);</span><br><span class="line">               <span class="keyword">return</span> <span class="string">&quot;123456789&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ANDOID_ID hook</span></span><br><span class="line">    <span class="keyword">var</span> Secure = Java.use(<span class="string">&quot;android.provider.Settings$Secure&quot;</span>);</span><br><span class="line">    Secure.getString.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">p1,p2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(p2.indexOf(<span class="string">&quot;android_id&quot;</span>)&lt;<span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">this</span>.getString(p1,p2);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;[*]Called - get android_ID, param is:&quot;</span>+p2);</span><br><span class="line">    <span class="keyword">var</span> temp = <span class="built_in">this</span>.getString(p1,p2);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;real Android_ID: &quot;</span>+temp);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;844de23bfcf93801&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//android的hidden API，需要通过反射调用</span></span><br><span class="line">    <span class="keyword">var</span> SP = Java.use(<span class="string">&quot;android.os.SystemProperties&quot;</span>);</span><br><span class="line">    SP.get.overload(<span class="string">&#x27;java.lang.String&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">p1</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> tmp = <span class="built_in">this</span>.get(p1);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;[*]&quot;</span>+p1+<span class="string">&quot; : &quot;</span>+tmp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    SP.get.overload(<span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;java.lang.String&#x27;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">p1,p2</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> tmp = <span class="built_in">this</span>.get(p1,p2)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;[*]&quot;</span>+p1+<span class="string">&quot;,&quot;</span>+p2+<span class="string">&quot; : &quot;</span>+tmp);</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// hook MAC</span></span><br><span class="line">    <span class="keyword">var</span> wifi = Java.use(<span class="string">&quot;android.net.wifi.WifiInfo&quot;</span>);</span><br><span class="line">    wifi.getMacAddress.implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> tmp = <span class="built_in">this</span>.getMacAddress();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;[*]real MAC: &quot;</span>+tmp);</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Hook-打印请求调用栈"><a href="#Hook-打印请求调用栈" class="headerlink" title="Hook 打印请求调用栈"></a>Hook 打印请求调用栈</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> class_Socket = Java.use(<span class="string">&quot;java.net.Socket&quot;</span>);</span><br><span class="line">class_Socket.getOutputStream.overload().implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    send(<span class="string">&quot;getOutputSteam&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> result = <span class="built_in">this</span>.getOutputStream();</span><br><span class="line">    <span class="keyword">var</span> bt = Java.use(<span class="string">&quot;android.util.Log&quot;</span>).getStackTraceString(</span><br><span class="line">        Java.use(<span class="string">&quot;java.lang.Exception&quot;</span>).$new();</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Backtrace:&quot;</span> + bt);</span><br><span class="line">    send(result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-UI-thread-注入"><a href="#Hook-UI-thread-注入" class="headerlink" title="Hook UI thread 注入"></a>Hook UI thread 注入</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> Toast = Java.use(<span class="string">&#x27;android.widget.Toast&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> currentApplication = Java.use(<span class="string">&#x27;android.app.ActivityThread&#x27;</span>).currentApplication(); </span><br><span class="line">  <span class="keyword">var</span> context = currentApplication.getApplicationContext();</span><br><span class="line"></span><br><span class="line">  Java.scheduleOnMainThread(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Toast.makeText(context, <span class="string">&quot;Hello World&quot;</span>, Toast.LENGTH_LONG.value).show();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="常用打印转换"><a href="#常用打印转换" class="headerlink" title="常用打印转换"></a>常用打印转换</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//工具相关函数</span></span><br><span class="line"><span class="keyword">var</span> base64EncodeChars = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span>,</span><br><span class="line">    base64DecodeChars = <span class="keyword">new</span> <span class="built_in">Array</span>((-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), <span class="number">62</span>, (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), <span class="number">63</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>), (-<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stringToBase64</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r, a, c, h, o, t;</span><br><span class="line">    <span class="keyword">for</span> (c = e.length, a = <span class="number">0</span>, r = <span class="string">&#x27;&#x27;</span>; a &lt; c;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (h = <span class="number">255</span> &amp; e.charCodeAt(a++), a == c) &#123;</span><br><span class="line">            r += base64EncodeChars.charAt(h &gt;&gt; <span class="number">2</span>),</span><br><span class="line">                r += base64EncodeChars.charAt((<span class="number">3</span> &amp; h) &lt;&lt; <span class="number">4</span>),</span><br><span class="line">                r += <span class="string">&#x27;==&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (o = e.charCodeAt(a++), a == c) &#123;</span><br><span class="line">            r += base64EncodeChars.charAt(h &gt;&gt; <span class="number">2</span>),</span><br><span class="line">                r += base64EncodeChars.charAt((<span class="number">3</span> &amp; h) &lt;&lt; <span class="number">4</span> | (<span class="number">240</span> &amp; o) &gt;&gt; <span class="number">4</span>),</span><br><span class="line">                r += base64EncodeChars.charAt((<span class="number">15</span> &amp; o) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">                r += <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        t = e.charCodeAt(a++),</span><br><span class="line">            r += base64EncodeChars.charAt(h &gt;&gt; <span class="number">2</span>),</span><br><span class="line">            r += base64EncodeChars.charAt((<span class="number">3</span> &amp; h) &lt;&lt; <span class="number">4</span> | (<span class="number">240</span> &amp; o) &gt;&gt; <span class="number">4</span>),</span><br><span class="line">            r += base64EncodeChars.charAt((<span class="number">15</span> &amp; o) &lt;&lt; <span class="number">2</span> | (<span class="number">192</span> &amp; t) &gt;&gt; <span class="number">6</span>),</span><br><span class="line">            r += base64EncodeChars.charAt(<span class="number">63</span> &amp; t)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base64ToString</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r, a, c, h, o, t, d;</span><br><span class="line">    <span class="keyword">for</span> (t = e.length, o = <span class="number">0</span>, d = <span class="string">&#x27;&#x27;</span>; o &lt; t;) &#123;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            r = base64DecodeChars[<span class="number">255</span> &amp; e.charCodeAt(o++)];</span><br><span class="line">        <span class="keyword">while</span> (o &lt; t &amp;&amp; r == -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (r == -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            a = base64DecodeChars[<span class="number">255</span> &amp; e.charCodeAt(o++)];</span><br><span class="line">        <span class="keyword">while</span> (o &lt; t &amp;&amp; a == -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (a == -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        d += <span class="built_in">String</span>.fromCharCode(r &lt;&lt; <span class="number">2</span> | (<span class="number">48</span> &amp; a) &gt;&gt; <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (c = <span class="number">255</span> &amp; e.charCodeAt(o++), <span class="number">61</span> == c)</span><br><span class="line">                <span class="keyword">return</span> d;</span><br><span class="line">            c = base64DecodeChars[c]</span><br><span class="line">        &#125; <span class="keyword">while</span> (o &lt; t &amp;&amp; c == -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (c == -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        d += <span class="built_in">String</span>.fromCharCode((<span class="number">15</span> &amp; a) &lt;&lt; <span class="number">4</span> | (<span class="number">60</span> &amp; c) &gt;&gt; <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (h = <span class="number">255</span> &amp; e.charCodeAt(o++), <span class="number">61</span> == h)</span><br><span class="line">                <span class="keyword">return</span> d;</span><br><span class="line">            h = base64DecodeChars[h]</span><br><span class="line">        &#125; <span class="keyword">while</span> (o &lt; t &amp;&amp; h == -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (h == -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        d += <span class="built_in">String</span>.fromCharCode((<span class="number">3</span> &amp; c) &lt;&lt; <span class="number">6</span> | h)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hexToBase64</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> base64Encode(<span class="built_in">String</span>.fromCharCode.apply(<span class="literal">null</span>, str.replace(<span class="regexp">/\r|\n/g</span>, <span class="string">&quot;&quot;</span>).replace(<span class="regexp">/([\da-fA-F]&#123;2&#125;) ?/g</span>, <span class="string">&quot;0x$1 &quot;</span>).replace(<span class="regexp">/ +$/</span>, <span class="string">&quot;&quot;</span>).split(<span class="string">&quot; &quot;</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base64ToHex</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, bin = base64Decode(str.replace(<span class="regexp">/[ \r\n]+$/</span>, <span class="string">&quot;&quot;</span>)), hex = []; i &lt; bin.length; ++i) &#123;</span><br><span class="line">        <span class="keyword">var</span> tmp = bin.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">if</span> (tmp.length === <span class="number">1</span>)</span><br><span class="line">            tmp = <span class="string">&quot;0&quot;</span> + tmp;</span><br><span class="line">        hex[hex.length] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hex.join(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hexToBytes</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> pos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> len = str.length;</span><br><span class="line">    <span class="keyword">if</span> (len % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    len /= <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">var</span> hexA = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> s = str.substr(pos, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">var</span> v = <span class="built_in">parseInt</span>(s, <span class="number">16</span>);</span><br><span class="line">        hexA.push(v);</span><br><span class="line">        pos += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hexA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bytesToHex</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> k, j;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        k = arr[i];</span><br><span class="line">        j = k;</span><br><span class="line">        <span class="keyword">if</span> (k &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            j = k + <span class="number">256</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (j &lt; <span class="number">16</span>) &#123;</span><br><span class="line">            str += <span class="string">&quot;0&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        str += j.toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stringToHex</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (val == <span class="string">&quot;&quot;</span>)</span><br><span class="line">            val = str.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            val += str.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stringToBytes</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ch, st, re = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">        ch = str.charCodeAt(i);</span><br><span class="line">        st = [];</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            st.push(ch &amp; <span class="number">0xFF</span>);</span><br><span class="line">            ch = ch &gt;&gt; <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (ch);</span><br><span class="line">        re = re.concat(st.reverse());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将byte[]转成String的方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bytesToString</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    arr = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(arr);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> arr) &#123;</span><br><span class="line">        str += <span class="built_in">String</span>.fromCharCode(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bytesToBase64</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r, a, c, h, o, t;</span><br><span class="line">    <span class="keyword">for</span> (c = e.length, a = <span class="number">0</span>, r = <span class="string">&#x27;&#x27;</span>; a &lt; c;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (h = <span class="number">255</span> &amp; e[a++], a == c) &#123;</span><br><span class="line">            r += base64EncodeChars.charAt(h &gt;&gt; <span class="number">2</span>),</span><br><span class="line">                r += base64EncodeChars.charAt((<span class="number">3</span> &amp; h) &lt;&lt; <span class="number">4</span>),</span><br><span class="line">                r += <span class="string">&#x27;==&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (o = e[a++], a == c) &#123;</span><br><span class="line">            r += base64EncodeChars.charAt(h &gt;&gt; <span class="number">2</span>),</span><br><span class="line">                r += base64EncodeChars.charAt((<span class="number">3</span> &amp; h) &lt;&lt; <span class="number">4</span> | (<span class="number">240</span> &amp; o) &gt;&gt; <span class="number">4</span>),</span><br><span class="line">                r += base64EncodeChars.charAt((<span class="number">15</span> &amp; o) &lt;&lt; <span class="number">2</span>),</span><br><span class="line">                r += <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        t = e[a++],</span><br><span class="line">            r += base64EncodeChars.charAt(h &gt;&gt; <span class="number">2</span>),</span><br><span class="line">            r += base64EncodeChars.charAt((<span class="number">3</span> &amp; h) &lt;&lt; <span class="number">4</span> | (<span class="number">240</span> &amp; o) &gt;&gt; <span class="number">4</span>),</span><br><span class="line">            r += base64EncodeChars.charAt((<span class="number">15</span> &amp; o) &lt;&lt; <span class="number">2</span> | (<span class="number">192</span> &amp; t) &gt;&gt; <span class="number">6</span>),</span><br><span class="line">            r += base64EncodeChars.charAt(<span class="number">63</span> &amp; t)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base64ToBytes</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r, a, c, h, o, t, d;</span><br><span class="line">    <span class="keyword">for</span> (t = e.length, o = <span class="number">0</span>, d = []; o &lt; t;) &#123;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            r = base64DecodeChars[<span class="number">255</span> &amp; e.charCodeAt(o++)];</span><br><span class="line">        <span class="keyword">while</span> (o &lt; t &amp;&amp; r == -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (r == -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            a = base64DecodeChars[<span class="number">255</span> &amp; e.charCodeAt(o++)];</span><br><span class="line">        <span class="keyword">while</span> (o &lt; t &amp;&amp; a == -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (a == -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        d.push(r &lt;&lt; <span class="number">2</span> | (<span class="number">48</span> &amp; a) &gt;&gt; <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (c = <span class="number">255</span> &amp; e.charCodeAt(o++), <span class="number">61</span> == c)</span><br><span class="line">                <span class="keyword">return</span> d;</span><br><span class="line">            c = base64DecodeChars[c]</span><br><span class="line">        &#125; <span class="keyword">while</span> (o &lt; t &amp;&amp; c == -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (c == -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        d.push((<span class="number">15</span> &amp; a) &lt;&lt; <span class="number">4</span> | (<span class="number">60</span> &amp; c) &gt;&gt; <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (h = <span class="number">255</span> &amp; e.charCodeAt(o++), <span class="number">61</span> == h)</span><br><span class="line">                <span class="keyword">return</span> d;</span><br><span class="line">            h = base64DecodeChars[h]</span><br><span class="line">        &#125; <span class="keyword">while</span> (o &lt; t &amp;&amp; h == -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (h == -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        d.push((<span class="number">3</span> &amp; c) &lt;&lt; <span class="number">6</span> | h)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> frida </category>
          
      </categories>
      
      
        <tags>
            
            <tag> frida </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
